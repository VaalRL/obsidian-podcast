/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Ks=Object.create;var Mt=Object.defineProperty;var Js=Object.getOwnPropertyDescriptor;var Zs=Object.getOwnPropertyNames;var ea=Object.getPrototypeOf,ta=Object.prototype.hasOwnProperty;var R=(u,t)=>()=>(t||u((t={exports:{}}).exports,t),t.exports),ra=(u,t)=>{for(var e in t)Mt(u,e,{get:t[e],enumerable:!0})},Rr=(u,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Zs(t))!ta.call(u,i)&&i!==e&&Mt(u,i,{get:()=>t[i],enumerable:!(r=Js(t,i))||r.enumerable});return u};var kt=(u,t,e)=>(e=u!=null?Ks(ea(u)):{},Rr(t||!u||!u.__esModule?Mt(e,"default",{value:u,enumerable:!0}):e,u)),ia=u=>Rr(Mt({},"__esModule",{value:!0}),u);var Ot=R(hr=>{(function(){hr.defaults={"0.1":{explicitCharkey:!1,trim:!0,normalize:!0,normalizeTags:!1,attrkey:"@",charkey:"#",explicitArray:!1,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!1,validator:null,xmlns:!1,explicitChildren:!1,childkey:"@@",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,emptyTag:""},"0.2":{explicitCharkey:!1,trim:!1,normalize:!1,normalizeTags:!1,attrkey:"$",charkey:"_",explicitArray:!0,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!0,validator:null,xmlns:!1,explicitChildren:!1,preserveChildrenOrder:!1,childkey:"$$",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,rootName:"root",xmldec:{version:"1.0",encoding:"UTF-8",standalone:!0},doctype:null,renderOpts:{pretty:!0,indent:"  ",newline:`
`},headless:!1,chunkSize:1e4,emptyTag:"",cdata:!1}}}).call(hr)});var me=R((Xr,xe)=>{(function(){var u,t,e,r,i,s,o,n=[].slice,l={}.hasOwnProperty;u=function(){var c,p,h,m,d,v;if(v=arguments[0],d=2<=arguments.length?n.call(arguments,1):[],i(Object.assign))Object.assign.apply(null,arguments);else for(c=0,h=d.length;c<h;c++)if(m=d[c],m!=null)for(p in m)l.call(m,p)&&(v[p]=m[p]);return v},i=function(c){return!!c&&Object.prototype.toString.call(c)==="[object Function]"},s=function(c){var p;return!!c&&((p=typeof c)=="function"||p==="object")},e=function(c){return i(Array.isArray)?Array.isArray(c):Object.prototype.toString.call(c)==="[object Array]"},r=function(c){var p;if(e(c))return!c.length;for(p in c)if(l.call(c,p))return!1;return!0},o=function(c){var p,h;return s(c)&&(h=Object.getPrototypeOf(c))&&(p=h.constructor)&&typeof p=="function"&&p instanceof p&&Function.prototype.toString.call(p)===Function.prototype.toString.call(Object)},t=function(c){return i(c.valueOf)?c.valueOf():c},xe.exports.assign=u,xe.exports.isFunction=i,xe.exports.isObject=s,xe.exports.isArray=e,xe.exports.isEmpty=r,xe.exports.isPlainObject=o,xe.exports.getValue=t}).call(Xr)});var gr=R((Wr,zr)=>{(function(){var u;zr.exports=u=function(){function t(){}return t.prototype.hasFeature=function(e,r){return!0},t.prototype.createDocumentType=function(e,r,i){throw new Error("This DOM method is not implemented.")},t.prototype.createDocument=function(e,r,i){throw new Error("This DOM method is not implemented.")},t.prototype.createHTMLDocument=function(e){throw new Error("This DOM method is not implemented.")},t.prototype.getFeature=function(e,r){throw new Error("This DOM method is not implemented.")},t}()}).call(Wr)});var Kr=R((Gr,Yr)=>{(function(){var u;Yr.exports=u=function(){function t(){}return t.prototype.handleError=function(e){throw new Error(e)},t}()}).call(Gr)});var ei=R((Jr,Zr)=>{(function(){var u;Zr.exports=u=function(){function t(e){this.arr=e||[]}return Object.defineProperty(t.prototype,"length",{get:function(){return this.arr.length}}),t.prototype.item=function(e){return this.arr[e]||null},t.prototype.contains=function(e){return this.arr.indexOf(e)!==-1},t}()}).call(Jr)});var ii=R((ti,ri)=>{(function(){var u,t,e;t=Kr(),e=ei(),ri.exports=u=function(){function r(){var i;this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new t,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=i=Object.create(this.defaultParams)}return Object.defineProperty(r.prototype,"parameterNames",{get:function(){return new e(Object.keys(this.defaultParams))}}),r.prototype.getParameter=function(i){return this.params.hasOwnProperty(i)?this.params[i]:null},r.prototype.canSetParameter=function(i,s){return!0},r.prototype.setParameter=function(i,s){return s!=null?this.params[i]=s:delete this.params[i]},r}()}).call(ti)});var G=R((si,ai)=>{(function(){ai.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(si)});var mr=R((oi,ni)=>{(function(){var u,t,e;u=G(),e=oe(),ni.exports=t=function(){function r(i,s,o){if(this.parent=i,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),s==null)throw new Error("Missing attribute name. "+this.debugInfo(s));this.name=this.stringify.name(s),this.value=this.stringify.attValue(o),this.type=u.Attribute,this.isId=!1,this.schemaTypeInfo=null}return Object.defineProperty(r.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(r.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(r.prototype,"textContent",{get:function(){return this.value},set:function(i){return this.value=i||""}}),Object.defineProperty(r.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(r.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(r.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(r.prototype,"specified",{get:function(){return!0}}),r.prototype.clone=function(){return Object.create(this)},r.prototype.toString=function(i){return this.options.writer.attribute(this,this.options.writer.filterOptions(i))},r.prototype.debugInfo=function(i){return i=i||this.name,i==null?"parent: <"+this.parent.name+">":"attribute: {"+i+"}, parent: <"+this.parent.name+">"},r.prototype.isEqualNode=function(i){return!(i.namespaceURI!==this.namespaceURI||i.prefix!==this.prefix||i.localName!==this.localName||i.value!==this.value)},r}()}).call(oi)});var Rt=R((li,ci)=>{(function(){var u;ci.exports=u=function(){function t(e){this.nodes=e}return Object.defineProperty(t.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),t.prototype.clone=function(){return this.nodes=null},t.prototype.getNamedItem=function(e){return this.nodes[e]},t.prototype.setNamedItem=function(e){var r;return r=this.nodes[e.nodeName],this.nodes[e.nodeName]=e,r||null},t.prototype.removeNamedItem=function(e){var r;return r=this.nodes[e],delete this.nodes[e],r||null},t.prototype.item=function(e){return this.nodes[Object.keys(this.nodes)[e]]||null},t.prototype.getNamedItemNS=function(e,r){throw new Error("This DOM method is not implemented.")},t.prototype.setNamedItemNS=function(e){throw new Error("This DOM method is not implemented.")},t.prototype.removeNamedItemNS=function(e,r){throw new Error("This DOM method is not implemented.")},t}()}).call(li)});var Qt=R((di,ui)=>{(function(){var u,t,e,r,i,s,o,n,l,c=function(h,m){for(var d in m)p.call(m,d)&&(h[d]=m[d]);function v(){this.constructor=h}return v.prototype=m.prototype,h.prototype=new v,h.__super__=m.prototype,h},p={}.hasOwnProperty;l=me(),n=l.isObject,o=l.isFunction,s=l.getValue,i=oe(),u=G(),t=mr(),r=Rt(),ui.exports=e=function(h){c(m,h);function m(d,v,D){var I,T,F,w;if(m.__super__.constructor.call(this,d),v==null)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(v),this.type=u.Element,this.attribs={},this.schemaTypeInfo=null,D!=null&&this.attribute(D),d.type===u.Document&&(this.isRoot=!0,this.documentObject=d,d.rootObject=this,d.children)){for(w=d.children,T=0,F=w.length;T<F;T++)if(I=w[T],I.type===u.DocType){I.name=this.name;break}}}return Object.defineProperty(m.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(m.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(m.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(m.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(m.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(m.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(m.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(m.prototype,"attributes",{get:function(){return(!this.attributeMap||!this.attributeMap.nodes)&&(this.attributeMap=new r(this.attribs)),this.attributeMap}}),m.prototype.clone=function(){var d,v,D,I;D=Object.create(this),D.isRoot&&(D.documentObject=null),D.attribs={},I=this.attribs;for(v in I)p.call(I,v)&&(d=I[v],D.attribs[v]=d.clone());return D.children=[],this.children.forEach(function(T){var F;return F=T.clone(),F.parent=D,D.children.push(F)}),D},m.prototype.attribute=function(d,v){var D,I;if(d!=null&&(d=s(d)),n(d))for(D in d)p.call(d,D)&&(I=d[D],this.attribute(D,I));else o(v)&&(v=v.apply()),this.options.keepNullAttributes&&v==null?this.attribs[d]=new t(this,d,""):v!=null&&(this.attribs[d]=new t(this,d,v));return this},m.prototype.removeAttribute=function(d){var v,D,I;if(d==null)throw new Error("Missing attribute name. "+this.debugInfo());if(d=s(d),Array.isArray(d))for(D=0,I=d.length;D<I;D++)v=d[D],delete this.attribs[v];else delete this.attribs[d];return this},m.prototype.toString=function(d){return this.options.writer.element(this,this.options.writer.filterOptions(d))},m.prototype.att=function(d,v){return this.attribute(d,v)},m.prototype.a=function(d,v){return this.attribute(d,v)},m.prototype.getAttribute=function(d){return this.attribs.hasOwnProperty(d)?this.attribs[d].value:null},m.prototype.setAttribute=function(d,v){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.getAttributeNode=function(d){return this.attribs.hasOwnProperty(d)?this.attribs[d]:null},m.prototype.setAttributeNode=function(d){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.removeAttributeNode=function(d){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.getElementsByTagName=function(d){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.getAttributeNS=function(d,v){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.setAttributeNS=function(d,v,D){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.removeAttributeNS=function(d,v){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.getAttributeNodeNS=function(d,v){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.setAttributeNodeNS=function(d){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.getElementsByTagNameNS=function(d,v){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.hasAttribute=function(d){return this.attribs.hasOwnProperty(d)},m.prototype.hasAttributeNS=function(d,v){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.setIdAttribute=function(d,v){return this.attribs.hasOwnProperty(d)?this.attribs[d].isId:v},m.prototype.setIdAttributeNS=function(d,v,D){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.setIdAttributeNode=function(d,v){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.getElementsByTagName=function(d){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.getElementsByTagNameNS=function(d,v){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.getElementsByClassName=function(d){throw new Error("This DOM method is not implemented."+this.debugInfo())},m.prototype.isEqualNode=function(d){var v,D,I;if(!m.__super__.isEqualNode.apply(this,arguments).isEqualNode(d)||d.namespaceURI!==this.namespaceURI||d.prefix!==this.prefix||d.localName!==this.localName||d.attribs.length!==this.attribs.length)return!1;for(v=D=0,I=this.attribs.length-1;0<=I?D<=I:D>=I;v=0<=I?++D:--D)if(!this.attribs[v].isEqualNode(d.attribs[v]))return!1;return!0},m}(i)}).call(di)});var ft=R((pi,hi)=>{(function(){var u,t,e=function(i,s){for(var o in s)r.call(s,o)&&(i[o]=s[o]);function n(){this.constructor=i}return n.prototype=s.prototype,i.prototype=new n,i.__super__=s.prototype,i},r={}.hasOwnProperty;t=oe(),hi.exports=u=function(i){e(s,i);function s(o){s.__super__.constructor.call(this,o),this.value=""}return Object.defineProperty(s.prototype,"data",{get:function(){return this.value},set:function(o){return this.value=o||""}}),Object.defineProperty(s.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(s.prototype,"textContent",{get:function(){return this.value},set:function(o){return this.value=o||""}}),s.prototype.clone=function(){return Object.create(this)},s.prototype.substringData=function(o,n){throw new Error("This DOM method is not implemented."+this.debugInfo())},s.prototype.appendData=function(o){throw new Error("This DOM method is not implemented."+this.debugInfo())},s.prototype.insertData=function(o,n){throw new Error("This DOM method is not implemented."+this.debugInfo())},s.prototype.deleteData=function(o,n){throw new Error("This DOM method is not implemented."+this.debugInfo())},s.prototype.replaceData=function(o,n,l){throw new Error("This DOM method is not implemented."+this.debugInfo())},s.prototype.isEqualNode=function(o){return!(!s.__super__.isEqualNode.apply(this,arguments).isEqualNode(o)||o.data!==this.data)},s}(t)}).call(pi)});var Bt=R((gi,mi)=>{(function(){var u,t,e,r=function(s,o){for(var n in o)i.call(o,n)&&(s[n]=o[n]);function l(){this.constructor=s}return l.prototype=o.prototype,s.prototype=new l,s.__super__=o.prototype,s},i={}.hasOwnProperty;u=G(),e=ft(),mi.exports=t=function(s){r(o,s);function o(n,l){if(o.__super__.constructor.call(this,n),l==null)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=u.CData,this.value=this.stringify.cdata(l)}return o.prototype.clone=function(){return Object.create(this)},o.prototype.toString=function(n){return this.options.writer.cdata(this,this.options.writer.filterOptions(n))},o}(e)}).call(gi)});var $t=R((fi,yi)=>{(function(){var u,t,e,r=function(s,o){for(var n in o)i.call(o,n)&&(s[n]=o[n]);function l(){this.constructor=s}return l.prototype=o.prototype,s.prototype=new l,s.__super__=o.prototype,s},i={}.hasOwnProperty;u=G(),t=ft(),yi.exports=e=function(s){r(o,s);function o(n,l){if(o.__super__.constructor.call(this,n),l==null)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=u.Comment,this.value=this.stringify.comment(l)}return o.prototype.clone=function(){return Object.create(this)},o.prototype.toString=function(n){return this.options.writer.comment(this,this.options.writer.filterOptions(n))},o}(t)}).call(fi)});var _t=R((vi,Pi)=>{(function(){var u,t,e,r,i=function(o,n){for(var l in n)s.call(n,l)&&(o[l]=n[l]);function c(){this.constructor=o}return c.prototype=n.prototype,o.prototype=new c,o.__super__=n.prototype,o},s={}.hasOwnProperty;r=me().isObject,e=oe(),u=G(),Pi.exports=t=function(o){i(n,o);function n(l,c,p,h){var m;n.__super__.constructor.call(this,l),r(c)&&(m=c,c=m.version,p=m.encoding,h=m.standalone),c||(c="1.0"),this.type=u.Declaration,this.version=this.stringify.xmlVersion(c),p!=null&&(this.encoding=this.stringify.xmlEncoding(p)),h!=null&&(this.standalone=this.stringify.xmlStandalone(h))}return n.prototype.toString=function(l){return this.options.writer.declaration(this,this.options.writer.filterOptions(l))},n}(e)}).call(vi)});var Ut=R((bi,Ei)=>{(function(){var u,t,e,r=function(s,o){for(var n in o)i.call(o,n)&&(s[n]=o[n]);function l(){this.constructor=s}return l.prototype=o.prototype,s.prototype=new l,s.__super__=o.prototype,s},i={}.hasOwnProperty;e=oe(),u=G(),Ei.exports=t=function(s){r(o,s);function o(n,l,c,p,h,m){if(o.__super__.constructor.call(this,n),l==null)throw new Error("Missing DTD element name. "+this.debugInfo());if(c==null)throw new Error("Missing DTD attribute name. "+this.debugInfo(l));if(!p)throw new Error("Missing DTD attribute type. "+this.debugInfo(l));if(!h)throw new Error("Missing DTD attribute default. "+this.debugInfo(l));if(h.indexOf("#")!==0&&(h="#"+h),!h.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(l));if(m&&!h.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(l));this.elementName=this.stringify.name(l),this.type=u.AttributeDeclaration,this.attributeName=this.stringify.name(c),this.attributeType=this.stringify.dtdAttType(p),m&&(this.defaultValue=this.stringify.dtdAttDefault(m)),this.defaultValueType=h}return o.prototype.toString=function(n){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(n))},o}(e)}).call(bi)});var Vt=R((wi,Si)=>{(function(){var u,t,e,r,i=function(o,n){for(var l in n)s.call(n,l)&&(o[l]=n[l]);function c(){this.constructor=o}return c.prototype=n.prototype,o.prototype=new c,o.__super__=n.prototype,o},s={}.hasOwnProperty;r=me().isObject,e=oe(),u=G(),Si.exports=t=function(o){i(n,o);function n(l,c,p,h){if(n.__super__.constructor.call(this,l),p==null)throw new Error("Missing DTD entity name. "+this.debugInfo(p));if(h==null)throw new Error("Missing DTD entity value. "+this.debugInfo(p));if(this.pe=!!c,this.name=this.stringify.name(p),this.type=u.EntityDeclaration,!r(h))this.value=this.stringify.dtdEntityValue(h),this.internal=!0;else{if(!h.pubID&&!h.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(p));if(h.pubID&&!h.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(p));if(this.internal=!1,h.pubID!=null&&(this.pubID=this.stringify.dtdPubID(h.pubID)),h.sysID!=null&&(this.sysID=this.stringify.dtdSysID(h.sysID)),h.nData!=null&&(this.nData=this.stringify.dtdNData(h.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(p))}}return Object.defineProperty(n.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(n.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(n.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(n.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(n.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(n.prototype,"xmlVersion",{get:function(){return null}}),n.prototype.toString=function(l){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions(l))},n}(e)}).call(wi)});var jt=R((Di,Ti)=>{(function(){var u,t,e,r=function(s,o){for(var n in o)i.call(o,n)&&(s[n]=o[n]);function l(){this.constructor=s}return l.prototype=o.prototype,s.prototype=new l,s.__super__=o.prototype,s},i={}.hasOwnProperty;e=oe(),u=G(),Ti.exports=t=function(s){r(o,s);function o(n,l,c){if(o.__super__.constructor.call(this,n),l==null)throw new Error("Missing DTD element name. "+this.debugInfo());c||(c="(#PCDATA)"),Array.isArray(c)&&(c="("+c.join(",")+")"),this.name=this.stringify.name(l),this.type=u.ElementDeclaration,this.value=this.stringify.dtdElementValue(c)}return o.prototype.toString=function(n){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(n))},o}(e)}).call(Di)});var Ht=R((xi,Ci)=>{(function(){var u,t,e,r=function(s,o){for(var n in o)i.call(o,n)&&(s[n]=o[n]);function l(){this.constructor=s}return l.prototype=o.prototype,s.prototype=new l,s.__super__=o.prototype,s},i={}.hasOwnProperty;e=oe(),u=G(),Ci.exports=t=function(s){r(o,s);function o(n,l,c){if(o.__super__.constructor.call(this,n),l==null)throw new Error("Missing DTD notation name. "+this.debugInfo(l));if(!c.pubID&&!c.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo(l));this.name=this.stringify.name(l),this.type=u.NotationDeclaration,c.pubID!=null&&(this.pubID=this.stringify.dtdPubID(c.pubID)),c.sysID!=null&&(this.sysID=this.stringify.dtdSysID(c.sysID))}return Object.defineProperty(o.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(o.prototype,"systemId",{get:function(){return this.sysID}}),o.prototype.toString=function(n){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(n))},o}(e)}).call(xi)});var Xt=R((Ii,Mi)=>{(function(){var u,t,e,r,i,s,o,n,l,c=function(h,m){for(var d in m)p.call(m,d)&&(h[d]=m[d]);function v(){this.constructor=h}return v.prototype=m.prototype,h.prototype=new v,h.__super__=m.prototype,h},p={}.hasOwnProperty;l=me().isObject,n=oe(),u=G(),t=Ut(),r=Vt(),e=jt(),i=Ht(),o=Rt(),Mi.exports=s=function(h){c(m,h);function m(d,v,D){var I,T,F,w,y,g;if(m.__super__.constructor.call(this,d),this.type=u.DocType,d.children){for(w=d.children,T=0,F=w.length;T<F;T++)if(I=w[T],I.type===u.Element){this.name=I.name;break}}this.documentObject=d,l(v)&&(y=v,v=y.pubID,D=y.sysID),D==null&&(g=[v,D],D=g[0],v=g[1]),v!=null&&(this.pubID=this.stringify.dtdPubID(v)),D!=null&&(this.sysID=this.stringify.dtdSysID(D))}return Object.defineProperty(m.prototype,"entities",{get:function(){var d,v,D,I,T;for(I={},T=this.children,v=0,D=T.length;v<D;v++)d=T[v],d.type===u.EntityDeclaration&&!d.pe&&(I[d.name]=d);return new o(I)}}),Object.defineProperty(m.prototype,"notations",{get:function(){var d,v,D,I,T;for(I={},T=this.children,v=0,D=T.length;v<D;v++)d=T[v],d.type===u.NotationDeclaration&&(I[d.name]=d);return new o(I)}}),Object.defineProperty(m.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(m.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(m.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),m.prototype.element=function(d,v){var D;return D=new e(this,d,v),this.children.push(D),this},m.prototype.attList=function(d,v,D,I,T){var F;return F=new t(this,d,v,D,I,T),this.children.push(F),this},m.prototype.entity=function(d,v){var D;return D=new r(this,!1,d,v),this.children.push(D),this},m.prototype.pEntity=function(d,v){var D;return D=new r(this,!0,d,v),this.children.push(D),this},m.prototype.notation=function(d,v){var D;return D=new i(this,d,v),this.children.push(D),this},m.prototype.toString=function(d){return this.options.writer.docType(this,this.options.writer.filterOptions(d))},m.prototype.ele=function(d,v){return this.element(d,v)},m.prototype.att=function(d,v,D,I,T){return this.attList(d,v,D,I,T)},m.prototype.ent=function(d,v){return this.entity(d,v)},m.prototype.pent=function(d,v){return this.pEntity(d,v)},m.prototype.not=function(d,v){return this.notation(d,v)},m.prototype.up=function(){return this.root()||this.documentObject},m.prototype.isEqualNode=function(d){return!(!m.__super__.isEqualNode.apply(this,arguments).isEqualNode(d)||d.name!==this.name||d.publicId!==this.publicId||d.systemId!==this.systemId)},m}(n)}).call(Ii)});var Wt=R((ki,Ai)=>{(function(){var u,t,e,r=function(s,o){for(var n in o)i.call(o,n)&&(s[n]=o[n]);function l(){this.constructor=s}return l.prototype=o.prototype,s.prototype=new l,s.__super__=o.prototype,s},i={}.hasOwnProperty;u=G(),t=oe(),Ai.exports=e=function(s){r(o,s);function o(n,l){if(o.__super__.constructor.call(this,n),l==null)throw new Error("Missing raw text. "+this.debugInfo());this.type=u.Raw,this.value=this.stringify.raw(l)}return o.prototype.clone=function(){return Object.create(this)},o.prototype.toString=function(n){return this.options.writer.raw(this,this.options.writer.filterOptions(n))},o}(t)}).call(ki)});var zt=R((Li,Fi)=>{(function(){var u,t,e,r=function(s,o){for(var n in o)i.call(o,n)&&(s[n]=o[n]);function l(){this.constructor=s}return l.prototype=o.prototype,s.prototype=new l,s.__super__=o.prototype,s},i={}.hasOwnProperty;u=G(),t=ft(),Fi.exports=e=function(s){r(o,s);function o(n,l){if(o.__super__.constructor.call(this,n),l==null)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=u.Text,this.value=this.stringify.text(l)}return Object.defineProperty(o.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(o.prototype,"wholeText",{get:function(){var n,l,c;for(c="",l=this.previousSibling;l;)c=l.data+c,l=l.previousSibling;for(c+=this.data,n=this.nextSibling;n;)c=c+n.data,n=n.nextSibling;return c}}),o.prototype.clone=function(){return Object.create(this)},o.prototype.toString=function(n){return this.options.writer.text(this,this.options.writer.filterOptions(n))},o.prototype.splitText=function(n){throw new Error("This DOM method is not implemented."+this.debugInfo())},o.prototype.replaceWholeText=function(n){throw new Error("This DOM method is not implemented."+this.debugInfo())},o}(t)}).call(Li)});var Gt=R((Ni,qi)=>{(function(){var u,t,e,r=function(s,o){for(var n in o)i.call(o,n)&&(s[n]=o[n]);function l(){this.constructor=s}return l.prototype=o.prototype,s.prototype=new l,s.__super__=o.prototype,s},i={}.hasOwnProperty;u=G(),t=ft(),qi.exports=e=function(s){r(o,s);function o(n,l,c){if(o.__super__.constructor.call(this,n),l==null)throw new Error("Missing instruction target. "+this.debugInfo());this.type=u.ProcessingInstruction,this.target=this.stringify.insTarget(l),this.name=this.target,c&&(this.value=this.stringify.insValue(c))}return o.prototype.clone=function(){return Object.create(this)},o.prototype.toString=function(n){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(n))},o.prototype.isEqualNode=function(n){return!(!o.__super__.isEqualNode.apply(this,arguments).isEqualNode(n)||n.target!==this.target)},o}(t)}).call(Ni)});var fr=R((Oi,Ri)=>{(function(){var u,t,e,r=function(s,o){for(var n in o)i.call(o,n)&&(s[n]=o[n]);function l(){this.constructor=s}return l.prototype=o.prototype,s.prototype=new l,s.__super__=o.prototype,s},i={}.hasOwnProperty;e=oe(),u=G(),Ri.exports=t=function(s){r(o,s);function o(n){o.__super__.constructor.call(this,n),this.type=u.Dummy}return o.prototype.clone=function(){return Object.create(this)},o.prototype.toString=function(n){return""},o}(e)}).call(Oi)});var $i=R((Qi,Bi)=>{(function(){var u;Bi.exports=u=function(){function t(e){this.nodes=e}return Object.defineProperty(t.prototype,"length",{get:function(){return this.nodes.length||0}}),t.prototype.clone=function(){return this.nodes=null},t.prototype.item=function(e){return this.nodes[e]||null},t}()}).call(Qi)});var Vi=R((_i,Ui)=>{(function(){Ui.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(_i)});var oe=R((ji,Hi)=>{(function(){var u,t,e,r,i,s,o,n,l,c,p,h,m,d,v,D,I,T,F,w={}.hasOwnProperty;F=me(),T=F.isObject,I=F.isFunction,D=F.isEmpty,v=F.getValue,n=null,e=null,r=null,i=null,s=null,m=null,d=null,h=null,o=null,t=null,p=null,l=null,u=null,Hi.exports=c=function(){function y(g){this.parent=g,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,n||(n=Qt(),e=Bt(),r=$t(),i=_t(),s=Xt(),m=Wt(),d=zt(),h=Gt(),o=fr(),t=G(),p=$i(),l=Rt(),u=Vi())}return Object.defineProperty(y.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(y.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(y.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(y.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(y.prototype,"childNodes",{get:function(){return(!this.childNodeList||!this.childNodeList.nodes)&&(this.childNodeList=new p(this.children)),this.childNodeList}}),Object.defineProperty(y.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(y.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(y.prototype,"previousSibling",{get:function(){var g;return g=this.parent.children.indexOf(this),this.parent.children[g-1]||null}}),Object.defineProperty(y.prototype,"nextSibling",{get:function(){var g;return g=this.parent.children.indexOf(this),this.parent.children[g+1]||null}}),Object.defineProperty(y.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(y.prototype,"textContent",{get:function(){var g,E,x,b,k;if(this.nodeType===t.Element||this.nodeType===t.DocumentFragment){for(k="",b=this.children,E=0,x=b.length;E<x;E++)g=b[E],g.textContent&&(k+=g.textContent);return k}else return null},set:function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),y.prototype.setParent=function(g){var E,x,b,k,S;for(this.parent=g,g&&(this.options=g.options,this.stringify=g.stringify),k=this.children,S=[],x=0,b=k.length;x<b;x++)E=k[x],S.push(E.setParent(this));return S},y.prototype.element=function(g,E,x){var b,k,S,M,L,q,B,V,O,Y,U;if(q=null,E===null&&x==null&&(O=[{},null],E=O[0],x=O[1]),E==null&&(E={}),E=v(E),T(E)||(Y=[E,x],x=Y[0],E=Y[1]),g!=null&&(g=v(g)),Array.isArray(g))for(S=0,B=g.length;S<B;S++)k=g[S],q=this.element(k);else if(I(g))q=this.element(g.apply());else if(T(g)){for(L in g)if(w.call(g,L))if(U=g[L],I(U)&&(U=U.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&L.indexOf(this.stringify.convertAttKey)===0)q=this.attribute(L.substr(this.stringify.convertAttKey.length),U);else if(!this.options.separateArrayItems&&Array.isArray(U)&&D(U))q=this.dummy();else if(T(U)&&D(U))q=this.element(L);else if(!this.options.keepNullNodes&&U==null)q=this.dummy();else if(!this.options.separateArrayItems&&Array.isArray(U))for(M=0,V=U.length;M<V;M++)k=U[M],b={},b[L]=k,q=this.element(b);else T(U)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&L.indexOf(this.stringify.convertTextKey)===0?q=this.element(U):(q=this.element(L),q.element(U)):q=this.element(L,U)}else!this.options.keepNullNodes&&x===null?q=this.dummy():!this.options.ignoreDecorators&&this.stringify.convertTextKey&&g.indexOf(this.stringify.convertTextKey)===0?q=this.text(x):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&g.indexOf(this.stringify.convertCDataKey)===0?q=this.cdata(x):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&g.indexOf(this.stringify.convertCommentKey)===0?q=this.comment(x):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&g.indexOf(this.stringify.convertRawKey)===0?q=this.raw(x):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&g.indexOf(this.stringify.convertPIKey)===0?q=this.instruction(g.substr(this.stringify.convertPIKey.length),x):q=this.node(g,E,x);if(q==null)throw new Error("Could not create any elements with: "+g+". "+this.debugInfo());return q},y.prototype.insertBefore=function(g,E,x){var b,k,S,M,L;if(g!=null&&g.type)return S=g,M=E,S.setParent(this),M?(k=children.indexOf(M),L=children.splice(k),children.push(S),Array.prototype.push.apply(children,L)):children.push(S),S;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(g));return k=this.parent.children.indexOf(this),L=this.parent.children.splice(k),b=this.parent.element(g,E,x),Array.prototype.push.apply(this.parent.children,L),b},y.prototype.insertAfter=function(g,E,x){var b,k,S;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(g));return k=this.parent.children.indexOf(this),S=this.parent.children.splice(k+1),b=this.parent.element(g,E,x),Array.prototype.push.apply(this.parent.children,S),b},y.prototype.remove=function(){var g,E;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return g=this.parent.children.indexOf(this),[].splice.apply(this.parent.children,[g,g-g+1].concat(E=[])),this.parent},y.prototype.node=function(g,E,x){var b,k;return g!=null&&(g=v(g)),E||(E={}),E=v(E),T(E)||(k=[E,x],x=k[0],E=k[1]),b=new n(this,g,E),x!=null&&b.text(x),this.children.push(b),b},y.prototype.text=function(g){var E;return T(g)&&this.element(g),E=new d(this,g),this.children.push(E),this},y.prototype.cdata=function(g){var E;return E=new e(this,g),this.children.push(E),this},y.prototype.comment=function(g){var E;return E=new r(this,g),this.children.push(E),this},y.prototype.commentBefore=function(g){var E,x,b;return x=this.parent.children.indexOf(this),b=this.parent.children.splice(x),E=this.parent.comment(g),Array.prototype.push.apply(this.parent.children,b),this},y.prototype.commentAfter=function(g){var E,x,b;return x=this.parent.children.indexOf(this),b=this.parent.children.splice(x+1),E=this.parent.comment(g),Array.prototype.push.apply(this.parent.children,b),this},y.prototype.raw=function(g){var E;return E=new m(this,g),this.children.push(E),this},y.prototype.dummy=function(){var g;return g=new o(this),g},y.prototype.instruction=function(g,E){var x,b,k,S,M;if(g!=null&&(g=v(g)),E!=null&&(E=v(E)),Array.isArray(g))for(S=0,M=g.length;S<M;S++)x=g[S],this.instruction(x);else if(T(g))for(x in g)w.call(g,x)&&(b=g[x],this.instruction(x,b));else I(E)&&(E=E.apply()),k=new h(this,g,E),this.children.push(k);return this},y.prototype.instructionBefore=function(g,E){var x,b,k;return b=this.parent.children.indexOf(this),k=this.parent.children.splice(b),x=this.parent.instruction(g,E),Array.prototype.push.apply(this.parent.children,k),this},y.prototype.instructionAfter=function(g,E){var x,b,k;return b=this.parent.children.indexOf(this),k=this.parent.children.splice(b+1),x=this.parent.instruction(g,E),Array.prototype.push.apply(this.parent.children,k),this},y.prototype.declaration=function(g,E,x){var b,k;return b=this.document(),k=new i(b,g,E,x),b.children.length===0?b.children.unshift(k):b.children[0].type===t.Declaration?b.children[0]=k:b.children.unshift(k),b.root()||b},y.prototype.dtd=function(g,E){var x,b,k,S,M,L,q,B,V,O;for(b=this.document(),k=new s(b,g,E),V=b.children,S=M=0,q=V.length;M<q;S=++M)if(x=V[S],x.type===t.DocType)return b.children[S]=k,k;for(O=b.children,S=L=0,B=O.length;L<B;S=++L)if(x=O[S],x.isRoot)return b.children.splice(S,0,k),k;return b.children.push(k),k},y.prototype.up=function(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent},y.prototype.root=function(){var g;for(g=this;g;){if(g.type===t.Document)return g.rootObject;if(g.isRoot)return g;g=g.parent}},y.prototype.document=function(){var g;for(g=this;g;){if(g.type===t.Document)return g;g=g.parent}},y.prototype.end=function(g){return this.document().end(g)},y.prototype.prev=function(){var g;if(g=this.parent.children.indexOf(this),g<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[g-1]},y.prototype.next=function(){var g;if(g=this.parent.children.indexOf(this),g===-1||g===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[g+1]},y.prototype.importDocument=function(g){var E;return E=g.root().clone(),E.parent=this,E.isRoot=!1,this.children.push(E),this},y.prototype.debugInfo=function(g){var E,x;return g=g||this.name,g==null&&!((E=this.parent)!=null&&E.name)?"":g==null?"parent: <"+this.parent.name+">":(x=this.parent)!=null&&x.name?"node: <"+g+">, parent: <"+this.parent.name+">":"node: <"+g+">"},y.prototype.ele=function(g,E,x){return this.element(g,E,x)},y.prototype.nod=function(g,E,x){return this.node(g,E,x)},y.prototype.txt=function(g){return this.text(g)},y.prototype.dat=function(g){return this.cdata(g)},y.prototype.com=function(g){return this.comment(g)},y.prototype.ins=function(g,E){return this.instruction(g,E)},y.prototype.doc=function(){return this.document()},y.prototype.dec=function(g,E,x){return this.declaration(g,E,x)},y.prototype.e=function(g,E,x){return this.element(g,E,x)},y.prototype.n=function(g,E,x){return this.node(g,E,x)},y.prototype.t=function(g){return this.text(g)},y.prototype.d=function(g){return this.cdata(g)},y.prototype.c=function(g){return this.comment(g)},y.prototype.r=function(g){return this.raw(g)},y.prototype.i=function(g,E){return this.instruction(g,E)},y.prototype.u=function(){return this.up()},y.prototype.importXMLBuilder=function(g){return this.importDocument(g)},y.prototype.replaceChild=function(g,E){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.removeChild=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.appendChild=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.hasChildNodes=function(){return this.children.length!==0},y.prototype.cloneNode=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.normalize=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.isSupported=function(g,E){return!0},y.prototype.hasAttributes=function(){return this.attribs.length!==0},y.prototype.compareDocumentPosition=function(g){var E,x;return E=this,E===g?0:this.document()!==g.document()?(x=u.Disconnected|u.ImplementationSpecific,Math.random()<.5?x|=u.Preceding:x|=u.Following,x):E.isAncestor(g)?u.Contains|u.Preceding:E.isDescendant(g)?u.Contains|u.Following:E.isPreceding(g)?u.Preceding:u.Following},y.prototype.isSameNode=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.lookupPrefix=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.isDefaultNamespace=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.lookupNamespaceURI=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.isEqualNode=function(g){var E,x,b;if(g.nodeType!==this.nodeType||g.children.length!==this.children.length)return!1;for(E=x=0,b=this.children.length-1;0<=b?x<=b:x>=b;E=0<=b?++x:--x)if(!this.children[E].isEqualNode(g.children[E]))return!1;return!0},y.prototype.getFeature=function(g,E){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.setUserData=function(g,E,x){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.getUserData=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.contains=function(g){return g?g===this||this.isDescendant(g):!1},y.prototype.isDescendant=function(g){var E,x,b,k,S;for(S=this.children,b=0,k=S.length;b<k;b++)if(E=S[b],g===E||(x=E.isDescendant(g),x))return!0;return!1},y.prototype.isAncestor=function(g){return g.isDescendant(this)},y.prototype.isPreceding=function(g){var E,x;return E=this.treePosition(g),x=this.treePosition(this),E===-1||x===-1?!1:E<x},y.prototype.isFollowing=function(g){var E,x;return E=this.treePosition(g),x=this.treePosition(this),E===-1||x===-1?!1:E>x},y.prototype.treePosition=function(g){var E,x;return x=0,E=!1,this.foreachTreeNode(this.document(),function(b){if(x++,!E&&b===g)return E=!0}),E?x:-1},y.prototype.foreachTreeNode=function(g,E){var x,b,k,S,M;for(g||(g=this.document()),S=g.children,b=0,k=S.length;b<k;b++){if(x=S[b],M=E(x))return M;if(M=this.foreachTreeNode(x,E),M)return M}},y}()}).call(ji)});var yr=R((Xi,Wi)=>{(function(){var u,t=function(r,i){return function(){return r.apply(i,arguments)}},e={}.hasOwnProperty;Wi.exports=u=function(){function r(i){this.assertLegalName=t(this.assertLegalName,this),this.assertLegalChar=t(this.assertLegalChar,this);var s,o,n;i||(i={}),this.options=i,this.options.version||(this.options.version="1.0"),o=i.stringify||{};for(s in o)e.call(o,s)&&(n=o[s],this[s]=n)}return r.prototype.name=function(i){return this.options.noValidation?i:this.assertLegalName(""+i||"")},r.prototype.text=function(i){return this.options.noValidation?i:this.assertLegalChar(this.textEscape(""+i||""))},r.prototype.cdata=function(i){return this.options.noValidation?i:(i=""+i||"",i=i.replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(i))},r.prototype.comment=function(i){if(this.options.noValidation)return i;if(i=""+i||"",i.match(/--/))throw new Error("Comment text cannot contain double-hypen: "+i);return this.assertLegalChar(i)},r.prototype.raw=function(i){return this.options.noValidation?i:""+i||""},r.prototype.attValue=function(i){return this.options.noValidation?i:this.assertLegalChar(this.attEscape(i=""+i||""))},r.prototype.insTarget=function(i){return this.options.noValidation?i:this.assertLegalChar(""+i||"")},r.prototype.insValue=function(i){if(this.options.noValidation)return i;if(i=""+i||"",i.match(/\?>/))throw new Error("Invalid processing instruction value: "+i);return this.assertLegalChar(i)},r.prototype.xmlVersion=function(i){if(this.options.noValidation)return i;if(i=""+i||"",!i.match(/1\.[0-9]+/))throw new Error("Invalid version number: "+i);return i},r.prototype.xmlEncoding=function(i){if(this.options.noValidation)return i;if(i=""+i||"",!i.match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+i);return this.assertLegalChar(i)},r.prototype.xmlStandalone=function(i){return this.options.noValidation?i:i?"yes":"no"},r.prototype.dtdPubID=function(i){return this.options.noValidation?i:this.assertLegalChar(""+i||"")},r.prototype.dtdSysID=function(i){return this.options.noValidation?i:this.assertLegalChar(""+i||"")},r.prototype.dtdElementValue=function(i){return this.options.noValidation?i:this.assertLegalChar(""+i||"")},r.prototype.dtdAttType=function(i){return this.options.noValidation?i:this.assertLegalChar(""+i||"")},r.prototype.dtdAttDefault=function(i){return this.options.noValidation?i:this.assertLegalChar(""+i||"")},r.prototype.dtdEntityValue=function(i){return this.options.noValidation?i:this.assertLegalChar(""+i||"")},r.prototype.dtdNData=function(i){return this.options.noValidation?i:this.assertLegalChar(""+i||"")},r.prototype.convertAttKey="@",r.prototype.convertPIKey="?",r.prototype.convertTextKey="#text",r.prototype.convertCDataKey="#cdata",r.prototype.convertCommentKey="#comment",r.prototype.convertRawKey="#raw",r.prototype.assertLegalChar=function(i){var s,o;if(this.options.noValidation)return i;if(s="",this.options.version==="1.0"){if(s=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,o=i.match(s))throw new Error("Invalid character in string: "+i+" at index "+o.index)}else if(this.options.version==="1.1"&&(s=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,o=i.match(s)))throw new Error("Invalid character in string: "+i+" at index "+o.index);return i},r.prototype.assertLegalName=function(i){var s;if(this.options.noValidation)return i;if(this.assertLegalChar(i),s=/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/,!i.match(s))throw new Error("Invalid character in name");return i},r.prototype.textEscape=function(i){var s;return this.options.noValidation?i:(s=this.options.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,i.replace(s,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;"))},r.prototype.attEscape=function(i){var s;return this.options.noValidation?i:(s=this.options.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,i.replace(s,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;"))},r}()}).call(Xi)});var yt=R((zi,Gi)=>{(function(){Gi.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(zi)});var vr=R((Yi,Ki)=>{(function(){var u,t,e,r,i,s,o,n,l,c,p,h,m,d,v,D,I,T={}.hasOwnProperty;I=me().assign,u=G(),l=_t(),c=Xt(),e=Bt(),r=$t(),h=Qt(),d=Wt(),v=zt(),m=Gt(),p=fr(),i=Ut(),s=jt(),o=Vt(),n=Ht(),t=yt(),Ki.exports=D=function(){function F(w){var y,g,E;w||(w={}),this.options=w,g=w.writer||{};for(y in g)T.call(g,y)&&(E=g[y],this["_"+y]=this[y],this[y]=E)}return F.prototype.filterOptions=function(w){var y,g,E,x,b,k,S,M;return w||(w={}),w=I({},this.options,w),y={writer:this},y.pretty=w.pretty||!1,y.allowEmpty=w.allowEmpty||!1,y.indent=(g=w.indent)!=null?g:"  ",y.newline=(E=w.newline)!=null?E:`
`,y.offset=(x=w.offset)!=null?x:0,y.dontPrettyTextNodes=(b=(k=w.dontPrettyTextNodes)!=null?k:w.dontprettytextnodes)!=null?b:0,y.spaceBeforeSlash=(S=(M=w.spaceBeforeSlash)!=null?M:w.spacebeforeslash)!=null?S:"",y.spaceBeforeSlash===!0&&(y.spaceBeforeSlash=" "),y.suppressPrettyCount=0,y.user={},y.state=t.None,y},F.prototype.indent=function(w,y,g){var E;return!y.pretty||y.suppressPrettyCount?"":y.pretty&&(E=(g||0)+y.offset+1,E>0)?new Array(E).join(y.indent):""},F.prototype.endline=function(w,y,g){return!y.pretty||y.suppressPrettyCount?"":y.newline},F.prototype.attribute=function(w,y,g){var E;return this.openAttribute(w,y,g),E=" "+w.name+'="'+w.value+'"',this.closeAttribute(w,y,g),E},F.prototype.cdata=function(w,y,g){var E;return this.openNode(w,y,g),y.state=t.OpenTag,E=this.indent(w,y,g)+"<![CDATA[",y.state=t.InsideTag,E+=w.value,y.state=t.CloseTag,E+="]]>"+this.endline(w,y,g),y.state=t.None,this.closeNode(w,y,g),E},F.prototype.comment=function(w,y,g){var E;return this.openNode(w,y,g),y.state=t.OpenTag,E=this.indent(w,y,g)+"<!-- ",y.state=t.InsideTag,E+=w.value,y.state=t.CloseTag,E+=" -->"+this.endline(w,y,g),y.state=t.None,this.closeNode(w,y,g),E},F.prototype.declaration=function(w,y,g){var E;return this.openNode(w,y,g),y.state=t.OpenTag,E=this.indent(w,y,g)+"<?xml",y.state=t.InsideTag,E+=' version="'+w.version+'"',w.encoding!=null&&(E+=' encoding="'+w.encoding+'"'),w.standalone!=null&&(E+=' standalone="'+w.standalone+'"'),y.state=t.CloseTag,E+=y.spaceBeforeSlash+"?>",E+=this.endline(w,y,g),y.state=t.None,this.closeNode(w,y,g),E},F.prototype.docType=function(w,y,g){var E,x,b,k,S;if(g||(g=0),this.openNode(w,y,g),y.state=t.OpenTag,k=this.indent(w,y,g),k+="<!DOCTYPE "+w.root().name,w.pubID&&w.sysID?k+=' PUBLIC "'+w.pubID+'" "'+w.sysID+'"':w.sysID&&(k+=' SYSTEM "'+w.sysID+'"'),w.children.length>0){for(k+=" [",k+=this.endline(w,y,g),y.state=t.InsideTag,S=w.children,x=0,b=S.length;x<b;x++)E=S[x],k+=this.writeChildNode(E,y,g+1);y.state=t.CloseTag,k+="]"}return y.state=t.CloseTag,k+=y.spaceBeforeSlash+">",k+=this.endline(w,y,g),y.state=t.None,this.closeNode(w,y,g),k},F.prototype.element=function(w,y,g){var E,x,b,k,S,M,L,q,B,V,O,Y,U,ke;g||(g=0),V=!1,O="",this.openNode(w,y,g),y.state=t.OpenTag,O+=this.indent(w,y,g)+"<"+w.name,Y=w.attribs;for(B in Y)T.call(Y,B)&&(E=Y[B],O+=this.attribute(E,y,g));if(b=w.children.length,k=b===0?null:w.children[0],b===0||w.children.every(function(ce){return(ce.type===u.Text||ce.type===u.Raw)&&ce.value===""}))y.allowEmpty?(O+=">",y.state=t.CloseTag,O+="</"+w.name+">"+this.endline(w,y,g)):(y.state=t.CloseTag,O+=y.spaceBeforeSlash+"/>"+this.endline(w,y,g));else if(y.pretty&&b===1&&(k.type===u.Text||k.type===u.Raw)&&k.value!=null)O+=">",y.state=t.InsideTag,y.suppressPrettyCount++,V=!0,O+=this.writeChildNode(k,y,g+1),y.suppressPrettyCount--,V=!1,y.state=t.CloseTag,O+="</"+w.name+">"+this.endline(w,y,g);else{if(y.dontPrettyTextNodes){for(U=w.children,S=0,L=U.length;S<L;S++)if(x=U[S],(x.type===u.Text||x.type===u.Raw)&&x.value!=null){y.suppressPrettyCount++,V=!0;break}}for(O+=">"+this.endline(w,y,g),y.state=t.InsideTag,ke=w.children,M=0,q=ke.length;M<q;M++)x=ke[M],O+=this.writeChildNode(x,y,g+1);y.state=t.CloseTag,O+=this.indent(w,y,g)+"</"+w.name+">",V&&y.suppressPrettyCount--,O+=this.endline(w,y,g),y.state=t.None}return this.closeNode(w,y,g),O},F.prototype.writeChildNode=function(w,y,g){switch(w.type){case u.CData:return this.cdata(w,y,g);case u.Comment:return this.comment(w,y,g);case u.Element:return this.element(w,y,g);case u.Raw:return this.raw(w,y,g);case u.Text:return this.text(w,y,g);case u.ProcessingInstruction:return this.processingInstruction(w,y,g);case u.Dummy:return"";case u.Declaration:return this.declaration(w,y,g);case u.DocType:return this.docType(w,y,g);case u.AttributeDeclaration:return this.dtdAttList(w,y,g);case u.ElementDeclaration:return this.dtdElement(w,y,g);case u.EntityDeclaration:return this.dtdEntity(w,y,g);case u.NotationDeclaration:return this.dtdNotation(w,y,g);default:throw new Error("Unknown XML node type: "+w.constructor.name)}},F.prototype.processingInstruction=function(w,y,g){var E;return this.openNode(w,y,g),y.state=t.OpenTag,E=this.indent(w,y,g)+"<?",y.state=t.InsideTag,E+=w.target,w.value&&(E+=" "+w.value),y.state=t.CloseTag,E+=y.spaceBeforeSlash+"?>",E+=this.endline(w,y,g),y.state=t.None,this.closeNode(w,y,g),E},F.prototype.raw=function(w,y,g){var E;return this.openNode(w,y,g),y.state=t.OpenTag,E=this.indent(w,y,g),y.state=t.InsideTag,E+=w.value,y.state=t.CloseTag,E+=this.endline(w,y,g),y.state=t.None,this.closeNode(w,y,g),E},F.prototype.text=function(w,y,g){var E;return this.openNode(w,y,g),y.state=t.OpenTag,E=this.indent(w,y,g),y.state=t.InsideTag,E+=w.value,y.state=t.CloseTag,E+=this.endline(w,y,g),y.state=t.None,this.closeNode(w,y,g),E},F.prototype.dtdAttList=function(w,y,g){var E;return this.openNode(w,y,g),y.state=t.OpenTag,E=this.indent(w,y,g)+"<!ATTLIST",y.state=t.InsideTag,E+=" "+w.elementName+" "+w.attributeName+" "+w.attributeType,w.defaultValueType!=="#DEFAULT"&&(E+=" "+w.defaultValueType),w.defaultValue&&(E+=' "'+w.defaultValue+'"'),y.state=t.CloseTag,E+=y.spaceBeforeSlash+">"+this.endline(w,y,g),y.state=t.None,this.closeNode(w,y,g),E},F.prototype.dtdElement=function(w,y,g){var E;return this.openNode(w,y,g),y.state=t.OpenTag,E=this.indent(w,y,g)+"<!ELEMENT",y.state=t.InsideTag,E+=" "+w.name+" "+w.value,y.state=t.CloseTag,E+=y.spaceBeforeSlash+">"+this.endline(w,y,g),y.state=t.None,this.closeNode(w,y,g),E},F.prototype.dtdEntity=function(w,y,g){var E;return this.openNode(w,y,g),y.state=t.OpenTag,E=this.indent(w,y,g)+"<!ENTITY",y.state=t.InsideTag,w.pe&&(E+=" %"),E+=" "+w.name,w.value?E+=' "'+w.value+'"':(w.pubID&&w.sysID?E+=' PUBLIC "'+w.pubID+'" "'+w.sysID+'"':w.sysID&&(E+=' SYSTEM "'+w.sysID+'"'),w.nData&&(E+=" NDATA "+w.nData)),y.state=t.CloseTag,E+=y.spaceBeforeSlash+">"+this.endline(w,y,g),y.state=t.None,this.closeNode(w,y,g),E},F.prototype.dtdNotation=function(w,y,g){var E;return this.openNode(w,y,g),y.state=t.OpenTag,E=this.indent(w,y,g)+"<!NOTATION",y.state=t.InsideTag,E+=" "+w.name,w.pubID&&w.sysID?E+=' PUBLIC "'+w.pubID+'" "'+w.sysID+'"':w.pubID?E+=' PUBLIC "'+w.pubID+'"':w.sysID&&(E+=' SYSTEM "'+w.sysID+'"'),y.state=t.CloseTag,E+=y.spaceBeforeSlash+">"+this.endline(w,y,g),y.state=t.None,this.closeNode(w,y,g),E},F.prototype.openNode=function(w,y,g){},F.prototype.closeNode=function(w,y,g){},F.prototype.openAttribute=function(w,y,g){},F.prototype.closeAttribute=function(w,y,g){},F}()}).call(Yi)});var Yt=R((Ji,Zi)=>{(function(){var u,t,e=function(i,s){for(var o in s)r.call(s,o)&&(i[o]=s[o]);function n(){this.constructor=i}return n.prototype=s.prototype,i.prototype=new n,i.__super__=s.prototype,i},r={}.hasOwnProperty;t=vr(),Zi.exports=u=function(i){e(s,i);function s(o){s.__super__.constructor.call(this,o)}return s.prototype.document=function(o,n){var l,c,p,h,m;for(n=this.filterOptions(n),h="",m=o.children,c=0,p=m.length;c<p;c++)l=m[c],h+=this.writeChildNode(l,n,0);return n.pretty&&h.slice(-n.newline.length)===n.newline&&(h=h.slice(0,-n.newline.length)),h},s}(t)}).call(Ji)});var Pr=R((es,ts)=>{(function(){var u,t,e,r,i,s,o,n,l=function(p,h){for(var m in h)c.call(h,m)&&(p[m]=h[m]);function d(){this.constructor=p}return d.prototype=h.prototype,p.prototype=new d,p.__super__=h.prototype,p},c={}.hasOwnProperty;n=me().isPlainObject,e=gr(),t=ii(),i=oe(),u=G(),o=yr(),s=Yt(),ts.exports=r=function(p){l(h,p);function h(m){h.__super__.constructor.call(this,null),this.name="#document",this.type=u.Document,this.documentURI=null,this.domConfig=new t,m||(m={}),m.writer||(m.writer=new s),this.options=m,this.stringify=new o(m)}return Object.defineProperty(h.prototype,"implementation",{value:new e}),Object.defineProperty(h.prototype,"doctype",{get:function(){var m,d,v,D;for(D=this.children,d=0,v=D.length;d<v;d++)if(m=D[d],m.type===u.DocType)return m;return null}}),Object.defineProperty(h.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(h.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(h.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(h.prototype,"xmlEncoding",{get:function(){return this.children.length!==0&&this.children[0].type===u.Declaration?this.children[0].encoding:null}}),Object.defineProperty(h.prototype,"xmlStandalone",{get:function(){return this.children.length!==0&&this.children[0].type===u.Declaration?this.children[0].standalone==="yes":!1}}),Object.defineProperty(h.prototype,"xmlVersion",{get:function(){return this.children.length!==0&&this.children[0].type===u.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(h.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(h.prototype,"origin",{get:function(){return null}}),Object.defineProperty(h.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(h.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(h.prototype,"contentType",{get:function(){return null}}),h.prototype.end=function(m){var d;return d={},m?n(m)&&(d=m,m=this.options.writer):m=this.options.writer,m.document(this,m.filterOptions(d))},h.prototype.toString=function(m){return this.options.writer.document(this,this.options.writer.filterOptions(m))},h.prototype.createElement=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.createDocumentFragment=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.createTextNode=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.createComment=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.createCDATASection=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.createProcessingInstruction=function(m,d){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.createAttribute=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.createEntityReference=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.getElementsByTagName=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.importNode=function(m,d){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.createElementNS=function(m,d){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.createAttributeNS=function(m,d){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.getElementsByTagNameNS=function(m,d){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.getElementById=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.adoptNode=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.normalizeDocument=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.renameNode=function(m,d,v){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.getElementsByClassName=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.createEvent=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.createRange=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.createNodeIterator=function(m,d,v){throw new Error("This DOM method is not implemented."+this.debugInfo())},h.prototype.createTreeWalker=function(m,d,v){throw new Error("This DOM method is not implemented."+this.debugInfo())},h}(i)}).call(es)});var ss=R((rs,is)=>{(function(){var u,t,e,r,i,s,o,n,l,c,p,h,m,d,v,D,I,T,F,w,y,g,E,x,b={}.hasOwnProperty;x=me(),g=x.isObject,y=x.isFunction,E=x.isPlainObject,w=x.getValue,u=G(),h=Pr(),d=Qt(),r=Bt(),i=$t(),D=Wt(),F=zt(),v=Gt(),c=_t(),p=Xt(),s=Ut(),n=Vt(),o=jt(),l=Ht(),e=mr(),T=yr(),I=Yt(),t=yt(),is.exports=m=function(){function k(S,M,L){var q;this.name="?xml",this.type=u.Document,S||(S={}),q={},S.writer?E(S.writer)&&(q=S.writer,S.writer=new I):S.writer=new I,this.options=S,this.writer=S.writer,this.writerOptions=this.writer.filterOptions(q),this.stringify=new T(S),this.onDataCallback=M||function(){},this.onEndCallback=L||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}return k.prototype.createChildNode=function(S){var M,L,q,B,V,O,Y,U;switch(S.type){case u.CData:this.cdata(S.value);break;case u.Comment:this.comment(S.value);break;case u.Element:q={},Y=S.attribs;for(L in Y)b.call(Y,L)&&(M=Y[L],q[L]=M.value);this.node(S.name,q);break;case u.Dummy:this.dummy();break;case u.Raw:this.raw(S.value);break;case u.Text:this.text(S.value);break;case u.ProcessingInstruction:this.instruction(S.target,S.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+S.constructor.name)}for(U=S.children,V=0,O=U.length;V<O;V++)B=U[V],this.createChildNode(B),B.type===u.Element&&this.up();return this},k.prototype.dummy=function(){return this},k.prototype.node=function(S,M,L){var q;if(S==null)throw new Error("Missing node name.");if(this.root&&this.currentLevel===-1)throw new Error("Document can only have one root node. "+this.debugInfo(S));return this.openCurrent(),S=w(S),M==null&&(M={}),M=w(M),g(M)||(q=[M,L],L=q[0],M=q[1]),this.currentNode=new d(this,S,M),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,L!=null&&this.text(L),this},k.prototype.element=function(S,M,L){var q,B,V,O,Y,U;if(this.currentNode&&this.currentNode.type===u.DocType)this.dtdElement.apply(this,arguments);else if(Array.isArray(S)||g(S)||y(S))for(O=this.options.noValidation,this.options.noValidation=!0,U=new h(this.options).element("TEMP_ROOT"),U.element(S),this.options.noValidation=O,Y=U.children,B=0,V=Y.length;B<V;B++)q=Y[B],this.createChildNode(q),q.type===u.Element&&this.up();else this.node(S,M,L);return this},k.prototype.attribute=function(S,M){var L,q;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(S));if(S!=null&&(S=w(S)),g(S))for(L in S)b.call(S,L)&&(q=S[L],this.attribute(L,q));else y(M)&&(M=M.apply()),this.options.keepNullAttributes&&M==null?this.currentNode.attribs[S]=new e(this,S,""):M!=null&&(this.currentNode.attribs[S]=new e(this,S,M));return this},k.prototype.text=function(S){var M;return this.openCurrent(),M=new F(this,S),this.onData(this.writer.text(M,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},k.prototype.cdata=function(S){var M;return this.openCurrent(),M=new r(this,S),this.onData(this.writer.cdata(M,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},k.prototype.comment=function(S){var M;return this.openCurrent(),M=new i(this,S),this.onData(this.writer.comment(M,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},k.prototype.raw=function(S){var M;return this.openCurrent(),M=new D(this,S),this.onData(this.writer.raw(M,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},k.prototype.instruction=function(S,M){var L,q,B,V,O;if(this.openCurrent(),S!=null&&(S=w(S)),M!=null&&(M=w(M)),Array.isArray(S))for(L=0,V=S.length;L<V;L++)q=S[L],this.instruction(q);else if(g(S))for(q in S)b.call(S,q)&&(B=S[q],this.instruction(q,B));else y(M)&&(M=M.apply()),O=new v(this,S,M),this.onData(this.writer.processingInstruction(O,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this},k.prototype.declaration=function(S,M,L){var q;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return q=new c(this,S,M,L),this.onData(this.writer.declaration(q,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},k.prototype.doctype=function(S,M,L){if(this.openCurrent(),S==null)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new p(this,M,L),this.currentNode.rootNodeName=S,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this},k.prototype.dtdElement=function(S,M){var L;return this.openCurrent(),L=new o(this,S,M),this.onData(this.writer.dtdElement(L,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},k.prototype.attList=function(S,M,L,q,B){var V;return this.openCurrent(),V=new s(this,S,M,L,q,B),this.onData(this.writer.dtdAttList(V,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},k.prototype.entity=function(S,M){var L;return this.openCurrent(),L=new n(this,!1,S,M),this.onData(this.writer.dtdEntity(L,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},k.prototype.pEntity=function(S,M){var L;return this.openCurrent(),L=new n(this,!0,S,M),this.onData(this.writer.dtdEntity(L,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},k.prototype.notation=function(S,M){var L;return this.openCurrent(),L=new l(this,S,M),this.onData(this.writer.dtdNotation(L,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},k.prototype.up=function(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this},k.prototype.end=function(){for(;this.currentLevel>=0;)this.up();return this.onEnd()},k.prototype.openCurrent=function(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)},k.prototype.openNode=function(S){var M,L,q,B;if(!S.isOpen){if(!this.root&&this.currentLevel===0&&S.type===u.Element&&(this.root=S),L="",S.type===u.Element){this.writerOptions.state=t.OpenTag,L=this.writer.indent(S,this.writerOptions,this.currentLevel)+"<"+S.name,B=S.attribs;for(q in B)b.call(B,q)&&(M=B[q],L+=this.writer.attribute(M,this.writerOptions,this.currentLevel));L+=(S.children?">":"/>")+this.writer.endline(S,this.writerOptions,this.currentLevel),this.writerOptions.state=t.InsideTag}else this.writerOptions.state=t.OpenTag,L=this.writer.indent(S,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+S.rootNodeName,S.pubID&&S.sysID?L+=' PUBLIC "'+S.pubID+'" "'+S.sysID+'"':S.sysID&&(L+=' SYSTEM "'+S.sysID+'"'),S.children?(L+=" [",this.writerOptions.state=t.InsideTag):(this.writerOptions.state=t.CloseTag,L+=">"),L+=this.writer.endline(S,this.writerOptions,this.currentLevel);return this.onData(L,this.currentLevel),S.isOpen=!0}},k.prototype.closeNode=function(S){var M;if(!S.isClosed)return M="",this.writerOptions.state=t.CloseTag,S.type===u.Element?M=this.writer.indent(S,this.writerOptions,this.currentLevel)+"</"+S.name+">"+this.writer.endline(S,this.writerOptions,this.currentLevel):M=this.writer.indent(S,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(S,this.writerOptions,this.currentLevel),this.writerOptions.state=t.None,this.onData(M,this.currentLevel),S.isClosed=!0},k.prototype.onData=function(S,M){return this.documentStarted=!0,this.onDataCallback(S,M+1)},k.prototype.onEnd=function(){return this.documentCompleted=!0,this.onEndCallback()},k.prototype.debugInfo=function(S){return S==null?"":"node: <"+S+">"},k.prototype.ele=function(){return this.element.apply(this,arguments)},k.prototype.nod=function(S,M,L){return this.node(S,M,L)},k.prototype.txt=function(S){return this.text(S)},k.prototype.dat=function(S){return this.cdata(S)},k.prototype.com=function(S){return this.comment(S)},k.prototype.ins=function(S,M){return this.instruction(S,M)},k.prototype.dec=function(S,M,L){return this.declaration(S,M,L)},k.prototype.dtd=function(S,M,L){return this.doctype(S,M,L)},k.prototype.e=function(S,M,L){return this.element(S,M,L)},k.prototype.n=function(S,M,L){return this.node(S,M,L)},k.prototype.t=function(S){return this.text(S)},k.prototype.d=function(S){return this.cdata(S)},k.prototype.c=function(S){return this.comment(S)},k.prototype.r=function(S){return this.raw(S)},k.prototype.i=function(S,M){return this.instruction(S,M)},k.prototype.att=function(){return this.currentNode&&this.currentNode.type===u.DocType?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},k.prototype.a=function(){return this.currentNode&&this.currentNode.type===u.DocType?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},k.prototype.ent=function(S,M){return this.entity(S,M)},k.prototype.pent=function(S,M){return this.pEntity(S,M)},k.prototype.not=function(S,M){return this.notation(S,M)},k}()}).call(rs)});var ns=R((as,os)=>{(function(){var u,t,e,r,i=function(o,n){for(var l in n)s.call(n,l)&&(o[l]=n[l]);function c(){this.constructor=o}return c.prototype=n.prototype,o.prototype=new c,o.__super__=n.prototype,o},s={}.hasOwnProperty;u=G(),r=vr(),t=yt(),os.exports=e=function(o){i(n,o);function n(l,c){this.stream=l,n.__super__.constructor.call(this,c)}return n.prototype.endline=function(l,c,p){return l.isLastRootNode&&c.state===t.CloseTag?"":n.__super__.endline.call(this,l,c,p)},n.prototype.document=function(l,c){var p,h,m,d,v,D,I,T,F;for(I=l.children,h=m=0,v=I.length;m<v;h=++m)p=I[h],p.isLastRootNode=h===l.children.length-1;for(c=this.filterOptions(c),T=l.children,F=[],d=0,D=T.length;d<D;d++)p=T[d],F.push(this.writeChildNode(p,c,0));return F},n.prototype.attribute=function(l,c,p){return this.stream.write(n.__super__.attribute.call(this,l,c,p))},n.prototype.cdata=function(l,c,p){return this.stream.write(n.__super__.cdata.call(this,l,c,p))},n.prototype.comment=function(l,c,p){return this.stream.write(n.__super__.comment.call(this,l,c,p))},n.prototype.declaration=function(l,c,p){return this.stream.write(n.__super__.declaration.call(this,l,c,p))},n.prototype.docType=function(l,c,p){var h,m,d,v;if(p||(p=0),this.openNode(l,c,p),c.state=t.OpenTag,this.stream.write(this.indent(l,c,p)),this.stream.write("<!DOCTYPE "+l.root().name),l.pubID&&l.sysID?this.stream.write(' PUBLIC "'+l.pubID+'" "'+l.sysID+'"'):l.sysID&&this.stream.write(' SYSTEM "'+l.sysID+'"'),l.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(l,c,p)),c.state=t.InsideTag,v=l.children,m=0,d=v.length;m<d;m++)h=v[m],this.writeChildNode(h,c,p+1);c.state=t.CloseTag,this.stream.write("]")}return c.state=t.CloseTag,this.stream.write(c.spaceBeforeSlash+">"),this.stream.write(this.endline(l,c,p)),c.state=t.None,this.closeNode(l,c,p)},n.prototype.element=function(l,c,p){var h,m,d,v,D,I,T,F,w,y;p||(p=0),this.openNode(l,c,p),c.state=t.OpenTag,this.stream.write(this.indent(l,c,p)+"<"+l.name),w=l.attribs;for(T in w)s.call(w,T)&&(h=w[T],this.attribute(h,c,p));if(d=l.children.length,v=d===0?null:l.children[0],d===0||l.children.every(function(g){return(g.type===u.Text||g.type===u.Raw)&&g.value===""}))c.allowEmpty?(this.stream.write(">"),c.state=t.CloseTag,this.stream.write("</"+l.name+">")):(c.state=t.CloseTag,this.stream.write(c.spaceBeforeSlash+"/>"));else if(c.pretty&&d===1&&(v.type===u.Text||v.type===u.Raw)&&v.value!=null)this.stream.write(">"),c.state=t.InsideTag,c.suppressPrettyCount++,F=!0,this.writeChildNode(v,c,p+1),c.suppressPrettyCount--,F=!1,c.state=t.CloseTag,this.stream.write("</"+l.name+">");else{for(this.stream.write(">"+this.endline(l,c,p)),c.state=t.InsideTag,y=l.children,D=0,I=y.length;D<I;D++)m=y[D],this.writeChildNode(m,c,p+1);c.state=t.CloseTag,this.stream.write(this.indent(l,c,p)+"</"+l.name+">")}return this.stream.write(this.endline(l,c,p)),c.state=t.None,this.closeNode(l,c,p)},n.prototype.processingInstruction=function(l,c,p){return this.stream.write(n.__super__.processingInstruction.call(this,l,c,p))},n.prototype.raw=function(l,c,p){return this.stream.write(n.__super__.raw.call(this,l,c,p))},n.prototype.text=function(l,c,p){return this.stream.write(n.__super__.text.call(this,l,c,p))},n.prototype.dtdAttList=function(l,c,p){return this.stream.write(n.__super__.dtdAttList.call(this,l,c,p))},n.prototype.dtdElement=function(l,c,p){return this.stream.write(n.__super__.dtdElement.call(this,l,c,p))},n.prototype.dtdEntity=function(l,c,p){return this.stream.write(n.__super__.dtdEntity.call(this,l,c,p))},n.prototype.dtdNotation=function(l,c,p){return this.stream.write(n.__super__.dtdNotation.call(this,l,c,p))},n}(r)}).call(as)});var cs=R((ls,Ce)=>{(function(){var u,t,e,r,i,s,o,n,l,c;c=me(),n=c.assign,l=c.isFunction,e=gr(),r=Pr(),i=ss(),o=Yt(),s=ns(),u=G(),t=yt(),Ce.exports.create=function(p,h,m,d){var v,D;if(p==null)throw new Error("Root element needs a name.");return d=n({},h,m,d),v=new r(d),D=v.element(p),d.headless||(v.declaration(d),(d.pubID!=null||d.sysID!=null)&&v.dtd(d)),D},Ce.exports.begin=function(p,h,m){var d;return l(p)&&(d=[p,h],h=d[0],m=d[1],p={}),h?new i(p,h,m):new r(p)},Ce.exports.stringWriter=function(p){return new o(p)},Ce.exports.streamWriter=function(p,h){return new s(p,h)},Ce.exports.implementation=new e,Ce.exports.nodeType=u,Ce.exports.writerState=t}).call(ls)});var ds=R(br=>{(function(){"use strict";var u,t,e,r,i,s={}.hasOwnProperty;u=cs(),t=Ot().defaults,r=function(o){return typeof o=="string"&&(o.indexOf("&")>=0||o.indexOf(">")>=0||o.indexOf("<")>=0)},i=function(o){return"<![CDATA["+e(o)+"]]>"},e=function(o){return o.replace("]]>","]]]]><![CDATA[>")},br.Builder=function(){function o(n){var l,c,p;this.options={},c=t["0.2"];for(l in c)s.call(c,l)&&(p=c[l],this.options[l]=p);for(l in n)s.call(n,l)&&(p=n[l],this.options[l]=p)}return o.prototype.buildObject=function(n){var l,c,p,h,m;return l=this.options.attrkey,c=this.options.charkey,Object.keys(n).length===1&&this.options.rootName===t["0.2"].rootName?(m=Object.keys(n)[0],n=n[m]):m=this.options.rootName,p=function(d){return function(v,D){var I,T,F,w,y,g;if(typeof D!="object")d.options.cdata&&r(D)?v.raw(i(D)):v.txt(D);else if(Array.isArray(D)){for(w in D)if(s.call(D,w)){T=D[w];for(y in T)F=T[y],v=p(v.ele(y),F).up()}}else for(y in D)if(s.call(D,y))if(T=D[y],y===l){if(typeof T=="object")for(I in T)g=T[I],v=v.att(I,g)}else if(y===c)d.options.cdata&&r(T)?v=v.raw(i(T)):v=v.txt(T);else if(Array.isArray(T))for(w in T)s.call(T,w)&&(F=T[w],typeof F=="string"?d.options.cdata&&r(F)?v=v.ele(y).raw(i(F)).up():v=v.ele(y,F).up():v=p(v.ele(y),F).up());else typeof T=="object"?v=p(v.ele(y),T).up():typeof T=="string"&&d.options.cdata&&r(T)?v=v.ele(y).raw(i(T)).up():(T==null&&(T=""),v=v.ele(y,T.toString()).up());return v}}(this),h=u.create(m,this.options.xmldec,this.options.doctype,{headless:this.options.headless,allowSurrogateChars:this.options.allowSurrogateChars}),p(h,n).end(this.options.renderOpts)},o}()}).call(br)});var us=R(Kt=>{(function(u){u.parser=function(P,f){return new e(P,f)},u.SAXParser=e,u.SAXStream=c,u.createStream=l,u.MAX_BUFFER_LENGTH=64*1024;var t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];u.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function e(P,f){if(!(this instanceof e))return new e(P,f);var A=this;i(A),A.q=A.c="",A.bufferCheckPosition=u.MAX_BUFFER_LENGTH,A.opt=f||{},A.opt.lowercase=A.opt.lowercase||A.opt.lowercasetags,A.looseCase=A.opt.lowercase?"toLowerCase":"toUpperCase",A.tags=[],A.closed=A.closedRoot=A.sawRoot=!1,A.tag=A.error=null,A.strict=!!P,A.noscript=!!(P||A.opt.noscript),A.state=b.BEGIN,A.strictEntities=A.opt.strictEntities,A.ENTITIES=A.strictEntities?Object.create(u.XML_ENTITIES):Object.create(u.ENTITIES),A.attribList=[],A.opt.xmlns&&(A.ns=Object.create(v)),A.opt.unquotedAttributeValues===void 0&&(A.opt.unquotedAttributeValues=!P),A.trackPosition=A.opt.position!==!1,A.trackPosition&&(A.position=A.line=A.column=0),S(A,"onready")}Object.create||(Object.create=function(P){function f(){}f.prototype=P;var A=new f;return A}),Object.keys||(Object.keys=function(P){var f=[];for(var A in P)P.hasOwnProperty(A)&&f.push(A);return f});function r(P){for(var f=Math.max(u.MAX_BUFFER_LENGTH,10),A=0,C=0,j=t.length;C<j;C++){var z=P[t[C]].length;if(z>f)switch(t[C]){case"textNode":L(P);break;case"cdata":M(P,"oncdata",P.cdata),P.cdata="";break;case"script":M(P,"onscript",P.script),P.script="";break;default:B(P,"Max buffer length exceeded: "+t[C])}A=Math.max(A,z)}var K=u.MAX_BUFFER_LENGTH-A;P.bufferCheckPosition=K+P.position}function i(P){for(var f=0,A=t.length;f<A;f++)P[t[f]]=""}function s(P){L(P),P.cdata!==""&&(M(P,"oncdata",P.cdata),P.cdata=""),P.script!==""&&(M(P,"onscript",P.script),P.script="")}e.prototype={end:function(){V(this)},write:Gs,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){s(this)}};var o;try{o=require("stream").Stream}catch(P){o=function(){}}o||(o=function(){});var n=u.EVENTS.filter(function(P){return P!=="error"&&P!=="end"});function l(P,f){return new c(P,f)}function c(P,f){if(!(this instanceof c))return new c(P,f);o.apply(this),this._parser=new e(P,f),this.writable=!0,this.readable=!0;var A=this;this._parser.onend=function(){A.emit("end")},this._parser.onerror=function(C){A.emit("error",C),A._parser.error=null},this._decoder=null,n.forEach(function(C){Object.defineProperty(A,"on"+C,{get:function(){return A._parser["on"+C]},set:function(j){if(!j)return A.removeAllListeners(C),A._parser["on"+C]=j,j;A.on(C,j)},enumerable:!0,configurable:!1})})}c.prototype=Object.create(o.prototype,{constructor:{value:c}}),c.prototype.write=function(P){if(typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(P)){if(!this._decoder){var f=require("string_decoder").StringDecoder;this._decoder=new f("utf8")}P=this._decoder.write(P)}return this._parser.write(P.toString()),this.emit("data",P),!0},c.prototype.end=function(P){return P&&P.length&&this.write(P),this._parser.end(),!0},c.prototype.on=function(P,f){var A=this;return!A._parser["on"+P]&&n.indexOf(P)!==-1&&(A._parser["on"+P]=function(){var C=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);C.splice(0,0,P),A.emit.apply(A,C)}),o.prototype.on.call(A,P,f)};var p="[CDATA[",h="DOCTYPE",m="http://www.w3.org/XML/1998/namespace",d="http://www.w3.org/2000/xmlns/",v={xml:m,xmlns:d},D=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,I=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,T=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,F=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function w(P){return P===" "||P===`
`||P==="\r"||P==="	"}function y(P){return P==='"'||P==="'"}function g(P){return P===">"||w(P)}function E(P,f){return P.test(f)}function x(P,f){return!E(P,f)}var b=0;u.STATE={BEGIN:b++,BEGIN_WHITESPACE:b++,TEXT:b++,TEXT_ENTITY:b++,OPEN_WAKA:b++,SGML_DECL:b++,SGML_DECL_QUOTED:b++,DOCTYPE:b++,DOCTYPE_QUOTED:b++,DOCTYPE_DTD:b++,DOCTYPE_DTD_QUOTED:b++,COMMENT_STARTING:b++,COMMENT:b++,COMMENT_ENDING:b++,COMMENT_ENDED:b++,CDATA:b++,CDATA_ENDING:b++,CDATA_ENDING_2:b++,PROC_INST:b++,PROC_INST_BODY:b++,PROC_INST_ENDING:b++,OPEN_TAG:b++,OPEN_TAG_SLASH:b++,ATTRIB:b++,ATTRIB_NAME:b++,ATTRIB_NAME_SAW_WHITE:b++,ATTRIB_VALUE:b++,ATTRIB_VALUE_QUOTED:b++,ATTRIB_VALUE_CLOSED:b++,ATTRIB_VALUE_UNQUOTED:b++,ATTRIB_VALUE_ENTITY_Q:b++,ATTRIB_VALUE_ENTITY_U:b++,CLOSE_TAG:b++,CLOSE_TAG_SAW_WHITE:b++,SCRIPT:b++,SCRIPT_ENDING:b++},u.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},u.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(u.ENTITIES).forEach(function(P){var f=u.ENTITIES[P],A=typeof f=="number"?String.fromCharCode(f):f;u.ENTITIES[P]=A});for(var k in u.STATE)u.STATE[u.STATE[k]]=k;b=u.STATE;function S(P,f,A){P[f]&&P[f](A)}function M(P,f,A){P.textNode&&L(P),S(P,f,A)}function L(P){P.textNode=q(P.opt,P.textNode),P.textNode&&S(P,"ontext",P.textNode),P.textNode=""}function q(P,f){return P.trim&&(f=f.trim()),P.normalize&&(f=f.replace(/\s+/g," ")),f}function B(P,f){return L(P),P.trackPosition&&(f+=`
Line: `+P.line+`
Column: `+P.column+`
Char: `+P.c),f=new Error(f),P.error=f,S(P,"onerror",f),P}function V(P){return P.sawRoot&&!P.closedRoot&&O(P,"Unclosed root tag"),P.state!==b.BEGIN&&P.state!==b.BEGIN_WHITESPACE&&P.state!==b.TEXT&&B(P,"Unexpected end"),L(P),P.c="",P.closed=!0,S(P,"onend"),e.call(P,P.strict,P.opt),P}function O(P,f){if(typeof P!="object"||!(P instanceof e))throw new Error("bad call to strictFail");P.strict&&B(P,f)}function Y(P){P.strict||(P.tagName=P.tagName[P.looseCase]());var f=P.tags[P.tags.length-1]||P,A=P.tag={name:P.tagName,attributes:{}};P.opt.xmlns&&(A.ns=f.ns),P.attribList.length=0,M(P,"onopentagstart",A)}function U(P,f){var A=P.indexOf(":"),C=A<0?["",P]:P.split(":"),j=C[0],z=C[1];return f&&P==="xmlns"&&(j="xmlns",z=""),{prefix:j,local:z}}function ke(P){if(P.strict||(P.attribName=P.attribName[P.looseCase]()),P.attribList.indexOf(P.attribName)!==-1||P.tag.attributes.hasOwnProperty(P.attribName)){P.attribName=P.attribValue="";return}if(P.opt.xmlns){var f=U(P.attribName,!0),A=f.prefix,C=f.local;if(A==="xmlns")if(C==="xml"&&P.attribValue!==m)O(P,"xml: prefix must be bound to "+m+`
Actual: `+P.attribValue);else if(C==="xmlns"&&P.attribValue!==d)O(P,"xmlns: prefix must be bound to "+d+`
Actual: `+P.attribValue);else{var j=P.tag,z=P.tags[P.tags.length-1]||P;j.ns===z.ns&&(j.ns=Object.create(z.ns)),j.ns[C]=P.attribValue}P.attribList.push([P.attribName,P.attribValue])}else P.tag.attributes[P.attribName]=P.attribValue,M(P,"onattribute",{name:P.attribName,value:P.attribValue});P.attribName=P.attribValue=""}function ce(P,f){if(P.opt.xmlns){var A=P.tag,C=U(P.tagName);A.prefix=C.prefix,A.local=C.local,A.uri=A.ns[C.prefix]||"",A.prefix&&!A.uri&&(O(P,"Unbound namespace prefix: "+JSON.stringify(P.tagName)),A.uri=C.prefix);var j=P.tags[P.tags.length-1]||P;A.ns&&j.ns!==A.ns&&Object.keys(A.ns).forEach(function(Or){M(P,"onopennamespace",{prefix:Or,uri:A.ns[Or]})});for(var z=0,K=P.attribList.length;z<K;z++){var re=P.attribList[z],ie=re[0],$e=re[1],Z=U(ie,!0),ye=Z.prefix,Ys=Z.local,qr=ye===""?"":A.ns[ye]||"",cr={name:ie,value:$e,prefix:ye,local:Ys,uri:qr};ye&&ye!=="xmlns"&&!qr&&(O(P,"Unbound namespace prefix: "+JSON.stringify(ye)),cr.uri=ye),P.tag.attributes[ie]=cr,M(P,"onattribute",cr)}P.attribList.length=0}P.tag.isSelfClosing=!!f,P.sawRoot=!0,P.tags.push(P.tag),M(P,"onopentag",P.tag),f||(!P.noscript&&P.tagName.toLowerCase()==="script"?P.state=b.SCRIPT:P.state=b.TEXT,P.tag=null,P.tagName=""),P.attribName=P.attribValue="",P.attribList.length=0}function nr(P){if(!P.tagName){O(P,"Weird empty close tag."),P.textNode+="</>",P.state=b.TEXT;return}if(P.script){if(P.tagName!=="script"){P.script+="</"+P.tagName+">",P.tagName="",P.state=b.SCRIPT;return}M(P,"onscript",P.script),P.script=""}var f=P.tags.length,A=P.tagName;P.strict||(A=A[P.looseCase]());for(var C=A;f--;){var j=P.tags[f];if(j.name!==C)O(P,"Unexpected close tag");else break}if(f<0){O(P,"Unmatched closing tag: "+P.tagName),P.textNode+="</"+P.tagName+">",P.state=b.TEXT;return}P.tagName=A;for(var z=P.tags.length;z-- >f;){var K=P.tag=P.tags.pop();P.tagName=P.tag.name,M(P,"onclosetag",P.tagName);var re={};for(var ie in K.ns)re[ie]=K.ns[ie];var $e=P.tags[P.tags.length-1]||P;P.opt.xmlns&&K.ns!==$e.ns&&Object.keys(K.ns).forEach(function(Z){var ye=K.ns[Z];M(P,"onclosenamespace",{prefix:Z,uri:ye})})}f===0&&(P.closedRoot=!0),P.tagName=P.attribValue=P.attribName="",P.attribList.length=0,P.state=b.TEXT}function zs(P){var f=P.entity,A=f.toLowerCase(),C,j="";return P.ENTITIES[f]?P.ENTITIES[f]:P.ENTITIES[A]?P.ENTITIES[A]:(f=A,f.charAt(0)==="#"&&(f.charAt(1)==="x"?(f=f.slice(2),C=parseInt(f,16),j=C.toString(16)):(f=f.slice(1),C=parseInt(f,10),j=C.toString(10))),f=f.replace(/^0+/,""),isNaN(C)||j.toLowerCase()!==f||C<0||C>1114111?(O(P,"Invalid character entity"),"&"+P.entity+";"):String.fromCodePoint(C))}function Nr(P,f){f==="<"?(P.state=b.OPEN_WAKA,P.startTagPosition=P.position):w(f)||(O(P,"Non-whitespace before first tag."),P.textNode=f,P.state=b.TEXT)}function lr(P,f){var A="";return f<P.length&&(A=P.charAt(f)),A}function Gs(P){var f=this;if(this.error)throw this.error;if(f.closed)return B(f,"Cannot write after close. Assign an onready handler.");if(P===null)return V(f);typeof P=="object"&&(P=P.toString());for(var A=0,C="";C=lr(P,A++),f.c=C,!!C;)switch(f.trackPosition&&(f.position++,C===`
`?(f.line++,f.column=0):f.column++),f.state){case b.BEGIN:if(f.state=b.BEGIN_WHITESPACE,C==="\uFEFF")continue;Nr(f,C);continue;case b.BEGIN_WHITESPACE:Nr(f,C);continue;case b.TEXT:if(f.sawRoot&&!f.closedRoot){for(var z=A-1;C&&C!=="<"&&C!=="&";)C=lr(P,A++),C&&f.trackPosition&&(f.position++,C===`
`?(f.line++,f.column=0):f.column++);f.textNode+=P.substring(z,A-1)}C==="<"&&!(f.sawRoot&&f.closedRoot&&!f.strict)?(f.state=b.OPEN_WAKA,f.startTagPosition=f.position):(!w(C)&&(!f.sawRoot||f.closedRoot)&&O(f,"Text data outside of root node."),C==="&"?f.state=b.TEXT_ENTITY:f.textNode+=C);continue;case b.SCRIPT:C==="<"?f.state=b.SCRIPT_ENDING:f.script+=C;continue;case b.SCRIPT_ENDING:C==="/"?f.state=b.CLOSE_TAG:(f.script+="<"+C,f.state=b.SCRIPT);continue;case b.OPEN_WAKA:if(C==="!")f.state=b.SGML_DECL,f.sgmlDecl="";else if(!w(C))if(E(D,C))f.state=b.OPEN_TAG,f.tagName=C;else if(C==="/")f.state=b.CLOSE_TAG,f.tagName="";else if(C==="?")f.state=b.PROC_INST,f.procInstName=f.procInstBody="";else{if(O(f,"Unencoded <"),f.startTagPosition+1<f.position){var j=f.position-f.startTagPosition;C=new Array(j).join(" ")+C}f.textNode+="<"+C,f.state=b.TEXT}continue;case b.SGML_DECL:if(f.sgmlDecl+C==="--"){f.state=b.COMMENT,f.comment="",f.sgmlDecl="";continue}f.doctype&&f.doctype!==!0&&f.sgmlDecl?(f.state=b.DOCTYPE_DTD,f.doctype+="<!"+f.sgmlDecl+C,f.sgmlDecl=""):(f.sgmlDecl+C).toUpperCase()===p?(M(f,"onopencdata"),f.state=b.CDATA,f.sgmlDecl="",f.cdata=""):(f.sgmlDecl+C).toUpperCase()===h?(f.state=b.DOCTYPE,(f.doctype||f.sawRoot)&&O(f,"Inappropriately located doctype declaration"),f.doctype="",f.sgmlDecl=""):C===">"?(M(f,"onsgmldeclaration",f.sgmlDecl),f.sgmlDecl="",f.state=b.TEXT):(y(C)&&(f.state=b.SGML_DECL_QUOTED),f.sgmlDecl+=C);continue;case b.SGML_DECL_QUOTED:C===f.q&&(f.state=b.SGML_DECL,f.q=""),f.sgmlDecl+=C;continue;case b.DOCTYPE:C===">"?(f.state=b.TEXT,M(f,"ondoctype",f.doctype),f.doctype=!0):(f.doctype+=C,C==="["?f.state=b.DOCTYPE_DTD:y(C)&&(f.state=b.DOCTYPE_QUOTED,f.q=C));continue;case b.DOCTYPE_QUOTED:f.doctype+=C,C===f.q&&(f.q="",f.state=b.DOCTYPE);continue;case b.DOCTYPE_DTD:C==="]"?(f.doctype+=C,f.state=b.DOCTYPE):C==="<"?(f.state=b.OPEN_WAKA,f.startTagPosition=f.position):y(C)?(f.doctype+=C,f.state=b.DOCTYPE_DTD_QUOTED,f.q=C):f.doctype+=C;continue;case b.DOCTYPE_DTD_QUOTED:f.doctype+=C,C===f.q&&(f.state=b.DOCTYPE_DTD,f.q="");continue;case b.COMMENT:C==="-"?f.state=b.COMMENT_ENDING:f.comment+=C;continue;case b.COMMENT_ENDING:C==="-"?(f.state=b.COMMENT_ENDED,f.comment=q(f.opt,f.comment),f.comment&&M(f,"oncomment",f.comment),f.comment=""):(f.comment+="-"+C,f.state=b.COMMENT);continue;case b.COMMENT_ENDED:C!==">"?(O(f,"Malformed comment"),f.comment+="--"+C,f.state=b.COMMENT):f.doctype&&f.doctype!==!0?f.state=b.DOCTYPE_DTD:f.state=b.TEXT;continue;case b.CDATA:for(var z=A-1;C&&C!=="]";)C=lr(P,A++),C&&f.trackPosition&&(f.position++,C===`
`?(f.line++,f.column=0):f.column++);f.cdata+=P.substring(z,A-1),C==="]"&&(f.state=b.CDATA_ENDING);continue;case b.CDATA_ENDING:C==="]"?f.state=b.CDATA_ENDING_2:(f.cdata+="]"+C,f.state=b.CDATA);continue;case b.CDATA_ENDING_2:C===">"?(f.cdata&&M(f,"oncdata",f.cdata),M(f,"onclosecdata"),f.cdata="",f.state=b.TEXT):C==="]"?f.cdata+="]":(f.cdata+="]]"+C,f.state=b.CDATA);continue;case b.PROC_INST:C==="?"?f.state=b.PROC_INST_ENDING:w(C)?f.state=b.PROC_INST_BODY:f.procInstName+=C;continue;case b.PROC_INST_BODY:if(!f.procInstBody&&w(C))continue;C==="?"?f.state=b.PROC_INST_ENDING:f.procInstBody+=C;continue;case b.PROC_INST_ENDING:C===">"?(M(f,"onprocessinginstruction",{name:f.procInstName,body:f.procInstBody}),f.procInstName=f.procInstBody="",f.state=b.TEXT):(f.procInstBody+="?"+C,f.state=b.PROC_INST_BODY);continue;case b.OPEN_TAG:E(I,C)?f.tagName+=C:(Y(f),C===">"?ce(f):C==="/"?f.state=b.OPEN_TAG_SLASH:(w(C)||O(f,"Invalid character in tag name"),f.state=b.ATTRIB));continue;case b.OPEN_TAG_SLASH:C===">"?(ce(f,!0),nr(f)):(O(f,"Forward-slash in opening tag not followed by >"),f.state=b.ATTRIB);continue;case b.ATTRIB:if(w(C))continue;C===">"?ce(f):C==="/"?f.state=b.OPEN_TAG_SLASH:E(D,C)?(f.attribName=C,f.attribValue="",f.state=b.ATTRIB_NAME):O(f,"Invalid attribute name");continue;case b.ATTRIB_NAME:C==="="?f.state=b.ATTRIB_VALUE:C===">"?(O(f,"Attribute without value"),f.attribValue=f.attribName,ke(f),ce(f)):w(C)?f.state=b.ATTRIB_NAME_SAW_WHITE:E(I,C)?f.attribName+=C:O(f,"Invalid attribute name");continue;case b.ATTRIB_NAME_SAW_WHITE:if(C==="=")f.state=b.ATTRIB_VALUE;else{if(w(C))continue;O(f,"Attribute without value"),f.tag.attributes[f.attribName]="",f.attribValue="",M(f,"onattribute",{name:f.attribName,value:""}),f.attribName="",C===">"?ce(f):E(D,C)?(f.attribName=C,f.state=b.ATTRIB_NAME):(O(f,"Invalid attribute name"),f.state=b.ATTRIB)}continue;case b.ATTRIB_VALUE:if(w(C))continue;y(C)?(f.q=C,f.state=b.ATTRIB_VALUE_QUOTED):(f.opt.unquotedAttributeValues||B(f,"Unquoted attribute value"),f.state=b.ATTRIB_VALUE_UNQUOTED,f.attribValue=C);continue;case b.ATTRIB_VALUE_QUOTED:if(C!==f.q){C==="&"?f.state=b.ATTRIB_VALUE_ENTITY_Q:f.attribValue+=C;continue}ke(f),f.q="",f.state=b.ATTRIB_VALUE_CLOSED;continue;case b.ATTRIB_VALUE_CLOSED:w(C)?f.state=b.ATTRIB:C===">"?ce(f):C==="/"?f.state=b.OPEN_TAG_SLASH:E(D,C)?(O(f,"No whitespace between attributes"),f.attribName=C,f.attribValue="",f.state=b.ATTRIB_NAME):O(f,"Invalid attribute name");continue;case b.ATTRIB_VALUE_UNQUOTED:if(!g(C)){C==="&"?f.state=b.ATTRIB_VALUE_ENTITY_U:f.attribValue+=C;continue}ke(f),C===">"?ce(f):f.state=b.ATTRIB;continue;case b.CLOSE_TAG:if(f.tagName)C===">"?nr(f):E(I,C)?f.tagName+=C:f.script?(f.script+="</"+f.tagName,f.tagName="",f.state=b.SCRIPT):(w(C)||O(f,"Invalid tagname in closing tag"),f.state=b.CLOSE_TAG_SAW_WHITE);else{if(w(C))continue;x(D,C)?f.script?(f.script+="</"+C,f.state=b.SCRIPT):O(f,"Invalid tagname in closing tag."):f.tagName=C}continue;case b.CLOSE_TAG_SAW_WHITE:if(w(C))continue;C===">"?nr(f):O(f,"Invalid characters in closing tag");continue;case b.TEXT_ENTITY:case b.ATTRIB_VALUE_ENTITY_Q:case b.ATTRIB_VALUE_ENTITY_U:var K,re;switch(f.state){case b.TEXT_ENTITY:K=b.TEXT,re="textNode";break;case b.ATTRIB_VALUE_ENTITY_Q:K=b.ATTRIB_VALUE_QUOTED,re="attribValue";break;case b.ATTRIB_VALUE_ENTITY_U:K=b.ATTRIB_VALUE_UNQUOTED,re="attribValue";break}if(C===";"){var ie=zs(f);f.opt.unparsedEntities&&!Object.values(u.XML_ENTITIES).includes(ie)?(f.entity="",f.state=K,f.write(ie)):(f[re]+=ie,f.entity="",f.state=K)}else E(f.entity.length?F:T,C)?f.entity+=C:(O(f,"Invalid character in entity name"),f[re]+="&"+f.entity+C,f.entity="",f.state=K);continue;default:throw new Error(f,"Unknown state: "+f.state)}return f.position>=f.bufferCheckPosition&&r(f),f}String.fromCodePoint||function(){var P=String.fromCharCode,f=Math.floor,A=function(){var C=16384,j=[],z,K,re=-1,ie=arguments.length;if(!ie)return"";for(var $e="";++re<ie;){var Z=Number(arguments[re]);if(!isFinite(Z)||Z<0||Z>1114111||f(Z)!==Z)throw RangeError("Invalid code point: "+Z);Z<=65535?j.push(Z):(Z-=65536,z=(Z>>10)+55296,K=Z%1024+56320,j.push(z,K)),(re+1===ie||j.length>C)&&($e+=P.apply(null,j),j.length=0)}return $e};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:A,configurable:!0,writable:!0}):String.fromCodePoint=A}()})(typeof Kt=="undefined"?Kt.sax={}:Kt)});var ps=R(Er=>{(function(){"use strict";Er.stripBOM=function(u){return u[0]==="\uFEFF"?u.substring(1):u}}).call(Er)});var wr=R(Qe=>{(function(){"use strict";var u;u=new RegExp(/(?!xmlns)^.*:/),Qe.normalize=function(t){return t.toLowerCase()},Qe.firstCharLowerCase=function(t){return t.charAt(0).toLowerCase()+t.slice(1)},Qe.stripPrefix=function(t){return t.replace(u,"")},Qe.parseNumbers=function(t){return isNaN(t)||(t=t%1===0?parseInt(t,10):parseFloat(t)),t},Qe.parseBooleans=function(t){return/^(?:true|false)$/i.test(t)&&(t=t.toLowerCase()==="true"),t}}).call(Qe)});var hs=R(Ee=>{(function(){"use strict";var u,t,e,r,i,s,o,n,l=function(h,m){return function(){return h.apply(m,arguments)}},c=function(h,m){for(var d in m)p.call(m,d)&&(h[d]=m[d]);function v(){this.constructor=h}return v.prototype=m.prototype,h.prototype=new v,h.__super__=m.prototype,h},p={}.hasOwnProperty;o=us(),e=require("events"),u=ps(),s=wr(),n=require("timers").setImmediate,t=Ot().defaults,r=function(h){return typeof h=="object"&&h!=null&&Object.keys(h).length===0},i=function(h,m,d){var v,D,I;for(v=0,D=h.length;v<D;v++)I=h[v],m=I(m,d);return m},Ee.Parser=function(h){c(m,h);function m(d){this.parseStringPromise=l(this.parseStringPromise,this),this.parseString=l(this.parseString,this),this.reset=l(this.reset,this),this.assignOrPush=l(this.assignOrPush,this),this.processAsync=l(this.processAsync,this);var v,D,I;if(!(this instanceof Ee.Parser))return new Ee.Parser(d);this.options={},D=t["0.2"];for(v in D)p.call(D,v)&&(I=D[v],this.options[v]=I);for(v in d)p.call(d,v)&&(I=d[v],this.options[v]=I);this.options.xmlns&&(this.options.xmlnskey=this.options.attrkey+"ns"),this.options.normalizeTags&&(this.options.tagNameProcessors||(this.options.tagNameProcessors=[]),this.options.tagNameProcessors.unshift(s.normalize)),this.reset()}return m.prototype.processAsync=function(){var d,v;try{return this.remaining.length<=this.options.chunkSize?(d=this.remaining,this.remaining="",this.saxParser=this.saxParser.write(d),this.saxParser.close()):(d=this.remaining.substr(0,this.options.chunkSize),this.remaining=this.remaining.substr(this.options.chunkSize,this.remaining.length),this.saxParser=this.saxParser.write(d),n(this.processAsync))}catch(D){if(v=D,!this.saxParser.errThrown)return this.saxParser.errThrown=!0,this.emit(v)}},m.prototype.assignOrPush=function(d,v,D){return v in d?(d[v]instanceof Array||(d[v]=[d[v]]),d[v].push(D)):this.options.explicitArray?d[v]=[D]:d[v]=D},m.prototype.reset=function(){var d,v,D,I;return this.removeAllListeners(),this.saxParser=o.parser(this.options.strict,{trim:!1,normalize:!1,xmlns:this.options.xmlns}),this.saxParser.errThrown=!1,this.saxParser.onerror=function(T){return function(F){if(T.saxParser.resume(),!T.saxParser.errThrown)return T.saxParser.errThrown=!0,T.emit("error",F)}}(this),this.saxParser.onend=function(T){return function(){if(!T.saxParser.ended)return T.saxParser.ended=!0,T.emit("end",T.resultObject)}}(this),this.saxParser.ended=!1,this.EXPLICIT_CHARKEY=this.options.explicitCharkey,this.resultObject=null,I=[],d=this.options.attrkey,v=this.options.charkey,this.saxParser.onopentag=function(T){return function(F){var w,y,g,E,x;if(g=Object.create(null),g[v]="",!T.options.ignoreAttrs){x=F.attributes;for(w in x)p.call(x,w)&&(!(d in g)&&!T.options.mergeAttrs&&(g[d]=Object.create(null)),y=T.options.attrValueProcessors?i(T.options.attrValueProcessors,F.attributes[w],w):F.attributes[w],E=T.options.attrNameProcessors?i(T.options.attrNameProcessors,w):w,T.options.mergeAttrs?T.assignOrPush(g,E,y):g[d][E]=y)}return g["#name"]=T.options.tagNameProcessors?i(T.options.tagNameProcessors,F.name):F.name,T.options.xmlns&&(g[T.options.xmlnskey]={uri:F.uri,local:F.local}),I.push(g)}}(this),this.saxParser.onclosetag=function(T){return function(){var F,w,y,g,E,x,b,k,S,M;if(x=I.pop(),E=x["#name"],(!T.options.explicitChildren||!T.options.preserveChildrenOrder)&&delete x["#name"],x.cdata===!0&&(F=x.cdata,delete x.cdata),S=I[I.length-1],x[v].match(/^\s*$/)&&!F?(w=x[v],delete x[v]):(T.options.trim&&(x[v]=x[v].trim()),T.options.normalize&&(x[v]=x[v].replace(/\s{2,}/g," ").trim()),x[v]=T.options.valueProcessors?i(T.options.valueProcessors,x[v],E):x[v],Object.keys(x).length===1&&v in x&&!T.EXPLICIT_CHARKEY&&(x=x[v])),r(x)&&(typeof T.options.emptyTag=="function"?x=T.options.emptyTag():x=T.options.emptyTag!==""?T.options.emptyTag:w),T.options.validator!=null&&(M="/"+function(){var L,q,B;for(B=[],L=0,q=I.length;L<q;L++)g=I[L],B.push(g["#name"]);return B}().concat(E).join("/"),function(){var L;try{return x=T.options.validator(M,S&&S[E],x)}catch(q){return L=q,T.emit("error",L)}}()),T.options.explicitChildren&&!T.options.mergeAttrs&&typeof x=="object"){if(!T.options.preserveChildrenOrder)g=Object.create(null),T.options.attrkey in x&&(g[T.options.attrkey]=x[T.options.attrkey],delete x[T.options.attrkey]),!T.options.charsAsChildren&&T.options.charkey in x&&(g[T.options.charkey]=x[T.options.charkey],delete x[T.options.charkey]),Object.getOwnPropertyNames(x).length>0&&(g[T.options.childkey]=x),x=g;else if(S){S[T.options.childkey]=S[T.options.childkey]||[],b=Object.create(null);for(y in x)p.call(x,y)&&(b[y]=x[y]);S[T.options.childkey].push(b),delete x["#name"],Object.keys(x).length===1&&v in x&&!T.EXPLICIT_CHARKEY&&(x=x[v])}}return I.length>0?T.assignOrPush(S,E,x):(T.options.explicitRoot&&(k=x,x=Object.create(null),x[E]=k),T.resultObject=x,T.saxParser.ended=!0,T.emit("end",T.resultObject))}}(this),D=function(T){return function(F){var w,y;if(y=I[I.length-1],y)return y[v]+=F,T.options.explicitChildren&&T.options.preserveChildrenOrder&&T.options.charsAsChildren&&(T.options.includeWhiteChars||F.replace(/\\n/g,"").trim()!=="")&&(y[T.options.childkey]=y[T.options.childkey]||[],w={"#name":"__text__"},w[v]=F,T.options.normalize&&(w[v]=w[v].replace(/\s{2,}/g," ").trim()),y[T.options.childkey].push(w)),y}}(this),this.saxParser.ontext=D,this.saxParser.oncdata=function(T){return function(F){var w;if(w=D(F),w)return w.cdata=!0}}(this)},m.prototype.parseString=function(d,v){var D;v!=null&&typeof v=="function"&&(this.on("end",function(I){return this.reset(),v(null,I)}),this.on("error",function(I){return this.reset(),v(I)}));try{return d=d.toString(),d.trim()===""?(this.emit("end",null),!0):(d=u.stripBOM(d),this.options.async?(this.remaining=d,n(this.processAsync),this.saxParser):this.saxParser.write(d).close())}catch(I){if(D=I,this.saxParser.errThrown||this.saxParser.ended){if(this.saxParser.ended)throw D}else return this.emit("error",D),this.saxParser.errThrown=!0}},m.prototype.parseStringPromise=function(d){return new Promise(function(v){return function(D,I){return v.parseString(d,function(T,F){return T?I(T):D(F)})}}(this))},m}(e),Ee.parseString=function(h,m,d){var v,D,I;return d!=null?(typeof d=="function"&&(v=d),typeof m=="object"&&(D=m)):(typeof m=="function"&&(v=m),D={}),I=new Ee.Parser(D),I.parseString(h,v)},Ee.parseStringPromise=function(h,m){var d,v;return typeof m=="object"&&(d=m),v=new Ee.Parser(d),v.parseStringPromise(h)}}).call(Ee)});var Sr=R(we=>{(function(){"use strict";var u,t,e,r,i=function(o,n){for(var l in n)s.call(n,l)&&(o[l]=n[l]);function c(){this.constructor=o}return c.prototype=n.prototype,o.prototype=new c,o.__super__=n.prototype,o},s={}.hasOwnProperty;t=Ot(),u=ds(),e=hs(),r=wr(),we.defaults=t.defaults,we.processors=r,we.ValidationError=function(o){i(n,o);function n(l){this.message=l}return n}(Error),we.Builder=u.Builder,we.Parser=e.Parser,we.parseString=e.parseString,we.parseStringPromise=e.parseStringPromise}).call(we)});var fs=R((gl,ms)=>{var Jt=ms.exports={};Jt.feed=[["author","creator"],["dc:publisher","publisher"],["dc:creator","creator"],["dc:source","source"],["dc:title","title"],["dc:type","type"],"title","description","author","pubDate","webMaster","managingEditor","generator","link","language","copyright","lastBuildDate","docs","generator","ttl","rating","skipHours","skipDays"];Jt.item=[["author","creator"],["dc:creator","creator"],["dc:date","date"],["dc:language","language"],["dc:rights","rights"],["dc:source","source"],["dc:title","title"],"title","link","pubDate","author","summary",["content:encoded","content:encoded",{includeSnippet:!0}],"enclosure","dc:creator","dc:date","comments"];var gs=function(u){return["itunes:"+u,u]};Jt.podcastFeed=["author","subtitle","summary","explicit"].map(gs);Jt.podcastItem=["author","subtitle","summary","explicit","duration","image","episode","image","season","keywords","episodeType"].map(gs)});var Dr=R((ml,oa)=>{oa.exports={Aacute:"\xC1",aacute:"\xE1",Abreve:"\u0102",abreve:"\u0103",ac:"\u223E",acd:"\u223F",acE:"\u223E\u0333",Acirc:"\xC2",acirc:"\xE2",acute:"\xB4",Acy:"\u0410",acy:"\u0430",AElig:"\xC6",aelig:"\xE6",af:"\u2061",Afr:"\u{1D504}",afr:"\u{1D51E}",Agrave:"\xC0",agrave:"\xE0",alefsym:"\u2135",aleph:"\u2135",Alpha:"\u0391",alpha:"\u03B1",Amacr:"\u0100",amacr:"\u0101",amalg:"\u2A3F",amp:"&",AMP:"&",andand:"\u2A55",And:"\u2A53",and:"\u2227",andd:"\u2A5C",andslope:"\u2A58",andv:"\u2A5A",ang:"\u2220",ange:"\u29A4",angle:"\u2220",angmsdaa:"\u29A8",angmsdab:"\u29A9",angmsdac:"\u29AA",angmsdad:"\u29AB",angmsdae:"\u29AC",angmsdaf:"\u29AD",angmsdag:"\u29AE",angmsdah:"\u29AF",angmsd:"\u2221",angrt:"\u221F",angrtvb:"\u22BE",angrtvbd:"\u299D",angsph:"\u2222",angst:"\xC5",angzarr:"\u237C",Aogon:"\u0104",aogon:"\u0105",Aopf:"\u{1D538}",aopf:"\u{1D552}",apacir:"\u2A6F",ap:"\u2248",apE:"\u2A70",ape:"\u224A",apid:"\u224B",apos:"'",ApplyFunction:"\u2061",approx:"\u2248",approxeq:"\u224A",Aring:"\xC5",aring:"\xE5",Ascr:"\u{1D49C}",ascr:"\u{1D4B6}",Assign:"\u2254",ast:"*",asymp:"\u2248",asympeq:"\u224D",Atilde:"\xC3",atilde:"\xE3",Auml:"\xC4",auml:"\xE4",awconint:"\u2233",awint:"\u2A11",backcong:"\u224C",backepsilon:"\u03F6",backprime:"\u2035",backsim:"\u223D",backsimeq:"\u22CD",Backslash:"\u2216",Barv:"\u2AE7",barvee:"\u22BD",barwed:"\u2305",Barwed:"\u2306",barwedge:"\u2305",bbrk:"\u23B5",bbrktbrk:"\u23B6",bcong:"\u224C",Bcy:"\u0411",bcy:"\u0431",bdquo:"\u201E",becaus:"\u2235",because:"\u2235",Because:"\u2235",bemptyv:"\u29B0",bepsi:"\u03F6",bernou:"\u212C",Bernoullis:"\u212C",Beta:"\u0392",beta:"\u03B2",beth:"\u2136",between:"\u226C",Bfr:"\u{1D505}",bfr:"\u{1D51F}",bigcap:"\u22C2",bigcirc:"\u25EF",bigcup:"\u22C3",bigodot:"\u2A00",bigoplus:"\u2A01",bigotimes:"\u2A02",bigsqcup:"\u2A06",bigstar:"\u2605",bigtriangledown:"\u25BD",bigtriangleup:"\u25B3",biguplus:"\u2A04",bigvee:"\u22C1",bigwedge:"\u22C0",bkarow:"\u290D",blacklozenge:"\u29EB",blacksquare:"\u25AA",blacktriangle:"\u25B4",blacktriangledown:"\u25BE",blacktriangleleft:"\u25C2",blacktriangleright:"\u25B8",blank:"\u2423",blk12:"\u2592",blk14:"\u2591",blk34:"\u2593",block:"\u2588",bne:"=\u20E5",bnequiv:"\u2261\u20E5",bNot:"\u2AED",bnot:"\u2310",Bopf:"\u{1D539}",bopf:"\u{1D553}",bot:"\u22A5",bottom:"\u22A5",bowtie:"\u22C8",boxbox:"\u29C9",boxdl:"\u2510",boxdL:"\u2555",boxDl:"\u2556",boxDL:"\u2557",boxdr:"\u250C",boxdR:"\u2552",boxDr:"\u2553",boxDR:"\u2554",boxh:"\u2500",boxH:"\u2550",boxhd:"\u252C",boxHd:"\u2564",boxhD:"\u2565",boxHD:"\u2566",boxhu:"\u2534",boxHu:"\u2567",boxhU:"\u2568",boxHU:"\u2569",boxminus:"\u229F",boxplus:"\u229E",boxtimes:"\u22A0",boxul:"\u2518",boxuL:"\u255B",boxUl:"\u255C",boxUL:"\u255D",boxur:"\u2514",boxuR:"\u2558",boxUr:"\u2559",boxUR:"\u255A",boxv:"\u2502",boxV:"\u2551",boxvh:"\u253C",boxvH:"\u256A",boxVh:"\u256B",boxVH:"\u256C",boxvl:"\u2524",boxvL:"\u2561",boxVl:"\u2562",boxVL:"\u2563",boxvr:"\u251C",boxvR:"\u255E",boxVr:"\u255F",boxVR:"\u2560",bprime:"\u2035",breve:"\u02D8",Breve:"\u02D8",brvbar:"\xA6",bscr:"\u{1D4B7}",Bscr:"\u212C",bsemi:"\u204F",bsim:"\u223D",bsime:"\u22CD",bsolb:"\u29C5",bsol:"\\",bsolhsub:"\u27C8",bull:"\u2022",bullet:"\u2022",bump:"\u224E",bumpE:"\u2AAE",bumpe:"\u224F",Bumpeq:"\u224E",bumpeq:"\u224F",Cacute:"\u0106",cacute:"\u0107",capand:"\u2A44",capbrcup:"\u2A49",capcap:"\u2A4B",cap:"\u2229",Cap:"\u22D2",capcup:"\u2A47",capdot:"\u2A40",CapitalDifferentialD:"\u2145",caps:"\u2229\uFE00",caret:"\u2041",caron:"\u02C7",Cayleys:"\u212D",ccaps:"\u2A4D",Ccaron:"\u010C",ccaron:"\u010D",Ccedil:"\xC7",ccedil:"\xE7",Ccirc:"\u0108",ccirc:"\u0109",Cconint:"\u2230",ccups:"\u2A4C",ccupssm:"\u2A50",Cdot:"\u010A",cdot:"\u010B",cedil:"\xB8",Cedilla:"\xB8",cemptyv:"\u29B2",cent:"\xA2",centerdot:"\xB7",CenterDot:"\xB7",cfr:"\u{1D520}",Cfr:"\u212D",CHcy:"\u0427",chcy:"\u0447",check:"\u2713",checkmark:"\u2713",Chi:"\u03A7",chi:"\u03C7",circ:"\u02C6",circeq:"\u2257",circlearrowleft:"\u21BA",circlearrowright:"\u21BB",circledast:"\u229B",circledcirc:"\u229A",circleddash:"\u229D",CircleDot:"\u2299",circledR:"\xAE",circledS:"\u24C8",CircleMinus:"\u2296",CirclePlus:"\u2295",CircleTimes:"\u2297",cir:"\u25CB",cirE:"\u29C3",cire:"\u2257",cirfnint:"\u2A10",cirmid:"\u2AEF",cirscir:"\u29C2",ClockwiseContourIntegral:"\u2232",CloseCurlyDoubleQuote:"\u201D",CloseCurlyQuote:"\u2019",clubs:"\u2663",clubsuit:"\u2663",colon:":",Colon:"\u2237",Colone:"\u2A74",colone:"\u2254",coloneq:"\u2254",comma:",",commat:"@",comp:"\u2201",compfn:"\u2218",complement:"\u2201",complexes:"\u2102",cong:"\u2245",congdot:"\u2A6D",Congruent:"\u2261",conint:"\u222E",Conint:"\u222F",ContourIntegral:"\u222E",copf:"\u{1D554}",Copf:"\u2102",coprod:"\u2210",Coproduct:"\u2210",copy:"\xA9",COPY:"\xA9",copysr:"\u2117",CounterClockwiseContourIntegral:"\u2233",crarr:"\u21B5",cross:"\u2717",Cross:"\u2A2F",Cscr:"\u{1D49E}",cscr:"\u{1D4B8}",csub:"\u2ACF",csube:"\u2AD1",csup:"\u2AD0",csupe:"\u2AD2",ctdot:"\u22EF",cudarrl:"\u2938",cudarrr:"\u2935",cuepr:"\u22DE",cuesc:"\u22DF",cularr:"\u21B6",cularrp:"\u293D",cupbrcap:"\u2A48",cupcap:"\u2A46",CupCap:"\u224D",cup:"\u222A",Cup:"\u22D3",cupcup:"\u2A4A",cupdot:"\u228D",cupor:"\u2A45",cups:"\u222A\uFE00",curarr:"\u21B7",curarrm:"\u293C",curlyeqprec:"\u22DE",curlyeqsucc:"\u22DF",curlyvee:"\u22CE",curlywedge:"\u22CF",curren:"\xA4",curvearrowleft:"\u21B6",curvearrowright:"\u21B7",cuvee:"\u22CE",cuwed:"\u22CF",cwconint:"\u2232",cwint:"\u2231",cylcty:"\u232D",dagger:"\u2020",Dagger:"\u2021",daleth:"\u2138",darr:"\u2193",Darr:"\u21A1",dArr:"\u21D3",dash:"\u2010",Dashv:"\u2AE4",dashv:"\u22A3",dbkarow:"\u290F",dblac:"\u02DD",Dcaron:"\u010E",dcaron:"\u010F",Dcy:"\u0414",dcy:"\u0434",ddagger:"\u2021",ddarr:"\u21CA",DD:"\u2145",dd:"\u2146",DDotrahd:"\u2911",ddotseq:"\u2A77",deg:"\xB0",Del:"\u2207",Delta:"\u0394",delta:"\u03B4",demptyv:"\u29B1",dfisht:"\u297F",Dfr:"\u{1D507}",dfr:"\u{1D521}",dHar:"\u2965",dharl:"\u21C3",dharr:"\u21C2",DiacriticalAcute:"\xB4",DiacriticalDot:"\u02D9",DiacriticalDoubleAcute:"\u02DD",DiacriticalGrave:"`",DiacriticalTilde:"\u02DC",diam:"\u22C4",diamond:"\u22C4",Diamond:"\u22C4",diamondsuit:"\u2666",diams:"\u2666",die:"\xA8",DifferentialD:"\u2146",digamma:"\u03DD",disin:"\u22F2",div:"\xF7",divide:"\xF7",divideontimes:"\u22C7",divonx:"\u22C7",DJcy:"\u0402",djcy:"\u0452",dlcorn:"\u231E",dlcrop:"\u230D",dollar:"$",Dopf:"\u{1D53B}",dopf:"\u{1D555}",Dot:"\xA8",dot:"\u02D9",DotDot:"\u20DC",doteq:"\u2250",doteqdot:"\u2251",DotEqual:"\u2250",dotminus:"\u2238",dotplus:"\u2214",dotsquare:"\u22A1",doublebarwedge:"\u2306",DoubleContourIntegral:"\u222F",DoubleDot:"\xA8",DoubleDownArrow:"\u21D3",DoubleLeftArrow:"\u21D0",DoubleLeftRightArrow:"\u21D4",DoubleLeftTee:"\u2AE4",DoubleLongLeftArrow:"\u27F8",DoubleLongLeftRightArrow:"\u27FA",DoubleLongRightArrow:"\u27F9",DoubleRightArrow:"\u21D2",DoubleRightTee:"\u22A8",DoubleUpArrow:"\u21D1",DoubleUpDownArrow:"\u21D5",DoubleVerticalBar:"\u2225",DownArrowBar:"\u2913",downarrow:"\u2193",DownArrow:"\u2193",Downarrow:"\u21D3",DownArrowUpArrow:"\u21F5",DownBreve:"\u0311",downdownarrows:"\u21CA",downharpoonleft:"\u21C3",downharpoonright:"\u21C2",DownLeftRightVector:"\u2950",DownLeftTeeVector:"\u295E",DownLeftVectorBar:"\u2956",DownLeftVector:"\u21BD",DownRightTeeVector:"\u295F",DownRightVectorBar:"\u2957",DownRightVector:"\u21C1",DownTeeArrow:"\u21A7",DownTee:"\u22A4",drbkarow:"\u2910",drcorn:"\u231F",drcrop:"\u230C",Dscr:"\u{1D49F}",dscr:"\u{1D4B9}",DScy:"\u0405",dscy:"\u0455",dsol:"\u29F6",Dstrok:"\u0110",dstrok:"\u0111",dtdot:"\u22F1",dtri:"\u25BF",dtrif:"\u25BE",duarr:"\u21F5",duhar:"\u296F",dwangle:"\u29A6",DZcy:"\u040F",dzcy:"\u045F",dzigrarr:"\u27FF",Eacute:"\xC9",eacute:"\xE9",easter:"\u2A6E",Ecaron:"\u011A",ecaron:"\u011B",Ecirc:"\xCA",ecirc:"\xEA",ecir:"\u2256",ecolon:"\u2255",Ecy:"\u042D",ecy:"\u044D",eDDot:"\u2A77",Edot:"\u0116",edot:"\u0117",eDot:"\u2251",ee:"\u2147",efDot:"\u2252",Efr:"\u{1D508}",efr:"\u{1D522}",eg:"\u2A9A",Egrave:"\xC8",egrave:"\xE8",egs:"\u2A96",egsdot:"\u2A98",el:"\u2A99",Element:"\u2208",elinters:"\u23E7",ell:"\u2113",els:"\u2A95",elsdot:"\u2A97",Emacr:"\u0112",emacr:"\u0113",empty:"\u2205",emptyset:"\u2205",EmptySmallSquare:"\u25FB",emptyv:"\u2205",EmptyVerySmallSquare:"\u25AB",emsp13:"\u2004",emsp14:"\u2005",emsp:"\u2003",ENG:"\u014A",eng:"\u014B",ensp:"\u2002",Eogon:"\u0118",eogon:"\u0119",Eopf:"\u{1D53C}",eopf:"\u{1D556}",epar:"\u22D5",eparsl:"\u29E3",eplus:"\u2A71",epsi:"\u03B5",Epsilon:"\u0395",epsilon:"\u03B5",epsiv:"\u03F5",eqcirc:"\u2256",eqcolon:"\u2255",eqsim:"\u2242",eqslantgtr:"\u2A96",eqslantless:"\u2A95",Equal:"\u2A75",equals:"=",EqualTilde:"\u2242",equest:"\u225F",Equilibrium:"\u21CC",equiv:"\u2261",equivDD:"\u2A78",eqvparsl:"\u29E5",erarr:"\u2971",erDot:"\u2253",escr:"\u212F",Escr:"\u2130",esdot:"\u2250",Esim:"\u2A73",esim:"\u2242",Eta:"\u0397",eta:"\u03B7",ETH:"\xD0",eth:"\xF0",Euml:"\xCB",euml:"\xEB",euro:"\u20AC",excl:"!",exist:"\u2203",Exists:"\u2203",expectation:"\u2130",exponentiale:"\u2147",ExponentialE:"\u2147",fallingdotseq:"\u2252",Fcy:"\u0424",fcy:"\u0444",female:"\u2640",ffilig:"\uFB03",fflig:"\uFB00",ffllig:"\uFB04",Ffr:"\u{1D509}",ffr:"\u{1D523}",filig:"\uFB01",FilledSmallSquare:"\u25FC",FilledVerySmallSquare:"\u25AA",fjlig:"fj",flat:"\u266D",fllig:"\uFB02",fltns:"\u25B1",fnof:"\u0192",Fopf:"\u{1D53D}",fopf:"\u{1D557}",forall:"\u2200",ForAll:"\u2200",fork:"\u22D4",forkv:"\u2AD9",Fouriertrf:"\u2131",fpartint:"\u2A0D",frac12:"\xBD",frac13:"\u2153",frac14:"\xBC",frac15:"\u2155",frac16:"\u2159",frac18:"\u215B",frac23:"\u2154",frac25:"\u2156",frac34:"\xBE",frac35:"\u2157",frac38:"\u215C",frac45:"\u2158",frac56:"\u215A",frac58:"\u215D",frac78:"\u215E",frasl:"\u2044",frown:"\u2322",fscr:"\u{1D4BB}",Fscr:"\u2131",gacute:"\u01F5",Gamma:"\u0393",gamma:"\u03B3",Gammad:"\u03DC",gammad:"\u03DD",gap:"\u2A86",Gbreve:"\u011E",gbreve:"\u011F",Gcedil:"\u0122",Gcirc:"\u011C",gcirc:"\u011D",Gcy:"\u0413",gcy:"\u0433",Gdot:"\u0120",gdot:"\u0121",ge:"\u2265",gE:"\u2267",gEl:"\u2A8C",gel:"\u22DB",geq:"\u2265",geqq:"\u2267",geqslant:"\u2A7E",gescc:"\u2AA9",ges:"\u2A7E",gesdot:"\u2A80",gesdoto:"\u2A82",gesdotol:"\u2A84",gesl:"\u22DB\uFE00",gesles:"\u2A94",Gfr:"\u{1D50A}",gfr:"\u{1D524}",gg:"\u226B",Gg:"\u22D9",ggg:"\u22D9",gimel:"\u2137",GJcy:"\u0403",gjcy:"\u0453",gla:"\u2AA5",gl:"\u2277",glE:"\u2A92",glj:"\u2AA4",gnap:"\u2A8A",gnapprox:"\u2A8A",gne:"\u2A88",gnE:"\u2269",gneq:"\u2A88",gneqq:"\u2269",gnsim:"\u22E7",Gopf:"\u{1D53E}",gopf:"\u{1D558}",grave:"`",GreaterEqual:"\u2265",GreaterEqualLess:"\u22DB",GreaterFullEqual:"\u2267",GreaterGreater:"\u2AA2",GreaterLess:"\u2277",GreaterSlantEqual:"\u2A7E",GreaterTilde:"\u2273",Gscr:"\u{1D4A2}",gscr:"\u210A",gsim:"\u2273",gsime:"\u2A8E",gsiml:"\u2A90",gtcc:"\u2AA7",gtcir:"\u2A7A",gt:">",GT:">",Gt:"\u226B",gtdot:"\u22D7",gtlPar:"\u2995",gtquest:"\u2A7C",gtrapprox:"\u2A86",gtrarr:"\u2978",gtrdot:"\u22D7",gtreqless:"\u22DB",gtreqqless:"\u2A8C",gtrless:"\u2277",gtrsim:"\u2273",gvertneqq:"\u2269\uFE00",gvnE:"\u2269\uFE00",Hacek:"\u02C7",hairsp:"\u200A",half:"\xBD",hamilt:"\u210B",HARDcy:"\u042A",hardcy:"\u044A",harrcir:"\u2948",harr:"\u2194",hArr:"\u21D4",harrw:"\u21AD",Hat:"^",hbar:"\u210F",Hcirc:"\u0124",hcirc:"\u0125",hearts:"\u2665",heartsuit:"\u2665",hellip:"\u2026",hercon:"\u22B9",hfr:"\u{1D525}",Hfr:"\u210C",HilbertSpace:"\u210B",hksearow:"\u2925",hkswarow:"\u2926",hoarr:"\u21FF",homtht:"\u223B",hookleftarrow:"\u21A9",hookrightarrow:"\u21AA",hopf:"\u{1D559}",Hopf:"\u210D",horbar:"\u2015",HorizontalLine:"\u2500",hscr:"\u{1D4BD}",Hscr:"\u210B",hslash:"\u210F",Hstrok:"\u0126",hstrok:"\u0127",HumpDownHump:"\u224E",HumpEqual:"\u224F",hybull:"\u2043",hyphen:"\u2010",Iacute:"\xCD",iacute:"\xED",ic:"\u2063",Icirc:"\xCE",icirc:"\xEE",Icy:"\u0418",icy:"\u0438",Idot:"\u0130",IEcy:"\u0415",iecy:"\u0435",iexcl:"\xA1",iff:"\u21D4",ifr:"\u{1D526}",Ifr:"\u2111",Igrave:"\xCC",igrave:"\xEC",ii:"\u2148",iiiint:"\u2A0C",iiint:"\u222D",iinfin:"\u29DC",iiota:"\u2129",IJlig:"\u0132",ijlig:"\u0133",Imacr:"\u012A",imacr:"\u012B",image:"\u2111",ImaginaryI:"\u2148",imagline:"\u2110",imagpart:"\u2111",imath:"\u0131",Im:"\u2111",imof:"\u22B7",imped:"\u01B5",Implies:"\u21D2",incare:"\u2105",in:"\u2208",infin:"\u221E",infintie:"\u29DD",inodot:"\u0131",intcal:"\u22BA",int:"\u222B",Int:"\u222C",integers:"\u2124",Integral:"\u222B",intercal:"\u22BA",Intersection:"\u22C2",intlarhk:"\u2A17",intprod:"\u2A3C",InvisibleComma:"\u2063",InvisibleTimes:"\u2062",IOcy:"\u0401",iocy:"\u0451",Iogon:"\u012E",iogon:"\u012F",Iopf:"\u{1D540}",iopf:"\u{1D55A}",Iota:"\u0399",iota:"\u03B9",iprod:"\u2A3C",iquest:"\xBF",iscr:"\u{1D4BE}",Iscr:"\u2110",isin:"\u2208",isindot:"\u22F5",isinE:"\u22F9",isins:"\u22F4",isinsv:"\u22F3",isinv:"\u2208",it:"\u2062",Itilde:"\u0128",itilde:"\u0129",Iukcy:"\u0406",iukcy:"\u0456",Iuml:"\xCF",iuml:"\xEF",Jcirc:"\u0134",jcirc:"\u0135",Jcy:"\u0419",jcy:"\u0439",Jfr:"\u{1D50D}",jfr:"\u{1D527}",jmath:"\u0237",Jopf:"\u{1D541}",jopf:"\u{1D55B}",Jscr:"\u{1D4A5}",jscr:"\u{1D4BF}",Jsercy:"\u0408",jsercy:"\u0458",Jukcy:"\u0404",jukcy:"\u0454",Kappa:"\u039A",kappa:"\u03BA",kappav:"\u03F0",Kcedil:"\u0136",kcedil:"\u0137",Kcy:"\u041A",kcy:"\u043A",Kfr:"\u{1D50E}",kfr:"\u{1D528}",kgreen:"\u0138",KHcy:"\u0425",khcy:"\u0445",KJcy:"\u040C",kjcy:"\u045C",Kopf:"\u{1D542}",kopf:"\u{1D55C}",Kscr:"\u{1D4A6}",kscr:"\u{1D4C0}",lAarr:"\u21DA",Lacute:"\u0139",lacute:"\u013A",laemptyv:"\u29B4",lagran:"\u2112",Lambda:"\u039B",lambda:"\u03BB",lang:"\u27E8",Lang:"\u27EA",langd:"\u2991",langle:"\u27E8",lap:"\u2A85",Laplacetrf:"\u2112",laquo:"\xAB",larrb:"\u21E4",larrbfs:"\u291F",larr:"\u2190",Larr:"\u219E",lArr:"\u21D0",larrfs:"\u291D",larrhk:"\u21A9",larrlp:"\u21AB",larrpl:"\u2939",larrsim:"\u2973",larrtl:"\u21A2",latail:"\u2919",lAtail:"\u291B",lat:"\u2AAB",late:"\u2AAD",lates:"\u2AAD\uFE00",lbarr:"\u290C",lBarr:"\u290E",lbbrk:"\u2772",lbrace:"{",lbrack:"[",lbrke:"\u298B",lbrksld:"\u298F",lbrkslu:"\u298D",Lcaron:"\u013D",lcaron:"\u013E",Lcedil:"\u013B",lcedil:"\u013C",lceil:"\u2308",lcub:"{",Lcy:"\u041B",lcy:"\u043B",ldca:"\u2936",ldquo:"\u201C",ldquor:"\u201E",ldrdhar:"\u2967",ldrushar:"\u294B",ldsh:"\u21B2",le:"\u2264",lE:"\u2266",LeftAngleBracket:"\u27E8",LeftArrowBar:"\u21E4",leftarrow:"\u2190",LeftArrow:"\u2190",Leftarrow:"\u21D0",LeftArrowRightArrow:"\u21C6",leftarrowtail:"\u21A2",LeftCeiling:"\u2308",LeftDoubleBracket:"\u27E6",LeftDownTeeVector:"\u2961",LeftDownVectorBar:"\u2959",LeftDownVector:"\u21C3",LeftFloor:"\u230A",leftharpoondown:"\u21BD",leftharpoonup:"\u21BC",leftleftarrows:"\u21C7",leftrightarrow:"\u2194",LeftRightArrow:"\u2194",Leftrightarrow:"\u21D4",leftrightarrows:"\u21C6",leftrightharpoons:"\u21CB",leftrightsquigarrow:"\u21AD",LeftRightVector:"\u294E",LeftTeeArrow:"\u21A4",LeftTee:"\u22A3",LeftTeeVector:"\u295A",leftthreetimes:"\u22CB",LeftTriangleBar:"\u29CF",LeftTriangle:"\u22B2",LeftTriangleEqual:"\u22B4",LeftUpDownVector:"\u2951",LeftUpTeeVector:"\u2960",LeftUpVectorBar:"\u2958",LeftUpVector:"\u21BF",LeftVectorBar:"\u2952",LeftVector:"\u21BC",lEg:"\u2A8B",leg:"\u22DA",leq:"\u2264",leqq:"\u2266",leqslant:"\u2A7D",lescc:"\u2AA8",les:"\u2A7D",lesdot:"\u2A7F",lesdoto:"\u2A81",lesdotor:"\u2A83",lesg:"\u22DA\uFE00",lesges:"\u2A93",lessapprox:"\u2A85",lessdot:"\u22D6",lesseqgtr:"\u22DA",lesseqqgtr:"\u2A8B",LessEqualGreater:"\u22DA",LessFullEqual:"\u2266",LessGreater:"\u2276",lessgtr:"\u2276",LessLess:"\u2AA1",lesssim:"\u2272",LessSlantEqual:"\u2A7D",LessTilde:"\u2272",lfisht:"\u297C",lfloor:"\u230A",Lfr:"\u{1D50F}",lfr:"\u{1D529}",lg:"\u2276",lgE:"\u2A91",lHar:"\u2962",lhard:"\u21BD",lharu:"\u21BC",lharul:"\u296A",lhblk:"\u2584",LJcy:"\u0409",ljcy:"\u0459",llarr:"\u21C7",ll:"\u226A",Ll:"\u22D8",llcorner:"\u231E",Lleftarrow:"\u21DA",llhard:"\u296B",lltri:"\u25FA",Lmidot:"\u013F",lmidot:"\u0140",lmoustache:"\u23B0",lmoust:"\u23B0",lnap:"\u2A89",lnapprox:"\u2A89",lne:"\u2A87",lnE:"\u2268",lneq:"\u2A87",lneqq:"\u2268",lnsim:"\u22E6",loang:"\u27EC",loarr:"\u21FD",lobrk:"\u27E6",longleftarrow:"\u27F5",LongLeftArrow:"\u27F5",Longleftarrow:"\u27F8",longleftrightarrow:"\u27F7",LongLeftRightArrow:"\u27F7",Longleftrightarrow:"\u27FA",longmapsto:"\u27FC",longrightarrow:"\u27F6",LongRightArrow:"\u27F6",Longrightarrow:"\u27F9",looparrowleft:"\u21AB",looparrowright:"\u21AC",lopar:"\u2985",Lopf:"\u{1D543}",lopf:"\u{1D55D}",loplus:"\u2A2D",lotimes:"\u2A34",lowast:"\u2217",lowbar:"_",LowerLeftArrow:"\u2199",LowerRightArrow:"\u2198",loz:"\u25CA",lozenge:"\u25CA",lozf:"\u29EB",lpar:"(",lparlt:"\u2993",lrarr:"\u21C6",lrcorner:"\u231F",lrhar:"\u21CB",lrhard:"\u296D",lrm:"\u200E",lrtri:"\u22BF",lsaquo:"\u2039",lscr:"\u{1D4C1}",Lscr:"\u2112",lsh:"\u21B0",Lsh:"\u21B0",lsim:"\u2272",lsime:"\u2A8D",lsimg:"\u2A8F",lsqb:"[",lsquo:"\u2018",lsquor:"\u201A",Lstrok:"\u0141",lstrok:"\u0142",ltcc:"\u2AA6",ltcir:"\u2A79",lt:"<",LT:"<",Lt:"\u226A",ltdot:"\u22D6",lthree:"\u22CB",ltimes:"\u22C9",ltlarr:"\u2976",ltquest:"\u2A7B",ltri:"\u25C3",ltrie:"\u22B4",ltrif:"\u25C2",ltrPar:"\u2996",lurdshar:"\u294A",luruhar:"\u2966",lvertneqq:"\u2268\uFE00",lvnE:"\u2268\uFE00",macr:"\xAF",male:"\u2642",malt:"\u2720",maltese:"\u2720",Map:"\u2905",map:"\u21A6",mapsto:"\u21A6",mapstodown:"\u21A7",mapstoleft:"\u21A4",mapstoup:"\u21A5",marker:"\u25AE",mcomma:"\u2A29",Mcy:"\u041C",mcy:"\u043C",mdash:"\u2014",mDDot:"\u223A",measuredangle:"\u2221",MediumSpace:"\u205F",Mellintrf:"\u2133",Mfr:"\u{1D510}",mfr:"\u{1D52A}",mho:"\u2127",micro:"\xB5",midast:"*",midcir:"\u2AF0",mid:"\u2223",middot:"\xB7",minusb:"\u229F",minus:"\u2212",minusd:"\u2238",minusdu:"\u2A2A",MinusPlus:"\u2213",mlcp:"\u2ADB",mldr:"\u2026",mnplus:"\u2213",models:"\u22A7",Mopf:"\u{1D544}",mopf:"\u{1D55E}",mp:"\u2213",mscr:"\u{1D4C2}",Mscr:"\u2133",mstpos:"\u223E",Mu:"\u039C",mu:"\u03BC",multimap:"\u22B8",mumap:"\u22B8",nabla:"\u2207",Nacute:"\u0143",nacute:"\u0144",nang:"\u2220\u20D2",nap:"\u2249",napE:"\u2A70\u0338",napid:"\u224B\u0338",napos:"\u0149",napprox:"\u2249",natural:"\u266E",naturals:"\u2115",natur:"\u266E",nbsp:"\xA0",nbump:"\u224E\u0338",nbumpe:"\u224F\u0338",ncap:"\u2A43",Ncaron:"\u0147",ncaron:"\u0148",Ncedil:"\u0145",ncedil:"\u0146",ncong:"\u2247",ncongdot:"\u2A6D\u0338",ncup:"\u2A42",Ncy:"\u041D",ncy:"\u043D",ndash:"\u2013",nearhk:"\u2924",nearr:"\u2197",neArr:"\u21D7",nearrow:"\u2197",ne:"\u2260",nedot:"\u2250\u0338",NegativeMediumSpace:"\u200B",NegativeThickSpace:"\u200B",NegativeThinSpace:"\u200B",NegativeVeryThinSpace:"\u200B",nequiv:"\u2262",nesear:"\u2928",nesim:"\u2242\u0338",NestedGreaterGreater:"\u226B",NestedLessLess:"\u226A",NewLine:`
`,nexist:"\u2204",nexists:"\u2204",Nfr:"\u{1D511}",nfr:"\u{1D52B}",ngE:"\u2267\u0338",nge:"\u2271",ngeq:"\u2271",ngeqq:"\u2267\u0338",ngeqslant:"\u2A7E\u0338",nges:"\u2A7E\u0338",nGg:"\u22D9\u0338",ngsim:"\u2275",nGt:"\u226B\u20D2",ngt:"\u226F",ngtr:"\u226F",nGtv:"\u226B\u0338",nharr:"\u21AE",nhArr:"\u21CE",nhpar:"\u2AF2",ni:"\u220B",nis:"\u22FC",nisd:"\u22FA",niv:"\u220B",NJcy:"\u040A",njcy:"\u045A",nlarr:"\u219A",nlArr:"\u21CD",nldr:"\u2025",nlE:"\u2266\u0338",nle:"\u2270",nleftarrow:"\u219A",nLeftarrow:"\u21CD",nleftrightarrow:"\u21AE",nLeftrightarrow:"\u21CE",nleq:"\u2270",nleqq:"\u2266\u0338",nleqslant:"\u2A7D\u0338",nles:"\u2A7D\u0338",nless:"\u226E",nLl:"\u22D8\u0338",nlsim:"\u2274",nLt:"\u226A\u20D2",nlt:"\u226E",nltri:"\u22EA",nltrie:"\u22EC",nLtv:"\u226A\u0338",nmid:"\u2224",NoBreak:"\u2060",NonBreakingSpace:"\xA0",nopf:"\u{1D55F}",Nopf:"\u2115",Not:"\u2AEC",not:"\xAC",NotCongruent:"\u2262",NotCupCap:"\u226D",NotDoubleVerticalBar:"\u2226",NotElement:"\u2209",NotEqual:"\u2260",NotEqualTilde:"\u2242\u0338",NotExists:"\u2204",NotGreater:"\u226F",NotGreaterEqual:"\u2271",NotGreaterFullEqual:"\u2267\u0338",NotGreaterGreater:"\u226B\u0338",NotGreaterLess:"\u2279",NotGreaterSlantEqual:"\u2A7E\u0338",NotGreaterTilde:"\u2275",NotHumpDownHump:"\u224E\u0338",NotHumpEqual:"\u224F\u0338",notin:"\u2209",notindot:"\u22F5\u0338",notinE:"\u22F9\u0338",notinva:"\u2209",notinvb:"\u22F7",notinvc:"\u22F6",NotLeftTriangleBar:"\u29CF\u0338",NotLeftTriangle:"\u22EA",NotLeftTriangleEqual:"\u22EC",NotLess:"\u226E",NotLessEqual:"\u2270",NotLessGreater:"\u2278",NotLessLess:"\u226A\u0338",NotLessSlantEqual:"\u2A7D\u0338",NotLessTilde:"\u2274",NotNestedGreaterGreater:"\u2AA2\u0338",NotNestedLessLess:"\u2AA1\u0338",notni:"\u220C",notniva:"\u220C",notnivb:"\u22FE",notnivc:"\u22FD",NotPrecedes:"\u2280",NotPrecedesEqual:"\u2AAF\u0338",NotPrecedesSlantEqual:"\u22E0",NotReverseElement:"\u220C",NotRightTriangleBar:"\u29D0\u0338",NotRightTriangle:"\u22EB",NotRightTriangleEqual:"\u22ED",NotSquareSubset:"\u228F\u0338",NotSquareSubsetEqual:"\u22E2",NotSquareSuperset:"\u2290\u0338",NotSquareSupersetEqual:"\u22E3",NotSubset:"\u2282\u20D2",NotSubsetEqual:"\u2288",NotSucceeds:"\u2281",NotSucceedsEqual:"\u2AB0\u0338",NotSucceedsSlantEqual:"\u22E1",NotSucceedsTilde:"\u227F\u0338",NotSuperset:"\u2283\u20D2",NotSupersetEqual:"\u2289",NotTilde:"\u2241",NotTildeEqual:"\u2244",NotTildeFullEqual:"\u2247",NotTildeTilde:"\u2249",NotVerticalBar:"\u2224",nparallel:"\u2226",npar:"\u2226",nparsl:"\u2AFD\u20E5",npart:"\u2202\u0338",npolint:"\u2A14",npr:"\u2280",nprcue:"\u22E0",nprec:"\u2280",npreceq:"\u2AAF\u0338",npre:"\u2AAF\u0338",nrarrc:"\u2933\u0338",nrarr:"\u219B",nrArr:"\u21CF",nrarrw:"\u219D\u0338",nrightarrow:"\u219B",nRightarrow:"\u21CF",nrtri:"\u22EB",nrtrie:"\u22ED",nsc:"\u2281",nsccue:"\u22E1",nsce:"\u2AB0\u0338",Nscr:"\u{1D4A9}",nscr:"\u{1D4C3}",nshortmid:"\u2224",nshortparallel:"\u2226",nsim:"\u2241",nsime:"\u2244",nsimeq:"\u2244",nsmid:"\u2224",nspar:"\u2226",nsqsube:"\u22E2",nsqsupe:"\u22E3",nsub:"\u2284",nsubE:"\u2AC5\u0338",nsube:"\u2288",nsubset:"\u2282\u20D2",nsubseteq:"\u2288",nsubseteqq:"\u2AC5\u0338",nsucc:"\u2281",nsucceq:"\u2AB0\u0338",nsup:"\u2285",nsupE:"\u2AC6\u0338",nsupe:"\u2289",nsupset:"\u2283\u20D2",nsupseteq:"\u2289",nsupseteqq:"\u2AC6\u0338",ntgl:"\u2279",Ntilde:"\xD1",ntilde:"\xF1",ntlg:"\u2278",ntriangleleft:"\u22EA",ntrianglelefteq:"\u22EC",ntriangleright:"\u22EB",ntrianglerighteq:"\u22ED",Nu:"\u039D",nu:"\u03BD",num:"#",numero:"\u2116",numsp:"\u2007",nvap:"\u224D\u20D2",nvdash:"\u22AC",nvDash:"\u22AD",nVdash:"\u22AE",nVDash:"\u22AF",nvge:"\u2265\u20D2",nvgt:">\u20D2",nvHarr:"\u2904",nvinfin:"\u29DE",nvlArr:"\u2902",nvle:"\u2264\u20D2",nvlt:"<\u20D2",nvltrie:"\u22B4\u20D2",nvrArr:"\u2903",nvrtrie:"\u22B5\u20D2",nvsim:"\u223C\u20D2",nwarhk:"\u2923",nwarr:"\u2196",nwArr:"\u21D6",nwarrow:"\u2196",nwnear:"\u2927",Oacute:"\xD3",oacute:"\xF3",oast:"\u229B",Ocirc:"\xD4",ocirc:"\xF4",ocir:"\u229A",Ocy:"\u041E",ocy:"\u043E",odash:"\u229D",Odblac:"\u0150",odblac:"\u0151",odiv:"\u2A38",odot:"\u2299",odsold:"\u29BC",OElig:"\u0152",oelig:"\u0153",ofcir:"\u29BF",Ofr:"\u{1D512}",ofr:"\u{1D52C}",ogon:"\u02DB",Ograve:"\xD2",ograve:"\xF2",ogt:"\u29C1",ohbar:"\u29B5",ohm:"\u03A9",oint:"\u222E",olarr:"\u21BA",olcir:"\u29BE",olcross:"\u29BB",oline:"\u203E",olt:"\u29C0",Omacr:"\u014C",omacr:"\u014D",Omega:"\u03A9",omega:"\u03C9",Omicron:"\u039F",omicron:"\u03BF",omid:"\u29B6",ominus:"\u2296",Oopf:"\u{1D546}",oopf:"\u{1D560}",opar:"\u29B7",OpenCurlyDoubleQuote:"\u201C",OpenCurlyQuote:"\u2018",operp:"\u29B9",oplus:"\u2295",orarr:"\u21BB",Or:"\u2A54",or:"\u2228",ord:"\u2A5D",order:"\u2134",orderof:"\u2134",ordf:"\xAA",ordm:"\xBA",origof:"\u22B6",oror:"\u2A56",orslope:"\u2A57",orv:"\u2A5B",oS:"\u24C8",Oscr:"\u{1D4AA}",oscr:"\u2134",Oslash:"\xD8",oslash:"\xF8",osol:"\u2298",Otilde:"\xD5",otilde:"\xF5",otimesas:"\u2A36",Otimes:"\u2A37",otimes:"\u2297",Ouml:"\xD6",ouml:"\xF6",ovbar:"\u233D",OverBar:"\u203E",OverBrace:"\u23DE",OverBracket:"\u23B4",OverParenthesis:"\u23DC",para:"\xB6",parallel:"\u2225",par:"\u2225",parsim:"\u2AF3",parsl:"\u2AFD",part:"\u2202",PartialD:"\u2202",Pcy:"\u041F",pcy:"\u043F",percnt:"%",period:".",permil:"\u2030",perp:"\u22A5",pertenk:"\u2031",Pfr:"\u{1D513}",pfr:"\u{1D52D}",Phi:"\u03A6",phi:"\u03C6",phiv:"\u03D5",phmmat:"\u2133",phone:"\u260E",Pi:"\u03A0",pi:"\u03C0",pitchfork:"\u22D4",piv:"\u03D6",planck:"\u210F",planckh:"\u210E",plankv:"\u210F",plusacir:"\u2A23",plusb:"\u229E",pluscir:"\u2A22",plus:"+",plusdo:"\u2214",plusdu:"\u2A25",pluse:"\u2A72",PlusMinus:"\xB1",plusmn:"\xB1",plussim:"\u2A26",plustwo:"\u2A27",pm:"\xB1",Poincareplane:"\u210C",pointint:"\u2A15",popf:"\u{1D561}",Popf:"\u2119",pound:"\xA3",prap:"\u2AB7",Pr:"\u2ABB",pr:"\u227A",prcue:"\u227C",precapprox:"\u2AB7",prec:"\u227A",preccurlyeq:"\u227C",Precedes:"\u227A",PrecedesEqual:"\u2AAF",PrecedesSlantEqual:"\u227C",PrecedesTilde:"\u227E",preceq:"\u2AAF",precnapprox:"\u2AB9",precneqq:"\u2AB5",precnsim:"\u22E8",pre:"\u2AAF",prE:"\u2AB3",precsim:"\u227E",prime:"\u2032",Prime:"\u2033",primes:"\u2119",prnap:"\u2AB9",prnE:"\u2AB5",prnsim:"\u22E8",prod:"\u220F",Product:"\u220F",profalar:"\u232E",profline:"\u2312",profsurf:"\u2313",prop:"\u221D",Proportional:"\u221D",Proportion:"\u2237",propto:"\u221D",prsim:"\u227E",prurel:"\u22B0",Pscr:"\u{1D4AB}",pscr:"\u{1D4C5}",Psi:"\u03A8",psi:"\u03C8",puncsp:"\u2008",Qfr:"\u{1D514}",qfr:"\u{1D52E}",qint:"\u2A0C",qopf:"\u{1D562}",Qopf:"\u211A",qprime:"\u2057",Qscr:"\u{1D4AC}",qscr:"\u{1D4C6}",quaternions:"\u210D",quatint:"\u2A16",quest:"?",questeq:"\u225F",quot:'"',QUOT:'"',rAarr:"\u21DB",race:"\u223D\u0331",Racute:"\u0154",racute:"\u0155",radic:"\u221A",raemptyv:"\u29B3",rang:"\u27E9",Rang:"\u27EB",rangd:"\u2992",range:"\u29A5",rangle:"\u27E9",raquo:"\xBB",rarrap:"\u2975",rarrb:"\u21E5",rarrbfs:"\u2920",rarrc:"\u2933",rarr:"\u2192",Rarr:"\u21A0",rArr:"\u21D2",rarrfs:"\u291E",rarrhk:"\u21AA",rarrlp:"\u21AC",rarrpl:"\u2945",rarrsim:"\u2974",Rarrtl:"\u2916",rarrtl:"\u21A3",rarrw:"\u219D",ratail:"\u291A",rAtail:"\u291C",ratio:"\u2236",rationals:"\u211A",rbarr:"\u290D",rBarr:"\u290F",RBarr:"\u2910",rbbrk:"\u2773",rbrace:"}",rbrack:"]",rbrke:"\u298C",rbrksld:"\u298E",rbrkslu:"\u2990",Rcaron:"\u0158",rcaron:"\u0159",Rcedil:"\u0156",rcedil:"\u0157",rceil:"\u2309",rcub:"}",Rcy:"\u0420",rcy:"\u0440",rdca:"\u2937",rdldhar:"\u2969",rdquo:"\u201D",rdquor:"\u201D",rdsh:"\u21B3",real:"\u211C",realine:"\u211B",realpart:"\u211C",reals:"\u211D",Re:"\u211C",rect:"\u25AD",reg:"\xAE",REG:"\xAE",ReverseElement:"\u220B",ReverseEquilibrium:"\u21CB",ReverseUpEquilibrium:"\u296F",rfisht:"\u297D",rfloor:"\u230B",rfr:"\u{1D52F}",Rfr:"\u211C",rHar:"\u2964",rhard:"\u21C1",rharu:"\u21C0",rharul:"\u296C",Rho:"\u03A1",rho:"\u03C1",rhov:"\u03F1",RightAngleBracket:"\u27E9",RightArrowBar:"\u21E5",rightarrow:"\u2192",RightArrow:"\u2192",Rightarrow:"\u21D2",RightArrowLeftArrow:"\u21C4",rightarrowtail:"\u21A3",RightCeiling:"\u2309",RightDoubleBracket:"\u27E7",RightDownTeeVector:"\u295D",RightDownVectorBar:"\u2955",RightDownVector:"\u21C2",RightFloor:"\u230B",rightharpoondown:"\u21C1",rightharpoonup:"\u21C0",rightleftarrows:"\u21C4",rightleftharpoons:"\u21CC",rightrightarrows:"\u21C9",rightsquigarrow:"\u219D",RightTeeArrow:"\u21A6",RightTee:"\u22A2",RightTeeVector:"\u295B",rightthreetimes:"\u22CC",RightTriangleBar:"\u29D0",RightTriangle:"\u22B3",RightTriangleEqual:"\u22B5",RightUpDownVector:"\u294F",RightUpTeeVector:"\u295C",RightUpVectorBar:"\u2954",RightUpVector:"\u21BE",RightVectorBar:"\u2953",RightVector:"\u21C0",ring:"\u02DA",risingdotseq:"\u2253",rlarr:"\u21C4",rlhar:"\u21CC",rlm:"\u200F",rmoustache:"\u23B1",rmoust:"\u23B1",rnmid:"\u2AEE",roang:"\u27ED",roarr:"\u21FE",robrk:"\u27E7",ropar:"\u2986",ropf:"\u{1D563}",Ropf:"\u211D",roplus:"\u2A2E",rotimes:"\u2A35",RoundImplies:"\u2970",rpar:")",rpargt:"\u2994",rppolint:"\u2A12",rrarr:"\u21C9",Rrightarrow:"\u21DB",rsaquo:"\u203A",rscr:"\u{1D4C7}",Rscr:"\u211B",rsh:"\u21B1",Rsh:"\u21B1",rsqb:"]",rsquo:"\u2019",rsquor:"\u2019",rthree:"\u22CC",rtimes:"\u22CA",rtri:"\u25B9",rtrie:"\u22B5",rtrif:"\u25B8",rtriltri:"\u29CE",RuleDelayed:"\u29F4",ruluhar:"\u2968",rx:"\u211E",Sacute:"\u015A",sacute:"\u015B",sbquo:"\u201A",scap:"\u2AB8",Scaron:"\u0160",scaron:"\u0161",Sc:"\u2ABC",sc:"\u227B",sccue:"\u227D",sce:"\u2AB0",scE:"\u2AB4",Scedil:"\u015E",scedil:"\u015F",Scirc:"\u015C",scirc:"\u015D",scnap:"\u2ABA",scnE:"\u2AB6",scnsim:"\u22E9",scpolint:"\u2A13",scsim:"\u227F",Scy:"\u0421",scy:"\u0441",sdotb:"\u22A1",sdot:"\u22C5",sdote:"\u2A66",searhk:"\u2925",searr:"\u2198",seArr:"\u21D8",searrow:"\u2198",sect:"\xA7",semi:";",seswar:"\u2929",setminus:"\u2216",setmn:"\u2216",sext:"\u2736",Sfr:"\u{1D516}",sfr:"\u{1D530}",sfrown:"\u2322",sharp:"\u266F",SHCHcy:"\u0429",shchcy:"\u0449",SHcy:"\u0428",shcy:"\u0448",ShortDownArrow:"\u2193",ShortLeftArrow:"\u2190",shortmid:"\u2223",shortparallel:"\u2225",ShortRightArrow:"\u2192",ShortUpArrow:"\u2191",shy:"\xAD",Sigma:"\u03A3",sigma:"\u03C3",sigmaf:"\u03C2",sigmav:"\u03C2",sim:"\u223C",simdot:"\u2A6A",sime:"\u2243",simeq:"\u2243",simg:"\u2A9E",simgE:"\u2AA0",siml:"\u2A9D",simlE:"\u2A9F",simne:"\u2246",simplus:"\u2A24",simrarr:"\u2972",slarr:"\u2190",SmallCircle:"\u2218",smallsetminus:"\u2216",smashp:"\u2A33",smeparsl:"\u29E4",smid:"\u2223",smile:"\u2323",smt:"\u2AAA",smte:"\u2AAC",smtes:"\u2AAC\uFE00",SOFTcy:"\u042C",softcy:"\u044C",solbar:"\u233F",solb:"\u29C4",sol:"/",Sopf:"\u{1D54A}",sopf:"\u{1D564}",spades:"\u2660",spadesuit:"\u2660",spar:"\u2225",sqcap:"\u2293",sqcaps:"\u2293\uFE00",sqcup:"\u2294",sqcups:"\u2294\uFE00",Sqrt:"\u221A",sqsub:"\u228F",sqsube:"\u2291",sqsubset:"\u228F",sqsubseteq:"\u2291",sqsup:"\u2290",sqsupe:"\u2292",sqsupset:"\u2290",sqsupseteq:"\u2292",square:"\u25A1",Square:"\u25A1",SquareIntersection:"\u2293",SquareSubset:"\u228F",SquareSubsetEqual:"\u2291",SquareSuperset:"\u2290",SquareSupersetEqual:"\u2292",SquareUnion:"\u2294",squarf:"\u25AA",squ:"\u25A1",squf:"\u25AA",srarr:"\u2192",Sscr:"\u{1D4AE}",sscr:"\u{1D4C8}",ssetmn:"\u2216",ssmile:"\u2323",sstarf:"\u22C6",Star:"\u22C6",star:"\u2606",starf:"\u2605",straightepsilon:"\u03F5",straightphi:"\u03D5",strns:"\xAF",sub:"\u2282",Sub:"\u22D0",subdot:"\u2ABD",subE:"\u2AC5",sube:"\u2286",subedot:"\u2AC3",submult:"\u2AC1",subnE:"\u2ACB",subne:"\u228A",subplus:"\u2ABF",subrarr:"\u2979",subset:"\u2282",Subset:"\u22D0",subseteq:"\u2286",subseteqq:"\u2AC5",SubsetEqual:"\u2286",subsetneq:"\u228A",subsetneqq:"\u2ACB",subsim:"\u2AC7",subsub:"\u2AD5",subsup:"\u2AD3",succapprox:"\u2AB8",succ:"\u227B",succcurlyeq:"\u227D",Succeeds:"\u227B",SucceedsEqual:"\u2AB0",SucceedsSlantEqual:"\u227D",SucceedsTilde:"\u227F",succeq:"\u2AB0",succnapprox:"\u2ABA",succneqq:"\u2AB6",succnsim:"\u22E9",succsim:"\u227F",SuchThat:"\u220B",sum:"\u2211",Sum:"\u2211",sung:"\u266A",sup1:"\xB9",sup2:"\xB2",sup3:"\xB3",sup:"\u2283",Sup:"\u22D1",supdot:"\u2ABE",supdsub:"\u2AD8",supE:"\u2AC6",supe:"\u2287",supedot:"\u2AC4",Superset:"\u2283",SupersetEqual:"\u2287",suphsol:"\u27C9",suphsub:"\u2AD7",suplarr:"\u297B",supmult:"\u2AC2",supnE:"\u2ACC",supne:"\u228B",supplus:"\u2AC0",supset:"\u2283",Supset:"\u22D1",supseteq:"\u2287",supseteqq:"\u2AC6",supsetneq:"\u228B",supsetneqq:"\u2ACC",supsim:"\u2AC8",supsub:"\u2AD4",supsup:"\u2AD6",swarhk:"\u2926",swarr:"\u2199",swArr:"\u21D9",swarrow:"\u2199",swnwar:"\u292A",szlig:"\xDF",Tab:"	",target:"\u2316",Tau:"\u03A4",tau:"\u03C4",tbrk:"\u23B4",Tcaron:"\u0164",tcaron:"\u0165",Tcedil:"\u0162",tcedil:"\u0163",Tcy:"\u0422",tcy:"\u0442",tdot:"\u20DB",telrec:"\u2315",Tfr:"\u{1D517}",tfr:"\u{1D531}",there4:"\u2234",therefore:"\u2234",Therefore:"\u2234",Theta:"\u0398",theta:"\u03B8",thetasym:"\u03D1",thetav:"\u03D1",thickapprox:"\u2248",thicksim:"\u223C",ThickSpace:"\u205F\u200A",ThinSpace:"\u2009",thinsp:"\u2009",thkap:"\u2248",thksim:"\u223C",THORN:"\xDE",thorn:"\xFE",tilde:"\u02DC",Tilde:"\u223C",TildeEqual:"\u2243",TildeFullEqual:"\u2245",TildeTilde:"\u2248",timesbar:"\u2A31",timesb:"\u22A0",times:"\xD7",timesd:"\u2A30",tint:"\u222D",toea:"\u2928",topbot:"\u2336",topcir:"\u2AF1",top:"\u22A4",Topf:"\u{1D54B}",topf:"\u{1D565}",topfork:"\u2ADA",tosa:"\u2929",tprime:"\u2034",trade:"\u2122",TRADE:"\u2122",triangle:"\u25B5",triangledown:"\u25BF",triangleleft:"\u25C3",trianglelefteq:"\u22B4",triangleq:"\u225C",triangleright:"\u25B9",trianglerighteq:"\u22B5",tridot:"\u25EC",trie:"\u225C",triminus:"\u2A3A",TripleDot:"\u20DB",triplus:"\u2A39",trisb:"\u29CD",tritime:"\u2A3B",trpezium:"\u23E2",Tscr:"\u{1D4AF}",tscr:"\u{1D4C9}",TScy:"\u0426",tscy:"\u0446",TSHcy:"\u040B",tshcy:"\u045B",Tstrok:"\u0166",tstrok:"\u0167",twixt:"\u226C",twoheadleftarrow:"\u219E",twoheadrightarrow:"\u21A0",Uacute:"\xDA",uacute:"\xFA",uarr:"\u2191",Uarr:"\u219F",uArr:"\u21D1",Uarrocir:"\u2949",Ubrcy:"\u040E",ubrcy:"\u045E",Ubreve:"\u016C",ubreve:"\u016D",Ucirc:"\xDB",ucirc:"\xFB",Ucy:"\u0423",ucy:"\u0443",udarr:"\u21C5",Udblac:"\u0170",udblac:"\u0171",udhar:"\u296E",ufisht:"\u297E",Ufr:"\u{1D518}",ufr:"\u{1D532}",Ugrave:"\xD9",ugrave:"\xF9",uHar:"\u2963",uharl:"\u21BF",uharr:"\u21BE",uhblk:"\u2580",ulcorn:"\u231C",ulcorner:"\u231C",ulcrop:"\u230F",ultri:"\u25F8",Umacr:"\u016A",umacr:"\u016B",uml:"\xA8",UnderBar:"_",UnderBrace:"\u23DF",UnderBracket:"\u23B5",UnderParenthesis:"\u23DD",Union:"\u22C3",UnionPlus:"\u228E",Uogon:"\u0172",uogon:"\u0173",Uopf:"\u{1D54C}",uopf:"\u{1D566}",UpArrowBar:"\u2912",uparrow:"\u2191",UpArrow:"\u2191",Uparrow:"\u21D1",UpArrowDownArrow:"\u21C5",updownarrow:"\u2195",UpDownArrow:"\u2195",Updownarrow:"\u21D5",UpEquilibrium:"\u296E",upharpoonleft:"\u21BF",upharpoonright:"\u21BE",uplus:"\u228E",UpperLeftArrow:"\u2196",UpperRightArrow:"\u2197",upsi:"\u03C5",Upsi:"\u03D2",upsih:"\u03D2",Upsilon:"\u03A5",upsilon:"\u03C5",UpTeeArrow:"\u21A5",UpTee:"\u22A5",upuparrows:"\u21C8",urcorn:"\u231D",urcorner:"\u231D",urcrop:"\u230E",Uring:"\u016E",uring:"\u016F",urtri:"\u25F9",Uscr:"\u{1D4B0}",uscr:"\u{1D4CA}",utdot:"\u22F0",Utilde:"\u0168",utilde:"\u0169",utri:"\u25B5",utrif:"\u25B4",uuarr:"\u21C8",Uuml:"\xDC",uuml:"\xFC",uwangle:"\u29A7",vangrt:"\u299C",varepsilon:"\u03F5",varkappa:"\u03F0",varnothing:"\u2205",varphi:"\u03D5",varpi:"\u03D6",varpropto:"\u221D",varr:"\u2195",vArr:"\u21D5",varrho:"\u03F1",varsigma:"\u03C2",varsubsetneq:"\u228A\uFE00",varsubsetneqq:"\u2ACB\uFE00",varsupsetneq:"\u228B\uFE00",varsupsetneqq:"\u2ACC\uFE00",vartheta:"\u03D1",vartriangleleft:"\u22B2",vartriangleright:"\u22B3",vBar:"\u2AE8",Vbar:"\u2AEB",vBarv:"\u2AE9",Vcy:"\u0412",vcy:"\u0432",vdash:"\u22A2",vDash:"\u22A8",Vdash:"\u22A9",VDash:"\u22AB",Vdashl:"\u2AE6",veebar:"\u22BB",vee:"\u2228",Vee:"\u22C1",veeeq:"\u225A",vellip:"\u22EE",verbar:"|",Verbar:"\u2016",vert:"|",Vert:"\u2016",VerticalBar:"\u2223",VerticalLine:"|",VerticalSeparator:"\u2758",VerticalTilde:"\u2240",VeryThinSpace:"\u200A",Vfr:"\u{1D519}",vfr:"\u{1D533}",vltri:"\u22B2",vnsub:"\u2282\u20D2",vnsup:"\u2283\u20D2",Vopf:"\u{1D54D}",vopf:"\u{1D567}",vprop:"\u221D",vrtri:"\u22B3",Vscr:"\u{1D4B1}",vscr:"\u{1D4CB}",vsubnE:"\u2ACB\uFE00",vsubne:"\u228A\uFE00",vsupnE:"\u2ACC\uFE00",vsupne:"\u228B\uFE00",Vvdash:"\u22AA",vzigzag:"\u299A",Wcirc:"\u0174",wcirc:"\u0175",wedbar:"\u2A5F",wedge:"\u2227",Wedge:"\u22C0",wedgeq:"\u2259",weierp:"\u2118",Wfr:"\u{1D51A}",wfr:"\u{1D534}",Wopf:"\u{1D54E}",wopf:"\u{1D568}",wp:"\u2118",wr:"\u2240",wreath:"\u2240",Wscr:"\u{1D4B2}",wscr:"\u{1D4CC}",xcap:"\u22C2",xcirc:"\u25EF",xcup:"\u22C3",xdtri:"\u25BD",Xfr:"\u{1D51B}",xfr:"\u{1D535}",xharr:"\u27F7",xhArr:"\u27FA",Xi:"\u039E",xi:"\u03BE",xlarr:"\u27F5",xlArr:"\u27F8",xmap:"\u27FC",xnis:"\u22FB",xodot:"\u2A00",Xopf:"\u{1D54F}",xopf:"\u{1D569}",xoplus:"\u2A01",xotime:"\u2A02",xrarr:"\u27F6",xrArr:"\u27F9",Xscr:"\u{1D4B3}",xscr:"\u{1D4CD}",xsqcup:"\u2A06",xuplus:"\u2A04",xutri:"\u25B3",xvee:"\u22C1",xwedge:"\u22C0",Yacute:"\xDD",yacute:"\xFD",YAcy:"\u042F",yacy:"\u044F",Ycirc:"\u0176",ycirc:"\u0177",Ycy:"\u042B",ycy:"\u044B",yen:"\xA5",Yfr:"\u{1D51C}",yfr:"\u{1D536}",YIcy:"\u0407",yicy:"\u0457",Yopf:"\u{1D550}",yopf:"\u{1D56A}",Yscr:"\u{1D4B4}",yscr:"\u{1D4CE}",YUcy:"\u042E",yucy:"\u044E",yuml:"\xFF",Yuml:"\u0178",Zacute:"\u0179",zacute:"\u017A",Zcaron:"\u017D",zcaron:"\u017E",Zcy:"\u0417",zcy:"\u0437",Zdot:"\u017B",zdot:"\u017C",zeetrf:"\u2128",ZeroWidthSpace:"\u200B",Zeta:"\u0396",zeta:"\u03B6",zfr:"\u{1D537}",Zfr:"\u2128",ZHcy:"\u0416",zhcy:"\u0436",zigrarr:"\u21DD",zopf:"\u{1D56B}",Zopf:"\u2124",Zscr:"\u{1D4B5}",zscr:"\u{1D4CF}",zwj:"\u200D",zwnj:"\u200C"}});var ys=R((fl,na)=>{na.exports={Aacute:"\xC1",aacute:"\xE1",Acirc:"\xC2",acirc:"\xE2",acute:"\xB4",AElig:"\xC6",aelig:"\xE6",Agrave:"\xC0",agrave:"\xE0",amp:"&",AMP:"&",Aring:"\xC5",aring:"\xE5",Atilde:"\xC3",atilde:"\xE3",Auml:"\xC4",auml:"\xE4",brvbar:"\xA6",Ccedil:"\xC7",ccedil:"\xE7",cedil:"\xB8",cent:"\xA2",copy:"\xA9",COPY:"\xA9",curren:"\xA4",deg:"\xB0",divide:"\xF7",Eacute:"\xC9",eacute:"\xE9",Ecirc:"\xCA",ecirc:"\xEA",Egrave:"\xC8",egrave:"\xE8",ETH:"\xD0",eth:"\xF0",Euml:"\xCB",euml:"\xEB",frac12:"\xBD",frac14:"\xBC",frac34:"\xBE",gt:">",GT:">",Iacute:"\xCD",iacute:"\xED",Icirc:"\xCE",icirc:"\xEE",iexcl:"\xA1",Igrave:"\xCC",igrave:"\xEC",iquest:"\xBF",Iuml:"\xCF",iuml:"\xEF",laquo:"\xAB",lt:"<",LT:"<",macr:"\xAF",micro:"\xB5",middot:"\xB7",nbsp:"\xA0",not:"\xAC",Ntilde:"\xD1",ntilde:"\xF1",Oacute:"\xD3",oacute:"\xF3",Ocirc:"\xD4",ocirc:"\xF4",Ograve:"\xD2",ograve:"\xF2",ordf:"\xAA",ordm:"\xBA",Oslash:"\xD8",oslash:"\xF8",Otilde:"\xD5",otilde:"\xF5",Ouml:"\xD6",ouml:"\xF6",para:"\xB6",plusmn:"\xB1",pound:"\xA3",quot:'"',QUOT:'"',raquo:"\xBB",reg:"\xAE",REG:"\xAE",sect:"\xA7",shy:"\xAD",sup1:"\xB9",sup2:"\xB2",sup3:"\xB3",szlig:"\xDF",THORN:"\xDE",thorn:"\xFE",times:"\xD7",Uacute:"\xDA",uacute:"\xFA",Ucirc:"\xDB",ucirc:"\xFB",Ugrave:"\xD9",ugrave:"\xF9",uml:"\xA8",Uuml:"\xDC",uuml:"\xFC",Yacute:"\xDD",yacute:"\xFD",yen:"\xA5",yuml:"\xFF"}});var Tr=R((yl,la)=>{la.exports={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}});var vs=R((vl,ca)=>{ca.exports={"0":65533,"128":8364,"130":8218,"131":402,"132":8222,"133":8230,"134":8224,"135":8225,"136":710,"137":8240,"138":352,"139":8249,"140":338,"142":381,"145":8216,"146":8217,"147":8220,"148":8221,"149":8226,"150":8211,"151":8212,"152":732,"153":8482,"154":353,"155":8250,"156":339,"158":382,"159":376}});var bs=R(vt=>{"use strict";var da=vt&&vt.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(vt,"__esModule",{value:!0});var Ps=da(vs()),ua=String.fromCodePoint||function(u){var t="";return u>65535&&(u-=65536,t+=String.fromCharCode(u>>>10&1023|55296),u=56320|u&1023),t+=String.fromCharCode(u),t};function pa(u){return u>=55296&&u<=57343||u>1114111?"\uFFFD":(u in Ps.default&&(u=Ps.default[u]),ua(u))}vt.default=pa});var Cr=R(fe=>{"use strict";var Zt=fe&&fe.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(fe,"__esModule",{value:!0});fe.decodeHTML=fe.decodeHTMLStrict=fe.decodeXML=void 0;var xr=Zt(Dr()),ha=Zt(ys()),ga=Zt(Tr()),Es=Zt(bs()),ma=/&(?:[a-zA-Z0-9]+|#[xX][\da-fA-F]+|#\d+);/g;fe.decodeXML=Ss(ga.default);fe.decodeHTMLStrict=Ss(xr.default);function Ss(u){var t=Ds(u);return function(e){return String(e).replace(ma,t)}}var ws=function(u,t){return u<t?1:-1};fe.decodeHTML=function(){for(var u=Object.keys(ha.default).sort(ws),t=Object.keys(xr.default).sort(ws),e=0,r=0;e<t.length;e++)u[r]===t[e]?(t[e]+=";?",r++):t[e]+=";";var i=new RegExp("&(?:"+t.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),s=Ds(xr.default);function o(n){return n.substr(-1)!==";"&&(n+=";"),s(n)}return function(n){return String(n).replace(i,o)}}();function Ds(u){return function(e){if(e.charAt(1)==="#"){var r=e.charAt(2);return r==="X"||r==="x"?Es.default(parseInt(e.substr(3),16)):Es.default(parseInt(e.substr(2),10))}return u[e.slice(1,-1)]||e}}});var Mr=R(se=>{"use strict";var Ts=se&&se.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(se,"__esModule",{value:!0});se.escapeUTF8=se.escape=se.encodeNonAsciiHTML=se.encodeHTML=se.encodeXML=void 0;var fa=Ts(Tr()),xs=Is(fa.default),Cs=Ms(xs);se.encodeXML=Ls(xs);var ya=Ts(Dr()),Ir=Is(ya.default),va=Ms(Ir);se.encodeHTML=ba(Ir,va);se.encodeNonAsciiHTML=Ls(Ir);function Is(u){return Object.keys(u).sort().reduce(function(t,e){return t[u[e]]="&"+e+";",t},{})}function Ms(u){for(var t=[],e=[],r=0,i=Object.keys(u);r<i.length;r++){var s=i[r];s.length===1?t.push("\\"+s):e.push(s)}t.sort();for(var o=0;o<t.length-1;o++){for(var n=o;n<t.length-1&&t[n].charCodeAt(1)+1===t[n+1].charCodeAt(1);)n+=1;var l=1+n-o;l<3||t.splice(o,l,t[o]+"-"+t[n])}return e.unshift("["+t.join("")+"]"),new RegExp(e.join("|"),"g")}var ks=/(?:[\x80-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g,Pa=String.prototype.codePointAt!=null?function(u){return u.codePointAt(0)}:function(u){return(u.charCodeAt(0)-55296)*1024+u.charCodeAt(1)-56320+65536};function er(u){return"&#x"+(u.length>1?Pa(u):u.charCodeAt(0)).toString(16).toUpperCase()+";"}function ba(u,t){return function(e){return e.replace(t,function(r){return u[r]}).replace(ks,er)}}var As=new RegExp(Cs.source+"|"+ks.source,"g");function Ea(u){return u.replace(As,er)}se.escape=Ea;function wa(u){return u.replace(Cs,er)}se.escapeUTF8=wa;function Ls(u){return function(t){return t.replace(As,function(e){return u[e]||er(e)})}}});var Ns=R($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.decodeXMLStrict=$.decodeHTML5Strict=$.decodeHTML4Strict=$.decodeHTML5=$.decodeHTML4=$.decodeHTMLStrict=$.decodeHTML=$.decodeXML=$.encodeHTML5=$.encodeHTML4=$.escapeUTF8=$.escape=$.encodeNonAsciiHTML=$.encodeHTML=$.encodeXML=$.encode=$.decodeStrict=$.decode=void 0;var tr=Cr(),Fs=Mr();function Sa(u,t){return(!t||t<=0?tr.decodeXML:tr.decodeHTML)(u)}$.decode=Sa;function Da(u,t){return(!t||t<=0?tr.decodeXML:tr.decodeHTMLStrict)(u)}$.decodeStrict=Da;function Ta(u,t){return(!t||t<=0?Fs.encodeXML:Fs.encodeHTML)(u)}$.encode=Ta;var Be=Mr();Object.defineProperty($,"encodeXML",{enumerable:!0,get:function(){return Be.encodeXML}});Object.defineProperty($,"encodeHTML",{enumerable:!0,get:function(){return Be.encodeHTML}});Object.defineProperty($,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return Be.encodeNonAsciiHTML}});Object.defineProperty($,"escape",{enumerable:!0,get:function(){return Be.escape}});Object.defineProperty($,"escapeUTF8",{enumerable:!0,get:function(){return Be.escapeUTF8}});Object.defineProperty($,"encodeHTML4",{enumerable:!0,get:function(){return Be.encodeHTML}});Object.defineProperty($,"encodeHTML5",{enumerable:!0,get:function(){return Be.encodeHTML}});var Ie=Cr();Object.defineProperty($,"decodeXML",{enumerable:!0,get:function(){return Ie.decodeXML}});Object.defineProperty($,"decodeHTML",{enumerable:!0,get:function(){return Ie.decodeHTML}});Object.defineProperty($,"decodeHTMLStrict",{enumerable:!0,get:function(){return Ie.decodeHTMLStrict}});Object.defineProperty($,"decodeHTML4",{enumerable:!0,get:function(){return Ie.decodeHTML}});Object.defineProperty($,"decodeHTML5",{enumerable:!0,get:function(){return Ie.decodeHTML}});Object.defineProperty($,"decodeHTML4Strict",{enumerable:!0,get:function(){return Ie.decodeHTMLStrict}});Object.defineProperty($,"decodeHTML5Strict",{enumerable:!0,get:function(){return Ie.decodeHTMLStrict}});Object.defineProperty($,"decodeXMLStrict",{enumerable:!0,get:function(){return Ie.decodeXML}})});var Os=R((Sl,qs)=>{var Se=qs.exports={},xa=Ns(),Ca=Sr();Se.stripHtml=function(u){return u=u.replace(/([^\n])<\/?(h|br|p|ul|ol|li|blockquote|section|table|tr|div)(?:.|\n)*?>([^\n])/gm,`$1
$3`),u=u.replace(/<(?:.|\n)*?>/gm,""),u};Se.getSnippet=function(u){return xa.decodeHTML(Se.stripHtml(u)).trim()};Se.getLink=function(u,t,e){if(u){for(let r=0;r<u.length;++r)if(u[r].$.rel===t)return u[r].$.href;if(u[e])return u[e].$.href}};Se.getContent=function(u){return typeof u._=="string"?u._:typeof u=="object"?new Ca.Builder({headless:!0,explicitRoot:!0,rootName:"div",renderOpts:{pretty:!1}}).buildObject(u):u};Se.copyFromXML=function(u,t,e){e.forEach(function(r){let i=r,s=r,o={};Array.isArray(r)&&(i=r[0],s=r[1],r.length>2&&(o=r[2]));let{keepArray:n,includeSnippet:l}=o;u[i]!==void 0&&(t[s]=n?u[i]:u[i][0]),t[s]&&typeof t[s]._=="string"&&(t[s]=t[s]._),l&&t[s]&&typeof t[s]=="string"&&(t[s+"Snippet"]=Se.getSnippet(t[s]))})};Se.maybePromisify=function(u,t){return u?t.then(e=>setTimeout(()=>u(null,e)),e=>setTimeout(()=>u(e))):t};var Ia="utf8",Ma=/(encoding|charset)\s*=\s*(\S+)/,ka=["ascii","utf8","utf16le","ucs2","base64","latin1","binary","hex"],Aa={"utf-8":"utf8","iso-8859-1":"latin1"};Se.getEncodingFromContentType=function(u){u=u||"";let e=(u.match(Ma)||[])[2]||"";return e=e.toLowerCase(),e=Aa[e]||e,(!e||ka.indexOf(e)===-1)&&(e=Ia),e}});var Bs=R((Dl,Qs)=>{"use strict";var La=require("http"),Fa=require("https"),Na=Sr(),Rs=require("url"),rr=fs(),te=Os(),qa={"User-Agent":"rss-parser",Accept:"application/rss+xml"},Oa=5,Ra=6e4,kr=class{constructor(t={}){t.headers=t.headers||{},t.xml2js=t.xml2js||{},t.customFields=t.customFields||{},t.customFields.item=t.customFields.item||[],t.customFields.feed=t.customFields.feed||[],t.requestOptions=t.requestOptions||{},t.maxRedirects||(t.maxRedirects=Oa),t.timeout||(t.timeout=Ra),this.options=t,this.xmlParser=new Na.Parser(this.options.xml2js)}parseString(t,e){let r=new Promise((i,s)=>{this.xmlParser.parseString(t,(o,n)=>{if(o)return s(o);if(!n)return s(new Error("Unable to parse XML."));let l=null;if(n.feed)l=this.buildAtomFeed(n);else if(n.rss&&n.rss.$&&n.rss.$.version&&n.rss.$.version.match(/^2/))l=this.buildRSS2(n);else if(n["rdf:RDF"])l=this.buildRSS1(n);else if(n.rss&&n.rss.$&&n.rss.$.version&&n.rss.$.version.match(/0\.9/))l=this.buildRSS0_9(n);else if(n.rss&&this.options.defaultRSS)switch(this.options.defaultRSS){case .9:l=this.buildRSS0_9(n);break;case 1:l=this.buildRSS1(n);break;case 2:l=this.buildRSS2(n);break;default:return s(new Error("default RSS version not recognized."))}else return s(new Error("Feed not recognized as RSS 1 or 2."));i(l)})});return r=te.maybePromisify(e,r),r}parseURL(t,e,r=0){let i="",s=t.indexOf("https")===0?Fa.get:La.get,o=Rs.parse(t),n=Object.assign({},qa,this.options.headers),l=null,c=new Promise((p,h)=>{let m=Object.assign({headers:n},o,this.options.requestOptions);s(m,v=>{if(this.options.maxRedirects&&v.statusCode>=300&&v.statusCode<400&&v.headers.location){if(r===this.options.maxRedirects)return h(new Error("Too many redirects"));{let I=Rs.resolve(t,v.headers.location);return this.parseURL(I,null,r+1).then(p,h)}}else if(v.statusCode>=300)return h(new Error("Status code "+v.statusCode));let D=te.getEncodingFromContentType(v.headers["content-type"]);v.setEncoding(D),v.on("data",I=>{i+=I}),v.on("end",()=>this.parseString(i).then(p,h))}).on("error",h),l=setTimeout(()=>h(new Error("Request timed out after "+this.options.timeout+"ms")),this.options.timeout)}).then(p=>(clearTimeout(l),Promise.resolve(p)),p=>(clearTimeout(l),Promise.reject(p)));return c=te.maybePromisify(e,c),c}buildAtomFeed(t){let e={items:[]};if(te.copyFromXML(t.feed,e,this.options.customFields.feed),t.feed.link&&(e.link=te.getLink(t.feed.link,"alternate",0),e.feedUrl=te.getLink(t.feed.link,"self",1)),t.feed.title){let r=t.feed.title[0]||"";r._&&(r=r._),r&&(e.title=r)}return t.feed.updated&&(e.lastBuildDate=t.feed.updated[0]),e.items=(t.feed.entry||[]).map(r=>this.parseItemAtom(r)),e}parseItemAtom(t){let e={};if(te.copyFromXML(t,e,this.options.customFields.item),t.title){let r=t.title[0]||"";r._&&(r=r._),r&&(e.title=r)}return t.link&&t.link.length&&(e.link=te.getLink(t.link,"alternate",0)),t.published&&t.published.length&&t.published[0].length&&(e.pubDate=new Date(t.published[0]).toISOString()),!e.pubDate&&t.updated&&t.updated.length&&t.updated[0].length&&(e.pubDate=new Date(t.updated[0]).toISOString()),t.author&&t.author.length&&t.author[0].name&&t.author[0].name.length&&(e.author=t.author[0].name[0]),t.content&&t.content.length&&(e.content=te.getContent(t.content[0]),e.contentSnippet=te.getSnippet(e.content)),t.summary&&t.summary.length&&(e.summary=te.getContent(t.summary[0])),t.id&&(e.id=t.id[0]),this.setISODate(e),e}buildRSS0_9(t){var e=t.rss.channel[0],r=e.item;return this.buildRSS(e,r)}buildRSS1(t){t=t["rdf:RDF"];let e=t.channel[0],r=t.item;return this.buildRSS(e,r)}buildRSS2(t){let e=t.rss.channel[0],r=e.item,i=this.buildRSS(e,r);return t.rss.$&&t.rss.$["xmlns:itunes"]&&this.decorateItunes(i,e),i}buildRSS(t,e){e=e||[];let r={items:[]},i=rr.feed.concat(this.options.customFields.feed),s=rr.item.concat(this.options.customFields.item);if(t["atom:link"]&&t["atom:link"][0]&&t["atom:link"][0].$&&(r.feedUrl=t["atom:link"][0].$.href),t.image&&t.image[0]&&t.image[0].url){r.image={};let n=t.image[0];n.link&&(r.image.link=n.link[0]),n.url&&(r.image.url=n.url[0]),n.title&&(r.image.title=n.title[0]),n.width&&(r.image.width=n.width[0]),n.height&&(r.image.height=n.height[0])}let o=this.generatePaginationLinks(t);return Object.keys(o).length&&(r.paginationLinks=o),te.copyFromXML(t,r,i),r.items=e.map(n=>this.parseItemRss(n,s)),r}parseItemRss(t,e){let r={};return te.copyFromXML(t,r,e),t.enclosure&&(r.enclosure=t.enclosure[0].$),t.description&&(r.content=te.getContent(t.description[0]),r.contentSnippet=te.getSnippet(r.content)),t.guid&&(r.guid=t.guid[0],r.guid._&&(r.guid=r.guid._)),t.$&&t.$["rdf:about"]&&(r["rdf:about"]=t.$["rdf:about"]),t.category&&(r.categories=t.category),this.setISODate(r),r}decorateItunes(t,e){let r=e.item||[],i=[];if(t.itunes={},e["itunes:owner"]){let s={};e["itunes:owner"][0]["itunes:name"]&&(s.name=e["itunes:owner"][0]["itunes:name"][0]),e["itunes:owner"][0]["itunes:email"]&&(s.email=e["itunes:owner"][0]["itunes:email"][0]),t.itunes.owner=s}if(e["itunes:image"]){let s;s=e["itunes:image"][0]&&e["itunes:image"][0].$&&e["itunes:image"][0].$.href?e["itunes:image"][0].$.href:null,s&&(t.itunes.image=s)}if(e["itunes:category"]){let s=e["itunes:category"].map(o=>({name:o&&o.$&&o.$.text,subs:o["itunes:category"]?o["itunes:category"].map(n=>({name:n&&n.$&&n.$.text})):null}));t.itunes.categories=s.map(o=>o.name),t.itunes.categoriesWithSubs=s}if(e["itunes:keywords"])if(e["itunes:keywords"].length>1)t.itunes.keywords=e["itunes:keywords"].map(s=>s&&s.$&&s.$.text);else{let s=e["itunes:keywords"][0];s&&typeof s._=="string"&&(s=s._),s&&s.$&&s.$.text?t.itunes.keywords=s.$.text.split(","):typeof s=="string"&&(t.itunes.keywords=s.split(","))}te.copyFromXML(e,t.itunes,rr.podcastFeed),r.forEach((s,o)=>{let n=t.items[o];n.itunes={},te.copyFromXML(s,n.itunes,rr.podcastItem);let l=s["itunes:image"];l&&l[0]&&l[0].$&&l[0].$.href&&(n.itunes.image=l[0].$.href)})}setISODate(t){let e=t.pubDate||t.date;if(e)try{t.isoDate=new Date(e.trim()).toISOString()}catch(r){}}generatePaginationLinks(t){if(!t["atom:link"])return{};let e=["self","first","next","prev","last"];return t["atom:link"].reduce((r,i)=>(!i.$||!e.includes(i.$.rel)||(r[i.$.rel]=i.$.href),r),{})}};Qs.exports=kr});var Ar=R((Tl,$s)=>{"use strict";$s.exports=Bs()});var $a={};ra($a,{default:()=>or});module.exports=ia($a);var It=require("obsidian");var ae={dataFolderPath:"plugins/podcasts/data",defaultPlaybackSettings:{volume:1,playbackSpeed:1,skipIntroSeconds:0,skipOutroSeconds:0},autoDownload:!1,maxCacheEpisodes:50,feedUpdateInterval:60,enableNotifications:!0,dailyNoteInsertPosition:"bottom",dailyNoteFolderPath:"",dailyNoteDateFormat:"YYYY-MM-DD",dailyNoteHeader:"## \u{1F3A7} Listening Log"};var ne=require("obsidian");var dr=class u{constructor(){this.logLevel=3;this.prefix="[Podcasts]"}static getInstance(){return u.instance||(u.instance=new u),u.instance}setLogLevel(t){this.logLevel=t}getLogLevel(){return this.logLevel}debug(t,...e){this.logLevel<=0&&console.debug(`${this.prefix} [DEBUG]`,t,...e)}info(t,...e){this.logLevel<=1&&console.debug(`${this.prefix} [INFO]`,t,...e)}warn(t,...e){this.logLevel<=2&&console.warn(`${this.prefix} [WARN]`,t,...e)}error(t,e,...r){this.logLevel<=3&&(e instanceof Error?console.error(`${this.prefix} [ERROR]`,t,e.message,e.stack,...r):console.error(`${this.prefix} [ERROR]`,t,e,...r))}methodEntry(t,e,...r){this.debug(`${t}.${e}() called`,...r)}methodExit(t,e,r){this.debug(`${t}.${e}() completed`,r)}},a=dr.getInstance();var sa=require("obsidian"),_e=class extends Error{constructor(e,r){super(e);this.code=r;this.name="PodcastPlayerError"}},ue=class extends _e{constructor(e,r,i){super(e,"FEED_PARSE_ERROR");this.feedUrl=r;this.cause=i;this.name="FeedParseError"}},de=class extends _e{constructor(e,r,i){super(e,"NETWORK_ERROR");this.url=r;this.cause=i;this.name="NetworkError"}},ee=class extends _e{constructor(e,r,i){super(e,"AUDIO_PLAYBACK_ERROR");this.audioUrl=r;this.cause=i;this.name="AudioPlaybackError"}},_=class extends _e{constructor(e,r){super(e,"STORAGE_ERROR");this.path=r;this.name="StorageError"}};async function At(u,t={}){let{maxRetries:e=3,initialDelay:r=1e3,maxDelay:i=1e4,backoffMultiplier:s=2}=t,o,n=r;for(let l=0;l<=e;l++)try{return await u()}catch(c){o=c,l<e&&(a.warn(`Attempt ${l+1} failed, retrying in ${n}ms...`,c),await aa(n),n=Math.min(n*s,i))}throw o}function aa(u){return new Promise(t=>setTimeout(t,u))}function Qr(u,t){try{return JSON.parse(u)}catch(e){return a.warn("Failed to parse JSON",e),t}}var ze=class{constructor(t,e){this.vault=t,this.basePath=(0,ne.normalizePath)(e),this.structure=this.buildStructure()}buildStructure(){return{root:this.basePath,subscriptions:(0,ne.normalizePath)(`${this.basePath}/subscriptions`),progress:(0,ne.normalizePath)(`${this.basePath}/progress`),playlists:(0,ne.normalizePath)(`${this.basePath}/playlists`),queues:(0,ne.normalizePath)(`${this.basePath}/queues`),cache:(0,ne.normalizePath)(`${this.basePath}/cache`),cacheFeed:(0,ne.normalizePath)(`${this.basePath}/cache/feeds`),cacheImages:(0,ne.normalizePath)(`${this.basePath}/cache/images`),backups:(0,ne.normalizePath)(`${this.basePath}/backups`)}}getStructure(){return{...this.structure}}getBasePath(){return this.basePath}updateBasePath(t){this.basePath=(0,ne.normalizePath)(t),this.structure=this.buildStructure()}async ensureDirectories(){a.info("Ensuring data directories exist",this.basePath);try{let t=this.vault.adapter;await t.exists(this.basePath)||(a.info("Creating base directory",this.basePath),await t.mkdir(this.basePath));let e=[this.structure.subscriptions,this.structure.progress,this.structure.playlists,this.structure.queues,this.structure.cache,this.structure.cacheFeed,this.structure.cacheImages,this.structure.backups];for(let r of e)await t.exists(r)||(a.debug("Creating directory",r),await t.mkdir(r));a.info("Data directories ready")}catch(t){throw a.error("Failed to create data directories",t),new _("Failed to create data directories",this.basePath)}}getFilePath(t,e){let r=this.structure[t];return(0,ne.normalizePath)(`${r}/${e}`)}async directoryExists(t){try{return await this.vault.adapter.exists(t)}catch(e){return a.error("Failed to check directory existence",e),!1}}async fileExists(t){try{return await this.vault.adapter.exists(t)}catch(e){return a.error("Failed to check file existence",e),!1}}async listFiles(t){let e=this.structure[t];try{let r=this.vault.adapter;return await r.exists(e)?(await r.list(e)).files:[]}catch(r){throw a.error("Failed to list files",r),new _(`Failed to list files in ${e}`,e)}}async deleteFile(t){try{await this.vault.adapter.remove(t),a.debug("Deleted file",t)}catch(e){throw a.error("Failed to delete file",e),new _(`Failed to delete file ${t}`,t)}}async createBackup(t,e){try{let r=await this.vault.adapter.read(t),i=new Date().toISOString().replace(/[:.]/g,"-"),s=e||`backup-${i}.json`,o=this.getFilePath("backups",s);return await this.vault.adapter.write(o,r),a.info("Created backup",o),o}catch(r){throw a.error("Failed to create backup",r),new _(`Failed to create backup of ${t}`,t)}}async cleanupOldBackups(t=5){try{let e=await this.listFiles("backups");if(e.length<=t)return;let r=await Promise.all(e.map(async s=>{let o=await this.vault.adapter.stat(s);return{file:s,mtime:(o==null?void 0:o.mtime)||0}}));r.sort((s,o)=>o.mtime-s.mtime);let i=r.slice(t);for(let{file:s}of i)await this.deleteFile(s),a.debug("Deleted old backup",s);a.info(`Cleaned up ${i.length} old backups`)}catch(e){a.error("Failed to cleanup old backups",e)}}async getDirectorySize(t){try{let e=await this.listFiles(t),r=0;for(let i of e){let s=await this.vault.adapter.stat(i);r+=(s==null?void 0:s.size)||0}return r}catch(e){return a.error("Failed to get directory size",e),0}}};var Lt=require("obsidian");var Ge=class{constructor(t,e,r="json"){this.vault=t,this.pathManager=e,this.format=r}async readJson(t,e){try{let r=this.vault.adapter;if(!await r.exists(t))return a.debug("File does not exist, returning fallback",t),e;let i=await r.read(t),s=Qr(i,e);return a.debug("Read JSON file",t),s}catch(r){throw a.error("Failed to read JSON file",r),new _(`Failed to read file ${t}`,t)}}async writeJson(t,e,r=!1){try{let i=this.vault.adapter;if(r&&await i.exists(t))try{await this.pathManager.createBackup(t)}catch(o){a.warn("Failed to create backup, continuing",o)}let s=JSON.stringify(e,null,2);await i.write(t,s),a.debug("Wrote JSON file",t)}catch(i){throw a.error("Failed to write JSON file",i),new _(`Failed to write file ${t}`,t)}}async deleteFile(t){try{await this.vault.adapter.remove(t),a.debug("Deleted file",t)}catch(e){throw a.error("Failed to delete file",e),new _(`Failed to delete file ${t}`,t)}}async fileExists(t){try{return await this.vault.adapter.exists(t)}catch(e){return a.error("Failed to check file existence",e),!1}}async listFiles(t){try{let e=this.vault.adapter;return await e.exists(t)?(await e.list(t)).files:[]}catch(e){throw a.error("Failed to list files",e),new _(`Failed to list files in ${t}`,t)}}},ve=class extends Ge{constructor(e,r,i,s="json"){super(e,r,s);this.cache=null;this.cacheTimestamp=0;this.CACHE_TTL_MS=2e3;this.isDirty=!1;this.saveDebounceTimer=null;this.SAVE_DEBOUNCE_MS=1e3;this.loadPromise=null;this.filePath=(0,Lt.normalizePath)(i)}async load(){if(a.methodEntry("SingleFileStore","load",this.filePath),this.loadPromise)return a.debug("Returning existing load promise",this.filePath),this.loadPromise;let e=Date.now();if(this.cache!==null&&e-this.cacheTimestamp<this.CACHE_TTL_MS)return a.debug("Returning cached data",this.filePath),a.methodExit("SingleFileStore","load","cached"),this.cache;this.loadPromise=this.performLoad(e);try{return await this.loadPromise}finally{this.loadPromise=null}}async performLoad(e){let r=await this.readJson(this.filePath,this.getDefaultValue());return this.validate(r)?(this.cache=r,this.cacheTimestamp=e,a.methodExit("SingleFileStore","load"),r):(a.warn("Data validation failed, using default value",this.filePath),this.getDefaultValue())}async save(e,r=!1){if(a.methodEntry("SingleFileStore","save",this.filePath),!this.validate(e))throw new _("Data validation failed",this.filePath);this.cache=e,this.cacheTimestamp=Date.now(),this.isDirty=!0,r?await this.flush():this.scheduleDebouncedSave(),a.methodExit("SingleFileStore","save")}scheduleDebouncedSave(){this.saveDebounceTimer&&clearTimeout(this.saveDebounceTimer),this.saveDebounceTimer=setTimeout(async()=>{if(this.saveDebounceTimer=null,this.isDirty&&this.cache)try{await this.writeJson(this.filePath,this.cache),this.isDirty=!1,a.debug("Debounced save completed",this.filePath)}catch(e){a.error("Debounced save failed",e)}},this.SAVE_DEBOUNCE_MS)}async flush(){this.saveDebounceTimer&&(clearTimeout(this.saveDebounceTimer),this.saveDebounceTimer=null),this.isDirty&&this.cache&&(await this.writeJson(this.filePath,this.cache),this.isDirty=!1,a.debug("Flushed pending save",this.filePath))}invalidateCache(){this.cache=null,this.cacheTimestamp=0,a.debug("Cache invalidated",this.filePath)}hasPendingChanges(){return this.isDirty}async clear(){a.methodEntry("SingleFileStore","clear",this.filePath);let e=this.getDefaultValue();await this.save(e,!0),this.invalidateCache(),a.methodExit("SingleFileStore","clear")}async delete(){this.saveDebounceTimer&&(clearTimeout(this.saveDebounceTimer),this.saveDebounceTimer=null),this.isDirty=!1,await this.fileExists(this.filePath)&&await this.deleteFile(this.filePath),this.invalidateCache()}},Pe=class extends Ge{constructor(t,e,r,i="json"){super(t,e,i),this.dirPath=(0,Lt.normalizePath)(r)}getItemFilePath(t){return(0,Lt.normalizePath)(`${this.dirPath}/${t}.json`)}async loadItem(t,e){let r=this.getItemFilePath(t);return await this.readJson(r,e)}async saveItem(t,e){let r=this.getItemFilePath(t);await this.writeJson(r,e)}async deleteItem(t){let e=this.getItemFilePath(t);await this.fileExists(e)&&await this.deleteFile(e)}async listItemIds(){return(await this.listFiles(this.dirPath)).filter(e=>e.endsWith(".json")).map(e=>(e.split("/").pop()||"").replace(".json",""))}async clear(){a.methodEntry("MultiFileStore","clear",this.dirPath);let t=await this.listFiles(this.dirPath);for(let e of t)await this.deleteFile(e);a.methodExit("MultiFileStore","clear")}};var Ye=class Ye extends ve{constructor(t,e){let r=e.getFilePath("subscriptions","subscriptions.json");super(t,e,r)}validate(t){if(!t||typeof t!="object")return a.warn("Invalid subscription data: not an object"),!1;if(!Array.isArray(t.podcasts))return a.warn("Invalid subscription data: podcasts is not an array"),!1;if(typeof t.version!="number")return a.warn("Invalid subscription data: version is not a number"),!1;for(let e of t.podcasts)if(!this.validatePodcast(e))return a.warn("Invalid podcast in subscription data",e),!1;return!0}validatePodcast(t){if(!t||typeof t!="object")return!1;let e=["id","title","feedUrl","subscribedAt"];for(let r of e)if(!(r in t))return a.warn(`Missing required field in podcast: ${r}`),!1;return!0}getDefaultValue(){return{podcasts:[],version:Ye.CURRENT_VERSION}}async getAllPodcasts(){a.methodEntry("SubscriptionStore","getAllPodcasts");let t=await this.load();return a.methodExit("SubscriptionStore","getAllPodcasts"),t.podcasts}async getPodcast(t){a.methodEntry("SubscriptionStore","getPodcast",t);let r=(await this.load()).podcasts.find(i=>i.id===t)||null;return a.methodExit("SubscriptionStore","getPodcast"),r}async getPodcastByFeedUrl(t){a.methodEntry("SubscriptionStore","getPodcastByFeedUrl",t);let r=(await this.load()).podcasts.find(i=>i.feedUrl===t)||null;return a.methodExit("SubscriptionStore","getPodcastByFeedUrl"),r}async addPodcast(t){if(a.methodEntry("SubscriptionStore","addPodcast",t.id),!this.validatePodcast(t))throw new _("Invalid podcast data",this.filePath);let e=await this.load(),r=e.podcasts.findIndex(i=>i.id===t.id);r!==-1?(a.warn("Podcast already exists, updating instead",t.id),e.podcasts[r]=t):e.podcasts.push(t),await this.save(e),a.methodExit("SubscriptionStore","addPodcast")}async updatePodcast(t){if(a.methodEntry("SubscriptionStore","updatePodcast",t.id),!this.validatePodcast(t))throw new _("Invalid podcast data",this.filePath);let e=await this.load(),r=e.podcasts.findIndex(i=>i.id===t.id);if(r===-1)throw new _(`Podcast not found: ${t.id}`,this.filePath);e.podcasts[r]=t,await this.save(e),a.methodExit("SubscriptionStore","updatePodcast")}async removePodcast(t){a.methodEntry("SubscriptionStore","removePodcast",t);let e=await this.load(),r=e.podcasts.findIndex(i=>i.id===t);if(r===-1){a.warn("Podcast not found, nothing to remove",t);return}e.podcasts.splice(r,1),await this.save(e),a.methodExit("SubscriptionStore","removePodcast")}async isSubscribed(t){return(await this.load()).podcasts.some(r=>r.id===t)}async isSubscribedByFeedUrl(t){return(await this.load()).podcasts.some(r=>r.feedUrl===t)}async getSubscriptionCount(){return(await this.load()).podcasts.length}async updatePodcastEpisodes(t,e){a.methodEntry("SubscriptionStore","updatePodcastEpisodes",t);let r=await this.load(),i=r.podcasts.find(s=>s.id===t);if(!i)throw new _(`Podcast not found: ${t}`,this.filePath);i.episodes=e,i.lastFetchedAt=new Date,await this.save(r),a.methodExit("SubscriptionStore","updatePodcastEpisodes")}async updatePodcastSettings(t,e){a.methodEntry("SubscriptionStore","updatePodcastSettings",t);let r=await this.load(),i=r.podcasts.find(s=>s.id===t);if(!i)throw new _(`Podcast not found: ${t}`,this.filePath);i.settings=e,await this.save(r),a.methodExit("SubscriptionStore","updatePodcastSettings")}async getPodcastsNeedingUpdate(t){let e=await this.load(),r=Date.now();return e.podcasts.filter(i=>{if(!i.lastFetchedAt)return!0;let s=new Date(i.lastFetchedAt).getTime();return r-s>=t})}async searchPodcasts(t){let e=await this.load(),r=t.toLowerCase();return e.podcasts.filter(i=>{var n;let s=i.title.toLowerCase().includes(r),o=(n=i.author)==null?void 0:n.toLowerCase().includes(r);return s||o})}async exportSubscriptions(){a.methodEntry("SubscriptionStore","exportSubscriptions");let t=await this.load();return a.methodExit("SubscriptionStore","exportSubscriptions"),t}async importSubscriptions(t,e=!1){if(a.methodEntry("SubscriptionStore","importSubscriptions",`replace=${e}`),!this.validate(t))throw new _("Invalid import data",this.filePath);if(e)await this.save(t);else{let i=[...(await this.load()).podcasts];for(let s of t.podcasts){let o=i.findIndex(n=>n.id===s.id);o!==-1?i[o]=s:i.push(s)}await this.save({podcasts:i,version:Ye.CURRENT_VERSION})}a.methodExit("SubscriptionStore","importSubscriptions")}};Ye.CURRENT_VERSION=1;var Ke=Ye;function Br(u){return Math.max(.5,Math.min(3,u))}function $r(u){return Math.max(0,Math.min(1,u))}var ur=[.5,.75,1,1.25,1.5,1.75,2,2.5,3];function _r(u){let t=ur.findIndex(e=>e>u);return t===-1?ur[0]:ur[t]}var Ur={SHORT:15,MEDIUM:30,LONG:60};function Vr(u,t,e=Ur.SHORT){return Math.min(t,u+e)}function jr(u,t=Ur.SHORT){return Math.max(0,u-t)}function Je(u,t,e=30){return t<=0?!1:t-u<=e}var Ue=class Ue extends ve{constructor(t,e){let r=e.getFilePath("progress","progress.json");super(t,e,r)}validate(t){if(!t||typeof t!="object")return a.warn("Invalid progress data: not an object"),!1;if(!Array.isArray(t.progress))return a.warn("Invalid progress data: progress is not an array"),!1;if(typeof t.version!="number")return a.warn("Invalid progress data: version is not a number"),!1;for(let e of t.progress)if(!this.validateProgress(e))return a.warn("Invalid progress entry in data",e),!1;return!0}validateProgress(t){if(!t||typeof t!="object")return!1;let e=["episodeId","podcastId","position","duration","lastPlayedAt"];for(let r of e)if(!(r in t))return a.warn(`Missing required field in progress: ${r}`),!1;return!(typeof t.position!="number"||t.position<0||typeof t.duration!="number"||t.duration<0||typeof t.completed!="boolean")}getDefaultValue(){return{progress:[],version:Ue.CURRENT_VERSION}}async getProgress(t){a.methodEntry("ProgressStore","getProgress",t);let r=(await this.load()).progress.find(i=>i.episodeId===t)||null;return a.methodExit("ProgressStore","getProgress"),r}async getBatchProgress(t){a.methodEntry("ProgressStore","getBatchProgress",`count=${t.length}`);let e=await this.load(),r=new Map,i=new Set(t);for(let s of e.progress)i.has(s.episodeId)&&r.set(s.episodeId,s);return a.methodExit("ProgressStore","getBatchProgress",`found=${r.size}`),r}async getBatchCompletionPercentages(t){a.methodEntry("ProgressStore","getBatchCompletionPercentages",`count=${t.length}`);let e=await this.getBatchProgress(t),r=new Map;for(let i of t){let s=e.get(i);if(!s||s.duration<=0)r.set(i,0);else{let o=Math.min(100,Math.max(0,s.position/s.duration*100));r.set(i,o)}}return a.methodExit("ProgressStore","getBatchCompletionPercentages"),r}async getPodcastProgress(t){a.methodEntry("ProgressStore","getPodcastProgress",t);let r=(await this.load()).progress.filter(i=>i.podcastId===t);return a.methodExit("ProgressStore","getPodcastProgress"),r}async getAllProgress(){a.methodEntry("ProgressStore","getAllProgress");let t=await this.load();return a.methodExit("ProgressStore","getAllProgress"),t.progress}async updateProgress(t){if(a.methodEntry("ProgressStore","updateProgress",t.episodeId),!this.validateProgress(t))throw new _("Invalid progress data",this.filePath);let e=await this.load(),r=e.progress.findIndex(i=>i.episodeId===t.episodeId);t.completed=Je(t.position,t.duration),r!==-1?e.progress[r]=t:e.progress.push(t),await this.save(e),a.methodExit("ProgressStore","updateProgress")}async updatePosition(t,e,r,i){a.methodEntry("ProgressStore","updatePosition",t);let s={episodeId:t,podcastId:e,position:r,duration:i,lastPlayedAt:new Date,completed:Je(r,i)};await this.updateProgress(s),a.methodExit("ProgressStore","updatePosition")}async markCompleted(t,e,r){a.methodEntry("ProgressStore","markCompleted",t);let i={episodeId:t,podcastId:e,position:r,duration:r,lastPlayedAt:new Date,completed:!0};await this.updateProgress(i),a.methodExit("ProgressStore","markCompleted")}async resetProgress(t){a.methodEntry("ProgressStore","resetProgress",t);let e=await this.load(),r=e.progress.findIndex(i=>i.episodeId===t);r!==-1&&(e.progress.splice(r,1),await this.save(e)),a.methodExit("ProgressStore","resetProgress")}async removeProgress(t){a.methodEntry("ProgressStore","removeProgress",t);let e=await this.load(),r=e.progress.findIndex(i=>i.episodeId===t);r!==-1&&(e.progress.splice(r,1),await this.save(e)),a.methodExit("ProgressStore","removeProgress")}async removePodcastProgress(t){a.methodEntry("ProgressStore","removePodcastProgress",t);let e=await this.load();e.progress=e.progress.filter(r=>r.podcastId!==t),await this.save(e),a.methodExit("ProgressStore","removePodcastProgress")}async getInProgressEpisodes(){return(await this.load()).progress.filter(e=>!e.completed&&e.position>0)}async getCompletedEpisodes(){return(await this.load()).progress.filter(e=>e.completed)}async getRecentlyPlayed(t=10){return[...(await this.load()).progress].sort((i,s)=>{let o=new Date(i.lastPlayedAt).getTime();return new Date(s.lastPlayedAt).getTime()-o}).slice(0,t)}async getCompletionPercentage(t){let e=await this.getProgress(t);return!e||e.duration<=0?0:Math.min(100,Math.max(0,e.position/e.duration*100))}async getTotalListeningTime(){return(await this.load()).progress.reduce((e,r)=>e+r.position,0)}async getPodcastStatistics(t){let e=await this.getPodcastProgress(t);return{totalEpisodes:e.length,completedEpisodes:e.filter(r=>r.completed).length,inProgressEpisodes:e.filter(r=>!r.completed&&r.position>0).length,totalListeningTime:e.reduce((r,i)=>r+i.position,0)}}async cleanupOldProgress(t=100){a.methodEntry("ProgressStore","cleanupOldProgress",`keepRecentCount=${t}`);let e=await this.load(),r=[...e.progress].sort((i,s)=>{let o=new Date(i.lastPlayedAt).getTime();return new Date(s.lastPlayedAt).getTime()-o});e.progress=r.slice(0,t),await this.save(e),a.methodExit("ProgressStore","cleanupOldProgress")}async exportProgress(){a.methodEntry("ProgressStore","exportProgress");let t=await this.load();return a.methodExit("ProgressStore","exportProgress"),t}async importProgress(t,e=!1){if(a.methodEntry("ProgressStore","importProgress",`replace=${e}`),!this.validate(t))throw new _("Invalid import data",this.filePath);if(e)await this.save(t);else{let i=[...(await this.load()).progress];for(let s of t.progress){let o=i.findIndex(n=>n.episodeId===s.episodeId);if(o!==-1){let n=new Date(i[o].lastPlayedAt).getTime();new Date(s.lastPlayedAt).getTime()>n&&(i[o]=s)}else i.push(s)}await this.save({progress:i,version:Ue.CURRENT_VERSION})}a.methodExit("ProgressStore","importProgress")}async clearAll(){a.methodEntry("ProgressStore","clearAll"),await this.save({progress:[],version:Ue.CURRENT_VERSION}),a.methodExit("ProgressStore","clearAll")}};Ue.CURRENT_VERSION=1;var Ze=Ue;var Hr=require("obsidian");var et=class extends ve{constructor(t,e){let r=e.getFilePath("root","settings.json");super(t,e,r)}validate(t){if(!t||typeof t!="object")return a.warn("Invalid settings data: not an object"),!1;if(typeof t.dataFolderPath!="string")return a.warn("Invalid settings: dataFolderPath is not a string"),!1;if(!t.defaultPlaybackSettings||typeof t.defaultPlaybackSettings!="object")return a.warn("Invalid settings: defaultPlaybackSettings is not an object"),!1;let e=t.defaultPlaybackSettings;return typeof e.volume!="number"||typeof e.playbackSpeed!="number"||typeof e.skipIntroSeconds!="number"?(a.warn("Invalid settings: defaultPlaybackSettings has invalid fields"),!1):typeof t.autoDownload!="boolean"?(a.warn("Invalid settings: autoDownload is not a boolean"),!1):typeof t.enableNotifications!="boolean"?(a.warn("Invalid settings: enableNotifications is not a boolean"),!1):typeof t.maxCacheEpisodes!="number"||t.maxCacheEpisodes<0?(a.warn("Invalid settings: maxCacheEpisodes is invalid"),!1):typeof t.feedUpdateInterval!="number"||t.feedUpdateInterval<0?(a.warn("Invalid settings: feedUpdateInterval is invalid"),!1):!0}getDefaultValue(){return{...ae}}async getSettings(){a.methodEntry("SettingsStore","getSettings");let t=await this.load();return a.methodExit("SettingsStore","getSettings"),t}async updateSettings(t){a.methodEntry("SettingsStore","updateSettings"),await this.save(t),a.methodExit("SettingsStore","updateSettings")}async updateSetting(t,e){a.methodEntry("SettingsStore","updateSetting",t);let r=await this.load();r[t]=e,await this.save(r),a.methodExit("SettingsStore","updateSetting")}async getSetting(t){return(await this.load())[t]}async updateDataFolderPath(t){a.methodEntry("SettingsStore","updateDataFolderPath",t),await this.updateSetting("dataFolderPath",(0,Hr.normalizePath)(t)),a.methodExit("SettingsStore","updateDataFolderPath")}async updateDefaultVolume(t){a.methodEntry("SettingsStore","updateDefaultVolume",t);let e=await this.load();e.defaultPlaybackSettings.volume=Math.max(0,Math.min(1,t)),await this.save(e),a.methodExit("SettingsStore","updateDefaultVolume")}async updateDefaultPlaybackSpeed(t){a.methodEntry("SettingsStore","updateDefaultPlaybackSpeed",t);let e=await this.load();e.defaultPlaybackSettings.playbackSpeed=Math.max(.5,Math.min(3,t)),await this.save(e),a.methodExit("SettingsStore","updateDefaultPlaybackSpeed")}async updateDefaultSkipIntro(t){a.methodEntry("SettingsStore","updateDefaultSkipIntro",t);let e=await this.load();e.defaultPlaybackSettings.skipIntroSeconds=Math.max(0,t),await this.save(e),a.methodExit("SettingsStore","updateDefaultSkipIntro")}async updateDefaultSkipOutro(t){a.methodEntry("SettingsStore","updateDefaultSkipOutro",t);let e=await this.load();e.defaultPlaybackSettings.skipOutroSeconds=Math.max(0,t),await this.save(e),a.methodExit("SettingsStore","updateDefaultSkipOutro")}async updateAutoDownload(t){a.methodEntry("SettingsStore","updateAutoDownload",t),await this.updateSetting("autoDownload",t),a.methodExit("SettingsStore","updateAutoDownload")}async updateMaxCacheEpisodes(t){a.methodEntry("SettingsStore","updateMaxCacheEpisodes",t),await this.updateSetting("maxCacheEpisodes",Math.max(0,t)),a.methodExit("SettingsStore","updateMaxCacheEpisodes")}async updateFeedUpdateInterval(t){a.methodEntry("SettingsStore","updateFeedUpdateInterval",t),await this.updateSetting("feedUpdateInterval",Math.max(0,t)),a.methodExit("SettingsStore","updateFeedUpdateInterval")}async updateNotifications(t){a.methodEntry("SettingsStore","updateNotifications",t),await this.updateSetting("enableNotifications",t),a.methodExit("SettingsStore","updateNotifications")}async resetToDefaults(){a.methodEntry("SettingsStore","resetToDefaults"),await this.save(this.getDefaultValue()),a.methodExit("SettingsStore","resetToDefaults")}async exportSettings(){a.methodEntry("SettingsStore","exportSettings");let t=await this.load();return a.methodExit("SettingsStore","exportSettings"),t}async importSettings(t){if(a.methodEntry("SettingsStore","importSettings"),!this.validate(t))throw new _("Invalid import settings",this.filePath);await this.save(t),a.methodExit("SettingsStore","importSettings")}async loadWithMigration(){a.methodEntry("SettingsStore","loadWithMigration");let t=await this.load(),e={...this.getDefaultValue(),...t,defaultPlaybackSettings:{...ae.defaultPlaybackSettings,...t.defaultPlaybackSettings}};return JSON.stringify(t)!==JSON.stringify(e)&&(a.info("Migrating settings to current version"),await this.save(e)),a.methodExit("SettingsStore","loadWithMigration"),e}};var tt=class extends Pe{constructor(t,e,r=36e5){let i=e.getStructure().cacheFeed;super(t,e,i),this.defaultTTL=r}validate(t){if(!Array.isArray(t))return a.warn("Invalid feed cache data: not an array"),!1;for(let e of t)if(!this.validateEntry(e))return a.warn("Invalid feed cache entry",e),!1;return!0}validateEntry(t){if(!t||typeof t!="object")return!1;let e=["data","cachedAt","expiresAt","url","feedUrl"];for(let r of e)if(!(r in t))return a.warn(`Missing required field in cache entry: ${r}`),!1;return!0}getDefaultValue(){return[]}async loadAllItems(){let t=await this.listItemIds(),e=[];for(let r of t)try{let i={data:"",cachedAt:new Date,expiresAt:new Date,url:"",feedUrl:""},s=await this.loadItem(r,i);s&&this.validateEntry(s)&&e.push(s)}catch(i){a.warn(`Failed to load cache entry: ${r}`,i)}return e}async load(){a.methodEntry("FeedCacheStore","load");let t=await this.loadAllItems();return a.methodExit("FeedCacheStore","load"),t}async save(t){if(a.methodEntry("FeedCacheStore","save"),!this.validate(t))throw new _("Invalid feed cache data",this.dirPath);await this.clear();for(let e of t){let r=this.getFeedCacheId(e.feedUrl);await this.saveItem(r,e)}a.methodExit("FeedCacheStore","save")}getFeedCacheId(t){let e=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);e=(e<<5)-e+i,e=e&e}return`feed-${Math.abs(e).toString(36)}`}async getCacheEntry(t){a.methodEntry("FeedCacheStore","getCacheEntry",t);let e=this.getFeedCacheId(t);try{let r={data:"",cachedAt:new Date,expiresAt:new Date,url:"",feedUrl:""},i=await this.loadItem(e,r);if(!i||!this.validateEntry(i))return a.methodExit("FeedCacheStore","getCacheEntry","invalid entry"),null;let s=new Date,o=new Date(i.expiresAt);return s>o?(a.debug("Cache entry expired",t),await this.deleteItem(e),a.methodExit("FeedCacheStore","getCacheEntry","expired"),null):(a.methodExit("FeedCacheStore","getCacheEntry"),i)}catch(r){return a.warn("Failed to get cache entry",r),a.methodExit("FeedCacheStore","getCacheEntry","error"),null}}async setCacheEntry(t,e,r=this.defaultTTL,i){a.methodEntry("FeedCacheStore","setCacheEntry",t);let s=new Date,o=new Date(s.getTime()+r),n={data:e,cachedAt:s,expiresAt:o,url:t,feedUrl:t,etag:i==null?void 0:i.etag,lastModified:i==null?void 0:i.lastModified},l=this.getFeedCacheId(t);await this.saveItem(l,n),a.methodExit("FeedCacheStore","setCacheEntry")}async removeCacheEntry(t){a.methodEntry("FeedCacheStore","removeCacheEntry",t);let e=this.getFeedCacheId(t);await this.deleteItem(e),a.methodExit("FeedCacheStore","removeCacheEntry")}async cleanupExpired(){a.methodEntry("FeedCacheStore","cleanupExpired");let t=await this.loadAllItems(),e=new Date,r=0;for(let i of t){let s=new Date(i.expiresAt);if(e>s){let o=this.getFeedCacheId(i.feedUrl);await this.deleteItem(o),r++}}a.info(`Cleaned up ${r} expired cache entries`),a.methodExit("FeedCacheStore","cleanupExpired")}async getCacheStats(){let t=await this.loadAllItems(),e=new Date,r=0,i=0;for(let s of t){let o=new Date(s.expiresAt);e>o&&r++,i+=s.data.length}return{totalEntries:t.length,expiredEntries:r,totalSize:i}}},Ft=class Ft{constructor(t,e){this.vault=t,this.pathManager=e,this.indexFilePath=e.getFilePath("cache","image-index.json")}async loadIndex(){try{let t=this.vault.adapter;if(!await t.exists(this.indexFilePath))return this.getDefaultIndex();let e=await t.read(this.indexFilePath),r=JSON.parse(e);return this.validateIndex(r)?r:(a.warn("Invalid image cache index, using default"),this.getDefaultIndex())}catch(t){return a.error("Failed to load image cache index",t),this.getDefaultIndex()}}async saveIndex(t){try{let e=JSON.stringify(t,null,2);await this.vault.adapter.write(this.indexFilePath,e)}catch(e){throw a.error("Failed to save image cache index",e),new _("Failed to save image cache index",this.indexFilePath)}}validateIndex(t){return!(!t||typeof t!="object"||!Array.isArray(t.images)||typeof t.version!="number")}getDefaultIndex(){return{images:[],version:Ft.CURRENT_VERSION}}getImageCacheFilename(t){let e="jpg";try{let o=new URL(t).pathname.match(/\.([a-zA-Z0-9]+)$/);o&&(e=o[1].toLowerCase())}catch(i){}let r=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);r=(r<<5)-r+s,r=r&r}return`image-${Math.abs(r).toString(36)}.${e}`}async getCachedImage(t){a.methodEntry("ImageCacheStore","getCachedImage",t);let r=(await this.loadIndex()).images.find(s=>s.imageUrl===t);return r?await this.vault.adapter.exists(r.localPath)?(a.methodExit("ImageCacheStore","getCachedImage"),r.localPath):(a.warn("Cached image file not found",r.localPath),await this.removeCachedImage(t),a.methodExit("ImageCacheStore","getCachedImage","file missing"),null):(a.methodExit("ImageCacheStore","getCachedImage","not found"),null)}async cacheImage(t,e){a.methodEntry("ImageCacheStore","cacheImage",t);let r=this.getImageCacheFilename(t),i=this.pathManager.getFilePath("cacheImages",r);await this.vault.adapter.writeBinary(i,e);let s=await this.loadIndex();s.images=s.images.filter(n=>n.imageUrl!==t);let o={imageUrl:t,localPath:i,cachedAt:new Date,size:e.byteLength};return s.images.push(o),await this.saveIndex(s),a.methodExit("ImageCacheStore","cacheImage"),i}async removeCachedImage(t){a.methodEntry("ImageCacheStore","removeCachedImage",t);let e=await this.loadIndex(),r=e.images.find(i=>i.imageUrl===t);if(r){try{await this.vault.adapter.remove(r.localPath)}catch(i){a.warn("Failed to delete cached image file",i)}e.images=e.images.filter(i=>i.imageUrl!==t),await this.saveIndex(e)}a.methodExit("ImageCacheStore","removeCachedImage")}async clearAll(){a.methodEntry("ImageCacheStore","clearAll");let t=await this.loadIndex();for(let e of t.images)try{await this.vault.adapter.remove(e.localPath)}catch(r){a.warn(`Failed to delete cached image: ${e.localPath}`,r)}await this.saveIndex(this.getDefaultIndex()),a.methodExit("ImageCacheStore","clearAll")}async getCacheStats(){let t=await this.loadIndex(),e=t.images.reduce((r,i)=>r+i.size,0);return{totalImages:t.images.length,totalSize:e}}async cleanupOldImages(t=100){a.methodEntry("ImageCacheStore","cleanupOldImages",`keepCount=${t}`);let e=await this.loadIndex();if(e.images.length<=t){a.methodExit("ImageCacheStore","cleanupOldImages","nothing to cleanup");return}let r=[...e.images].sort((s,o)=>{let n=new Date(s.cachedAt).getTime();return new Date(o.cachedAt).getTime()-n}),i=r.slice(t);for(let s of i)try{await this.vault.adapter.remove(s.localPath)}catch(o){a.warn(`Failed to delete old image: ${s.localPath}`,o)}e.images=r.slice(0,t),await this.saveIndex(e),a.info(`Cleaned up ${i.length} old cached images`),a.methodExit("ImageCacheStore","cleanupOldImages")}};Ft.CURRENT_VERSION=1;var rt=Ft;var Q=require("obsidian");var Ae=require("obsidian"),pr=class extends Ae.Modal{constructor(e,r,i,s){super(e);this.inputValue="";this.options={confirmText:"Confirm",cancelText:"Cancel",confirmClass:"cta",...r},this.onConfirm=i,this.onCancel=s}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("confirm-modal"),e.createEl("h2",{text:this.options.title}),e.createEl("p",{cls:"confirm-modal-message podcast-confirm-message"}).setText(this.options.message);let i=e.createDiv({cls:"modal-button-container podcast-modal-button-container"});new Ae.ButtonComponent(i).setButtonText(this.options.cancelText).onClick(()=>{this.onCancel&&this.onCancel(),this.close()});let s=new Ae.ButtonComponent(i).setButtonText(this.options.confirmText);this.options.confirmClass==="warning"||this.options.confirmClass==="destructive"?s.setWarning():s.setCta(),this.options.requireInput&&s.setDisabled(!0),s.onClick(()=>{this.options.requireInput&&this.inputValue!==this.options.requireInput||(this.onConfirm(),this.close())});let o=null;if(this.options.requireInput){let n=e.createDiv({cls:"confirm-modal-input podcast-confirm-input-container"});e.insertBefore(n,i),n.createEl("p",{text:`Type "${this.options.requireInput}" to confirm:`,cls:"confirm-modal-input-label"}),new Ae.Setting(n).addText(c=>{c.setPlaceholder(this.options.inputPlaceholder||this.options.requireInput||"").onChange(p=>{this.inputValue=p,s.setDisabled(p!==this.options.requireInput)}),o=c.inputEl}).settingEl.addClass("podcast-confirm-input-setting")}setTimeout(()=>{o&&o.focus()},10)}onClose(){let{contentEl:e}=this;e.empty()}};function it(u,t){return new Promise(e=>{new pr(u,t,()=>e(!0),()=>e(!1)).open()})}var st=class extends Q.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),this.loadSettings(),this.addStorageSection(t),this.addPlaybackSection(t),this.addDailyNoteSection(t),this.addCacheSection(t),this.addSyncSection(t),this.addNotificationSection(t),this.addBackupSection(t),this.addAdvancedSection(t),this.addSupportSection(t)}loadSettings(){this.settings=this.plugin.settings}async saveSettings(){await this.plugin.saveSettings()}addStorageSection(t){new Q.Setting(t).setName("Data storage").setHeading(),new Q.Setting(t).setName("Data folder path").setDesc("Folder where podcast data will be stored (relative to vault root)").addText(e=>e.setPlaceholder(this.settings.dataFolderPath||"config/plugins/podcasts/data").setValue(this.settings.dataFolderPath).onChange(async r=>{this.settings.dataFolderPath=r,await this.saveSettings()}))}addPlaybackSection(t){new Q.Setting(t).setName("Default playback").setDesc("These settings apply to all podcasts by default. Individual podcasts can override these.").setHeading(),new Q.Setting(t).setName("Default volume").setDesc("Default playback volume (0.0 to 1.0)").addSlider(e=>e.setLimits(0,100,5).setValue(this.settings.defaultPlaybackSettings.volume*100).setDynamicTooltip().onChange(async r=>{this.settings.defaultPlaybackSettings.volume=r/100,await this.saveSettings()})),new Q.Setting(t).setName("Default playback speed").setDesc("Default playback speed (0.5x to 3.0x)").addSlider(e=>e.setLimits(50,300,5).setValue(this.settings.defaultPlaybackSettings.playbackSpeed*100).setDynamicTooltip().onChange(async r=>{this.settings.defaultPlaybackSettings.playbackSpeed=r/100,await this.saveSettings()})),new Q.Setting(t).setName("Skip intro seconds").setDesc("Number of seconds to skip at the beginning of each episode").addText(e=>e.setPlaceholder("0").setValue(String(this.settings.defaultPlaybackSettings.skipIntroSeconds)).onChange(async r=>{let i=parseInt(r,10);!isNaN(i)&&i>=0&&(this.settings.defaultPlaybackSettings.skipIntroSeconds=i,await this.saveSettings())})),new Q.Setting(t).setName("Skip outro seconds").setDesc("Number of seconds to skip at the end of each episode").addText(e=>e.setPlaceholder("0").setValue(String(this.settings.defaultPlaybackSettings.skipOutroSeconds||0)).onChange(async r=>{let i=parseInt(r,10);!isNaN(i)&&i>=0&&(this.settings.defaultPlaybackSettings.skipOutroSeconds=i,await this.saveSettings())}))}addDailyNoteSection(t){new Q.Setting(t).setName("Daily note integration").setDesc("Configure how podcast notes are added to your daily notes.").setHeading(),new Q.Setting(t).setName("Daily note folder").setDesc("Folder where your daily notes are stored (leave empty for vault root)").addText(e=>e.setPlaceholder("Daily notes").setValue(this.settings.dailyNoteFolderPath).onChange(r=>{this.settings.dailyNoteFolderPath=r,this.saveSettings()})),new Q.Setting(t).setName("Daily note date format").setDesc("Date format for daily note filenames (uses moment.js format)").addText(e=>e.setPlaceholder("Year-month-day").setValue(this.settings.dailyNoteDateFormat).onChange(r=>{this.settings.dailyNoteDateFormat=r||"YYYY-MM-DD",this.saveSettings()})),new Q.Setting(t).setName("Note insert position").setDesc("Where to insert podcast notes in your daily note").addDropdown(e=>e.addOption("top","Top of file").addOption("bottom","Bottom of file").setValue(this.settings.dailyNoteInsertPosition).onChange(r=>{this.settings.dailyNoteInsertPosition=r,this.saveSettings()})),new Q.Setting(t).setName("Daily note header").setDesc("Header to insert notes under (e.g. ## \u{1F3A7} Listening Log)").addText(e=>e.setPlaceholder("## \u{1F3A7} Listening Log").setValue(this.settings.dailyNoteHeader).onChange(async r=>{this.settings.dailyNoteHeader=r,await this.saveSettings()}))}addCacheSection(t){new Q.Setting(t).setName("Download and cache").setHeading(),new Q.Setting(t).setName("Auto download new episodes").setDesc("Automatically download new episodes when feeds are updated").addToggle(e=>e.setValue(this.settings.autoDownload).onChange(async r=>{this.settings.autoDownload=r,await this.saveSettings()})),new Q.Setting(t).setName("Maximum cached episodes").setDesc("Maximum number of episodes to keep in cache. Older episodes will be removed.").addText(e=>e.setPlaceholder("50").setValue(String(this.settings.maxCacheEpisodes)).onChange(async r=>{let i=parseInt(r,10);!isNaN(i)&&i>=0&&(this.settings.maxCacheEpisodes=i,await this.saveSettings())}))}addSyncSection(t){new Q.Setting(t).setName("Feed sync").setHeading(),new Q.Setting(t).setName("Feed update interval").setDesc("How often to check for new episodes (in minutes)").addDropdown(e=>e.addOption("15","15 minutes").addOption("30","30 minutes").addOption("60","1 hour").addOption("120","2 hours").addOption("360","6 hours").addOption("720","12 hours").addOption("1440","24 hours").setValue(String(this.settings.feedUpdateInterval)).onChange(async r=>{this.settings.feedUpdateInterval=parseInt(r,10),await this.saveSettings()}))}addNotificationSection(t){new Q.Setting(t).setName("Notifications").setHeading(),new Q.Setting(t).setName("Enable notifications").setDesc("Show notifications for new episodes and playback events").addToggle(e=>e.setValue(this.settings.enableNotifications).onChange(async r=>{this.settings.enableNotifications=r,await this.saveSettings()}))}addBackupSection(t){new Q.Setting(t).setName("Backup and restore").setHeading(),new Q.Setting(t).setName("Export subscriptions").setDesc("Save your podcast subscriptions to a file that can be imported into other podcast apps").addButton(e=>e.setButtonText("Export").onClick(()=>{this.exportOPML()})),new Q.Setting(t).setName("Import subscriptions").setDesc("Load podcast subscriptions from a file exported from another podcast app").addButton(e=>e.setButtonText("Import").onClick(()=>{this.importOPML()})),new Q.Setting(t).setName("Export full backup").setDesc("Export all data including subscriptions, playlists, queues, progress, and settings").addButton(e=>e.setButtonText("Export backup").onClick(()=>{this.exportFullBackup()})),new Q.Setting(t).setName("Import full backup").setDesc("Restore all data from a backup file").addButton(e=>e.setButtonText("Import backup").setWarning().onClick(()=>{this.importFullBackup()})),t.createEl("p",{text:"Auto-backup: daily backups are automatically created and kept for 30 days.",cls:"setting-item-description"})}addAdvancedSection(t){new Q.Setting(t).setName("Advanced").setHeading(),new Q.Setting(t).setName("Reset to defaults").setDesc("Reset all settings to their default values").addButton(e=>e.setButtonText("Reset").setWarning().onClick(()=>{(async()=>await it(this.app,{title:"Reset settings",message:`Are you sure you want to reset all settings to their default values?

This cannot be undone.`,confirmText:"Reset",confirmClass:"warning"})&&(await this.plugin.resetSettings(),this.display(),new Q.Notice("Settings reset to defaults")))()})),new Q.Setting(t).setName("Delete all data").setDesc("Delete all subscriptions, playlists, queues, progress, and cache. This cannot be undone!").addButton(e=>e.setButtonText("Delete all").setWarning().onClick(()=>{this.deleteAllData()}))}addSupportSection(t){new Q.Setting(t).setName("Support").setDesc("If you find this plugin useful, consider supporting the development!").setHeading(),t.createDiv({cls:"podcast-support-button-container"}).createEl("a",{href:"https://buymeacoffee.com/whoami885",attr:{target:"_blank",rel:"noopener noreferrer"}}).createEl("img",{cls:"podcast-support-button",attr:{src:"https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png",alt:"Buy Me A Coffee"}})}exportSettings(){try{let t=JSON.stringify(this.settings,null,2),e=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(e),i=document.createElement("a");i.href=r,i.download=`podcast-player-settings-${Date.now()}.json`,i.click(),URL.revokeObjectURL(r),new Q.Notice("Settings exported successfully")}catch(t){a.error("Failed to export settings",t),new Q.Notice("Failed to export settings")}}importSettings(){let t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=async e=>{var s;let i=(s=e.target.files)==null?void 0:s[0];if(i)try{let o=await i.text(),n=JSON.parse(o);if(!n.dataFolderPath||!n.defaultPlaybackSettings)throw new Error("Invalid settings file format");this.settings=n,await this.saveSettings(),this.display(),new Q.Notice("Settings imported successfully")}catch(o){a.error("Failed to import settings",o),new Q.Notice("Failed to import settings: invalid file format")}},t.click()}async exportOPML(){try{let e=await this.plugin.getBackupService().exportOPML(),r=new Blob([e],{type:"text/xml"}),i=URL.createObjectURL(r),s=document.createElement("a");s.href=i,s.download=`podcast-subscriptions-${new Date().toISOString().split("T")[0]}.opml`,s.click(),URL.revokeObjectURL(i),new Q.Notice("Subscriptions exported successfully")}catch(t){a.error("Failed to export OPML",t),new Q.Notice("Failed to export subscriptions")}}importOPML(){let t=document.createElement("input");t.type="file",t.accept=".opml,.xml",t.onchange=async e=>{var s;let i=(s=e.target.files)==null?void 0:s[0];if(i)try{let o=await i.text(),l=this.plugin.getBackupService().parseOPML(o);if(l.length===0){new Q.Notice("No podcast feeds found in file");return}let c=this.plugin.getPodcastService(),p=0,h=0;new Q.Notice(`Importing ${l.length} podcasts...`);for(let m of l)try{(await c.subscribe(m)).success?p++:h++}catch(d){h++}new Q.Notice(`Imported ${p} podcasts (${h} failed)`)}catch(o){a.error("Failed to import OPML",o),new Q.Notice("Failed to import subscriptions: invalid file format")}},t.click()}async exportFullBackup(){try{let e=await this.plugin.getBackupService().exportFullBackupJSON(this.settings),r=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(r),s=document.createElement("a");s.href=i,s.download=`podcast-player-backup-${new Date().toISOString().split("T")[0]}.json`,s.click(),URL.revokeObjectURL(i),new Q.Notice("Full backup exported successfully")}catch(t){a.error("Failed to export backup",t),new Q.Notice("Failed to export backup")}}importFullBackup(){let t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=async e=>{var s;let i=(s=e.target.files)==null?void 0:s[0];if(i)try{let o=await i.text(),n=JSON.parse(o);if(!this.plugin.getBackupService().validateBackupData(n))throw new Error("Invalid backup file format");if(!await it(this.app,{title:"Restore backup",message:"This will overwrite all current data. Are you sure you want to restore from this backup?",confirmText:"Restore",confirmClass:"warning"}))return;n.settings&&(this.settings=n.settings,await this.saveSettings()),new Q.Notice("Settings restored. Please restart Obsidian for full effect."),this.display()}catch(o){a.error("Failed to import backup",o),new Q.Notice("Failed to import backup: invalid file format")}},t.click()}async deleteAllData(){if(!await it(this.app,{title:"Delete all data",message:`WARNING: This will permanently delete ALL your podcast data including:

\u2022 All podcast subscriptions
\u2022 All playlists
\u2022 All queues
\u2022 All playback progress
\u2022 All cached feeds and images
\u2022 All backups

This action cannot be undone!`,confirmText:"Continue",confirmClass:"warning"}))return;if(!await it(this.app,{title:"Final confirmation",message:`You are about to permanently delete all podcast data.

This is your last chance to cancel.`,confirmText:"Delete all",confirmClass:"destructive",requireInput:"DELETE",inputPlaceholder:"Type DELETE to confirm"})){new Q.Notice("Deletion cancelled");return}try{new Q.Notice("Deleting all data...");let i=await this.plugin.getBackupService().deleteAllData();i.success?new Q.Notice(`All data deleted successfully (${i.deletedItems} items)`):new Q.Notice(`Data deleted with some errors: ${i.errors.join(", ")}`),this.display()}catch(r){a.error("Failed to delete all data",r),new Q.Notice("Failed to delete all data")}}};var H=require("obsidian");var le=require("obsidian");var be=require("obsidian");var Le=class extends be.Modal{constructor(t,e,r,i){super(t),this.plugin=e,this.episodes=r,this.onSubmit=i}onOpen(){this.renderContent()}async renderContent(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"Add to queue"});let e=this.plugin.getQueueManager(),r=await e.getAllQueues(),i=null;r.length>0&&new be.Setting(t).setName("Select queue").setDesc("Choose an existing queue or create a new one").addDropdown(c=>{c.addOption("","Create new queue..."),r.forEach(p=>{c.addOption(p.id,p.name)}),c.onChange(p=>{i=p||null;let h=t.querySelector(".new-queue-setting");h&&(i?(h.addClass("podcast-display-none"),h.removeClass("podcast-display-block")):(h.addClass("podcast-display-block"),h.removeClass("podcast-display-none")))})});let s="",o=new be.Setting(t).setName("New queue name").setDesc("Enter a name for the new queue").addText(c=>c.setPlaceholder("My queue").onChange(p=>{s=p}));o.settingEl.addClass("new-queue-setting"),r.length>0&&i&&o.settingEl.addClass("podcast-display-none");let n=t.createDiv({cls:"episode-info"});this.episodes.length===1?n.createEl("p",{text:`Adding: ${this.episodes[0].title}`}):n.createEl("p",{text:`Adding ${this.episodes.length} episodes`});let l=t.createDiv({cls:"modal-button-container"});l.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),l.createEl("button",{text:"Add",cls:"mod-cta"}).addEventListener("click",()=>{(async()=>{try{let c;if(i)c=i;else{if(!s.trim()){new be.Notice("Please enter a queue name");return}c=(await e.createQueue(s.trim())).id}for(let p of this.episodes)await e.addEpisode(c,p.id);this.onSubmit(c),this.close(),new be.Notice("Added to queue successfully")}catch(c){a.error("Failed to add to queue",c),new be.Notice("Failed to add to queue")}})()})}onClose(){let{contentEl:t}=this;t.empty()}};var pe=require("obsidian");var Fe=class extends pe.Modal{constructor(t,e,r,i){super(t),this.plugin=e,this.episodes=r,this.onSubmit=i}onOpen(){this.renderContent()}async renderContent(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"Add to playlist"});let e=this.plugin.getPlaylistManager(),r=await e.getAllPlaylists(),i=null;r.length>0&&new pe.Setting(t).setName("Select playlist").setDesc("Choose an existing playlist or create a new one").addDropdown(p=>{p.addOption("","Create new playlist..."),r.forEach(h=>{p.addOption(h.id,h.name)}),p.onChange(h=>{i=h||null;let m=t.querySelector(".new-playlist-settings");m&&(i?(m.addClass("podcast-display-none"),m.removeClass("podcast-display-block")):(m.addClass("podcast-display-block"),m.removeClass("podcast-display-none")))})});let s="",o="",n=t.createDiv({cls:"new-playlist-settings"});new pe.Setting(n).setName("Playlist name").setDesc("Enter a name for the new playlist").addText(p=>p.setPlaceholder("My playlist").onChange(h=>{s=h})),new pe.Setting(n).setName("Description (optional)").setDesc("Add a description for the playlist").addTextArea(p=>p.setPlaceholder("Description...").onChange(h=>{o=h})),r.length>0&&i&&n.addClass("podcast-display-none");let l=t.createDiv({cls:"episode-info"});this.episodes.length===1?l.createEl("p",{text:`Adding: ${this.episodes[0].title}`}):l.createEl("p",{text:`Adding ${this.episodes.length} episodes`});let c=t.createDiv({cls:"modal-button-container"});c.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),c.createEl("button",{text:"Add",cls:"mod-cta"}).addEventListener("click",()=>{(async()=>{try{let p;if(i)p=i;else{if(!s.trim()){new pe.Notice("Please enter a playlist name");return}p=(await e.createPlaylist(s.trim(),o.trim()||void 0)).id}for(let h of this.episodes)await e.addEpisode(p,h.id);this.onSubmit(p),this.close(),new pe.Notice("Added to playlist successfully")}catch(p){a.error("Failed to add to playlist",p),new pe.Notice("Failed to add to playlist")}})()})}onClose(){let{contentEl:t}=this;t.empty()}};var he=class extends le.Modal{constructor(e,r,i){super(e);this.podcast=null;this.plugin=r,this.episode=i}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("episode-detail-modal"),this.modalEl.addClass("episode-detail-modal-container"),this.loadDataAndRender()}async loadDataAndRender(){await this.loadData(),this.render()}async loadData(){try{let e=this.plugin.getSubscriptionStore();this.podcast=await e.getPodcast(this.episode.podcastId);let i=await this.plugin.getEpisodeManager().getEpisodeWithProgress(this.episode.id);this.progress=i==null?void 0:i.progress}catch(e){a.error("Failed to load episode data",e)}}render(){let{contentEl:e}=this;e.empty(),this.renderHeader(),this.renderEpisodeInfo(),this.podcast&&this.renderPodcastInfo(),this.progress&&this.renderProgressInfo(),this.renderActions()}renderHeader(){var i,s;let{contentEl:e}=this,r=e.createDiv({cls:"episode-detail-header"});if(this.episode.imageUrl||(i=this.podcast)!=null&&i.imageUrl){let o=this.episode.imageUrl||((s=this.podcast)==null?void 0:s.imageUrl)||"";o&&r.createEl("img",{cls:"episode-detail-image",attr:{src:o,alt:this.episode.title}})}r.createEl("h2",{text:this.episode.title,cls:"episode-detail-title"})}renderEpisodeInfo(){let{contentEl:e}=this,r=e.createDiv({cls:"episode-detail-section"});if(r.createEl("h3",{text:"Episode information"}),this.episode.duration){let s=r.createDiv({cls:"episode-detail-row"});s.createSpan({text:"Duration: ",cls:"episode-detail-label"}),s.createSpan({text:this.formatDuration(this.episode.duration)})}let i=r.createDiv({cls:"episode-detail-row"});if(i.createSpan({text:"Published: ",cls:"episode-detail-label"}),i.createSpan({text:this.formatDate(this.episode.publishDate)}),this.episode.episodeNumber){let s=r.createDiv({cls:"episode-detail-row"});s.createSpan({text:"Episode: ",cls:"episode-detail-label"}),s.createSpan({text:`#${this.episode.episodeNumber}`})}if(this.episode.seasonNumber){let s=r.createDiv({cls:"episode-detail-row"});s.createSpan({text:"Season: ",cls:"episode-detail-label"}),s.createSpan({text:`${this.episode.seasonNumber}`})}if(this.episode.description){r.createEl("h4",{text:"Description",cls:"episode-detail-subsection"});let s=r.createDiv({cls:"episode-detail-description"});this.renderDescription(s,this.episode.description)}}renderPodcastInfo(){if(!this.podcast)return;let{contentEl:e}=this,r=e.createDiv({cls:"episode-detail-section"});r.createEl("h3",{text:"Podcast"});let i=r.createDiv({cls:"episode-detail-row"});if(i.createSpan({text:"Show: ",cls:"episode-detail-label"}),i.createSpan({text:this.podcast.title}),this.podcast.author){let s=r.createDiv({cls:"episode-detail-row"});s.createSpan({text:"Author: ",cls:"episode-detail-label"}),s.createSpan({text:this.podcast.author})}}renderProgressInfo(){if(!this.progress)return;let{contentEl:e}=this,r=e.createDiv({cls:"episode-detail-section"});r.createEl("h3",{text:"Playback progress"});let i=r.createDiv({cls:"episode-detail-row"});i.createSpan({text:"Position: ",cls:"episode-detail-label"}),i.createSpan({text:`${this.formatDuration(this.progress.position)} / ${this.formatDuration(this.episode.duration)}`});let s=r.createDiv({cls:"episode-detail-progress-container"}),n=s.createDiv({cls:"episode-detail-progress-bar"}).createDiv({cls:"episode-detail-progress-fill"}),l=this.progress.position/this.episode.duration*100;n.setCssProps({width:`${l}%`}),s.createSpan({text:`${Math.round(l)}%`,cls:"episode-detail-progress-text"});let p=r.createDiv({cls:"episode-detail-row"}).createSpan({cls:"episode-detail-completed"});if((0,le.setIcon)(p,"check"),p.createSpan({text:" Completed"}),this.progress.lastPlayedAt){let h=r.createDiv({cls:"episode-detail-row"});h.createSpan({text:"Last played: ",cls:"episode-detail-label"}),h.createSpan({text:this.formatDate(this.progress.lastPlayedAt)})}}renderActions(){let{contentEl:e}=this,r=e.createDiv({cls:"episode-detail-actions"}),i=r.createEl("button",{cls:"mod-cta clickable-icon"});(0,le.setIcon)(i,"play"),i.createSpan({text:" Play"}),i.addEventListener("click",()=>void this.handlePlay());let s=r.createEl("button",{cls:"clickable-icon"});(0,le.setIcon)(s,"list-plus"),s.createSpan({text:" Add to queue"}),s.addEventListener("click",()=>this.handleAddToQueue());let o=r.createEl("button",{cls:"clickable-icon"});(0,le.setIcon)(o,"folder-plus"),o.createSpan({text:" Add to playlist"}),o.addEventListener("click",()=>this.handleAddToPlaylist()),r.createEl("button",{text:"Close"}).addEventListener("click",()=>this.close())}async handlePlay(){try{await this.plugin.playerController.loadEpisode(this.episode,!0,!0),new le.Notice(`Now playing: ${this.episode.title}`),this.close()}catch(e){a.error("Failed to play episode",e),new le.Notice("Failed to start playback")}}handleAddToQueue(){new Le(this.app,this.plugin,[this.episode],e=>{new le.Notice("Episode added to queue")}).open()}handleAddToPlaylist(){new Fe(this.app,this.plugin,[this.episode],e=>{new le.Notice("Episode added to playlist")}).open()}formatDuration(e){let r=Math.floor(e/3600),i=Math.floor(e%3600/60),s=Math.floor(e%60);return r>0?`${r}:${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${i}:${s.toString().padStart(2,"0")}`}formatDate(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}renderDescription(e,r){let s=r.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").trim().split(/\n\n+/);for(let o of s)o.trim()&&e.createEl("p",{text:o.trim()})}onClose(){let{contentEl:e}=this;e.empty()}};var ge=require("obsidian");var Nt=class extends ge.Modal{constructor(e,r,i,s,o,n){super(e);this.noteContent="";this.plugin=r,this.episode=i,this.podcast=s,this.currentPosition=o,this.onSubmit=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("add-note-modal"),e.createEl("h2",{text:"Add note"});let r=e.createDiv({cls:"add-note-context"});this.podcast&&r.createEl("p",{text:`\u{1F4FB} ${this.podcast.title}`,cls:"add-note-podcast"}),r.createEl("p",{text:`\u{1F399}\uFE0F ${this.episode.title}`,cls:"add-note-episode"}),r.createEl("p",{text:`\u23F1\uFE0F ${this.formatTime(this.currentPosition)}`,cls:"add-note-timestamp"});let i=e.createDiv({cls:"add-note-input-container"});i.createEl("label",{text:"Your note:",cls:"add-note-label"});let s=new ge.TextAreaComponent(i);s.setPlaceholder("Enter your note here...").setValue(this.noteContent).onChange(l=>{this.noteContent=l}),s.inputEl.addClass("add-note-textarea"),s.inputEl.rows=5,setTimeout(()=>s.inputEl.focus(),50);let o=e.createDiv({cls:"add-note-buttons"});o.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),o.createEl("button",{text:"Add note",cls:"mod-cta"}).addEventListener("click",()=>void this.handleSubmit()),s.inputEl.addEventListener("keydown",l=>{l.key==="Enter"&&(l.ctrlKey||l.metaKey)&&(l.preventDefault(),this.handleSubmit())})}async handleSubmit(){if(!this.noteContent.trim()){new ge.Notice("Please enter a note");return}try{await this.insertNoteIntoDailyNote(),this.onSubmit(this.noteContent),new ge.Notice("Note added to daily note"),this.close()}catch(e){a.error("Failed to add note",e),new ge.Notice("Failed to add note")}}async insertNoteIntoDailyNote(){var m,d;let e=this.plugin.settings,r=window.moment(),i=e.dailyNoteDateFormat||"YYYY-MM-DD",s=r.format(i)+".md",o=e.dailyNoteFolderPath||"",n=o?`${o}/${s}`:s,l=r.format("HH:mm:ss"),c=this.formatTime(this.currentPosition),p=this.formatNoteEntry(l,c),h=this.app.vault.getAbstractFileByPath(n);if(!h){if((d=(m=this.app.internalPlugins)==null?void 0:m.getPluginById("daily-notes"))!=null&&d.enabled)try{this.app.commands.executeCommandById("daily-notes:goto-today"),await new Promise(v=>setTimeout(v,500))}catch(v){a.error("Failed to invoke daily notes command",v)}if(h=this.app.vault.getAbstractFileByPath(n),!h){let v=o?this.app.vault.getAbstractFileByPath(o):!0;o&&!v&&await this.app.vault.createFolder(o),h=await this.app.vault.create(n,"")}}if(h&&h instanceof ge.TFile){let v=await this.app.vault.read(h),D,T=(e.dailyNoteHeader||"## \u{1F3A7} Listening Log").trim();if(v.includes(T)){let F=v.split(`
`),w=F.findIndex(y=>y.trim()===T);w!==-1?(F.splice(w+1,0,"",p),D=F.join(`
`)):D=v+`

`+T+`

`+p}else(e.dailyNoteInsertPosition||"bottom")==="top"?D=T+`

`+p+`

`+v:D=v+(v.endsWith(`
`)?"":`
`)+`
`+T+`

`+p;await this.app.vault.modify(h,D)}}formatNoteEntry(e,r){var o;let i=((o=this.podcast)==null?void 0:o.title)||"Unknown Podcast",s=this.episode.title;return`## \u{1F3A7} Podcast Note - ${e}

- **Podcast**: ${i}
- **Episode**: ${s}
- **Playback Position**: ${r}

${this.noteContent}

---`}formatTime(e){let r=Math.floor(e/3600),i=Math.floor(e%3600/60),s=Math.floor(e%60);return r>0?`${r}:${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${i}:${s.toString().padStart(2,"0")}`}onClose(){let{contentEl:e}=this;e.empty()}};var Ne="podcast-player-view",at=class extends H.ItemView{constructor(e,r){super(e);this.updateInterval=null;this.currentQueueId=null;this.isDraggingProgress=!1;this.lastPlaylistStateKey="queue";this.lastQueueEpisodeIds=[];this.lastQueueUpdatedAt=0;this.plugin=r}onload(){super.onload(),this.registerEvent(this.app.workspace.on("podcast:queue-updated",e=>{(async()=>{let r=await this.plugin.getQueueManager().getCurrentQueue();r&&r.id===e&&(JSON.stringify(r.episodeIds)!==JSON.stringify(this.lastQueueEpisodeIds)?(this.lastQueueEpisodeIds=[...r.episodeIds],await this.renderPlayer()):this.updatePlayState())})()})),this.registerEvent(this.app.workspace.on("podcast:player-state-updated",()=>this.updatePlayState())),this.registerEvent(this.app.workspace.on("podcast:episode-changed",()=>this.updatePlayState()))}getViewType(){return Ne}getDisplayText(){return"Podcasts"}getIcon(){return"podcast"}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.addClass("podcast-player-view"),this.playerContentEl=e.createDiv({cls:"podcast-player-content"}),await this.renderPlayer(),this.startUpdateInterval()}async onClose(){this.stopUpdateInterval()}async renderPlayer(){this.playerContentEl.empty();let e=this.playerContentEl.createDiv({cls:"player-container"});this.renderEpisodeInfo(e),this.renderPlaybackControls(e),this.renderProgressSection(e),this.renderAdvancedControls(e),await this.renderQueueSection(e)}renderEpisodeInfo(e){let r=e.createDiv({cls:"episode-info-section"});this.updatePlayerState();let i=r.createDiv({cls:"episode-title-container"});i.createEl("h3",{text:"No episode playing",cls:"episode-title"});let s=i.createEl("button",{cls:"player-info-button clickable-icon podcast-display-none",attr:{"aria-label":"View episode details"}});(0,H.setIcon)(s,"info"),s.addEventListener("click",()=>this.handleShowEpisodeDetails()),r.createEl("p",{text:"Select a podcast to start",cls:"podcast-name"}),r.createDiv({cls:"episode-metadata"}).createSpan({text:"--:--",cls:"episode-duration"})}handleShowEpisodeDetails(){let r=this.plugin.playerController.getCurrentEpisode();r&&new he(this.app,this.plugin,r).open()}renderPlaybackControls(e){let r=e.createDiv({cls:"playback-controls-section"}),i=r.createEl("button",{cls:"player-button player-button-prev clickable-icon",attr:{"aria-label":"Previous episode"}});(0,H.setIcon)(i,"skip-back"),i.addEventListener("click",()=>void this.handlePrevious());let s=r.createEl("button",{cls:"player-button player-button-skip-back clickable-icon",attr:{"aria-label":"Skip backward 15s"}});(0,H.setIcon)(s,"rewind"),s.addEventListener("click",()=>void this.handleSkipBackward());let o=r.createEl("button",{cls:"player-button player-button-play-pause clickable-icon",attr:{"aria-label":"Play/pause"}});(0,H.setIcon)(o,"play"),o.addEventListener("click",()=>void this.handlePlayPause());let n=r.createEl("button",{cls:"player-button player-button-skip-forward clickable-icon",attr:{"aria-label":"Skip forward 30s"}});(0,H.setIcon)(n,"fast-forward"),n.addEventListener("click",()=>void this.handleSkipForward());let l=r.createEl("button",{cls:"player-button player-button-next clickable-icon",attr:{"aria-label":"Next episode"}});(0,H.setIcon)(l,"skip-forward"),l.addEventListener("click",()=>void this.handleNext());let c=r.createEl("button",{cls:"player-button player-button-add-note clickable-icon",attr:{"aria-label":"Add note to daily note"}});(0,H.setIcon)(c,"file-plus"),c.addEventListener("click",()=>void this.handleAddNote())}renderProgressSection(e){let r=e.createDiv({cls:"progress-section"});r.createSpan({text:"0:00",cls:"current-time"});let i=r.createDiv({cls:"progress-bar-container"});i.setAttribute("tabindex","0"),i.setAttribute("aria-label","Seek slider"),i.setAttribute("role","slider");let s=i.createDiv({cls:"progress-bar"});s.createDiv({cls:"progress-fill podcast-progress-width-0"}),s.createDiv({cls:"progress-bar-thumb podcast-progress-left-0"});let o=i.createDiv({cls:"progress-tooltip"});o.textContent="0:00";let n=c=>{var p,h,m,d;return"touches"in c?(d=(m=(p=c.touches[0])==null?void 0:p.clientX)!=null?m:(h=c.changedTouches[0])==null?void 0:h.clientX)!=null?d:0:c.clientX},l=c=>{c.preventDefault(),i.focus();let p=this.plugin.playerController,h=p.getState();if(!h.currentEpisode)return;this.isDraggingProgress=!0;let m=h.currentEpisode.duration,d=T=>{let F=i.getBoundingClientRect(),w=T-F.left,y=Math.max(0,Math.min(1,w/F.width)),g=i.querySelector(".progress-fill"),E=i.querySelector(".progress-bar-thumb"),x=this.playerContentEl.querySelector(".current-time");return g&&g.setCssProps({width:`${y*100}%`}),E&&E.setCssProps({left:`${y*100}%`}),x&&(x.textContent=this.formatTime(m*y)),y},v=d(n(c)),D=T=>{this.isDraggingProgress&&(v=d(n(T)))},I=()=>{this.isDraggingProgress=!1,document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",I),document.removeEventListener("touchmove",D),document.removeEventListener("touchend",I),document.removeEventListener("touchcancel",I),p.seek(m*v)};"touches"in c?(document.addEventListener("touchmove",D,{passive:!1}),document.addEventListener("touchend",I),document.addEventListener("touchcancel",I)):(document.addEventListener("mousemove",D),document.addEventListener("mouseup",I))};i.addEventListener("mousedown",l),i.addEventListener("touchstart",l,{passive:!1}),i.addEventListener("keydown",c=>{let p=this.plugin.playerController,h=p.getState();if(!h.currentEpisode)return;let m=h.currentEpisode.duration,d=h.position,v=d;switch(c.key){case"ArrowLeft":c.preventDefault(),v=Math.max(0,d-5);break;case"ArrowRight":c.preventDefault(),v=Math.min(m,d+5);break;case"Home":c.preventDefault(),v=0;break;case"End":c.preventDefault(),v=m;break;default:return}p.seek(v)}),i.addEventListener("mousemove",c=>{let h=this.plugin.playerController.getState();if(!h.currentEpisode)return;let m=i.getBoundingClientRect(),d=c.clientX-m.left,v=Math.max(0,Math.min(1,d/m.width)),D=h.currentEpisode.duration;o.textContent=this.formatTime(D*v),o.setCssProps({left:`${v*100}%`})}),r.createSpan({text:"0:00",cls:"total-time"})}renderAdvancedControls(e){let r=e.createDiv({cls:"advanced-controls-section"}),i=r.createDiv({cls:"control-group volume-control"}),s=i.createSpan({cls:"control-icon volume-icon"});(0,H.setIcon)(s,"volume-2");let o=i.createEl("input",{type:"range",cls:"control-slider volume-slider",attr:{min:"0",max:"100",value:"100",title:"Volume"}}),n=i.createSpan({cls:"control-value-label volume-value",text:"100"});o.addEventListener("input",m=>{let d=m.target,v=parseInt(d.value);n.textContent=String(v),this.handleVolumeChange(v)});let l=r.createDiv({cls:"control-group speed-control"}),c=l.createSpan({cls:"control-icon speed-icon"});(0,H.setIcon)(c,"zap");let p=l.createEl("input",{type:"range",cls:"control-slider speed-slider",attr:{min:"0.5",max:"3.0",step:"0.1",value:"1.0",title:"Playback speed"}}),h=l.createSpan({cls:"control-value-label speed-value",text:"1.0x"});p.addEventListener("input",m=>{let d=m.target,v=parseFloat(d.value);h.textContent=`${v.toFixed(1)}x`,this.handleSpeedChange(v)})}async handlePlayPause(){try{if(!this.plugin){a.error("PlayerView: Plugin instance is missing");return}if(!this.plugin.playerController){a.error("PlayerView: PlayerController is missing");return}let e=this.plugin.playerController,r=e.getState();r.status==="playing"?e.pause():r.status==="paused"?e.play():r.status==="stopped"&&!r.currentEpisode?await this.playFromFirstQueue():r.status==="stopped"&&e.play()}catch(e){a.error("Failed to toggle playback",e)}}async playFromFirstQueue(){try{let e=this.plugin.getQueueManager(),r=await e.getAllQueues();if(r.length===0)return;for(let i of r)if(i.episodeIds.length>0){let s=i.episodeIds[0];e.setCurrentQueue(i.id),await e.jumpTo(i.id,0),this.currentQueueId=i.id,await this.loadEpisodeById(s);return}}catch(e){a.error("Failed to play from first queue",e)}}async handlePrevious(){try{let e=this.plugin.playerController;if(e.isPlayingFromPlaylist()){let s=e.getPreviousPlaylistEpisodeId();s&&await this.loadEpisodeById(s);return}if(!this.currentQueueId)return;let i=await this.plugin.getQueueManager().previous(this.currentQueueId);i&&await this.loadEpisodeById(i)}catch(e){a.error("Failed to go to previous episode",e)}}async handleNext(){try{let e=this.plugin.playerController;if(e.isPlayingFromPlaylist()){let s=e.getNextPlaylistEpisodeId();s&&await this.loadEpisodeById(s);return}if(!this.currentQueueId)return;let i=await this.plugin.getQueueManager().next(this.currentQueueId);i&&await this.loadEpisodeById(i)}catch(e){a.error("Failed to go to next episode",e)}}async handleAddNote(){let e=this.plugin.playerController,r=e.getCurrentEpisode();if(!r){new H.Notice("No episode is currently playing");return}let i=e.getCurrentPosition(),s=null;try{s=await this.plugin.getSubscriptionStore().getPodcast(r.podcastId)}catch(o){a.error("Failed to get podcast info",o)}new Nt(this.app,this.plugin,r,s,i,o=>{}).open()}async loadEpisodeById(e){try{let i=await this.plugin.getEpisodeManager().getEpisodeWithProgress(e);i&&await this.plugin.playerController.loadEpisode(i,!0,!0)}catch(r){a.error("Failed to load episode",r)}}handleSkipBackward(){try{this.plugin.playerController.skipBackward(15)}catch(e){a.error("Failed to skip backward",e)}}handleSkipForward(){try{this.plugin.playerController.skipForward(30)}catch(e){a.error("Failed to skip forward",e)}}handleSeek(e,r){try{let i=this.plugin.playerController,s=i.getState();if(!s.currentEpisode)return;let o=r.getBoundingClientRect(),n=e.clientX-o.left,l=Math.max(0,Math.min(1,n/o.width)),p=s.currentEpisode.duration*l;i.seek(p)}catch(i){a.error("Failed to seek",i)}}handleVolumeChange(e){try{this.plugin.playerController.setVolume(e/100)}catch(r){a.error("Failed to change volume",r)}}handleSpeedChange(e){try{this.plugin.playerController.setPlaybackSpeed(e)}catch(r){a.error("Failed to change playback speed",r)}}startUpdateInterval(){this.updateInterval=window.setInterval(()=>{this.updatePlayerState()},1e3)}stopUpdateInterval(){this.updateInterval!==null&&(window.clearInterval(this.updateInterval),this.updateInterval=null)}async updatePlayerState(){try{let e=this.plugin.playerController,r=e.getState(),i=this.playerContentEl.querySelector(".episode-title"),s=this.playerContentEl.querySelector(".podcast-name"),o=this.playerContentEl.querySelector(".episode-duration"),n=this.playerContentEl.querySelector(".player-podcast-thumbnail"),l=this.playerContentEl.querySelector(".player-info-button");if(r.currentEpisode){i&&(i.textContent=r.currentEpisode.title),o&&(o.textContent=this.formatTime(r.currentEpisode.duration)),l&&(l.removeClass("podcast-hidden"),l.addClass("podcast-flex-visible"));let g=r.currentEpisode.podcastId;g?this.plugin.getSubscriptionStore().getPodcast(g).then(E=>{E&&(s&&(s.textContent=E.title),n&&E.imageUrl?(n.src=E.imageUrl,n.removeClass("podcast-hidden"),n.addClass("podcast-visible")):n&&(n.removeClass("podcast-visible"),n.addClass("podcast-hidden")))}):(s&&(s.textContent="Unknown podcast"),n&&(n.removeClass("podcast-visible"),n.addClass("podcast-hidden")))}else i&&(i.textContent="No episode playing"),s&&(s.textContent="Select a podcast to start"),o&&(o.textContent="--:--"),n&&(n.removeClass("podcast-visible"),n.addClass("podcast-hidden")),l&&(l.removeClass("podcast-flex-visible"),l.addClass("podcast-hidden"));let c=this.playerContentEl.querySelector(".player-button-play-pause");c&&(r.status==="loading"?c.addClass("is-loading"):(c.removeClass("is-loading"),(0,H.setIcon)(c,r.status==="playing"?"pause":"play")));let p=this.playerContentEl.querySelector(".current-time"),h=this.playerContentEl.querySelector(".total-time");p&&(p.textContent=this.formatTime(r.position)),h&&r.currentEpisode&&(h.textContent=this.formatTime(r.currentEpisode.duration));let m=this.playerContentEl.querySelector(".progress-fill"),d=this.playerContentEl.querySelector(".progress-bar-thumb");if(m&&!this.isDraggingProgress)if(r.currentEpisode&&r.currentEpisode.duration>0){let g=Math.min(100,Math.max(0,r.position/r.currentEpisode.duration*100));m.setCssProps({width:`${g}%`}),d&&d.setCssProps({left:`${g}%`})}else m.setCssProps({width:"0%"}),d&&d.setCssProps({left:"0%"});let v=this.playerContentEl.querySelector(".volume-slider");v&&(v.value=String(r.volume*100));let D=this.playerContentEl.querySelector(".speed-slider"),I=this.playerContentEl.querySelector(".speed-value");D&&document.activeElement!==D&&(D.value=String(r.playbackSpeed)),I&&(I.textContent=`${r.playbackSpeed.toFixed(1)}x`);let T=e.isPlayingFromPlaylist(),F=e.getCurrentPlaylist(),w=e.getCurrentPlaylistIndex(),y=T?`playlist:${F==null?void 0:F.id}:${w}`:"queue";if(this.lastPlaylistStateKey!==y){this.lastPlaylistStateKey=y;let g=this.playerContentEl.querySelector(".player-container");if(g){let E=g.querySelector(".queue-section");E&&E.remove(),await this.renderQueueSection(g)}return}if(!T){let E=await this.plugin.getQueueManager().getCurrentQueue();if(E){let x=E.updatedAt instanceof Date?E.updatedAt.getTime():new Date(E.updatedAt).getTime();if(E.id!==this.currentQueueId||x>this.lastQueueUpdatedAt){this.currentQueueId=E.id,this.lastQueueUpdatedAt=x;let b=this.playerContentEl.querySelector(".player-container");if(b){let k=b.querySelector(".queue-section");k&&k.remove(),await this.renderQueueSection(b)}}}}}catch(e){a.error("Failed to update player state",e)}}updatePlayState(){var e;try{let i=this.plugin.playerController.getState(),s=(e=i.currentEpisode)==null?void 0:e.id,o=i.status==="playing";this.playerContentEl.querySelectorAll(".queue-episode-item").forEach(l=>{let c=l.getAttribute("data-episode-id"),p=l.querySelector(".queue-episode-action");if(p)if(c===s)if(l.addClass("current"),p.empty(),o){let h=p.createDiv({cls:"icon-current"});(0,H.setIcon)(h,"pause")}else{let h=p.createDiv({cls:"icon-current"});(0,H.setIcon)(h,"play")}else{l.removeClass("current"),p.empty();let h=p.createDiv({cls:"icon-drag"});(0,H.setIcon)(h,"grip-vertical");let m=p.createDiv({cls:"icon-play"});(0,H.setIcon)(m,"play")}})}catch(r){a.error("Failed to update play state",r)}}formatTime(e){let r=Math.floor(e/3600),i=Math.floor(e%3600/60),s=Math.floor(e%60);return r>0?`${r}:${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${i}:${s.toString().padStart(2,"0")}`}async renderQueueSection(e){let r=e.createDiv({cls:"queue-section"});try{let i=this.plugin.playerController;if(i.isPlayingFromPlaylist()){let l=i.getCurrentPlaylist();if(l){await this.renderPlaylistSection(r,l);return}}let s=await this.getCurrentQueue(),o=r.createDiv({cls:"queue-header"}),n="Current Queue";if(s&&(s.isPlaylist?n=`Current Playlist: ${s.name.startsWith("Playlist: ")?s.name.substring(10):s.name}`:n=`Current Queue: ${s.name}`),o.createEl("h3",{text:n,cls:"queue-title"}),!s||s.episodeIds.length===0){let l=r.createDiv({cls:"queue-empty-state"});l.createEl("p",{text:"No queue active"}),l.createEl("p",{text:"Add episodes to queue to see them here",cls:"queue-empty-hint"});return}await this.renderQueueEpisodeList(r,s)}catch(i){a.error("Failed to render queue section",i),r.createDiv({cls:"queue-error-state"}).createEl("p",{text:"Failed to load queue"})}}async renderPlaylistSection(e,r){if(e.createDiv({cls:"queue-header"}).createEl("h3",{text:`Current Playlist: ${r.name}`,cls:"queue-title"}),r.episodeIds.length===0){e.createDiv({cls:"queue-empty-state"}).createEl("p",{text:"Playlist is empty"});return}let s=e.createDiv({cls:"queue-episode-list"}),o=this.plugin.getEpisodeManager(),n=this.plugin.playerController,l=n.getCurrentPlaylistIndex(),p=n.getState().status==="playing",h=s.createDiv({cls:"queue-info"});h.createSpan({text:`${r.episodeIds.length} episodes`,cls:"queue-count"}),h.createSpan({text:` \u2022 Playing ${l+1} of ${r.episodeIds.length}`,cls:"queue-position"});let m=s.createDiv({cls:"queue-episodes"});for(let d=0;d<r.episodeIds.length;d++){let v=r.episodeIds[d],D=await o.getEpisodeWithProgress(v);if(D){let I=d===l;this.renderPlaylistEpisodeItem(m,D,d,I,p)}}}renderPlaylistEpisodeItem(e,r,i,s,o){let n=e.createDiv({cls:`queue-episode-item ${s?"current":""}`});n.setAttribute("data-episode-id",r.id),n.setAttribute("data-index",String(i));let l=n.createDiv({cls:"queue-episode-action"});if(s){let p=l.createDiv({cls:"icon-current"});(0,H.setIcon)(p,o?"pause":"play")}else{let p=l.createDiv({cls:"icon-play"});(0,H.setIcon)(p,"play")}let c=n.createDiv({cls:"queue-episode-info"});c.createEl("span",{text:r.title,cls:"queue-episode-title"}),r.duration&&c.createEl("span",{text:this.formatTime(r.duration),cls:"queue-episode-duration"}),n.addEventListener("click",()=>{(async()=>{let p=this.plugin.playerController,h=p.getCurrentPlaylist();h&&(p.setCurrentPlaylist(h,i),await p.loadEpisode(r,!0,!0))})()})}async getCurrentQueue(){try{let e=this.plugin.getQueueManager(),r=await e.getCurrentQueue();if(r)return this.currentQueueId=r.id,r;if(this.currentQueueId){let s=await e.getQueue(this.currentQueueId);if(s)return e.setCurrentQueue(s.id),s}let i=await e.getAllQueues();return i.length>0?(this.currentQueueId=i[0].id,e.setCurrentQueue(i[0].id),i[0]):null}catch(e){return a.error("Failed to get current queue",e),null}}async renderQueueEpisodeList(e,r){let i=e.createDiv({cls:"queue-episode-list"});if(r.episodeIds.length===0){i.createEl("p",{text:"Queue is empty",cls:"queue-empty-text"});return}let s=this.plugin.getEpisodeManager(),l=this.plugin.playerController.getState().status==="playing",c=i.createDiv({cls:"queue-info"});c.createSpan({text:`${r.episodeIds.length} episodes`,cls:"queue-count"}),c.createSpan({text:` \u2022 Current: ${r.currentIndex+1}`,cls:"queue-current"});let p=i.createDiv({cls:"queue-episodes"}),h=Math.min(r.episodeIds.length,10);for(let m=0;m<h;m++){let d=r.episodeIds[m];try{let v=await s.getEpisodeWithProgress(d);if(v){let D=r.currentIndex===m;this.renderQueueEpisodeItem(p,v,m,D,D&&l,h)}}catch(v){a.error(`Failed to load episode: ${d}`,v)}}r.episodeIds.length>10&&p.createDiv({cls:"queue-more"}).createEl("span",{text:`+ ${r.episodeIds.length-10} more episodes`,cls:"queue-more-text"})}renderQueueEpisodeItem(e,r,i,s,o=!1,n=0){let l=H.Platform.isMobile,c=e.createDiv({cls:s?"queue-episode-item current":"queue-episode-item",attr:{"data-episode-id":r.id}});l||(c.draggable=!0,c.addEventListener("dragstart",d=>{var v;(v=d.dataTransfer)==null||v.setData("text/plain",i.toString()),c.addClass("dragging"),d.dataTransfer&&(d.dataTransfer.effectAllowed="move")}),c.addEventListener("dragend",()=>{c.removeClass("dragging"),e.querySelectorAll(".queue-episode-item").forEach(d=>d.removeClass("drag-over"))}),c.addEventListener("dragover",d=>{d.preventDefault(),d.dataTransfer&&(d.dataTransfer.dropEffect="move"),c.addClass("drag-over")}),c.addEventListener("dragleave",()=>{c.removeClass("drag-over")}),c.addEventListener("drop",d=>{var I;d.preventDefault(),c.removeClass("drag-over");let v=parseInt(((I=d.dataTransfer)==null?void 0:I.getData("text/plain"))||"-1"),D=this.currentQueueId;v!==-1&&v!==i&&D&&(async()=>{try{await this.plugin.getQueueManager().moveEpisode(D,v,i),await this.renderPlayer()}catch(T){a.error("Failed to move episode",T)}})()}));let p=c.createDiv({cls:"queue-episode-action"});if(s&&o){let d=p.createDiv({cls:"icon-current"});(0,H.setIcon)(d,"pause")}else{if(!l){let v=p.createDiv({cls:"icon-drag"});(0,H.setIcon)(v,"grip-vertical")}let d=p.createDiv({cls:l?"icon-play-mobile":"icon-play"});(0,H.setIcon)(d,"play")}let h=c.createDiv({cls:"queue-episode-info"}),m=h.createEl("div",{text:r.title,cls:"queue-episode-title"});if(r.title.length>40&&(m.textContent=r.title.substring(0,40)+"...",m.setAttribute("title",r.title)),r.duration&&h.createEl("div",{text:this.formatDuration(r.duration),cls:"queue-episode-duration"}),l&&!s){let d=c.createDiv({cls:"queue-episode-reorder"});if(i>0){let v=d.createEl("button",{cls:"queue-reorder-btn clickable-icon",attr:{"aria-label":"Move up"}});(0,H.setIcon)(v,"chevron-up"),v.addEventListener("click",D=>{D.stopPropagation(),this.moveQueueEpisode(i,i-1)})}if(i<n-1){let v=d.createEl("button",{cls:"queue-reorder-btn clickable-icon",attr:{"aria-label":"Move down"}});(0,H.setIcon)(v,"chevron-down"),v.addEventListener("click",D=>{D.stopPropagation(),this.moveQueueEpisode(i,i+1)})}}c.addEventListener("click",()=>{(async()=>{try{let d=this.plugin.playerController,v=d.getState();if(s)v.status==="playing"?d.pause():await d.play();else{let D=this.plugin.getQueueManager();this.currentQueueId&&(await D.jumpTo(this.currentQueueId,i),await d.loadEpisode(r,!0,!0),await this.renderPlayer())}}catch(d){a.error("Failed to play/pause episode from queue",d)}})()})}async moveQueueEpisode(e,r){if(this.currentQueueId)try{await this.plugin.getQueueManager().moveEpisode(this.currentQueueId,e,r),await this.renderPlayer()}catch(i){a.error("Failed to move episode",i)}}formatRepeatMode(e){switch(e){case"none":return"Off";case"one":return"One";case"all":return"All"}}formatDuration(e){let r=Math.floor(e/3600),i=Math.floor(e%3600/60);return r>0?`${r}h ${i}m`:`${i}m`}};var N=require("obsidian");var Te=require("obsidian"),ot=class extends Te.Modal{constructor(t,e,r,i,s,o){super(t),this.title=e,this.name=r,this.placeholder=i,this.onSubmit=s,this.onDelete=o}onOpen(){var s;let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:this.title}),(s=new Te.Setting(t).addText(o=>o.setValue(this.name).setPlaceholder(this.placeholder).onChange(n=>{this.name=n})).controlEl.querySelector("input"))==null||s.focus();let r=t.createDiv({cls:"modal-button-container podcast-modal-button-container-spaced"});this.onDelete&&new Te.ButtonComponent(r).setButtonText("Delete").setWarning().onClick(()=>{this.onDelete&&(this.onDelete(),this.close())}).buttonEl.addClass("podcast-delete-button-auto-margin");let i=r.createDiv({cls:"podcast-modal-right-buttons"});new Te.ButtonComponent(i).setButtonText("Cancel").onClick(()=>this.close()),new Te.ButtonComponent(i).setButtonText("Save").setCta().onClick(()=>{this.onSubmit(this.name),this.close()}),t.addEventListener("keydown",o=>{o.key==="Enter"&&(o.preventDefault(),this.onSubmit(this.name),this.close())})}onClose(){let{contentEl:t}=this;t.empty()}};var X=require("obsidian");var qe=class extends X.Modal{constructor(e,r,i){super(e);this.searchResults=[];this.selectedFeeds=new Set;this.currentPage=0;this.resultsPerPage=5;this.searchResultsContainer=null;this.searchButtonContainer=null;this.feedUrl="";this.feedUrlInput=null;this.activeTab="search";this.contentContainer=null;this.opmlFeeds=[];this.selectedOpmlFeeds=new Set;this.plugin=r,this.onSubmit=i}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("subscribe-podcast-modal"),e.createEl("h2",{text:"Subscribe to podcast"}),this.renderTabs(e),this.contentContainer=e.createDiv({cls:"subscribe-modal-content"}),this.renderContent()}renderTabs(e){let r=e.createDiv({cls:"subscribe-modal-tabs"}),i=r.createEl("button",{text:"Search online",cls:"subscribe-modal-tab"});this.activeTab==="search"&&i.addClass("active"),i.onclick=()=>{this.activeTab!=="search"&&(this.activeTab="search",this.updateTabStyles(r),this.renderContent())};let s=r.createEl("button",{text:"Add by URL",cls:"subscribe-modal-tab"});this.activeTab==="url"&&s.addClass("active"),s.onclick=()=>{this.activeTab!=="url"&&(this.activeTab="url",this.updateTabStyles(r),this.renderContent())};let o=r.createEl("button",{text:"From file",cls:"subscribe-modal-tab"});this.activeTab==="file"&&o.addClass("active"),o.onclick=()=>{this.activeTab!=="file"&&(this.activeTab="file",this.updateTabStyles(r),this.renderContent())}}updateTabStyles(e){let r=e.querySelectorAll(".subscribe-modal-tab");r[0].className=`subscribe-modal-tab ${this.activeTab==="search"?"active":""}`,r[1].className=`subscribe-modal-tab ${this.activeTab==="url"?"active":""}`,r[2].className=`subscribe-modal-tab ${this.activeTab==="file"?"active":""}`}renderContent(){this.contentContainer&&(this.contentContainer.empty(),this.activeTab==="search"?(this.renderSearchSection(this.contentContainer),this.searchResults.length>0&&this.renderSearchResults()):this.activeTab==="url"?this.renderUrlSection(this.contentContainer):this.activeTab==="file"&&this.renderFileSection(this.contentContainer))}renderSearchSection(e){let r=e.createDiv({cls:"subscribe-search-section"}),i=r.createDiv({cls:"subscribe-search-container"}),s="",o=i.createEl("input",{type:"text",placeholder:"Search podcasts...",cls:"subscribe-search-input"});o.addEventListener("input",l=>{s=l.target.value}),o.addEventListener("keydown",l=>{l.key==="Enter"&&(l.preventDefault(),this.performSearch(s))});let n=i.createEl("button",{cls:"subscribe-search-button clickable-icon",attr:{"aria-label":"Search"}});(0,X.setIcon)(n,"search"),n.addEventListener("click",()=>{this.performSearch(s)}),this.searchResultsContainer=r.createDiv({cls:"subscribe-search-results"}),this.searchButtonContainer=r.createDiv({cls:"subscribe-search-buttons"}),this.renderSearchButtons()}renderSearchButtons(){if(!this.searchButtonContainer)return;this.searchButtonContainer.empty(),this.searchButtonContainer.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close());let r=this.searchButtonContainer.createEl("button",{text:`Subscribe${this.selectedFeeds.size>0?` (${this.selectedFeeds.size})`:""}`,cls:"mod-cta"});r.disabled=this.selectedFeeds.size===0,r.addEventListener("click",()=>{this.selectedFeeds.size>0&&this.handleSubscribeMultiple(Array.from(this.selectedFeeds))})}renderUrlSection(e){let r=e.createDiv({cls:"subscribe-url-section"});r.createEl("p",{text:"Enter the feed address of the podcast you want to subscribe to",cls:"subscribe-url-desc"}),new X.Setting(r).setName("Feed address").setDesc("Example: https://example.com/podcast/feed.xml").addText(o=>{o.setPlaceholder("Enter feed address").setValue(this.feedUrl).onChange(n=>{this.feedUrl=n}),this.feedUrlInput=o.inputEl});let i=r.createDiv({cls:"modal-button-container"});i.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),i.createEl("button",{text:"Subscribe",cls:"mod-cta"}).addEventListener("click",()=>{this.feedUrl.trim()?this.handleSubscribeByUrl(this.feedUrl.trim()):new X.Notice("Please enter a URL")})}renderFileSection(e){let r=e.createDiv({cls:"subscribe-file-section"});r.createEl("p",{text:"Import podcasts from a file exported from another podcast app",cls:"subscribe-file-desc"});let i=r.createDiv({cls:"subscribe-file-input-container"}),s=i.createEl("input",{type:"file",cls:"subscribe-file-input",attr:{accept:".opml,.xml"}}),o=i.createEl("button",{text:"Select file",cls:"subscribe-file-select-button clickable-icon"});(0,X.setIcon)(o,"file-up"),o.addEventListener("click",()=>{s.click()}),s.addEventListener("change",p=>{var d;let m=(d=p.target.files)==null?void 0:d[0];m&&this.handleOpmlFile(m,r)});let n=r.createDiv({cls:"subscribe-opml-results"});this.opmlFeeds.length>0&&this.renderOpmlResults(n);let l=r.createDiv({cls:"subscribe-file-buttons"});l.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close());let c=l.createEl("button",{text:`Subscribe${this.selectedOpmlFeeds.size>0?` (${this.selectedOpmlFeeds.size})`:""}`,cls:"mod-cta"});c.disabled=this.selectedOpmlFeeds.size===0,c.addEventListener("click",()=>{this.selectedOpmlFeeds.size>0&&this.handleSubscribeMultiple(Array.from(this.selectedOpmlFeeds))})}async handleOpmlFile(e,r){try{let i=await e.text(),o=new DOMParser().parseFromString(i,"text/xml");if(o.querySelector("parsererror")){new X.Notice("Invalid file: unable to parse content");return}let l=o.querySelectorAll("outline[xmlUrl]");if(this.opmlFeeds=[],this.selectedOpmlFeeds.clear(),l.forEach(c=>{let p=c.getAttribute("text")||"Unknown podcast",h=c.getAttribute("xmlUrl");h&&(this.opmlFeeds.push({text:p,xmlUrl:h}),this.selectedOpmlFeeds.add(h))}),this.opmlFeeds.length===0){new X.Notice("No podcast feeds found in file");return}new X.Notice(`Found ${this.opmlFeeds.length} podcasts in OPML file`),this.renderContent()}catch(i){a.error("Failed to parse OPML file",i),new X.Notice("Failed to read file")}}renderOpmlResults(e){e.empty();let r=e.createDiv({cls:"subscribe-opml-header"});r.createEl("span",{text:`${this.opmlFeeds.length} podcasts found`,cls:"subscribe-opml-count"});let i=r.createDiv({cls:"subscribe-opml-header-actions"});i.createEl("button",{text:"Select all",cls:"subscribe-opml-action-btn"}).addEventListener("click",()=>{this.opmlFeeds.forEach(l=>this.selectedOpmlFeeds.add(l.xmlUrl)),this.renderContent()}),i.createEl("button",{text:"Select none",cls:"subscribe-opml-action-btn"}).addEventListener("click",()=>{this.selectedOpmlFeeds.clear(),this.renderContent()});let n=e.createDiv({cls:"subscribe-opml-list"});for(let l of this.opmlFeeds){let c=n.createDiv({cls:"subscribe-opml-item"});this.selectedOpmlFeeds.has(l.xmlUrl)&&c.addClass("selected");let p=c.createEl("input",{type:"checkbox",cls:"subscribe-opml-checkbox"});p.checked=this.selectedOpmlFeeds.has(l.xmlUrl);let h=c.createDiv({cls:"subscribe-opml-info"});h.createEl("span",{text:l.text,cls:"subscribe-opml-title"}),h.createEl("span",{text:l.xmlUrl,cls:"subscribe-opml-url"});let m=()=>{this.selectedOpmlFeeds.has(l.xmlUrl)?(this.selectedOpmlFeeds.delete(l.xmlUrl),c.removeClass("selected"),p.checked=!1):(this.selectedOpmlFeeds.add(l.xmlUrl),c.addClass("selected"),p.checked=!0),this.renderContent()};p.addEventListener("click",d=>{d.stopPropagation(),m()}),c.addEventListener("click",()=>{m()})}}async performSearch(e){if(!e.trim()){new X.Notice("Please enter a search query");return}if(this.searchResultsContainer)try{this.searchResultsContainer.empty(),this.searchResultsContainer.createDiv({cls:"subscribe-loading",text:"Searching..."});let r=this.plugin.getPodcastService();if(this.isValidUrl(e)){let i=await r.getPodcastMetadata(e);i?this.searchResults=[i]:this.searchResults=[]}else this.searchResults=await r.searchOnline(e,{limit:50});this.currentPage=0,this.renderSearchResults()}catch(r){a.error("Search failed",r),this.searchResultsContainer.empty();let i=this.searchResultsContainer.createDiv({cls:"subscribe-error"});i.createEl("p",{text:"Search failed."}),i.createEl("p",{text:"Could not connect to the podcast search service. This might be due to",cls:"subscribe-error-detail"});let s=i.createEl("ul",{cls:"subscribe-error-reasons"});s.createEl("li",{text:"Network connection issues"}),s.createEl("li",{text:"Network request restrictions"}),s.createEl("li",{text:"Search service temporarily unavailable"}),i.createEl("p",{text:"Suggestion: try entering the feed address directly to subscribe.",cls:"subscribe-error-suggestion"})}}renderSearchResults(){if(!this.searchResultsContainer)return;if(this.searchResultsContainer.empty(),this.searchResults.length===0){this.searchResultsContainer.createDiv({cls:"subscribe-no-results",text:"No podcasts found"});return}let e=this.currentPage*this.resultsPerPage,r=Math.min(e+this.resultsPerPage,this.searchResults.length),i=this.searchResults.slice(e,r),s=this.searchResultsContainer.createDiv({cls:"subscribe-results-list"});for(let o of i)this.renderSearchResultItem(s,o);this.searchResults.length>this.resultsPerPage&&this.renderPagination()}renderSearchResultItem(e,r){let i=e.createDiv({cls:"subscribe-result-item"});if(this.selectedFeeds.has(r.feedUrl)&&i.addClass("selected"),r.artworkUrl)i.createEl("img",{cls:"subscribe-result-artwork",attr:{src:r.artworkUrl,alt:r.title}});else{let c=i.createDiv({cls:"subscribe-result-artwork-placeholder"});(0,X.setIcon)(c,"mic")}let s=i.createDiv({cls:"subscribe-result-info"});if(s.createEl("h4",{text:r.title,cls:"subscribe-result-title"}),r.author&&s.createEl("p",{text:r.author,cls:"subscribe-result-author"}),r.description){let c=s.createEl("p",{text:r.description,cls:"subscribe-result-description"});r.description.length>100&&c.setText(r.description.substring(0,100)+"...")}let n=i.createDiv({cls:"subscribe-result-checkbox-container"}).createEl("input",{type:"checkbox",cls:"subscribe-result-checkbox"});n.checked=this.selectedFeeds.has(r.feedUrl);let l=()=>{this.selectedFeeds.has(r.feedUrl)?(this.selectedFeeds.delete(r.feedUrl),i.removeClass("selected"),n.checked=!1):(this.selectedFeeds.add(r.feedUrl),i.addClass("selected"),n.checked=!0),this.renderSearchButtons()};n.addEventListener("click",c=>{c.stopPropagation(),l()}),i.addEventListener("click",()=>{l()})}renderPagination(){if(!this.searchResultsContainer)return;let e=Math.ceil(this.searchResults.length/this.resultsPerPage),r=this.searchResultsContainer.createDiv({cls:"subscribe-pagination"}),i=r.createEl("button",{cls:"subscribe-pagination-button clickable-icon",attr:{"aria-label":"Previous page"}});(0,X.setIcon)(i,"chevron-left"),i.disabled=this.currentPage===0,i.addEventListener("click",()=>{this.currentPage>0&&(this.currentPage--,this.renderSearchResults())}),r.createSpan({text:`Page ${this.currentPage+1} of ${e}`,cls:"subscribe-pagination-info"});let s=r.createEl("button",{cls:"subscribe-pagination-button clickable-icon",attr:{"aria-label":"Next page"}});(0,X.setIcon)(s,"chevron-right"),s.disabled=this.currentPage>=e-1,s.addEventListener("click",()=>{this.currentPage<e-1&&(this.currentPage++,this.renderSearchResults())})}async handleSubscribeMultiple(e){if(e.length!==0)try{let r=new X.Notice(`Subscribing to ${e.length} podcasts...`,0),i=this.plugin.getPodcastService(),s=0,o=0;for(let n of e){let l=await i.subscribe(n);l.success?s++:(o++,a.error(`Failed to subscribe to ${n}`,l.error))}r.hide(),s>0&&(new X.Notice(`Successfully subscribed to ${s} podcasts`),this.close(),this.onSubmit("")),o>0&&new X.Notice(`Failed to subscribe to ${o} podcasts`)}catch(r){a.error("Batch subscription failed",r),new X.Notice("Failed to subscribe to podcasts")}}async handleSubscribeByUrl(e){if(!e){new X.Notice("Please enter a feed URL");return}if(!this.isValidUrl(e)){new X.Notice("Please enter a valid URL");return}try{let r=new X.Notice("Subscribing to podcast...",0),s=await this.plugin.getPodcastService().subscribe(e);if(r.hide(),s.success&&s.podcast)new X.Notice(`Successfully subscribed to: ${s.podcast.title}`),this.close(),this.onSubmit(s.podcast.id);else{let o=s.error||"Failed to subscribe to podcast";new X.Notice(o)}}catch(r){a.error("Failed to subscribe to podcast",r);let i="Failed to subscribe to podcast";r instanceof Error&&(r.message.includes("already subscribed")?i="You are already subscribed to this podcast":r.message.includes("Invalid feed")?i="Invalid RSS/Atom feed URL":r.message.includes("Network")?i="Network error. Please check your connection.":r.message.includes("timeout")&&(i="Request timed out. Please try again.")),new X.Notice(i)}}isValidUrl(e){try{let r=new URL(e);return r.protocol==="http:"||r.protocol==="https:"}catch(r){return!1}}onClose(){let{contentEl:e}=this;e.empty(),this.searchResults=[],this.currentPage=0,this.searchResultsContainer=null,this.searchButtonContainer=null,this.feedUrl="",this.feedUrlInput=null,this.selectedFeeds.clear(),this.opmlFeeds=[],this.selectedOpmlFeeds.clear()}};var J=require("obsidian");var nt=class u extends J.Modal{constructor(t,e,r,i){super(t),this.plugin=e,this.podcast=r,this.onSubmit=i;let s=r.settings||e.settings.defaultPlaybackSettings;this.volume=s.volume,this.playbackSpeed=s.playbackSpeed,this.skipIntroSeconds=s.skipIntroSeconds,this.skipOutroSeconds=s.skipOutroSeconds||0;let o=r.autoAddRule;this.autoAddEnabled=(o==null?void 0:o.enabled)||!1,this.autoAddTargetType=(o==null?void 0:o.targetType)||"queue",this.autoAddTargetId=(o==null?void 0:o.targetId)||"",this.autoAddPosition=(o==null?void 0:o.position)||"bottom"}onOpen(){this.renderContent()}async renderContent(){let{contentEl:t}=this;if(t.empty(),t.createEl("h2",{text:`Settings for ${this.podcast.title}`}),t.createEl("p",{text:"These settings override the global defaults for this podcast only.",cls:"setting-item-description"}),new J.Setting(t).setName("Volume").setDesc("Playback volume for this podcast (0% - 100%)").addSlider(r=>r.setLimits(0,100,5).setValue(this.volume*100).setDynamicTooltip().onChange(i=>{this.volume=i/100})),new J.Setting(t).setName("Playback speed").setDesc("Playback speed for this podcast (0.5x - 3.0x)").addSlider(r=>r.setLimits(50,300,25).setValue(this.playbackSpeed*100).setDynamicTooltip().onChange(i=>{this.playbackSpeed=i/100})),new J.Setting(t).setName("Skip intro").setDesc("Number of seconds to skip at the beginning of each episode").addText(r=>r.setPlaceholder("0").setValue(String(this.skipIntroSeconds)).onChange(i=>{let s=parseInt(i);!isNaN(s)&&s>=0&&(this.skipIntroSeconds=s)})),new J.Setting(t).setName("Skip outro").setDesc("Number of seconds to skip at the end of each episode").addText(r=>r.setPlaceholder("0").setValue(String(this.skipOutroSeconds)).onChange(i=>{let s=parseInt(i);!isNaN(s)&&s>=0&&(this.skipOutroSeconds=s)})),t.createEl("h3",{text:"Auto-add new episodes"}),new J.Setting(t).setName("Enable auto-add").setDesc("Automatically add new episodes to a playlist or queue").addToggle(r=>r.setValue(this.autoAddEnabled).onChange(i=>{this.autoAddEnabled=i,this.renderContent()})),this.autoAddEnabled){let r=this.plugin.getPlaylistManager(),i=this.plugin.getQueueManager(),s=await r.getAllPlaylists(),o=await i.getAllQueues();new J.Setting(t).setName("Target").setDesc("Select where to add new episodes").addDropdown(l=>{if(l.addOption("","Select a target..."),o.length>0)for(let c of o)l.addOption(`queue:${c.id}`,`queue: ${c.name}`);if(s.length>0)for(let c of s)l.addOption(`playlist:${c.id}`,`playlist: ${c.name}`);this.autoAddTargetId&&l.setValue(`${this.autoAddTargetType}:${this.autoAddTargetId}`),l.onChange(c=>{if(c){let[p,h]=c.split(":");this.autoAddTargetType=p,this.autoAddTargetId=h}else this.autoAddTargetId=""})}),new J.Setting(t).setName("Position").setDesc("Where to add the episode in the list").addDropdown(l=>l.addOption("top","Top (beginning)").addOption("bottom","Bottom (end)").setValue(this.autoAddPosition).onChange(c=>{this.autoAddPosition=c}))}let e=t.createDiv({cls:"modal-button-container"});e.createEl("button",{text:"Reset to global defaults"}).addEventListener("click",()=>{this.resetToDefaults()}),e.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),e.createEl("button",{text:"Save",cls:"mod-cta"}).addEventListener("click",()=>{this.handleSave()})}resetToDefaults(){let t=this.plugin.settings.defaultPlaybackSettings;this.volume=t.volume,this.playbackSpeed=t.playbackSpeed,this.skipIntroSeconds=t.skipIntroSeconds,this.skipOutroSeconds=t.skipOutroSeconds||0,this.close(),new u(this.app,this.plugin,this.podcast,this.onSubmit).open()}handleSave(){try{if(this.volume<0||this.volume>1){new J.Notice("Volume must be between 0 and 1");return}if(this.playbackSpeed<.5||this.playbackSpeed>3){new J.Notice("Playback speed must be between 0.5x and 3.0x");return}if(this.skipIntroSeconds<0){new J.Notice("Skip intro seconds must be positive");return}if(this.skipOutroSeconds<0){new J.Notice("Skip outro seconds must be positive");return}let t={volume:this.volume,playbackSpeed:this.playbackSpeed,skipIntroSeconds:this.skipIntroSeconds,skipOutroSeconds:this.skipOutroSeconds},e;if(this.autoAddEnabled){if(!this.autoAddTargetId){new J.Notice("Please select a target for auto-add");return}e={enabled:!0,targetType:this.autoAddTargetType,targetId:this.autoAddTargetId,position:this.autoAddPosition}}else this.podcast.autoAddRule&&(e={...this.podcast.autoAddRule,enabled:!1});this.onSubmit(t,e),this.close(),new J.Notice("Podcast settings saved")}catch(t){a.error("Failed to save podcast settings",t),new J.Notice("Failed to save settings")}}onClose(){let{contentEl:t}=this;t.empty()}};var qt=require("obsidian"),lt=class extends qt.Modal{constructor(e,r,i,s,o){super(e);this.result=null;this.title=r,this.message=i,this.defaultValue=s,this.onSubmit=o}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:this.title});let r=this.defaultValue;new qt.Setting(e).setName(this.message).addText(s=>s.setValue(this.defaultValue).onChange(o=>{r=o}).inputEl.addEventListener("keydown",o=>{o.key==="Enter"&&(o.preventDefault(),this.result=r,this.close())}));let i=e.createDiv({cls:"modal-button-container"});i.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.result=null,this.close()}),i.createEl("button",{text:"OK",cls:"mod-cta"}).addEventListener("click",()=>{this.result=r,this.close()})}onClose(){let{contentEl:e}=this;e.empty(),this.onSubmit(this.result)}};var Oe="podcast-sidebar-view",ct=class extends N.ItemView{constructor(e,r){super(e);this.viewMode="podcasts";this.selectedPodcast=null;this.selectedPlaylist=null;this.selectedQueue=null;this.searchQuery="";this.podcastSortBy="title";this.episodeSortBy="date";this.playlistSortBy="date";this.podcastSortDirection="asc";this.episodeSortDirection="desc";this.playlistSortDirection="asc";this.podcastStats=new Map;this.feedsViewMode="feeds";this.dragStartIndex=-1;this.dragType=null;this.dragTargetId=null;this.renderAbortController=null;this.plugin=r}onload(){super.onload(),this.registerEvent(this.app.workspace.on("podcast:queue-updated",e=>{(async()=>this.selectedQueue&&this.selectedQueue.id===e&&(this.selectedQueue=await this.plugin.getQueueManager().getQueue(e),await this.render()))()})),this.registerEvent(this.app.workspace.on("podcast:player-state-updated",()=>{this.updateListIcons()})),this.registerEvent(this.app.workspace.on("podcast:episode-changed",()=>{this.updateListIcons()})),this.registerEvent(this.app.workspace.on("podcast:playlist-updated",e=>{(async()=>this.selectedPlaylist&&this.selectedPlaylist.id===e&&(this.selectedPlaylist=await this.plugin.getPlaylistManager().getPlaylist(e),await this.render()))()}))}getViewType(){return Oe}getDisplayText(){return"Podcasts"}getIcon(){return"podcast"}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.addClass("podcast-sidebar-view"),this.sidebarContentEl=e.createDiv({cls:"podcast-sidebar-content"}),await this.render()}async onClose(){}renderLoading(e){e.createDiv({cls:"podcast-spinner-container"}).createDiv({cls:"podcast-spinner"})}async render(){this.renderAbortController&&this.renderAbortController.abort(),this.renderAbortController=new AbortController;let e=this.renderAbortController.signal;this.sidebarContentEl.empty(),this.renderHeader(),this.renderSearchBox();try{this.selectedPodcast?await this.renderEpisodeList(e):this.selectedPlaylist?await this.renderPlaylistDetails(e):this.selectedQueue?await this.renderQueueDetails(e):this.viewMode==="podcasts"?this.feedsViewMode==="episodes"?await this.renderAllEpisodes(e):await this.renderPodcastList(e):await this.renderPlaylistList(e)}catch(r){if(e.aborted)return;a.error("Render failed",r)}}renderSearchBox(){let e=this.sidebarContentEl.createDiv({cls:"sidebar-search-container"}),r=this.selectedPodcast?"Search episodes...":this.selectedPlaylist?"Search playlist episodes...":this.viewMode==="podcasts"?"Search podcasts...":"Search playlists...",i=e.createEl("input",{type:"text",placeholder:r,cls:"sidebar-search-input",value:this.searchQuery}),s=e.createEl("button",{cls:"sidebar-search-button clickable-icon",attr:{"aria-label":"Search"}});(0,N.setIcon)(s,"search");let o=()=>{this.searchQuery=i.value,this.render()};if(s.addEventListener("click",p=>{o()}),i.addEventListener("keydown",p=>{p.key==="Enter"&&(p.preventDefault(),o())}),this.searchQuery){let p=e.createEl("button",{cls:"sidebar-search-clear clickable-icon",attr:{"aria-label":"Clear search"}});(0,N.setIcon)(p,"x"),p.addEventListener("click",()=>{this.searchQuery="",this.render()})}let n="asc",l="";this.selectedPodcast||this.selectedPlaylist?(n=this.episodeSortDirection,l=this.episodeSortBy):this.viewMode==="playlists"?(n=this.playlistSortDirection,l=this.playlistSortBy):(n=this.podcastSortDirection,l=this.podcastSortBy);let c=e.createEl("button",{cls:"sort-direction-button clickable-icon",attr:{"aria-label":"Sort options"}});(0,N.setIcon)(c,n==="asc"?"arrow-up":"arrow-down"),c.addEventListener("click",p=>{let h=new N.Menu;h.addItem(m=>m.setIsLabel(!0).setTitle("Sort by")),this.selectedPodcast||this.selectedPlaylist?(h.addItem(m=>m.setTitle("Title").setChecked(l==="title").onClick(()=>{this.episodeSortBy="title",this.render()})),h.addItem(m=>m.setTitle("Date").setChecked(l==="date").onClick(()=>{this.episodeSortBy="date",this.render()})),h.addItem(m=>m.setTitle("Duration").setChecked(l==="duration").onClick(()=>{this.episodeSortBy="duration",this.render()}))):this.viewMode==="playlists"?(h.addItem(m=>m.setTitle("Name").setChecked(l==="name").onClick(()=>{this.playlistSortBy="name",this.render()})),h.addItem(m=>m.setTitle("Date").setChecked(l==="date").onClick(()=>{this.playlistSortBy="date",this.render()})),h.addItem(m=>m.setTitle("Episode count").setChecked(l==="count").onClick(()=>{this.playlistSortBy="count",this.render()}))):(h.addItem(m=>m.setTitle("Title").setChecked(l==="title").onClick(()=>{this.podcastSortBy="title",this.render()})),h.addItem(m=>m.setTitle("Author").setChecked(l==="author").onClick(()=>{this.podcastSortBy="author",this.render()})),h.addItem(m=>m.setTitle("Subscribed date").setChecked(l==="date").onClick(()=>{this.podcastSortBy="date",this.render()})),h.addItem(m=>m.setTitle("Latest episode").setChecked(l==="latest").onClick(()=>{this.podcastSortBy="latest",this.render()})),h.addItem(m=>m.setTitle("Total episodes").setChecked(l==="count").onClick(()=>{this.podcastSortBy="count",this.render()})),h.addItem(m=>m.setTitle("Unplayed count").setChecked(l==="unplayed").onClick(()=>{this.podcastSortBy="unplayed",this.render()}))),h.addSeparator(),h.addItem(m=>m.setIsLabel(!0).setTitle("Order")),h.addItem(m=>m.setTitle("Ascending").setChecked(n==="asc").onClick(()=>this.setSortDirection("asc"))),h.addItem(m=>m.setTitle("Descending").setChecked(n==="desc").onClick(()=>this.setSortDirection("desc"))),h.showAtMouseEvent(p)})}setSortDirection(e){this.selectedPodcast||this.selectedPlaylist?this.episodeSortDirection=e:this.viewMode==="playlists"?this.playlistSortDirection=e:this.podcastSortDirection=e,this.render()}renderHeader(){let e=this.sidebarContentEl.createDiv({cls:"sidebar-header"});if(this.selectedPodcast||this.selectedPlaylist||this.selectedQueue){let l=e.createEl("button",{cls:"sidebar-back-button clickable-icon",attr:{"aria-label":"Back to list"}});(0,N.setIcon)(l,"arrow-left"),l.createSpan({text:" Back"}),l.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),this.selectedPodcast=null,this.selectedPlaylist=null,this.selectedQueue=null,this.render()})}let r="";this.selectedPodcast?r=this.selectedPodcast.title:this.selectedPlaylist?r=this.selectedPlaylist.name:this.selectedQueue?r=this.selectedQueue.name:this.viewMode==="podcasts"?r=this.feedsViewMode==="feeds"?"My feeds":"All episodes":r="My lists",e.createEl("h2",{text:r,cls:"sidebar-title"});let i=e.createDiv({cls:"sidebar-actions"});if(!this.selectedPodcast&&!this.selectedPlaylist&&!this.selectedQueue)if(this.viewMode==="podcasts"){let l=i.createEl("button",{cls:"sidebar-action-button clickable-icon",attr:{"aria-label":this.feedsViewMode==="feeds"?"Show all episodes":"Show feeds"}});(0,N.setIcon)(l,this.feedsViewMode==="feeds"?"list":"rss"),l.addEventListener("click",()=>{this.feedsViewMode=this.feedsViewMode==="feeds"?"episodes":"feeds",this.render()});let c=i.createEl("button",{cls:"sidebar-action-button clickable-icon",attr:{"aria-label":"Subscribe to podcast"}});(0,N.setIcon)(c,"plus"),c.addEventListener("click",()=>this.handleAddPodcast());let p=i.createEl("button",{cls:"sidebar-action-button clickable-icon",attr:{"aria-label":"Refresh feeds"}});(0,N.setIcon)(p,"refresh-cw"),p.addEventListener("click",()=>void this.handleRefreshFeeds())}else{let l=i.createEl("button",{cls:"sidebar-action-button clickable-icon",attr:{"aria-label":"Create new"}});(0,N.setIcon)(l,"plus"),l.addEventListener("click",c=>{let p=new N.Menu;p.addItem(h=>h.setTitle("New queue").setIcon("list-ordered").onClick(()=>void this.handleCreateQueue())),p.addItem(h=>h.setTitle("New playlist").setIcon("folder-plus").onClick(()=>void this.handleCreatePlaylist())),p.showAtMouseEvent(c)})}else if(this.selectedPodcast){let l=i.createEl("button",{cls:"sidebar-action-button clickable-icon",attr:{"aria-label":"Podcast settings"}});(0,N.setIcon)(l,"settings"),l.addEventListener("click",()=>this.handlePodcastSettings())}else if(this.selectedPlaylist){let l=i.createEl("button",{cls:"sidebar-action-button clickable-icon",attr:{"aria-label":"Rename playlist"}});(0,N.setIcon)(l,"pencil"),l.addEventListener("click",()=>this.handleRenamePlaylist())}else if(this.selectedQueue){let l=i.createEl("button",{cls:"sidebar-action-button clickable-icon",attr:{"aria-label":"Rename queue"}});(0,N.setIcon)(l,"pencil"),l.addEventListener("click",()=>this.handleRenameQueue())}let s=this.sidebarContentEl.createDiv({cls:"sidebar-mode-toggle"});s.createEl("button",{text:"Feeds",cls:this.viewMode==="podcasts"&&!this.selectedPlaylist&&!this.selectedQueue?"mode-active":"mode-inactive"}).addEventListener("click",()=>{this.selectedPodcast=null,this.selectedPlaylist=null,this.selectedQueue=null,this.viewMode="podcasts",this.render()}),s.createEl("button",{text:"Lists",cls:this.viewMode==="playlists"||this.selectedPlaylist||this.selectedQueue?"mode-active":"mode-inactive"}).addEventListener("click",()=>{this.selectedPodcast=null,this.selectedPlaylist=null,this.selectedQueue=null,this.viewMode="playlists",this.render()})}async renderPodcastList(e){let r=this.sidebarContentEl.createDiv({cls:"podcast-list-container"});this.renderLoading(r);let i=await this.loadPodcasts();if(await this.loadPodcastStats(i),this.searchQuery&&(i=this.filterPodcasts(i,this.searchQuery)),i=this.sortPodcasts(i,this.podcastSortBy,this.podcastSortDirection),i.length===0){let s=r.createDiv({cls:"empty-state"});this.searchQuery?(s.createEl("p",{text:"No podcasts found"}),s.createEl("p",{text:`No podcasts match "${this.searchQuery}"`,cls:"empty-state-hint"})):(s.createEl("p",{text:"No podcasts yet"}),s.createEl("p",{text:"Click the + button to subscribe to a podcast",cls:"empty-state-hint"}));return}r.empty();for(let s of i){if(e!=null&&e.aborted)return;this.renderPodcastItem(r,s)}}async renderAllEpisodes(e){let r=this.sidebarContentEl.createDiv({cls:"episode-list-container"});this.renderLoading(r);let s=await this.plugin.getSubscriptionStore().getAllPodcasts(),o=[],n=new Map;for(let l of s)n.set(l.id,l),l.episodes&&(o=o.concat(l.episodes));if(this.searchQuery&&(o=this.filterEpisodes(o,this.searchQuery)),o=this.sortEpisodes(o,this.episodeSortBy,this.episodeSortDirection),o.length===0){let l=r.createDiv({cls:"empty-state"});this.searchQuery?(l.createEl("p",{text:"No episodes found"}),l.createEl("p",{text:`No episodes match "${this.searchQuery}"`,cls:"empty-state-hint"})):(l.createEl("p",{text:"No episodes yet"}),l.createEl("p",{text:"Subscribe to podcasts to see episodes here",cls:"empty-state-hint"}));return}r.empty();for(let l of o){if(e!=null&&e.aborted)return;let c=n.get(l.podcastId);this.renderAllEpisodesItem(r,l,c)}}renderAllEpisodesItem(e,r,i){let s=e.createDiv({cls:"episode-item all-episodes-item"}),o=s.createDiv({cls:"episode-info"});o.createEl("div",{text:r.title,cls:"episode-title"});let n=o.createDiv({cls:"episode-meta"});i&&(n.createSpan({text:i.title,cls:"episode-podcast-name"}),n.createSpan({text:" \u2022 ",cls:"episode-meta-separator"})),n.createSpan({text:this.formatDate(new Date(r.publishDate)),cls:"episode-date"}),r.duration&&(n.createSpan({text:" \u2022 ",cls:"episode-meta-separator"}),n.createSpan({text:this.formatDuration(r.duration),cls:"episode-duration"}));let l=s.createDiv({cls:"episode-actions"}),c=l.createEl("button",{cls:"episode-action-button clickable-icon",attr:{"aria-label":"Play episode"}});(0,N.setIcon)(c,"play"),c.addEventListener("click",h=>{h.stopPropagation(),this.handlePlayEpisode(r)});let p=l.createEl("button",{cls:"episode-action-button clickable-icon",attr:{"aria-label":"Add to queue or playlist"}});(0,N.setIcon)(p,"plus"),p.addEventListener("click",h=>{h.stopPropagation(),this.showAddToPlaylistMenu(r,h)}),s.addEventListener("click",()=>this.handleEpisodeClick(r)),s.addEventListener("contextmenu",h=>{h.preventDefault(),this.showEpisodeContextMenu(r,h)})}renderPodcastItem(e,r){var n;let i=e.createDiv({cls:"podcast-item"});if(r.imageUrl)i.createEl("img",{cls:"podcast-image",attr:{src:r.imageUrl,alt:r.title}});else{let l=i.createDiv({cls:"podcast-image-placeholder"});(0,N.setIcon)(l,"mic")}let s=i.createDiv({cls:"podcast-info"});s.createEl("h3",{text:r.title,cls:"podcast-title"}),s.createEl("p",{text:r.author,cls:"podcast-author"});let o=this.podcastStats.get(r.id);if(o){let l=[];l.push(`${o.totalEpisodes} eps`),o.unplayedEpisodes>0&&l.push(`${o.unplayedEpisodes} new`),s.createDiv({text:l.join(" \u2022 "),cls:"podcast-episode-count"})}else{let l=((n=r.episodes)==null?void 0:n.length)||0;s.createDiv({text:`${l} episodes`,cls:"podcast-episode-count"})}i.addEventListener("click",()=>{this.selectedPodcast=r,this.episodeSortBy="date",this.episodeSortDirection="desc",this.render()}),i.addEventListener("contextmenu",l=>{l.preventDefault(),this.showPodcastContextMenu(r,l)})}async renderEpisodeList(e){if(!this.selectedPodcast)return;let r=this.sidebarContentEl.createDiv({cls:"episode-list-container"});this.renderLoading(r);let s=await this.plugin.getSubscriptionStore().getPodcast(this.selectedPodcast.id),o=(s==null?void 0:s.episodes)||[];if(this.searchQuery&&(o=this.filterEpisodes(o,this.searchQuery)),o=this.sortEpisodes(o,this.episodeSortBy,this.episodeSortDirection),o.length===0){let n=r.createDiv({cls:"empty-state"});this.searchQuery?(n.createEl("p",{text:"No episodes found"}),n.createEl("p",{text:`No episodes match "${this.searchQuery}"`,cls:"empty-state-hint"})):(n.createEl("p",{text:"No episodes available"}),n.createEl("p",{text:"Try refreshing the feed",cls:"empty-state-hint"}));return}r.empty();for(let n of o){if(e!=null&&e.aborted)return;this.renderEpisodeItem(r,n)}}renderEpisodeItem(e,r){let i=e.createDiv({cls:"episode-item"}),s=i.createDiv({cls:"episode-info"});s.createEl("h4",{text:r.title,cls:"episode-title"});let o=s.createDiv({cls:"episode-metadata"}),n=new Date(r.publishDate);o.createSpan({text:n.toLocaleDateString(),cls:"episode-date"}),r.duration&&o.createSpan({text:` \u2022 ${this.formatDuration(r.duration)}`,cls:"episode-duration"});let l=i.createDiv({cls:"episode-item-actions"}),c=l.createEl("button",{cls:"episode-action-button clickable-icon",attr:{"aria-label":"Play"}});(0,N.setIcon)(c,"play"),c.addEventListener("click",h=>{h.stopPropagation(),this.handlePlayEpisode(r,!0)});let p=l.createEl("button",{cls:"episode-action-button clickable-icon",attr:{"aria-label":"Add to playlist"}});(0,N.setIcon)(p,"plus"),p.addEventListener("click",h=>{h.stopPropagation(),this.showAddToPlaylistMenu(r,h)}),i.addEventListener("click",()=>{this.handleEpisodeClick(r)}),i.addEventListener("contextmenu",h=>{h.preventDefault(),this.showEpisodeContextMenu(r,h)})}handleAddPodcast(){new qe(this.app,this.plugin,async e=>{await this.render()}).open()}async handleRefreshFeeds(){try{let e=this.plugin.getFeedSyncManager(),r=new N.Notice("Refreshing feeds...",0),i=await e.syncAll();r.hide(),new N.Notice(`Refreshed ${i.successCount} feeds. ${i.failureCount} failed.`),await this.render()}catch(e){a.error("Failed to refresh feeds",e),new N.Notice("Failed to refresh feeds")}}handlePodcastSettings(){this.selectedPodcast&&new nt(this.app,this.plugin,this.selectedPodcast,(e,r)=>{(async()=>{try{let i=this.plugin.getSubscriptionStore();this.selectedPodcast.settings=e,this.selectedPodcast.autoAddRule=r,await i.updatePodcast(this.selectedPodcast),new N.Notice("Podcast settings updated"),await this.render()}catch(i){a.error("Failed to save podcast settings",i),new N.Notice("Failed to save settings")}})()}).open()}async showAddToPlaylistMenu(e,r){let i=new N.Menu,s=this.plugin.getPlaylistManager(),o=this.plugin.getQueueManager();i.addItem(c=>c.setTitle("Queues").setIsLabel(!0)),(await o.getAllQueues()).forEach(c=>{i.addItem(p=>p.setTitle(c.name).setIcon("list-ordered").onClick(()=>{(async()=>{try{await o.addEpisode(c.id,e.id),new N.Notice(`Added to queue: ${c.name}`)}catch(h){a.error("Operation failed",h),new N.Notice("Failed to add to queue")}})()}))}),i.addItem(c=>c.setTitle("New queue...").setIcon("plus").onClick(()=>{(async()=>{let p=await this.promptForInput("New Queue","Enter queue name:");if(p){let h=await o.createQueue(p);await o.addEpisode(h.id,e.id),new N.Notice(`Created queue "${p}" and added episode`),await this.render()}})()})),i.addSeparator(),i.addItem(c=>c.setTitle("Playlists").setIsLabel(!0)),(await s.getAllPlaylists()).forEach(c=>{i.addItem(p=>p.setTitle(c.name).setIcon("list").onClick(()=>{(async()=>{try{await s.addEpisode(c.id,e.id),new N.Notice(`Added to playlist: ${c.name}`)}catch(h){a.error("Operation failed",h),new N.Notice("Failed to add to playlist")}})()}))}),i.addItem(c=>c.setTitle("New playlist...").setIcon("plus").onClick(()=>{(async()=>{let p=await this.promptForInput("New Playlist","Enter playlist name:");if(p){let h=await s.createPlaylist(p);await s.addEpisode(h.id,e.id),new N.Notice(`Created playlist "${p}" and added episode`),await this.render()}})()})),i.showAtMouseEvent(r)}async handlePlayPlaylist(e){if(e.episodeIds.length===0){new N.Notice("Playlist is empty");return}let r=this.plugin.getEpisodeManager(),i=e.episodeIds[0],s=await r.getEpisodeWithProgress(i);s?await this.handlePlayEpisode(s,!1,e):new N.Notice("Failed to load episode from playlist")}async handlePlayEpisode(e,r=!1,i){try{let s=this.plugin.playerController,o=this.plugin.getQueueManager();if(i){let n=i.episodeIds.indexOf(e.id);s.setCurrentPlaylist(i,n>=0?n:0),await s.loadEpisode(e,!0,!0),new N.Notice(`Now playing: ${e.title}`);return}else if(r){let n=await o.getCurrentQueue();if(!n){let l=await o.getAllQueues();l.length>0?n=l[0]:n=await o.createQueue("Default Queue"),o.setCurrentQueue(n.id)}await o.insertEpisode(n.id,e.id,0),await o.jumpTo(n.id,0)}else if(this.selectedPodcast){let n=`Podcast: ${this.selectedPodcast.title}`,l=this.selectedPodcast.episodes||[];this.searchQuery&&(l=this.filterEpisodes(l,this.searchQuery)),l=this.sortEpisodes(l,this.episodeSortBy,this.episodeSortDirection);let p=(await o.getAllQueues()).find(d=>d.name===n);p||(p=await o.createQueue(n)),await o.clearQueue(p.id);let h=l.map(d=>d.id);await o.addEpisodes(p.id,h);let m=h.indexOf(e.id);m!==-1&&await o.jumpTo(p.id,m),o.setCurrentQueue(p.id)}await s.loadEpisode(e,!0,!0),new N.Notice(`Now playing: ${e.title}`)}catch(s){a.error("Failed to play episode",s),new N.Notice("Failed to start playback")}}handleEpisodeClick(e){new he(this.app,this.plugin,e).open()}showPodcastContextMenu(e,r){let i=new N.Menu;i.addItem(s=>s.setTitle("View episodes").setIcon("list").onClick(()=>{this.selectedPodcast=e,this.render()})),i.addItem(s=>s.setTitle("Refresh feed").setIcon("refresh-cw").onClick(()=>{(async()=>{try{let o=this.plugin.getFeedSyncManager();new N.Notice("Refreshing feed..."),await o.syncPodcast(e.id),new N.Notice("Feed refreshed"),await this.render()}catch(o){a.error("Failed to refresh feed",o),new N.Notice("Failed to refresh feed")}})()})),i.addSeparator(),i.addItem(s=>s.setTitle("Unsubscribe").setIcon("trash").onClick(()=>{(async()=>{try{await this.plugin.getPodcastService().unsubscribe(e.id),new N.Notice(`Unsubscribed from ${e.title}`),await this.render()}catch(o){a.error("Failed to unsubscribe",o),new N.Notice("Failed to unsubscribe")}})()})),i.showAtMouseEvent(r)}showEpisodeContextMenu(e,r){let i=new N.Menu;i.addItem(s=>s.setTitle("View details").setIcon("info").onClick(()=>this.handleEpisodeClick(e))),i.addSeparator(),i.addItem(s=>s.setTitle("Play").setIcon("play").onClick(()=>void this.handlePlayEpisode(e))),i.addItem(s=>s.setTitle("Add to queue").setIcon("list-plus").onClick(()=>{new Le(this.app,this.plugin,[e],o=>{}).open()})),i.addItem(s=>s.setTitle("Add to playlist").setIcon("folder-plus").onClick(()=>{new Fe(this.app,this.plugin,[e],o=>{}).open()})),i.addSeparator(),i.addItem(s=>s.setTitle("Export to note").setIcon("file-text").onClick(()=>{this.handleExportToNote(e)})),i.showAtMouseEvent(r)}async handleExportToNote(e){try{let r=new N.Notice("Exporting episode to note...",0),s=await this.plugin.getSubscriptionStore().getPodcast(e.podcastId);if(!s){r.hide(),new N.Notice("Failed to find podcast information");return}let n=await this.plugin.getEpisodeManager().getEpisodeWithProgress(e.id),l=n==null?void 0:n.progress,p=await this.plugin.getNoteExporter().exportEpisode(e,s,l);r.hide(),new N.Notice(`Note created: ${p.name}`),await this.app.workspace.getLeaf(!1).openFile(p)}catch(r){a.error("Failed to export to note",r),new N.Notice("Failed to export to note")}}formatDuration(e){let r=Math.floor(e/3600),i=Math.floor(e%3600/60);return r>0?`${r}h ${i}m`:`${i}m`}async loadPodcasts(){try{return await this.plugin.getSubscriptionStore().getAllPodcasts()}catch(e){return a.error("Failed to load podcasts",e),[]}}async loadPodcastStats(e){let r=this.plugin.getEpisodeManager(),i=e.filter(n=>!this.podcastStats.has(n.id));if(i.length===0)return;let s=i.map(async n=>{try{let l=await r.getPodcastStatistics(n.id);return{podcastId:n.id,stats:l,error:null}}catch(l){return a.error(`Failed to load stats for podcast ${n.id}`,l),{podcastId:n.id,stats:null,error:l}}}),o=await Promise.all(s);for(let n of o)n.stats&&this.podcastStats.set(n.podcastId,n.stats)}filterPodcasts(e,r){let i=r.toLowerCase();return e.filter(s=>{var o,n;return!!(s.title.toLowerCase().includes(i)||(o=s.author)!=null&&o.toLowerCase().includes(i)||(n=s.description)!=null&&n.toLowerCase().includes(i))})}filterEpisodes(e,r){let i=r.toLowerCase();return e.filter(s=>{var o;return!!(s.title.toLowerCase().includes(i)||(o=s.description)!=null&&o.toLowerCase().includes(i))})}sortPodcasts(e,r,i){return[...e].sort((o,n)=>{var c,p,h,m;let l=0;switch(r){case"title":l=o.title.localeCompare(n.title);break;case"author":l=(o.author||"").localeCompare(n.author||"");break;case"date":{let d=new Date(o.subscribedAt).getTime(),v=new Date(n.subscribedAt).getTime();l=d-v;break}case"latest":{let d=this.getLatestEpisodeDate(o),v=this.getLatestEpisodeDate(n);l=d-v;break}case"count":{let d=((c=this.podcastStats.get(o.id))==null?void 0:c.totalEpisodes)||0,v=((p=this.podcastStats.get(n.id))==null?void 0:p.totalEpisodes)||0;l=d-v;break}case"unplayed":{let d=((h=this.podcastStats.get(o.id))==null?void 0:h.unplayedEpisodes)||0,v=((m=this.podcastStats.get(n.id))==null?void 0:m.unplayedEpisodes)||0;l=d-v;break}}return i==="asc"?l:-l})}getLatestEpisodeDate(e){if(!e.episodes||e.episodes.length===0)return 0;let r=e.episodes.map(i=>new Date(i.publishDate).getTime());return Math.max(...r)}sortEpisodes(e,r,i){return[...e].sort((o,n)=>{let l=0;switch(r){case"title":l=o.title.localeCompare(n.title);break;case"date":{let c=new Date(o.publishDate).getTime(),p=new Date(n.publishDate).getTime();l=c-p;break}case"duration":l=o.duration-n.duration;break}return i==="asc"?l:-l})}async renderPlaylistList(e){let r=this.sidebarContentEl.createDiv({cls:"playlist-list-container"});this.renderLoading(r),r.empty();let s=await this.plugin.getQueueManager().getAllQueues();if(s.length>0){let l=r.createDiv({cls:"queue-section-sidebar"});l.createEl("h4",{text:"Queues",cls:"section-title"});for(let c of s){if(e!=null&&e.aborted)return;this.renderQueueAsPlaylistItem(l,c)}}let n=await this.plugin.getPlaylistManager().getAllPlaylists();if(this.searchQuery&&(n=this.filterPlaylists(n,this.searchQuery)),n=this.sortPlaylists(n,this.playlistSortBy,this.playlistSortDirection),n.length>0||this.searchQuery){let l=r.createDiv({cls:"playlist-section-sidebar"});if(this.searchQuery||l.createEl("h4",{text:"Playlists",cls:"section-title"}),n.length===0){let c=l.createDiv({cls:"empty-state"});this.searchQuery?(c.createEl("p",{text:"No playlists found"}),c.createEl("p",{text:`No playlists match "${this.searchQuery}"`,cls:"empty-state-hint"})):(c.createEl("p",{text:"No playlists yet"}),c.createEl("p",{text:"Click the + button to create a playlist",cls:"empty-state-hint"}))}else for(let c of n){if(e!=null&&e.aborted)return;this.renderPlaylistItem(l,c)}}else if(s.length===0){let l=r.createDiv({cls:"empty-state"});l.createEl("p",{text:"No playlists yet"}),l.createEl("p",{text:"Click the + button to create a playlist",cls:"empty-state-hint"})}}renderQueueAsPlaylistItem(e,r){let i=e.createDiv({cls:"playlist-item queue-item"}),s=i.createDiv({cls:"playlist-info"});s.createEl("h3",{text:r.name,cls:"playlist-title"});let o=s.createDiv({cls:"playlist-metadata"});o.createSpan({text:`${r.episodeIds.length} episodes`,cls:"playlist-count"}),o.createSpan({text:` \u2022 Updated ${this.formatDate(r.updatedAt)}`,cls:"playlist-date"});let n=i.createEl("button",{cls:"playlist-play-button clickable-icon",attr:{"aria-label":"Play queue"}});(0,N.setIcon)(n,"play"),n.addEventListener("click",l=>{l.stopPropagation(),this.handlePlayQueue(r)}),i.addEventListener("click",()=>{this.showQueueDetails(r)}),i.addEventListener("contextmenu",l=>{l.preventDefault(),this.showQueueContextMenu(r,l)})}async handlePlayQueue(e){if(e.episodeIds.length===0){new N.Notice("Queue is empty");return}try{this.plugin.getQueueManager().setCurrentQueue(e.id);let i=this.plugin.getEpisodeManager(),s=e.episodeIds[e.currentIndex]||e.episodeIds[0],o=await i.getEpisodeWithProgress(s);o&&await this.plugin.playerController.loadEpisode(o,!0,!0)}catch(r){a.error("Failed to play queue",r),new N.Notice("Failed to play queue")}}async showQueueDetails(e){this.selectedQueue=e,await this.render()}showQueueContextMenu(e,r){let i=new N.Menu;i.addItem(s=>s.setTitle("View details").setIcon("list").onClick(()=>{this.showQueueDetails(e)})),i.addItem(s=>s.setTitle("Play").setIcon("play").onClick(()=>{this.handlePlayQueue(e)})),i.addItem(s=>s.setTitle("Rename").setIcon("pencil").onClick(()=>{(async()=>{let o=await this.promptForInput("Rename Queue","Enter new name:",e.name);if(!(!o||o===e.name))try{await this.plugin.getQueueManager().updateQueue(e.id,{name:o}),new N.Notice("Queue renamed"),await this.render()}catch(n){a.error("Failed to rename queue",n),new N.Notice("Failed to rename queue")}})()})),i.addSeparator(),i.addItem(s=>s.setTitle("Clear queue").setIcon("eraser").onClick(()=>{(async()=>{try{await this.plugin.getQueueManager().clearQueue(e.id),new N.Notice("Queue cleared"),await this.render()}catch(o){a.error("Failed to clear queue",o),new N.Notice("Failed to clear queue")}})()})),i.addItem(s=>s.setTitle("Delete queue").setIcon("trash").onClick(()=>{(async()=>{try{await this.plugin.getQueueManager().deleteQueue(e.id),new N.Notice("Queue deleted"),await this.render()}catch(o){a.error("Failed to delete queue",o),new N.Notice("Failed to delete queue")}})()})),i.showAtMouseEvent(r)}renderPlaylistItem(e,r){let i=e.createDiv({cls:"playlist-item"}),s=i.createDiv({cls:"playlist-info"});s.createEl("h3",{text:r.name,cls:"playlist-title"}),r.description&&s.createEl("p",{text:r.description,cls:"playlist-description"});let o=s.createDiv({cls:"playlist-metadata"});o.createSpan({text:`${r.episodeIds.length} episodes`,cls:"playlist-count"}),o.createSpan({text:` \u2022 Updated ${this.formatDate(r.updatedAt)}`,cls:"playlist-date"});let n=i.createEl("button",{cls:"playlist-play-button clickable-icon",attr:{"aria-label":"Play playlist"}});(0,N.setIcon)(n,"play"),n.addEventListener("click",l=>{l.stopPropagation(),this.handlePlayPlaylist(r)}),i.addEventListener("click",()=>{this.selectedPlaylist=r,this.render()}),i.addEventListener("contextmenu",l=>{l.preventDefault(),this.showPlaylistContextMenu(r,l)})}updateListIcons(){var e;try{let i=this.plugin.playerController.getState(),s=(e=i.currentEpisode)==null?void 0:e.id,o=i.status==="playing";this.sidebarContentEl.querySelectorAll(".playlist-episode-item").forEach(l=>{let c=l.getAttribute("data-episode-id"),p=l.querySelector(".queue-episode-action");if(p)if(c===s)if(l.addClass("current"),p.empty(),o){let h=p.createDiv({cls:"icon-current"});(0,N.setIcon)(h,"pause")}else{let h=p.createDiv({cls:"icon-current"});(0,N.setIcon)(h,"play")}else{l.removeClass("current"),p.empty();let h=p.createDiv({cls:"icon-drag"});(0,N.setIcon)(h,"grip-vertical");let m=p.createDiv({cls:"icon-play"});(0,N.setIcon)(m,"play")}})}catch(r){a.error("Failed to update list icons",r)}}async renderPlaylistDetails(e){if(!this.selectedPlaylist)return;let r=this.sidebarContentEl.createDiv({cls:"playlist-details-container"}),i=0,s=this.plugin.getEpisodeManager();try{i=(await s.getEpisodesWithProgress(this.selectedPlaylist.episodeIds)).reduce((c,p)=>c+(p.duration||0),0)}catch(l){a.error("Failed to calculate playlist duration",l)}let o=r.createDiv({cls:"playlist-details-metadata"});this.selectedPlaylist.description&&o.createEl("p",{text:this.selectedPlaylist.description,cls:"playlist-details-description"});let n=i>0?` \u2022 ${this.formatDuration(i)}`:"";o.createEl("p",{text:`${this.selectedPlaylist.episodeIds.length} episodes${n} \u2022 Created ${this.formatDate(this.selectedPlaylist.createdAt)}`,cls:"playlist-details-info"}),await this.renderPlaylistEpisodeList(r,this.selectedPlaylist.episodeIds,e)}async renderPlaylistEpisodeList(e,r,i){if(r.length===0){e.createDiv({cls:"empty-state"}).createEl("p",{text:"No episodes in this playlist"});return}let s=this.plugin.getEpisodeManager(),o=e.createDiv({cls:"playlist-episode-list"});this.renderLoading(o),r.length>0,o.empty(),o.empty();for(let n=0;n<r.length;n++){if(i!=null&&i.aborted)return;let l=r[n];try{let c=await s.getEpisodeWithProgress(l);c&&this.renderPlaylistEpisodeItem(o,c,n)}catch(c){a.error(`Failed to load episode: ${l}`,c)}}}renderPlaylistEpisodeItem(e,r,i){var v;let o=this.plugin.playerController.getState(),n=((v=o.currentEpisode)==null?void 0:v.id)===r.id,l=n&&o.status==="playing",c=e.createDiv({cls:n?"playlist-episode-item current":"playlist-episode-item",attr:{"data-episode-id":r.id}});c.draggable=!0,c.addEventListener("dragstart",D=>{this.selectedPlaylist&&this.handleDragStart(D,i,"playlist",this.selectedPlaylist.id)}),c.addEventListener("dragover",D=>this.handleDragOver(D)),c.addEventListener("dragenter",D=>this.handleDragEnter(D)),c.addEventListener("dragleave",D=>this.handleDragLeave(D)),c.addEventListener("drop",D=>{this.selectedPlaylist&&this.handleDrop(D,i,"playlist",this.selectedPlaylist.id)});let p=c.createDiv({cls:"queue-episode-action"});if(n&&l){let D=p.createDiv({cls:"icon-current"});(0,N.setIcon)(D,"pause")}else{let D=p.createDiv({cls:"icon-drag"});(0,N.setIcon)(D,"grip-vertical");let I=p.createDiv({cls:"icon-play"});(0,N.setIcon)(I,"play")}let h=c.createDiv({cls:"playlist-episode-info"});h.createEl("h4",{text:r.title,cls:"playlist-episode-title"});let m=h.createDiv({cls:"playlist-episode-metadata"});r.duration&&m.createSpan({text:this.formatDuration(r.duration),cls:"playlist-episode-duration"});let d=c.createEl("button",{cls:"playlist-episode-delete clickable-icon",attr:{"aria-label":"Remove from playlist"}});(0,N.setIcon)(d,"trash"),d.addEventListener("click",D=>{D.stopPropagation(),(async()=>{if(this.selectedPlaylist){let I=this.plugin.getPlaylistManager();await I.removeEpisode(this.selectedPlaylist.id,r.id),this.selectedPlaylist=await I.getPlaylist(this.selectedPlaylist.id),await this.render()}})()}),c.addEventListener("click",D=>{D.stopPropagation(),(async()=>{var I;try{let T=this.plugin.playerController.getState();((I=T.currentEpisode)==null?void 0:I.id)===r.id?T.status==="playing"?this.plugin.playerController.pause():await this.plugin.playerController.play():await this.handlePlayEpisode(r,!1,this.selectedPlaylist||void 0)}catch(T){a.error("Failed to play/pause episode",T)}})()}),c.addEventListener("contextmenu",D=>{D.preventDefault(),this.showPlaylistEpisodeContextMenu(r,i,D)})}renderQueueEpisodeItem(e,r,i){var v;let o=this.plugin.playerController.getState(),n=((v=o.currentEpisode)==null?void 0:v.id)===r.id,l=n&&o.status==="playing",c=e.createDiv({cls:n?"playlist-episode-item current":"playlist-episode-item",attr:{"data-episode-id":r.id}});c.draggable=!0,c.addEventListener("dragstart",D=>{this.selectedQueue&&this.handleDragStart(D,i,"queue",this.selectedQueue.id)}),c.addEventListener("dragover",D=>this.handleDragOver(D)),c.addEventListener("dragenter",D=>this.handleDragEnter(D)),c.addEventListener("dragleave",D=>this.handleDragLeave(D)),c.addEventListener("drop",D=>{this.selectedQueue&&this.handleDrop(D,i,"queue",this.selectedQueue.id)});let p=c.createDiv({cls:"queue-episode-action"});if(n&&l){let D=p.createDiv({cls:"icon-current"});(0,N.setIcon)(D,"pause")}else{let D=p.createDiv({cls:"icon-drag"});(0,N.setIcon)(D,"grip-vertical");let I=p.createDiv({cls:"icon-play"});(0,N.setIcon)(I,"play")}let h=c.createDiv({cls:"playlist-episode-info"});h.createEl("h4",{text:r.title,cls:"playlist-episode-title"});let m=h.createDiv({cls:"playlist-episode-metadata"});r.duration&&m.createSpan({text:this.formatDuration(r.duration),cls:"playlist-episode-duration"});let d=c.createEl("button",{cls:"playlist-episode-delete clickable-icon",attr:{"aria-label":"Remove from queue"}});(0,N.setIcon)(d,"trash"),d.addEventListener("click",D=>{D.stopPropagation(),(async()=>{if(this.selectedQueue){let I=this.plugin.getQueueManager();await I.removeEpisode(this.selectedQueue.id,r.id),this.selectedQueue=await I.getQueue(this.selectedQueue.id),await this.render()}})()}),c.addEventListener("click",D=>{D.stopPropagation(),(async()=>{var I;try{let T=this.plugin.playerController.getState();if(((I=T.currentEpisode)==null?void 0:I.id)===r.id)T.status==="playing"?this.plugin.playerController.pause():await this.plugin.playerController.play();else if(this.selectedQueue){let w=this.plugin.getQueueManager();w.setCurrentQueue(this.selectedQueue.id),await w.jumpTo(this.selectedQueue.id,i),await this.plugin.playerController.loadEpisode(r,!0)}else await this.handlePlayEpisode(r)}catch(T){a.error("Failed to play/pause episode",T)}})()}),c.addEventListener("contextmenu",D=>{D.preventDefault(),this.showEpisodeContextMenu(r,D)})}handleDragStart(e,r,i,s){this.dragStartIndex=r,this.dragType=i,this.dragTargetId=s,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({index:r,type:i,id:s}))),e.target.addClass("dragging")}handleDragOver(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!1}handleDragEnter(e){var r;(r=e.target.closest(".playlist-episode-item"))==null||r.addClass("drag-over")}handleDragLeave(e){var r;(r=e.target.closest(".playlist-episode-item"))==null||r.removeClass("drag-over")}async handleDrop(e,r,i,s){var o;if(e.stopPropagation(),(o=e.target.closest(".playlist-episode-item"))==null||o.removeClass("drag-over"),!(this.dragStartIndex===r||this.dragType!==i||this.dragTargetId!==s)){try{if(i==="playlist"){let n=this.plugin.getPlaylistManager(),l=await n.getPlaylist(s);if(l){let c=l.episodeIds[this.dragStartIndex];l.episodeIds.splice(this.dragStartIndex,1),l.episodeIds.splice(r,0,c),await n.updatePlaylist(s,{episodeIds:l.episodeIds}),this.selectedPlaylist=l}}else if(i==="queue"){let n=this.plugin.getQueueManager(),l=await n.getQueue(s);if(l){let c=l.episodeIds[this.dragStartIndex];l.episodeIds.splice(this.dragStartIndex,1),l.episodeIds.splice(r,0,c),await n.updateQueue(s,{episodeIds:l.episodeIds}),this.selectedQueue=l}}await this.render()}catch(n){a.error("Failed to reorder",n),new N.Notice("Failed to reorder items")}finally{document.querySelectorAll(".dragging").forEach(n=>n.removeClass("dragging")),this.dragStartIndex=-1,this.dragType=null,this.dragTargetId=null}return!1}}async handleCreatePlaylist(){try{let e=await this.promptForInput("Create Playlist","Enter playlist name:");if(!e)return;let r=await this.promptForInput("Playlist Description","Enter description (optional):");await this.plugin.getPlaylistManager().createPlaylist(e,r||void 0),new N.Notice(`Playlist "${e}" created`),await this.render()}catch(e){a.error("Failed to create playlist",e),new N.Notice("Failed to create playlist")}}async handleCreateQueue(){try{let e=await this.promptForInput("Create Queue","Enter queue name:");if(!e)return;await this.plugin.getQueueManager().createQueue(e),new N.Notice(`Queue "${e}" created`),await this.render()}catch(e){a.error("Failed to create queue",e),new N.Notice("Failed to create queue")}}handleRenamePlaylist(){this.selectedPlaylist&&new ot(this.app,"Rename playlist",this.selectedPlaylist.name,"Enter new playlist name",e=>{(async()=>{if(!(!this.selectedPlaylist||!e||e===this.selectedPlaylist.name))try{let r=this.plugin.getPlaylistManager();await r.updatePlaylist(this.selectedPlaylist.id,{name:e}),new N.Notice(`Playlist renamed to "${e}"`),this.selectedPlaylist=await r.getPlaylist(this.selectedPlaylist.id),await this.render()}catch(r){a.error("Failed to rename playlist",r),new N.Notice("Failed to rename playlist")}})()},()=>{(async()=>{if(this.selectedPlaylist)try{await this.plugin.getPlaylistManager().deletePlaylist(this.selectedPlaylist.id),new N.Notice("Playlist deleted"),this.selectedPlaylist=null,await this.render()}catch(e){a.error("Failed to delete playlist",e),new N.Notice("Failed to delete playlist")}})()}).open()}async renderQueueDetails(e){if(!this.selectedQueue)return;let r=this.sidebarContentEl.createDiv({cls:"playlist-details-container"}),i=r.createDiv({cls:"playlist-details-header podcast-sidebar-header-flex"}),s=0,o=this.plugin.getEpisodeManager();try{s=(await o.getEpisodesWithProgress(this.selectedQueue.episodeIds)).reduce((d,v)=>d+(v.duration||0),0)}catch(m){a.error("Failed to calculate queue duration",m)}let n=i.createDiv({cls:"playlist-details-metadata"}),l=s>0?` \u2022 ${this.formatDuration(s)}`:"";n.createEl("p",{text:`${this.selectedQueue.episodeIds.length} episodes${l}`,cls:"playlist-details-count"});let c=i.createEl("button",{text:"Play queue",cls:"playlist-play-all-button clickable-icon"});(0,N.setIcon)(c,"play"),c.addEventListener("click",()=>{this.selectedQueue&&this.handlePlayQueue(this.selectedQueue)});let p=r.createDiv({cls:"episode-list-container"});if(this.selectedQueue.episodeIds.length===0){p.createDiv({cls:"empty-state"}).createEl("p",{text:"Queue is empty"});return}let h=[];for(let m of this.selectedQueue.episodeIds){if(e!=null&&e.aborted)return;let d=await o.getEpisodeWithProgress(m);d&&h.push(d)}h.forEach((m,d)=>{e!=null&&e.aborted||this.renderQueueEpisodeItem(p,m,d)})}handleRenameQueue(){this.selectedQueue&&new ot(this.app,"Rename queue",this.selectedQueue.name,"Enter new queue name",e=>{(async()=>{if(!(!this.selectedQueue||!e||e===this.selectedQueue.name))try{await this.plugin.getQueueManager().updateQueue(this.selectedQueue.id,{name:e}),this.selectedQueue.name=e,new N.Notice("Queue renamed"),await this.render()}catch(r){a.error("Failed to rename queue",r),new N.Notice("Failed to rename queue")}})()},()=>{(async()=>{if(this.selectedQueue)try{await this.plugin.getQueueManager().deleteQueue(this.selectedQueue.id),new N.Notice("Queue deleted"),this.selectedQueue=null,await this.render()}catch(e){a.error("Failed to delete queue",e),new N.Notice("Failed to delete queue")}})()}).open()}showPlaylistContextMenu(e,r){let i=new N.Menu;i.addItem(s=>s.setTitle("View details").setIcon("list").onClick(()=>{this.selectedPlaylist=e,this.render()})),i.addItem(s=>s.setTitle("Rename").setIcon("pencil").onClick(()=>{(async()=>{let o=await this.promptForInput("Rename Playlist","Enter new name:",e.name);if(!(!o||o===e.name))try{await this.plugin.getPlaylistManager().updatePlaylist(e.id,{name:o}),new N.Notice("Playlist renamed"),await this.render()}catch(n){a.error("Failed to rename playlist",n),new N.Notice("Failed to rename playlist")}})()})),i.addSeparator(),i.addItem(s=>s.setTitle("Delete").setIcon("trash").onClick(()=>{(async()=>{try{await this.plugin.getPlaylistManager().deletePlaylist(e.id),new N.Notice("Playlist deleted"),await this.render()}catch(o){a.error("Failed to delete playlist",o),new N.Notice("Failed to delete playlist")}})()})),i.showAtMouseEvent(r)}showPlaylistEpisodeContextMenu(e,r,i){let s=new N.Menu;s.addItem(o=>o.setTitle("View details").setIcon("info").onClick(()=>this.handleEpisodeClick(e))),s.addSeparator(),s.addItem(o=>o.setTitle("Play").setIcon("play").onClick(()=>void this.handlePlayEpisode(e,!1,this.selectedPlaylist||void 0))),s.addSeparator(),s.addItem(o=>o.setTitle("Remove from playlist").setIcon("trash").onClick(()=>{(async()=>{try{if(this.selectedPlaylist){let n=this.plugin.getPlaylistManager();await n.removeEpisode(this.selectedPlaylist.id,e.id),this.selectedPlaylist=await n.getPlaylist(this.selectedPlaylist.id),new N.Notice("Episode removed from playlist"),await this.render()}}catch(n){a.error("Failed to remove episode",n),new N.Notice("Failed to remove episode")}})()})),s.showAtMouseEvent(i)}filterPlaylists(e,r){let i=r.toLowerCase();return e.filter(s=>{var o;return!!(s.name.toLowerCase().includes(i)||(o=s.description)!=null&&o.toLowerCase().includes(i))})}sortPlaylists(e,r,i){return[...e].sort((o,n)=>{let l=0;switch(r){case"name":l=o.name.localeCompare(n.name);break;case"date":{let c=new Date(o.createdAt).getTime(),p=new Date(n.createdAt).getTime();l=c-p;break}case"count":l=o.episodeIds.length-n.episodeIds.length;break}return i==="asc"?l:-l})}formatDate(e){let i=new Date().getTime()-new Date(e).getTime(),s=Math.floor(i/(1e3*60*60*24));if(s===0)return"today";if(s===1)return"yesterday";if(s<7)return`${s} days ago`;if(s<30){let o=Math.floor(s/7);return`${o} week${o>1?"s":""} ago`}else{let o=Math.floor(s/30);return`${o} month${o>1?"s":""} ago`}}async promptForInput(e,r,i){return new Promise(s=>{new lt(this.app,e,r,i||"",n=>s(n)).open()})}async refresh(){await this.render()}};var W=require("obsidian");var Re="playlist-queue-view",dt=class extends W.ItemView{constructor(e,r){super(e);this.viewMode="playlists";this.selectedPlaylist=null;this.selectedQueue=null;this.searchQuery="";this.sortBy="date";this.sortDirection="desc";this.lastQueueEpisodeIds=[];this.plugin=r}onload(){super.onload(),this.registerEvent(this.app.workspace.on("podcast:queue-changed",()=>{this.render()})),this.registerEvent(this.app.workspace.on("podcast:playlist-updated",()=>{this.render()})),this.registerEvent(this.app.workspace.on("podcast:queue-updated",()=>{this.render()}))}getViewType(){return Re}getDisplayText(){return"Playlists & queues"}getIcon(){return"list-music"}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.addClass("playlist-queue-view"),this.pqContentEl=e.createDiv({cls:"playlist-queue-content"}),await this.render()}async onClose(){}async render(){this.pqContentEl.empty(),this.renderHeader(),!this.selectedPlaylist&&!this.selectedQueue&&(this.renderSearchBox(),this.renderSortOptions()),this.selectedPlaylist?await this.renderPlaylistDetails():this.selectedQueue?await this.renderQueueDetails():this.viewMode==="playlists"?await this.renderPlaylistList():await this.renderQueueList()}renderSearchBox(){let e=this.pqContentEl.createDiv({cls:"pq-search-container"});if(e.createEl("input",{type:"text",placeholder:`Search ${this.viewMode}...`,cls:"pq-search-input",value:this.searchQuery}).addEventListener("input",i=>{this.searchQuery=i.target.value,this.render()}),this.searchQuery){let i=e.createEl("button",{cls:"pq-search-clear clickable-icon",attr:{"aria-label":"Clear search"}});(0,W.setIcon)(i,"x"),i.addEventListener("click",()=>{this.searchQuery="",this.render()})}}renderSortOptions(){let e=this.pqContentEl.createDiv({cls:"pq-sort-container"});e.createSpan({text:"Sort: ",cls:"sort-label"});let r=e.createEl("select",{cls:"sort-select"});r.createEl("option",{value:"name",text:"Name"}),r.createEl("option",{value:"date",text:"Date"}),r.createEl("option",{value:"count",text:"Episode count"}),r.value=this.sortBy,r.addEventListener("change",s=>{this.sortBy=s.target.value,this.render()});let i=e.createEl("button",{cls:"sort-direction-button clickable-icon",attr:{"aria-label":"Toggle sort direction"}});(0,W.setIcon)(i,this.sortDirection==="asc"?"arrow-up":"arrow-down"),i.addEventListener("click",()=>{this.sortDirection=this.sortDirection==="asc"?"desc":"asc",this.render()})}renderHeader(){let e=this.pqContentEl.createDiv({cls:"pq-header"});if(this.selectedPlaylist||this.selectedQueue){let s=e.createEl("button",{cls:"pq-back-button clickable-icon",attr:{"aria-label":"Back to list"}});(0,W.setIcon)(s,"arrow-left"),s.createSpan({text:" Back"}),s.addEventListener("click",()=>{this.selectedPlaylist=null,this.selectedQueue=null,this.render()})}let r="";if(this.selectedPlaylist?r=this.selectedPlaylist.name:this.selectedQueue?r=this.selectedQueue.name:r=this.viewMode==="playlists"?"Playlists":"Queues",e.createEl("h2",{text:r,cls:"pq-title"}),!this.selectedPlaylist&&!this.selectedQueue){let s=e.createDiv({cls:"pq-mode-toggle"});s.createEl("button",{text:"Playlists",cls:this.viewMode==="playlists"?"pq-mode-active":"pq-mode-inactive"}).addEventListener("click",()=>{this.viewMode="playlists",this.render()}),s.createEl("button",{text:"Queues",cls:this.viewMode==="queues"?"pq-mode-active":"pq-mode-inactive"}).addEventListener("click",()=>{this.viewMode="queues",this.render()})}let i=e.createDiv({cls:"pq-actions"});if(!this.selectedPlaylist&&!this.selectedQueue){let s=i.createEl("button",{cls:"pq-action-button clickable-icon",attr:{"aria-label":`Create new ${this.viewMode==="playlists"?"playlist":"queue"}`}});(0,W.setIcon)(s,"plus"),s.addEventListener("click",()=>void this.handleCreate())}}async renderPlaylistList(){let e=this.pqContentEl.createDiv({cls:"pq-list-container"}),i=await this.plugin.getPlaylistManager().getAllPlaylists();if(this.searchQuery&&(i=this.filterPlaylists(i,this.searchQuery)),i=this.sortPlaylists(i,this.sortBy,this.sortDirection),i.length===0){let s=e.createDiv({cls:"pq-empty-state"});this.searchQuery?(s.createEl("p",{text:"No playlists found"}),s.createEl("p",{text:`No playlists match "${this.searchQuery}"`,cls:"pq-empty-hint"})):(s.createEl("p",{text:"No playlists yet"}),s.createEl("p",{text:"Click the + button to create a playlist",cls:"pq-empty-hint"}));return}for(let s of i)this.renderPlaylistItem(e,s)}renderPlaylistItem(e,r){let i=e.createDiv({cls:"pq-item"}),s=i.createDiv({cls:"pq-item-info"});s.createEl("h3",{text:r.name,cls:"pq-item-title"}),r.description&&s.createEl("p",{text:r.description,cls:"pq-item-description"});let o=s.createDiv({cls:"pq-item-metadata"});o.createSpan({text:`${r.episodeIds.length} episodes`,cls:"pq-item-count"}),o.createSpan({text:` \u2022 Updated ${this.formatDate(r.updatedAt)}`,cls:"pq-item-date"}),i.addEventListener("click",()=>{this.selectedPlaylist=r,this.render()}),i.addEventListener("contextmenu",n=>{n.preventDefault(),this.showPlaylistContextMenu(r,n)})}async renderQueueList(){let e=this.pqContentEl.createDiv({cls:"pq-list-container"}),i=await this.plugin.getQueueManager().getAllQueues();if(this.searchQuery&&(i=this.filterQueues(i,this.searchQuery)),i=this.sortQueues(i,this.sortBy,this.sortDirection),i.length===0){let s=e.createDiv({cls:"pq-empty-state"});this.searchQuery?(s.createEl("p",{text:"No queues found"}),s.createEl("p",{text:`No queues match "${this.searchQuery}"`,cls:"pq-empty-hint"})):(s.createEl("p",{text:"No queues yet"}),s.createEl("p",{text:"Click the + button to create a queue",cls:"pq-empty-hint"}));return}for(let s of i)this.renderQueueItem(e,s)}renderQueueItem(e,r){let i=e.createDiv({cls:"pq-item"}),s=i.createDiv({cls:"pq-item-info"});s.createEl("h3",{text:r.name,cls:"pq-item-title"});let o=s.createDiv({cls:"pq-item-status"});o.createSpan({text:`Shuffle: ${r.shuffle?"On":"Off"}`}),o.createSpan({text:` \u2022 Repeat: ${this.formatRepeatMode(r.repeat)}`});let n=s.createDiv({cls:"pq-item-metadata"});n.createSpan({text:`${r.episodeIds.length} episodes`,cls:"pq-item-count"}),r.episodeIds.length>0&&n.createSpan({text:` \u2022 Current: ${r.currentIndex+1}`,cls:"pq-item-current"}),i.addEventListener("click",()=>{this.selectedQueue=r,this.render()}),i.addEventListener("contextmenu",l=>{l.preventDefault(),this.showQueueContextMenu(r,l)})}async renderPlaylistDetails(){if(!this.selectedPlaylist)return;let e=this.pqContentEl.createDiv({cls:"pq-details-container"}),r=e.createDiv({cls:"pq-details-metadata"});this.selectedPlaylist.description&&r.createEl("p",{text:this.selectedPlaylist.description,cls:"pq-details-description"}),r.createEl("p",{text:`${this.selectedPlaylist.episodeIds.length} episodes \u2022 Created ${this.formatDate(this.selectedPlaylist.createdAt)}`,cls:"pq-details-info"}),await this.renderEpisodeList(e,this.selectedPlaylist.episodeIds,"playlist")}async renderQueueDetails(){if(!this.selectedQueue)return;let e=this.pqContentEl.createDiv({cls:"pq-details-container"}),r=e.createDiv({cls:"pq-queue-controls"});r.createEl("button",{text:`Shuffle: ${this.selectedQueue.shuffle?"On":"Off"}`,cls:"pq-control-button"}).addEventListener("click",()=>{(async()=>{if(this.selectedQueue){let o=this.plugin.getQueueManager();await o.toggleShuffle(this.selectedQueue.id),this.selectedQueue=await o.getQueue(this.selectedQueue.id),await this.render()}})()}),r.createEl("button",{text:`Repeat: ${this.formatRepeatMode(this.selectedQueue.repeat)}`,cls:"pq-control-button"}).addEventListener("click",()=>{(async()=>{if(this.selectedQueue){let o=this.plugin.getQueueManager(),n=["none","one","all"],l=n.indexOf(this.selectedQueue.repeat),c=n[(l+1)%n.length];await o.setRepeat(this.selectedQueue.id,c),this.selectedQueue=await o.getQueue(this.selectedQueue.id),await this.render()}})()}),await this.renderEpisodeList(e,this.selectedQueue.episodeIds,"queue",this.selectedQueue.currentIndex)}async renderEpisodeList(e,r,i,s){if(r.length===0){e.createDiv({cls:"pq-empty-state"}).createEl("p",{text:"No episodes in this "+i});return}let o=this.plugin.getEpisodeManager(),n=e.createDiv({cls:"pq-episode-list"});for(let l=0;l<r.length;l++){let c=r[l];try{let p=await o.getEpisodeWithProgress(c);p&&this.renderEpisodeItem(n,p,l,i,l===s)}catch(p){a.error(`Failed to load episode: ${c}`,p)}}}renderEpisodeItem(e,r,i,s,o=!1){let n=e.createDiv({cls:o?"pq-episode-item pq-episode-current":"pq-episode-item"}),l=n.createDiv({cls:"pq-episode-index"});l.textContent=`${i+1}`;let c=n.createDiv({cls:"pq-episode-info"});c.createEl("h4",{text:r.title,cls:"pq-episode-title"});let p=c.createDiv({cls:"pq-episode-metadata"});r.duration&&p.createSpan({text:this.formatDuration(r.duration),cls:"pq-episode-duration"});let h=n.createEl("button",{cls:"pq-episode-play clickable-icon",attr:{"aria-label":"Play episode"}});(0,W.setIcon)(h,"play"),h.addEventListener("click",m=>{m.stopPropagation(),this.handlePlayEpisode(r)}),n.addEventListener("click",()=>{new he(this.app,this.plugin,r).open()}),n.addEventListener("contextmenu",m=>{m.preventDefault(),this.showEpisodeContextMenu(r,i,s,m)})}handleCreate(){new W.Notice(`Create new ${this.viewMode==="playlists"?"playlist":"queue"} - coming soon!`)}async handlePlayEpisode(e){try{await this.plugin.playerController.loadEpisode(e,!0,!0),new W.Notice(`Now playing: ${e.title}`)}catch(r){a.error("Failed to play episode",r),new W.Notice("Failed to start playback")}}showPlaylistContextMenu(e,r){let i=new W.Menu;i.addItem(s=>s.setTitle("View details").setIcon("list").onClick(()=>{this.selectedPlaylist=e,this.render()})),i.addItem(s=>s.setTitle("Rename").setIcon("pencil").onClick(()=>{new W.Notice("Rename playlist - coming soon!")})),i.addSeparator(),i.addItem(s=>s.setTitle("Delete").setIcon("trash").onClick(()=>{(async()=>{try{await this.plugin.getPlaylistManager().deletePlaylist(e.id),new W.Notice("Playlist deleted"),await this.render()}catch(o){a.error("Failed to delete playlist",o),new W.Notice("Failed to delete playlist")}})()})),i.showAtMouseEvent(r)}showQueueContextMenu(e,r){let i=new W.Menu;i.addItem(s=>s.setTitle("View details").setIcon("list").onClick(()=>{this.selectedQueue=e,this.render()})),i.addItem(s=>s.setTitle("Rename").setIcon("pencil").onClick(()=>{new W.Notice("Rename queue - coming soon!")})),i.addSeparator(),i.addItem(s=>s.setTitle("Clear").setIcon("eraser").onClick(()=>{(async()=>{try{await this.plugin.getQueueManager().clearQueue(e.id),new W.Notice("Queue cleared"),await this.render()}catch(o){a.error("Failed to clear queue",o),new W.Notice("Failed to clear queue")}})()})),i.addItem(s=>s.setTitle("Delete").setIcon("trash").onClick(()=>{(async()=>{try{await this.plugin.getQueueManager().deleteQueue(e.id),new W.Notice("Queue deleted"),await this.render()}catch(o){a.error("Failed to delete queue",o),new W.Notice("Failed to delete queue")}})()})),i.showAtMouseEvent(r)}showEpisodeContextMenu(e,r,i,s){let o=new W.Menu;o.addItem(n=>n.setTitle("View details").setIcon("info").onClick(()=>{new he(this.app,this.plugin,e).open()})),o.addSeparator(),o.addItem(n=>n.setTitle("Play").setIcon("play").onClick(()=>void this.handlePlayEpisode(e))),o.addSeparator(),o.addItem(n=>n.setTitle("Remove from "+i).setIcon("trash").onClick(()=>{(async()=>{try{if(i==="playlist"&&this.selectedPlaylist){let l=this.plugin.getPlaylistManager();await l.removeEpisode(this.selectedPlaylist.id,e.id),this.selectedPlaylist=await l.getPlaylist(this.selectedPlaylist.id),new W.Notice("Episode removed from playlist")}else if(i==="queue"&&this.selectedQueue){let l=this.plugin.getQueueManager();await l.removeEpisode(this.selectedQueue.id,e.id),this.selectedQueue=await l.getQueue(this.selectedQueue.id),new W.Notice("Episode removed from queue")}await this.render()}catch(l){a.error("Failed to remove episode",l),new W.Notice("Failed to remove episode")}})()})),o.showAtMouseEvent(s)}formatRepeatMode(e){switch(e){case"none":return"Off";case"one":return"One";case"all":return"All"}}formatDuration(e){let r=Math.floor(e/3600),i=Math.floor(e%3600/60);return r>0?`${r}h ${i}m`:`${i}m`}formatDate(e){let i=new Date().getTime()-new Date(e).getTime(),s=Math.floor(i/(1e3*60*60*24));if(s===0)return"today";if(s===1)return"yesterday";if(s<7)return`${s} days ago`;if(s<30){let o=Math.floor(s/7);return`${o} week${o>1?"s":""} ago`}else{let o=Math.floor(s/30);return`${o} month${o>1?"s":""} ago`}}filterPlaylists(e,r){let i=r.toLowerCase();return e.filter(s=>{var o;return!!(s.name.toLowerCase().includes(i)||(o=s.description)!=null&&o.toLowerCase().includes(i))})}filterQueues(e,r){let i=r.toLowerCase();return e.filter(s=>!!s.name.toLowerCase().includes(i))}sortPlaylists(e,r,i){return[...e].sort((o,n)=>{let l=0;switch(r){case"name":l=o.name.localeCompare(n.name);break;case"date":{let c=new Date(o.createdAt).getTime(),p=new Date(n.createdAt).getTime();l=c-p;break}case"count":l=o.episodeIds.length-n.episodeIds.length;break}return i==="asc"?l:-l})}sortQueues(e,r,i){return[...e].sort((o,n)=>{let l=0;switch(r){case"name":l=o.name.localeCompare(n.name);break;case"date":{let c=new Date(o.createdAt).getTime(),p=new Date(n.createdAt).getTime();l=c-p;break}case"count":l=o.episodeIds.length-n.episodeIds.length;break}return i==="asc"?l:-l})}async refresh(){await this.render()}};var Ve=require("obsidian");var ut=class{constructor(t){this.statusBarItem=null;this.plugin=t,this.isMobile=Ve.Platform.isMobile}onload(){if(this.isMobile){a.info("MiniPlayer: Skipping status bar on mobile platform");return}this.statusBarItem=this.plugin.addStatusBarItem(),this.statusBarItem.addClass("podcast-mini-player"),this.statusBarItem.addClass("is-hidden"),this.render(),this.registerEvents(),this.updateState()}render(){if(!this.statusBarItem)return;this.statusBarItem.empty();let t=this.statusBarItem.createDiv({cls:"mini-player-container"});this.playPauseBtn=t.createDiv({cls:"mini-player-btn"}),(0,Ve.setIcon)(this.playPauseBtn,"play"),this.playPauseBtn.addEventListener("click",e=>{e.stopPropagation(),this.togglePlayback()}),this.titleEl=t.createDiv({cls:"mini-player-title"}),this.titleEl.textContent="No episode playing",this.statusBarItem.addEventListener("click",()=>{this.plugin.activatePlayerView()}),this.statusBarItem.setAttribute("aria-label","Click to open Podcasts")}registerEvents(){this.isMobile||!this.statusBarItem||(this.plugin.registerEvent(this.plugin.app.workspace.on("podcast:player-state-updated",()=>{this.updateState()})),this.plugin.registerEvent(this.plugin.app.workspace.on("podcast:episode-changed",()=>{this.updateState()})))}updateState(){if(!this.plugin.playerController||!this.statusBarItem)return;let t=this.plugin.playerController.getState(),e=t.currentEpisode;e?(this.statusBarItem.removeClass("is-hidden"),this.titleEl.textContent=e.title,t.status==="playing"?((0,Ve.setIcon)(this.playPauseBtn,"pause"),this.playPauseBtn.setAttribute("aria-label","Pause")):((0,Ve.setIcon)(this.playPauseBtn,"play"),this.playPauseBtn.setAttribute("aria-label","Play"))):(this.statusBarItem.addClass("is-hidden"),this.titleEl.textContent="")}async togglePlayback(){try{let t=this.plugin.playerController;t.getState().status==="playing"?await t.pause():await t.play()}catch(t){a.error("MiniPlayer: Failed to toggle playback",t)}}unload(){this.statusBarItem&&this.statusBarItem.remove()}};var pt=class extends Pe{constructor(t,e){let r=e.getStructure().playlists;super(t,e,r)}async loadItem(t,e){let r=await super.loadItem(t,e);return r&&(typeof r.createdAt=="string"&&(r.createdAt=new Date(r.createdAt)),typeof r.updatedAt=="string"&&(r.updatedAt=new Date(r.updatedAt))),r}validate(t){if(!Array.isArray(t))return a.warn("Invalid playlist data: not an array"),!1;for(let e of t)if(!this.validatePlaylist(e))return a.warn("Invalid playlist",e),!1;return!0}validatePlaylist(t){if(!t||typeof t!="object")return!1;let e=["id","name","episodeIds","createdAt","updatedAt"];for(let r of e)if(!(r in t))return a.warn(`Missing required field in playlist: ${r}`),!1;return Array.isArray(t.episodeIds)?!0:(a.warn("Playlist episodeIds is not an array"),!1)}getDefaultValue(){return[]}async loadAllItems(){let t=await this.listItemIds(),e=[];for(let r of t)try{let i={id:"",name:"",description:"",episodeIds:[],createdAt:new Date,updatedAt:new Date},s=await this.loadItem(r,i);s&&this.validatePlaylist(s)&&e.push(s)}catch(i){a.warn(`Failed to load playlist: ${r}`,i)}return e}async load(){a.methodEntry("PlaylistStore","load");let t=await this.loadAllItems();return a.methodExit("PlaylistStore","load"),t}async save(t){if(a.methodEntry("PlaylistStore","save"),!this.validate(t))throw new _("Invalid playlist data",this.dirPath);await this.clear();for(let e of t)await this.saveItem(e.id,e);a.methodExit("PlaylistStore","save")}async getPlaylist(t){a.methodEntry("PlaylistStore","getPlaylist",t);try{let e={id:"",name:"",description:"",episodeIds:[],createdAt:new Date,updatedAt:new Date},r=await this.loadItem(t,e);return!r||!this.validatePlaylist(r)?(a.methodExit("PlaylistStore","getPlaylist","invalid"),null):(a.methodExit("PlaylistStore","getPlaylist"),r)}catch(e){return a.warn("Failed to get playlist",e),a.methodExit("PlaylistStore","getPlaylist","error"),null}}async savePlaylist(t){if(a.methodEntry("PlaylistStore","savePlaylist",t.id),!this.validatePlaylist(t))throw new _("Invalid playlist data",`${this.dirPath}/${t.id}.json`);await this.saveItem(t.id,t),a.methodExit("PlaylistStore","savePlaylist")}async deletePlaylist(t){a.methodEntry("PlaylistStore","deletePlaylist",t),await this.deleteItem(t),a.methodExit("PlaylistStore","deletePlaylist")}async exists(t){return await this.getPlaylist(t)!==null}async getAllIds(){return await this.listItemIds()}async getCount(){return(await this.listItemIds()).length}async clear(){a.methodEntry("PlaylistStore","clear");let t=await this.listItemIds();for(let e of t)await this.deleteItem(e);a.info("All playlists cleared"),a.methodExit("PlaylistStore","clear")}};var ht=class{constructor(t,e){this.playlistStore=t,this.app=e}async createPlaylist(t,e,r){a.methodEntry("PlaylistManager","createPlaylist",t);let i=this.generatePlaylistId(t),s=new Date,o={id:i,name:t,description:e,episodeIds:[],createdAt:s,updatedAt:s,imageUrl:r};return await this.playlistStore.savePlaylist(o),a.info("Playlist created",i),a.methodExit("PlaylistManager","createPlaylist"),o}async getPlaylist(t){a.methodEntry("PlaylistManager","getPlaylist",t);let e=await this.playlistStore.getPlaylist(t);return a.methodExit("PlaylistManager","getPlaylist"),e}async getAllPlaylists(){a.methodEntry("PlaylistManager","getAllPlaylists");let t=await this.playlistStore.load();return t.sort((e,r)=>r.updatedAt.getTime()-e.updatedAt.getTime()),a.methodExit("PlaylistManager","getAllPlaylists"),t}async updatePlaylist(t,e){a.methodEntry("PlaylistManager","updatePlaylist",t);let r=await this.playlistStore.getPlaylist(t);if(!r)throw new Error(`Playlist not found: ${t}`);let i={...r,...e,id:r.id,createdAt:r.createdAt,updatedAt:new Date};await this.playlistStore.savePlaylist(i),this.app&&this.app.workspace.trigger("podcast:playlist-updated",t),a.methodExit("PlaylistManager","updatePlaylist")}async deletePlaylist(t){a.methodEntry("PlaylistManager","deletePlaylist",t),await this.playlistStore.deletePlaylist(t),a.info("Playlist deleted",t),a.methodExit("PlaylistManager","deletePlaylist")}async addEpisode(t,e){a.methodEntry("PlaylistManager","addEpisode",`${t}, ${e}`);let r=await this.playlistStore.getPlaylist(t);if(!r)throw new Error(`Playlist not found: ${t}`);if(r.episodeIds.includes(e)){a.warn("Episode already in playlist",e);return}r.episodeIds.push(e),r.updatedAt=new Date,await this.playlistStore.savePlaylist(r),a.info("Episode added to playlist",e),this.app&&this.app.workspace.trigger("podcast:playlist-updated",t),a.methodExit("PlaylistManager","addEpisode")}async addEpisodes(t,e){a.methodEntry("PlaylistManager","addEpisodes",`${t}, count=${e.length}`);let r=await this.playlistStore.getPlaylist(t);if(!r)throw new Error(`Playlist not found: ${t}`);let i=new Set(r.episodeIds),s=e.filter(o=>!i.has(o));if(s.length===0){a.warn("No new episodes to add");return}r.episodeIds.push(...s),r.updatedAt=new Date,await this.playlistStore.savePlaylist(r),a.info(`Added ${s.length} episodes to playlist`),this.app&&this.app.workspace.trigger("podcast:playlist-updated",t),a.methodExit("PlaylistManager","addEpisodes")}async removeEpisode(t,e){a.methodEntry("PlaylistManager","removeEpisode",`${t}, ${e}`);let r=await this.playlistStore.getPlaylist(t);if(!r)throw new Error(`Playlist not found: ${t}`);let i=r.episodeIds.indexOf(e);if(i===-1){a.warn("Episode not found in playlist",e);return}r.episodeIds.splice(i,1),r.updatedAt=new Date,await this.playlistStore.savePlaylist(r),a.info("Episode removed from playlist",e),this.app&&this.app.workspace.trigger("podcast:playlist-updated",t),a.methodExit("PlaylistManager","removeEpisode")}async removeEpisodes(t,e){a.methodEntry("PlaylistManager","removeEpisodes",`${t}, count=${e.length}`);let r=await this.playlistStore.getPlaylist(t);if(!r)throw new Error(`Playlist not found: ${t}`);let i=new Set(e);r.episodeIds=r.episodeIds.filter(s=>!i.has(s)),r.updatedAt=new Date,await this.playlistStore.savePlaylist(r),a.info(`Removed ${e.length} episodes from playlist`),this.app&&this.app.workspace.trigger("podcast:playlist-updated",t),a.methodExit("PlaylistManager","removeEpisodes")}async reorderEpisodes(t,e){a.methodEntry("PlaylistManager","reorderEpisodes",t);let r=await this.playlistStore.getPlaylist(t);if(!r)throw new Error(`Playlist not found: ${t}`);let i=new Set(r.episodeIds);if(!e.every(o=>i.has(o)))throw new Error("Invalid episode IDs in reorder request");r.episodeIds=e,r.updatedAt=new Date,await this.playlistStore.savePlaylist(r),a.info("Playlist episodes reordered"),this.app&&this.app.workspace.trigger("podcast:playlist-updated",t),a.methodExit("PlaylistManager","reorderEpisodes")}async moveEpisode(t,e,r){a.methodEntry("PlaylistManager","moveEpisode",`${t}, ${e}, to=${r}`);let i=await this.playlistStore.getPlaylist(t);if(!i)throw new Error(`Playlist not found: ${t}`);let s=i.episodeIds.indexOf(e);if(s===-1)throw new Error(`Episode not found in playlist: ${e}`);i.episodeIds.splice(s,1);let o=Math.max(0,Math.min(r,i.episodeIds.length));i.episodeIds.splice(o,0,e),i.updatedAt=new Date,await this.playlistStore.savePlaylist(i),a.info("Episode moved in playlist"),this.app&&this.app.workspace.trigger("podcast:playlist-updated",t),a.methodExit("PlaylistManager","moveEpisode")}async clearPlaylist(t){a.methodEntry("PlaylistManager","clearPlaylist",t);let e=await this.playlistStore.getPlaylist(t);if(!e)throw new Error(`Playlist not found: ${t}`);e.episodeIds=[],e.updatedAt=new Date,await this.playlistStore.savePlaylist(e),a.info("Playlist cleared"),this.app&&this.app.workspace.trigger("podcast:playlist-updated",t),a.methodExit("PlaylistManager","clearPlaylist")}async getEpisodeCount(t){let e=await this.playlistStore.getPlaylist(t);return e?e.episodeIds.length:0}async hasEpisode(t,e){let r=await this.playlistStore.getPlaylist(t);return r?r.episodeIds.includes(e):!1}async searchPlaylists(t){a.methodEntry("PlaylistManager","searchPlaylists",t);let e=await this.getAllPlaylists(),r=t.toLowerCase(),i=e.filter(s=>{var l;let o=s.name.toLowerCase().includes(r),n=(l=s.description)==null?void 0:l.toLowerCase().includes(r);return o||n});return a.methodExit("PlaylistManager","searchPlaylists",`results=${i.length}`),i}async duplicatePlaylist(t,e){a.methodEntry("PlaylistManager","duplicatePlaylist",t);let r=await this.playlistStore.getPlaylist(t);if(!r)throw new Error(`Playlist not found: ${t}`);let i=e||`${r.name} (Copy)`,s=await this.createPlaylist(i,r.description,r.imageUrl);return s.episodeIds=[...r.episodeIds],await this.playlistStore.savePlaylist(s),a.info("Playlist duplicated",s.id),a.methodExit("PlaylistManager","duplicatePlaylist"),s}async mergePlaylists(t,e){a.methodEntry("PlaylistManager","mergePlaylists",`count=${t.length}`);let r=[];for(let o of t){let n=await this.playlistStore.getPlaylist(o);n&&r.push(...n.episodeIds)}let i=Array.from(new Set(r)),s=await this.createPlaylist(e);return s.episodeIds=i,await this.playlistStore.savePlaylist(s),a.info("Playlists merged",s.id),a.methodExit("PlaylistManager","mergePlaylists"),s}async getPlaylistCount(){return await this.playlistStore.getCount()}generatePlaylistId(t){let e=Date.now(),r=Math.random().toString(36).substring(2,8);return`playlist-${e}-${r}`}async exportPlaylist(t){let e=await this.playlistStore.getPlaylist(t);if(!e)throw new Error(`Playlist not found: ${t}`);return e}async importPlaylist(t){return a.methodEntry("PlaylistManager","importPlaylist",t.id),await this.playlistStore.exists(t.id)&&(t.id=this.generatePlaylistId(t.name)),await this.playlistStore.savePlaylist(t),a.info("Playlist imported",t.id),a.methodExit("PlaylistManager","importPlaylist"),t}};var gt=class extends Pe{constructor(t,e){let r=e.getStructure().queues;super(t,e,r)}async loadItem(t,e){let r=await super.loadItem(t,e);return r&&(typeof r.createdAt=="string"&&(r.createdAt=new Date(r.createdAt)),typeof r.updatedAt=="string"&&(r.updatedAt=new Date(r.updatedAt))),r}validate(t){if(!Array.isArray(t))return a.warn("Invalid queue data: not an array"),!1;for(let e of t)if(!this.validateQueue(e))return a.warn("Invalid queue",e),!1;return!0}validateQueue(t){if(!t||typeof t!="object")return!1;let e=["id","name","episodeIds","currentIndex","autoPlayNext","shuffle","repeat","createdAt","updatedAt"];for(let r of e)if(!(r in t))return a.warn(`Missing required field in queue: ${r}`),!1;return Array.isArray(t.episodeIds)?typeof t.currentIndex!="number"?(a.warn("Queue currentIndex is not a number"),!1):typeof t.autoPlayNext!="boolean"?(a.warn("Queue autoPlayNext is not a boolean"),!1):typeof t.shuffle!="boolean"?(a.warn("Queue shuffle is not a boolean"),!1):["none","one","all"].includes(t.repeat)?!0:(a.warn("Queue repeat has invalid value"),!1):(a.warn("Queue episodeIds is not an array"),!1)}getDefaultValue(){return[]}async loadAllItems(){let t=await this.listItemIds(),e=[];for(let r of t)try{let i=await this.loadItem(r,{});i&&this.validateQueue(i)&&e.push(i)}catch(i){a.warn(`Failed to load queue: ${r}`,i)}return e}async load(){a.methodEntry("QueueStore","load");let t=await this.loadAllItems();return a.methodExit("QueueStore","load"),t}async save(t){if(a.methodEntry("QueueStore","save"),!this.validate(t))throw new _("Invalid queue data",this.dirPath);await this.clear();for(let e of t)await this.saveItem(e.id,e);a.methodExit("QueueStore","save")}async getQueue(t){a.methodEntry("QueueStore","getQueue",t);try{let e=await this.loadItem(t,{});return!e||!this.validateQueue(e)?(a.methodExit("QueueStore","getQueue","invalid"),null):(a.methodExit("QueueStore","getQueue"),e)}catch(e){return a.warn("Failed to get queue",e),a.methodExit("QueueStore","getQueue","error"),null}}async saveQueue(t){if(a.methodEntry("QueueStore","saveQueue",t.id),!this.validateQueue(t))throw new _("Invalid queue data",`${this.dirPath}/${t.id}.json`);await this.saveItem(t.id,t),a.methodExit("QueueStore","saveQueue")}async deleteQueue(t){a.methodEntry("QueueStore","deleteQueue",t),await this.deleteItem(t),a.methodExit("QueueStore","deleteQueue")}async exists(t){return await this.getQueue(t)!==null}async getAllIds(){return await this.listItemIds()}async getCount(){return(await this.listItemIds()).length}async clear(){a.methodEntry("QueueStore","clear");let t=await this.listItemIds();for(let e of t)await this.deleteItem(e);a.info("All queues cleared"),a.methodExit("QueueStore","clear")}};var mt=class{constructor(t,e){this.currentQueueId=null;this.queueStore=t,this.app=e}async createQueue(t){a.methodEntry("QueueManager","createQueue",t);let e=this.generateQueueId(t),r=new Date,i={id:e,name:t,episodeIds:[],currentIndex:0,autoPlayNext:!0,shuffle:!1,repeat:"none",createdAt:r,updatedAt:r};return await this.queueStore.saveQueue(i),a.info("Queue created",e),a.methodExit("QueueManager","createQueue"),i}async getQueue(t){a.methodEntry("QueueManager","getQueue",t);let e=await this.queueStore.getQueue(t);return a.methodExit("QueueManager","getQueue"),e}async getAllQueues(){a.methodEntry("QueueManager","getAllQueues");let t=await this.queueStore.load();return t.sort((e,r)=>r.updatedAt.getTime()-e.updatedAt.getTime()),a.methodExit("QueueManager","getAllQueues"),t}async updateQueue(t,e){a.methodEntry("QueueManager","updateQueue",t);let r=await this.queueStore.getQueue(t);if(!r)throw new Error(`Queue not found: ${t}`);let i={...r,...e,id:r.id,createdAt:r.createdAt,updatedAt:new Date};await this.queueStore.saveQueue(i),this.app&&this.app.workspace.trigger("podcast:queue-updated",t),a.methodExit("QueueManager","updateQueue")}async deleteQueue(t){a.methodEntry("QueueManager","deleteQueue",t),await this.queueStore.deleteQueue(t),this.currentQueueId===t&&(this.currentQueueId=null),a.info("Queue deleted",t),a.methodExit("QueueManager","deleteQueue")}setCurrentQueue(t){a.methodEntry("QueueManager","setCurrentQueue",t),this.currentQueueId=t,a.methodExit("QueueManager","setCurrentQueue")}async getCurrentQueue(){return this.currentQueueId?await this.getQueue(this.currentQueueId):null}async addEpisode(t,e){a.methodEntry("QueueManager","addEpisode",`${t}, ${e}`);let r=await this.queueStore.getQueue(t);if(!r)throw new Error(`Queue not found: ${t}`);if(r.episodeIds.includes(e)){a.info("Episode already in queue, skipping add",e),a.methodExit("QueueManager","addEpisode","duplicate");return}r.episodeIds.push(e),r.updatedAt=new Date,await this.queueStore.saveQueue(r),a.info("Episode added to queue",e),this.app&&this.app.workspace.trigger("podcast:queue-updated",t),a.methodExit("QueueManager","addEpisode")}async addEpisodes(t,e){a.methodEntry("QueueManager","addEpisodes",`${t}, count=${e.length}`);let r=await this.queueStore.getQueue(t);if(!r)throw new Error(`Queue not found: ${t}`);let i=e.filter(s=>!r.episodeIds.includes(s));if(i.length===0){a.info("All episodes already in queue, skipping"),a.methodExit("QueueManager","addEpisodes","all duplicates");return}r.episodeIds.push(...i),r.updatedAt=new Date,await this.queueStore.saveQueue(r),a.info(`Added ${i.length} episodes to queue`),this.app&&this.app.workspace.trigger("podcast:queue-updated",t),a.methodExit("QueueManager","addEpisodes")}async insertEpisode(t,e,r){a.methodEntry("QueueManager","insertEpisode",`${t}, ${e}, index=${r}`);let i=await this.queueStore.getQueue(t);if(!i)throw new Error(`Queue not found: ${t}`);let s=i.episodeIds.indexOf(e);s!==-1&&i.episodeIds.splice(s,1);let o=Math.max(0,Math.min(r,i.episodeIds.length));i.episodeIds.splice(o,0,e),i.updatedAt=new Date,await this.queueStore.saveQueue(i),a.info("Episode inserted into queue",e),this.app&&this.app.workspace.trigger("podcast:queue-updated",t),a.methodExit("QueueManager","insertEpisode")}async removeEpisode(t,e){a.methodEntry("QueueManager","removeEpisode",`${t}, ${e}`);let r=await this.queueStore.getQueue(t);if(!r)throw new Error(`Queue not found: ${t}`);let i=r.episodeIds.indexOf(e);if(i===-1){a.warn("Episode not found in queue",e);return}r.episodeIds.splice(i,1),i<r.currentIndex?r.currentIndex=Math.max(0,r.currentIndex-1):i===r.currentIndex&&(r.currentIndex=Math.min(r.currentIndex,r.episodeIds.length-1)),r.updatedAt=new Date,await this.queueStore.saveQueue(r),a.info("Episode removed from queue",e),this.app&&this.app.workspace.trigger("podcast:queue-updated",t),a.methodExit("QueueManager","removeEpisode")}async clearQueue(t){a.methodEntry("QueueManager","clearQueue",t);let e=await this.queueStore.getQueue(t);if(!e)throw new Error(`Queue not found: ${t}`);e.episodeIds=[],e.currentIndex=0,e.updatedAt=new Date,await this.queueStore.saveQueue(e),a.info("Queue cleared"),this.app&&this.app.workspace.trigger("podcast:queue-updated",t),a.methodExit("QueueManager","clearQueue")}async getCurrentEpisodeId(t){let e=await this.queueStore.getQueue(t);return!e||e.episodeIds.length===0||e.currentIndex<0||e.currentIndex>=e.episodeIds.length?null:e.episodeIds[e.currentIndex]}async next(t){a.methodEntry("QueueManager","next",t);let e=await this.queueStore.getQueue(t);if(!e||e.episodeIds.length===0)return a.methodExit("QueueManager","next","no queue or empty"),null;if(e.repeat==="one")return a.methodExit("QueueManager","next","repeat one"),e.episodeIds[e.currentIndex];if(e.currentIndex++,e.currentIndex>=e.episodeIds.length)if(e.repeat==="all")e.currentIndex=0;else return e.currentIndex=e.episodeIds.length-1,await this.queueStore.saveQueue(e),a.methodExit("QueueManager","next","end of queue"),null;e.updatedAt=new Date,await this.queueStore.saveQueue(e);let r=e.episodeIds[e.currentIndex];return a.info("Moved to next episode",r),a.methodExit("QueueManager","next"),r}async nextAndRemovePlayed(t){a.methodEntry("QueueManager","nextAndRemovePlayed",t);let e=await this.queueStore.getQueue(t);if(!e||e.episodeIds.length===0)return a.methodExit("QueueManager","nextAndRemovePlayed","no queue or empty"),null;if(e.repeat==="one")return a.methodExit("QueueManager","nextAndRemovePlayed","repeat one"),e.episodeIds[e.currentIndex];if(e.isPlaylist){if(e.currentIndex++,e.currentIndex>=e.episodeIds.length)if(e.repeat==="all")e.currentIndex=0;else return e.currentIndex=0,e.updatedAt=new Date,await this.queueStore.saveQueue(e),a.methodExit("QueueManager","nextAndRemovePlayed","end of playlist"),null;return e.updatedAt=new Date,await this.queueStore.saveQueue(e),e.episodeIds[e.currentIndex]}let r=e.episodeIds[e.currentIndex];if(e.episodeIds.splice(e.currentIndex,1),e.episodeIds.length===0)return e.currentIndex=0,e.updatedAt=new Date,await this.queueStore.saveQueue(e),a.info("Queue is now empty after removing played episode",r),a.methodExit("QueueManager","nextAndRemovePlayed","queue empty"),null;if(e.currentIndex>=e.episodeIds.length)if(e.repeat==="all")e.currentIndex=0;else return e.currentIndex=0,e.updatedAt=new Date,await this.queueStore.saveQueue(e),a.info("End of queue, removed played episode",r),a.methodExit("QueueManager","nextAndRemovePlayed","end of queue"),null;e.updatedAt=new Date,await this.queueStore.saveQueue(e);let i=e.episodeIds[e.currentIndex];return a.info("Moved to next episode and removed played",{played:r,next:i}),a.methodExit("QueueManager","nextAndRemovePlayed"),i}async previous(t){a.methodEntry("QueueManager","previous",t);let e=await this.queueStore.getQueue(t);if(!e||e.episodeIds.length===0)return a.methodExit("QueueManager","previous","no queue or empty"),null;if(e.repeat==="one")return a.methodExit("QueueManager","previous","repeat one"),e.episodeIds[e.currentIndex];e.currentIndex--,e.currentIndex<0&&(e.repeat==="all"?e.currentIndex=e.episodeIds.length-1:e.currentIndex=0),e.updatedAt=new Date,await this.queueStore.saveQueue(e);let r=e.episodeIds[e.currentIndex];return a.info("Moved to previous episode",r),a.methodExit("QueueManager","previous"),r}async jumpTo(t,e){a.methodEntry("QueueManager","jumpTo",`${t}, index=${e}`);let r=await this.queueStore.getQueue(t);if(!r||r.episodeIds.length===0)return a.methodExit("QueueManager","jumpTo","no queue or empty"),null;if(e<0||e>=r.episodeIds.length)return a.warn("Invalid index",e),a.methodExit("QueueManager","jumpTo","invalid index"),null;r.currentIndex=e,r.updatedAt=new Date,await this.queueStore.saveQueue(r);let i=r.episodeIds[r.currentIndex];return a.info("Jumped to episode",i),this.app&&this.app.workspace.trigger("podcast:queue-updated",t),a.methodExit("QueueManager","jumpTo"),i}async moveEpisode(t,e,r){a.methodEntry("QueueManager","moveEpisode",`${t}, ${e} -> ${r}`);let i=await this.queueStore.getQueue(t);if(!i)throw new Error(`Queue not found: ${t}`);if(e<0||e>=i.episodeIds.length||r<0||r>=i.episodeIds.length){a.warn("Invalid index",e,r);return}let s=i.episodeIds[e];i.episodeIds.splice(e,1),i.episodeIds.splice(r,0,s),i.currentIndex===e?i.currentIndex=r:i.currentIndex>e&&i.currentIndex<=r?i.currentIndex--:i.currentIndex<e&&i.currentIndex>=r&&i.currentIndex++,i.updatedAt=new Date,await this.queueStore.saveQueue(i),a.info("Episode moved",s),this.app&&this.app.workspace.trigger("podcast:queue-updated",t),a.methodExit("QueueManager","moveEpisode")}async toggleShuffle(t){a.methodEntry("QueueManager","toggleShuffle",t);let e=await this.queueStore.getQueue(t);if(!e)throw new Error(`Queue not found: ${t}`);if(e.shuffle=!e.shuffle,e.updatedAt=new Date,e.shuffle&&e.episodeIds.length>0){let r=e.episodeIds[e.currentIndex];this.shuffleArray(e.episodeIds),e.currentIndex=e.episodeIds.indexOf(r)}return await this.queueStore.saveQueue(e),a.info("Shuffle toggled",e.shuffle),a.methodExit("QueueManager","toggleShuffle"),e.shuffle}async setRepeat(t,e){a.methodEntry("QueueManager","setRepeat",`${t}, ${e}`);let r=await this.queueStore.getQueue(t);if(!r)throw new Error(`Queue not found: ${t}`);r.repeat=e,r.updatedAt=new Date,await this.queueStore.saveQueue(r),a.info("Repeat mode set",e),a.methodExit("QueueManager","setRepeat")}async cycleRepeat(t){let e=await this.queueStore.getQueue(t);if(!e)throw new Error(`Queue not found: ${t}`);let r=e.repeat==="none"?"one":e.repeat==="one"?"all":"none";return await this.setRepeat(t,r),r}async setAutoPlayNext(t,e){a.methodEntry("QueueManager","setAutoPlayNext",`${t}, ${e}`);let r=await this.queueStore.getQueue(t);if(!r)throw new Error(`Queue not found: ${t}`);r.autoPlayNext=e,r.updatedAt=new Date,await this.queueStore.saveQueue(r),a.info("Auto play next set",e),a.methodExit("QueueManager","setAutoPlayNext")}async getEpisodeCount(t){let e=await this.queueStore.getQueue(t);return e?e.episodeIds.length:0}async hasNext(t){let e=await this.queueStore.getQueue(t);return!e||e.episodeIds.length===0?!1:e.repeat!=="none"?!0:e.currentIndex<e.episodeIds.length-1}async hasPrevious(t){let e=await this.queueStore.getQueue(t);return!e||e.episodeIds.length===0?!1:e.repeat==="all"?!0:e.currentIndex>0}async getQueueCount(){return await this.queueStore.getCount()}generateQueueId(t){let e=Date.now(),r=Math.random().toString(36).substring(2,8);return`queue-${e}-${r}`}shuffleArray(t){for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}}};var _s=kt(Ar());var je=class{constructor(){this.parser=new _s.default({customFields:{feed:["itunes:image","itunes:author","itunes:summary","itunes:category","itunes:owner"],item:["itunes:image","itunes:duration","itunes:episode","itunes:season","itunes:episodeType","itunes:author","itunes:summary"]}})}async parseFromString(t,e){a.methodEntry("RSSParser","parseFromString",e);try{let r=await this.parser.parseString(t),i=this.extractPodcastData(r,e),s=this.extractEpisodesData(r,i.id);return a.info(`Parsed RSS feed: ${i.title}, ${s.length} episodes`),a.methodExit("RSSParser","parseFromString"),{podcast:i,episodes:s}}catch(r){throw a.error("Failed to parse RSS feed",r),new ue("Failed to parse RSS feed",e,r)}}async parseFromUrl(t){a.methodEntry("RSSParser","parseFromUrl",t);try{let e=await this.parser.parseURL(t),r=this.extractPodcastData(e,t),i=this.extractEpisodesData(e,r.id);return a.info(`Parsed RSS feed: ${r.title}, ${i.length} episodes`),a.methodExit("RSSParser","parseFromUrl"),{podcast:r,episodes:i}}catch(e){throw a.error("Failed to parse RSS feed from URL",e),new ue("Failed to parse RSS feed from URL",t,e)}}extractPodcastData(t,e){var m,d,v,D,I,T,F,w,y,g,E,x,b,k,S,M;let r=this.generatePodcastId(e),i=((m=t.title)==null?void 0:m.trim())||"Untitled Podcast",s=((v=(d=t.itunes)==null?void 0:d.author)==null?void 0:v.trim())||((T=(I=(D=t.itunes)==null?void 0:D.owner)==null?void 0:I.name)==null?void 0:T.trim())||"Unknown Author",o=((w=(F=t.itunes)==null?void 0:F.summary)==null?void 0:w.trim())||((y=t.description)==null?void 0:y.trim())||"No description available",n;typeof((g=t.itunes)==null?void 0:g.image)=="string"?n=t.itunes.image:(E=t.itunes)!=null&&E.image&&typeof t.itunes.image=="object"&&"href"in t.itunes.image?n=t.itunes.image.href:(x=t.image)!=null&&x.url&&(n=t.image.url);let l=(b=t.link)==null?void 0:b.trim(),c=(S=(k=t.itunes)==null?void 0:k.categories)==null?void 0:S.filter(L=>typeof L=="string"),p=(M=t.language)==null?void 0:M.trim();return{id:r,title:i,author:s,description:o,feedUrl:e,imageUrl:n,websiteUrl:l,categories:c,language:p,subscribedAt:new Date,lastFetchedAt:new Date}}extractEpisodesData(t,e){if(!t.items||t.items.length===0)return a.warn("No episodes found in RSS feed"),[];let r=[];for(let i of t.items)try{let s=this.extractEpisodeData(i,e);s&&r.push(s)}catch(s){a.warn("Failed to parse episode, skipping",s)}return r}extractEpisodeData(t,e){var I,T,F,w,y,g,E,x,b,k,S,M,L,q;if(!((I=t.enclosure)!=null&&I.url))return a.warn("Episode missing audio URL, skipping"),null;let r=t.enclosure.url.trim(),i=this.generateEpisodeId(t.guid||r),s=((T=t.title)==null?void 0:T.trim())||"Untitled Episode",o=((w=(F=t.itunes)==null?void 0:F.summary)==null?void 0:w.trim())||((y=t.content)==null?void 0:y.trim())||((g=t.description)==null?void 0:g.trim())||"No description available",n=this.parseDuration((E=t.itunes)==null?void 0:E.duration),l=t.pubDate?new Date(t.pubDate):new Date,c=(x=t.itunes)!=null&&x.episode?parseInt(t.itunes.episode,10):void 0,p=(b=t.itunes)!=null&&b.season?parseInt(t.itunes.season,10):void 0,h;if((k=t.itunes)!=null&&k.episodeType){let B=t.itunes.episodeType.toLowerCase();(B==="full"||B==="trailer"||B==="bonus")&&(h=B)}let m;typeof((S=t.itunes)==null?void 0:S.image)=="string"?m=t.itunes.image:(M=t.itunes)!=null&&M.image&&typeof t.itunes.image=="object"&&"href"in t.itunes.image&&(m=t.itunes.image.href);let d=t.enclosure.length?parseInt(t.enclosure.length,10):void 0,v=(L=t.enclosure.type)==null?void 0:L.trim();return{id:i,podcastId:e,title:s,description:o,audioUrl:r,duration:n,publishDate:l,episodeNumber:c,seasonNumber:p,episodeType:h,imageUrl:m,fileSize:d,mimeType:v,guid:(q=t.guid)==null?void 0:q.trim()}}parseDuration(t){if(!t)return 0;let e=t.trim(),r=parseInt(e,10);if(!isNaN(r)&&e===r.toString())return r;let i=e.split(":").map(s=>parseInt(s,10));if(i.some(isNaN))return a.warn(`Invalid duration format: ${t}`),0;if(i.length===3){let[s,o,n]=i;return s*3600+o*60+n}else if(i.length===2){let[s,o]=i;return s*60+o}else if(i.length===1)return i[0];return a.warn(`Invalid duration format: ${t}`),0}generatePodcastId(t){let e=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);e=(e<<5)-e+i,e=e&e}return`podcast-${Math.abs(e).toString(36)}`}generateEpisodeId(t){let e=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);e=(e<<5)-e+i,e=e&e}return`episode-${Math.abs(e).toString(36)}`}static validateXML(t){if(!t||typeof t!="string")return!1;let e=t.trim();return!(!e.startsWith("<?xml")&&!e.startsWith("<rss")||!e.includes("<rss"))}};var Us=kt(Ar());var He=class{constructor(){this.parser=new Us.default({customFields:{feed:["subtitle","author"],item:["summary","author"]}})}async parseFromString(t,e){a.methodEntry("AtomParser","parseFromString",e);try{let r=await this.parser.parseString(t),i=this.extractPodcastData(r,e),s=this.extractEpisodesData(r,i.id);return a.info(`Parsed Atom feed: ${i.title}, ${s.length} episodes`),a.methodExit("AtomParser","parseFromString"),{podcast:i,episodes:s}}catch(r){throw a.error("Failed to parse Atom feed",r),new ue("Failed to parse Atom feed",e,r)}}async parseFromUrl(t){a.methodEntry("AtomParser","parseFromUrl",t);try{let e=await this.parser.parseURL(t),r=this.extractPodcastData(e,t),i=this.extractEpisodesData(e,r.id);return a.info(`Parsed Atom feed: ${r.title}, ${i.length} episodes`),a.methodExit("AtomParser","parseFromUrl"),{podcast:r,episodes:i}}catch(e){throw a.error("Failed to parse Atom feed from URL",e),new ue("Failed to parse Atom feed from URL",t,e)}}extractPodcastData(t,e){var h,m,d,v,D,I,T;let r=this.generatePodcastId(e),i=((h=t.title)==null?void 0:h.trim())||"Untitled Podcast",s=((m=t.author)==null?void 0:m.trim())||"Unknown Author",o=((d=t.subtitle)==null?void 0:d.trim())||"No description available",n=(D=(v=t.image)==null?void 0:v.url)==null?void 0:D.trim(),l=(I=t.link)==null?void 0:I.trim(),c=(T=t.language)==null?void 0:T.trim();return{id:r,title:i,author:s,description:o,feedUrl:e,imageUrl:n,websiteUrl:l,language:c,subscribedAt:new Date,lastFetchedAt:new Date}}extractEpisodesData(t,e){if(!t.items||t.items.length===0)return a.warn("No episodes found in Atom feed"),[];let r=[];for(let i of t.items)try{let s=this.extractEpisodeData(i,e);s&&r.push(s)}catch(s){a.warn("Failed to parse episode, skipping",s)}return r}extractEpisodeData(t,e){var m,d,v,D,I,T;if(!((m=t.enclosure)!=null&&m.url))return a.warn("Episode missing audio URL, skipping"),null;let r=t.enclosure.url.trim(),i=this.generateEpisodeId(t.id||r),s=((d=t.title)==null?void 0:d.trim())||"Untitled Episode",o=((v=t.content)==null?void 0:v.trim())||((D=t.summary)==null?void 0:D.trim())||"No description available",n=0,l=t.pubDate?new Date(t.pubDate):new Date,c=t.enclosure.length?parseInt(t.enclosure.length,10):void 0,p=(I=t.enclosure.type)==null?void 0:I.trim();return{id:i,podcastId:e,title:s,description:o,audioUrl:r,duration:n,publishDate:l,fileSize:c,mimeType:p,guid:(T=t.id)==null?void 0:T.trim()}}generatePodcastId(t){let e=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);e=(e<<5)-e+i,e=e&e}return`podcast-${Math.abs(e).toString(36)}`}generateEpisodeId(t){let e=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);e=(e<<5)-e+i,e=e&e}return`episode-${Math.abs(e).toString(36)}`}static validateXML(t){if(!t||typeof t!="string")return!1;let e=t.trim();return!(!e.startsWith("<?xml")&&!e.startsWith("<feed")||!e.includes("<feed")||!e.includes('xmlns="http://www.w3.org/2005/Atom"'))}};var Vs=require("obsidian");var js=kt(require("https")),Hs=kt(require("url"));var Me=class{constructor(t){this.cacheStore=null;this.rssParser=new je,this.atomParser=new He,this.cacheStore=t||null}async fetchFeed(t,e={}){a.methodEntry("FeedService","fetchFeed",t);let{useCache:r=!0,cacheTTL:i=36e5,timeout:s=3e4,userAgent:o="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",etag:n,lastModified:l}=e;if(r&&this.cacheStore){let v=await this.getCachedFeed(t);if(v)return a.info("Using cached feed data"),a.methodExit("FeedService","fetchFeed","from cache"),v}let{xml:c,responseEtag:p,responseLastModified:h}=await this.fetchFeedXML(t,s,o,n,l),m=this.detectFeedType(c),d;if(m==="rss")d=await this.rssParser.parseFromString(c,t);else if(m==="atom")d=await this.atomParser.parseFromString(c,t);else try{d=await this.rssParser.parseFromString(c,t)}catch(v){d=await this.atomParser.parseFromString(c,t)}return this.cacheStore&&await this.cacheFeed(t,c,i,{etag:p,lastModified:h}),a.methodExit("FeedService","fetchFeed"),d}async updateFeed(t){var o;a.methodEntry("FeedService","updateFeed",t.id);let{podcast:e,episodes:r}=await this.fetchFeed(t.feedUrl,{useCache:!1}),i=new Set(((o=t.episodes)==null?void 0:o.map(n=>n.id))||[]),s=r.filter(n=>!i.has(n.id));return a.info(`Feed updated: ${s.length} new episodes`),a.methodExit("FeedService","updateFeed"),{podcast:e,episodes:r,newEpisodes:s}}async fetchFeedXML(t,e,r,i,s){a.debug("Fetching feed XML",t);try{let o=await At(async()=>{let p={Accept:"application/rss+xml, application/atom+xml, application/xml, text/xml","Accept-Language":"en-US,en;q=0.9"};r&&r!=="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"&&(p["User-Agent"]=r),i&&(p["If-None-Match"]=i),s&&(p["If-Modified-Since"]=s);let m=await(0,Vs.requestUrl)({url:t,method:"GET",headers:p,throw:!1});if(m.status===304)throw new Error("NOT_MODIFIED");if(m.status>=400)throw new de(`HTTP ${m.status}: Failed to fetch feed`,t);return m},{maxRetries:3,initialDelay:1e3,maxDelay:1e4}),n=o.text,l=o.headers.etag,c=o.headers["last-modified"];return{xml:n,responseEtag:l,responseLastModified:c}}catch(o){if(o instanceof Error&&o.message==="NOT_MODIFIED")throw o;a.warn(`requestUrl failed for ${t}, trying fallback to fetch`,o);try{let n=await fetch(t);if(!n.ok)throw new Error(`Fetch returned status ${n.status}`);let l=await n.text(),c=n.headers.get("etag")||void 0,p=n.headers.get("last-modified")||void 0;return{xml:l,responseEtag:c,responseLastModified:p}}catch(n){a.warn("fetch fallback failed, trying Node https",n);try{return await new Promise((l,c)=>{let p=new Hs.URL(t),h={hostname:p.hostname,path:p.pathname+p.search,method:"GET",headers:{"User-Agent":r||"Obsidian/1.0.0",Accept:"*/*"},rejectUnauthorized:!1},m=js.request(h,d=>{let v="";d.on("data",D=>{v+=D}),d.on("end",()=>{d.statusCode&&d.statusCode>=200&&d.statusCode<300?l({xml:v,responseEtag:d.headers.etag,responseLastModified:d.headers["last-modified"]}):c(new Error(`HTTPS Node request returned status ${d.statusCode}`))})});m.on("error",d=>{c(d)}),m.end()})}catch(l){throw a.error("All fetch methods failed",l),new de("Failed to fetch feed",t,l)}}}}detectFeedType(t){let e=t.trim().toLowerCase();return e.includes("<rss")?"rss":e.includes("<feed")&&e.includes('xmlns="http://www.w3.org/2005/atom"')?"atom":je.validateXML(t)?"rss":He.validateXML(t)?"atom":"unknown"}async getCachedFeed(t){if(!this.cacheStore)return null;try{let e=await this.cacheStore.getCacheEntry(t);if(!e)return null;let r=this.detectFeedType(e.data);return r==="rss"?await this.rssParser.parseFromString(e.data,t):r==="atom"?await this.atomParser.parseFromString(e.data,t):null}catch(e){return a.warn("Failed to get cached feed",e),null}}async cacheFeed(t,e,r,i){if(this.cacheStore)try{await this.cacheStore.setCacheEntry(t,e,r,i),a.debug("Feed cached successfully")}catch(s){a.warn("Failed to cache feed",s)}}async clearCache(t){this.cacheStore&&(t?(await this.cacheStore.removeCacheEntry(t),a.info("Feed cache cleared",t)):(await this.cacheStore.clear(),a.info("All feed caches cleared")))}static validateFeedUrl(t){try{let e=new URL(t);return e.protocol==="http:"||e.protocol==="https:"}catch(e){return!1}}};var Lr=require("obsidian"),Pt=class{constructor(t,e,r,i,s=36e5){this.syncTimer=null;this.isSyncing=!1;this.lastSyncTime=null;this.feedService=t,this.subscriptionStore=e,this.queueManager=r,this.playlistManager=i,this.syncInterval=s}startAutoSync(){if(a.methodEntry("FeedSyncManager","startAutoSync"),this.syncTimer){a.warn("Auto sync already running");return}this.syncAll({force:!1}).catch(t=>{a.error("Initial sync failed",t)}),this.syncTimer=setInterval(()=>{this.syncAll({force:!1}).catch(t=>{a.error("Auto sync failed",t)})},this.syncInterval),a.info(`Auto sync started (interval: ${this.syncInterval}ms)`),a.methodExit("FeedSyncManager","startAutoSync")}stopAutoSync(){a.methodEntry("FeedSyncManager","stopAutoSync"),this.syncTimer&&(clearInterval(this.syncTimer),this.syncTimer=null,a.info("Auto sync stopped")),a.methodExit("FeedSyncManager","stopAutoSync")}async syncAll(t={}){if(a.methodEntry("FeedSyncManager","syncAll"),this.isSyncing)throw a.warn("Sync already in progress"),new Error("Sync already in progress");this.isSyncing=!0;let e=new Date;try{let{force:r=!1,concurrency:i=3,updateInterval:s=this.syncInterval}=t,o=await this.subscriptionStore.getAllPodcasts(),n=r?o:o.filter(h=>this.shouldUpdate(h,s));a.info(`Syncing ${n.length} of ${o.length} podcasts`);let l=await this.batchUpdate(n,i),c=new Date,p={totalPodcasts:n.length,successCount:l.filter(h=>h.success).length,failureCount:l.filter(h=>!h.success).length,totalNewEpisodes:l.reduce((h,m)=>h+m.newEpisodesCount,0),results:l,startedAt:e,completedAt:c};return this.lastSyncTime=c,a.info(`Sync completed: ${p.successCount} succeeded, ${p.failureCount} failed, ${p.totalNewEpisodes} new episodes`),a.methodExit("FeedSyncManager","syncAll"),p}finally{this.isSyncing=!1}}async syncPodcasts(t,e={}){if(a.methodEntry("FeedSyncManager","syncPodcasts",`count=${t.length}`),this.isSyncing)throw a.warn("Sync already in progress"),new Error("Sync already in progress");this.isSyncing=!0;let r=new Date;try{let{concurrency:i=3}=e,s=[];for(let c of t){let p=await this.subscriptionStore.getPodcast(c);p&&s.push(p)}a.info(`Syncing ${s.length} specific podcasts`);let o=await this.batchUpdate(s,i),n=new Date,l={totalPodcasts:s.length,successCount:o.filter(c=>c.success).length,failureCount:o.filter(c=>!c.success).length,totalNewEpisodes:o.reduce((c,p)=>c+p.newEpisodesCount,0),results:o,startedAt:r,completedAt:n};return a.info(`Sync completed: ${l.successCount} succeeded, ${l.failureCount} failed`),a.methodExit("FeedSyncManager","syncPodcasts"),l}finally{this.isSyncing=!1}}async syncPodcast(t){a.methodEntry("FeedSyncManager","syncPodcast",t);let e=await this.subscriptionStore.getPodcast(t);if(!e)throw new Error(`Podcast not found: ${t}`);let r=await this.updatePodcast(e);return a.methodExit("FeedSyncManager","syncPodcast"),r}async batchUpdate(t,e){let r=[],i=[...t];for(;i.length>0;){let s=i.splice(0,e),o=await Promise.all(s.map(n=>this.updatePodcast(n)));r.push(...o),i.length>0&&await this.delay(1e3)}return r}async updatePodcast(t){a.debug(`Updating podcast: ${t.title}`);try{let{podcast:e,newEpisodes:r}=await this.feedService.updateFeed(t),i=t.episodes||[],s=[...r,...i],o=Array.from(new Map(s.map(n=>[n.id,n])).values());return o.sort((n,l)=>{let c=n.publishDate instanceof Date?n.publishDate:new Date(n.publishDate);return(l.publishDate instanceof Date?l.publishDate:new Date(l.publishDate)).getTime()-c.getTime()}),e.episodes=o,r.length>0&&t.autoAddRule&&t.autoAddRule.enabled&&await this.handleAutoAdd(t.autoAddRule,r),await this.subscriptionStore.updatePodcast(e),{podcastId:t.id,success:!0,newEpisodesCount:r.length}}catch(e){return a.error(`Failed to update podcast: ${t.title}`,e),{podcastId:t.id,success:!1,newEpisodesCount:0,error:e instanceof Error?e.message:"Unknown error"}}}async handleAutoAdd(t,e){try{let r=e.map(i=>i.id);if(t.targetType==="queue"){let i=await this.queueManager.getQueue(t.targetId);if(i){if(t.position==="top")for(let s=e.length-1;s>=0;s--)await this.queueManager.insertEpisode(t.targetId,e[s].id,0);else await this.queueManager.addEpisodes(t.targetId,r);new Lr.Notice(`Auto-added ${e.length} episodes to queue: ${i.name}`)}}else if(t.targetType==="playlist"){let i=await this.playlistManager.getPlaylist(t.targetId);if(i){if(t.position==="top"){let s=i.episodeIds,o=[...r,...s];await this.playlistManager.updatePlaylist(t.targetId,{episodeIds:o})}else await this.playlistManager.addEpisodes(t.targetId,r);new Lr.Notice(`Auto-added ${e.length} episodes to playlist: ${i.name}`)}}}catch(r){a.error("Failed to auto-add episodes",r)}}shouldUpdate(t,e){if(!t.lastFetchedAt)return!0;let r=Date.now(),i=new Date(t.lastFetchedAt).getTime();return r-i>=e}delay(t){return new Promise(e=>setTimeout(e,t))}getSyncStatus(){return{isSyncing:this.isSyncing,isAutoSyncEnabled:this.syncTimer!==null,lastSyncTime:this.lastSyncTime,syncInterval:this.syncInterval}}setSyncInterval(t){a.methodEntry("FeedSyncManager","setSyncInterval",t),this.syncInterval=t,this.syncTimer&&(this.stopAutoSync(),this.startAutoSync()),a.methodExit("FeedSyncManager","setSyncInterval")}};var Ws=require("obsidian");var Xs=require("obsidian"),De=class De{async searchPodcasts(t,e={}){if(a.methodEntry("iTunesSearchService","searchPodcasts",t),!t||t.trim().length===0)return a.warn("Empty search query"),[];let{limit:r=De.DEFAULT_LIMIT,country:i="US",includeExplicit:s=!0}=e,o=Math.min(Math.max(1,r),De.MAX_LIMIT);try{let n=this.buildSearchUrl(t.trim(),o,i,s);a.debug("Searching iTunes API",n);let c=(await At(async()=>{try{let h=await(0,Xs.requestUrl)({url:n,method:"GET",headers:{Accept:"application/json"},throw:!1});if(h.status!==200){if(h.status>=400&&h.status<500)return a.warn(`iTunes API returned status ${h.status}`),{status:h.status,json:{resultCount:0,results:[]},headers:{},arrayBuffer:new ArrayBuffer(0),text:""};throw new de(`iTunes API returned status ${h.status}`,n)}return h}catch(h){a.warn(`requestUrl failed for ${n}, trying fallback to fetch`,h);try{let m=await fetch(n);if(!m.ok)throw new Error(`Fetch returned status ${m.status}`);let d=await m.json();return{status:m.status,headers:{},arrayBuffer:await new Response(JSON.stringify(d)).arrayBuffer(),json:d,text:JSON.stringify(d)}}catch(m){throw a.error("Both requestUrl and fetch fallback failed",m),new de(`Failed to connect to iTunes API: ${m instanceof Error?m.message:"Unknown error"}`,n)}}},{maxRetries:2,initialDelay:1e3,maxDelay:5e3})).json;if(!c||!Array.isArray(c.results))return a.warn("Invalid iTunes API response format"),[];a.info(`Found ${c.resultCount} results`);let p=c.results.map(h=>this.transformResult(h));return a.methodExit("iTunesSearchService","searchPodcasts",`count=${p.length}`),p}catch(n){return a.error("iTunes search failed",n),n instanceof de&&a.debug("Network error details:",`message: ${n.message}, url: ${n.url}`),[]}}buildSearchUrl(t,e,r,i){let s=new URL(De.API_BASE_URL);return s.searchParams.append("term",t),s.searchParams.append("media","podcast"),s.searchParams.append("entity","podcast"),s.searchParams.append("limit",e.toString()),s.searchParams.append("country",r),i||s.searchParams.append("explicit","No"),s.href}transformResult(t){var e;return{title:t.collectionName||"Untitled Podcast",author:t.artistName,feedUrl:t.feedUrl,artworkUrl:t.artworkUrl600||t.artworkUrl100||t.artworkUrl60||t.artworkUrl30,collectionId:(e=t.collectionId)==null?void 0:e.toString(),episodeCount:t.trackCount,genres:this.extractGenres(t)}}extractGenres(t){let e=[];return t.primaryGenreName&&e.push(t.primaryGenreName),t.genres&&Array.isArray(t.genres)&&e.push(...t.genres.filter(r=>r!==t.primaryGenreName)),e.length>0?e:void 0}static isAppleUrl(t){try{let e=new URL(t);return e.hostname.includes("apple.com")||e.hostname.includes("itunes.com")}catch(e){return!1}}};De.API_BASE_URL="https://itunes.apple.com/search",De.DEFAULT_TIMEOUT=15e3,De.DEFAULT_LIMIT=10,De.MAX_LIMIT=200;var ir=De;var bt=class{constructor(t,e,r){this.imageCache=null;this.feedService=t,this.subscriptionStore=e,this.imageCache=r||null,this.searchService=new ir}async subscribe(t){a.methodEntry("PodcastService","subscribe",t);try{if(!Me.validateFeedUrl(t))return{success:!1,error:"Invalid feed URL"};let e=await this.subscriptionStore.getPodcastByFeedUrl(t);if(e)return a.info("Already subscribed to this podcast"),{success:!0,podcast:e};let{podcast:r,episodes:i}=await this.feedService.fetchFeed(t,{useCache:!1});return r.episodes=i,r.imageUrl&&this.imageCache&&await this.cacheImage(r.imageUrl).catch(s=>{a.warn("Failed to cache podcast image",s)}),await this.subscriptionStore.addPodcast(r),a.info(`Subscribed to podcast: ${r.title}`),a.methodExit("PodcastService","subscribe"),{success:!0,podcast:r}}catch(e){a.error("Failed to subscribe to podcast",e);let r="Failed to subscribe to podcast";return e instanceof ue?r="Failed to parse podcast feed":e instanceof de&&(r="Failed to fetch podcast feed"),a.methodExit("PodcastService","subscribe","failed"),{success:!1,error:r}}}async unsubscribe(t){a.methodEntry("PodcastService","unsubscribe",t);let e=await this.subscriptionStore.getPodcast(t);if(!e)throw new Error(`Podcast not found: ${t}`);await this.subscriptionStore.removePodcast(t),await this.feedService.clearCache(e.feedUrl),a.info(`Unsubscribed from podcast: ${e.title}`),a.methodExit("PodcastService","unsubscribe")}async getPodcast(t){a.methodEntry("PodcastService","getPodcast",t);let e=await this.subscriptionStore.getPodcast(t);return a.methodExit("PodcastService","getPodcast"),e}async getPodcastByFeedUrl(t){a.methodEntry("PodcastService","getPodcastByFeedUrl",t);let e=await this.subscriptionStore.getPodcastByFeedUrl(t);return a.methodExit("PodcastService","getPodcastByFeedUrl"),e}async getAllPodcasts(){a.methodEntry("PodcastService","getAllPodcasts");let t=await this.subscriptionStore.getAllPodcasts();return a.methodExit("PodcastService","getAllPodcasts"),t}async getSubscriptionCount(){return await this.subscriptionStore.getSubscriptionCount()}async isSubscribed(t){return await this.subscriptionStore.isSubscribed(t)}async isSubscribedByFeedUrl(t){return await this.subscriptionStore.isSubscribedByFeedUrl(t)}async searchPodcasts(t){a.methodEntry("PodcastService","searchPodcasts",t);let e=await this.subscriptionStore.searchPodcasts(t);return a.methodExit("PodcastService","searchPodcasts"),e}async updatePodcastMetadata(t,e){a.methodEntry("PodcastService","updatePodcastMetadata",t);let r=await this.subscriptionStore.getPodcast(t);if(!r)throw new Error(`Podcast not found: ${t}`);let i={...r,...e,id:r.id,feedUrl:r.feedUrl,subscribedAt:r.subscribedAt};await this.subscriptionStore.updatePodcast(i),a.methodExit("PodcastService","updatePodcastMetadata")}async updatePodcastSettings(t,e){a.methodEntry("PodcastService","updatePodcastSettings",t),await this.subscriptionStore.updatePodcastSettings(t,e),a.methodExit("PodcastService","updatePodcastSettings")}async getPodcastSettings(t){let e=await this.subscriptionStore.getPodcast(t);return e==null?void 0:e.settings}async clearPodcastSettings(t){a.methodEntry("PodcastService","clearPodcastSettings",t),await this.subscriptionStore.updatePodcastSettings(t,void 0),a.methodExit("PodcastService","clearPodcastSettings")}async getEpisodes(t){a.methodEntry("PodcastService","getEpisodes",t);let e=await this.subscriptionStore.getPodcast(t);if(!e)throw new Error(`Podcast not found: ${t}`);return a.methodExit("PodcastService","getEpisodes"),e.episodes||[]}async getEpisode(t,e){a.methodEntry("PodcastService","getEpisode",e);let i=(await this.getEpisodes(t)).find(s=>s.id===e)||null;return a.methodExit("PodcastService","getEpisode"),i}async getLatestEpisodes(t=20){a.methodEntry("PodcastService","getLatestEpisodes",`limit=${t}`);let e=await this.subscriptionStore.getAllPodcasts(),r=[];for(let s of e)s.episodes&&r.push(...s.episodes);r.sort((s,o)=>{let n=s.publishDate instanceof Date?s.publishDate:new Date(s.publishDate);return(o.publishDate instanceof Date?o.publishDate:new Date(o.publishDate)).getTime()-n.getTime()});let i=r.slice(0,t);return a.methodExit("PodcastService","getLatestEpisodes"),i}async getPodcastsNeedingUpdate(t){return await this.subscriptionStore.getPodcastsNeedingUpdate(t)}async cacheImage(t){if(this.imageCache)try{if(await this.imageCache.getCachedImage(t)){a.debug("Image already cached",t);return}let r=await(0,Ws.requestUrl)({url:t,method:"GET"});if(r.status!==200)throw new Error(`Failed to fetch image: ${r.status}`);let i=r.arrayBuffer;await this.imageCache.cacheImage(t,i),a.debug("Image cached successfully",t)}catch(e){a.warn("Failed to cache image",e)}}async getCachedImagePath(t){return this.imageCache?await this.imageCache.getCachedImage(t):null}async exportSubscriptions(){a.methodEntry("PodcastService","exportSubscriptions");let t=await this.subscriptionStore.exportSubscriptions();return a.methodExit("PodcastService","exportSubscriptions"),t}async importSubscriptions(t,e=!1){a.methodEntry("PodcastService","importSubscriptions",`replace=${e}`),await this.subscriptionStore.importSubscriptions(t,e),a.methodExit("PodcastService","importSubscriptions")}async searchOnline(t,e){a.methodEntry("PodcastService","searchOnline",t);let r=await this.searchService.searchPodcasts(t,e);return a.methodExit("PodcastService","searchOnline",`count=${r.length}`),r}async searchAndSubscribe(t,e=0,r){a.methodEntry("PodcastService","searchAndSubscribe",t);try{let i=await this.searchOnline(t,r);if(i.length===0)return{success:!1,error:"No podcasts found matching your search"};if(e<0||e>=i.length)return{success:!1,error:`Invalid result index: ${e}`};let s=i[e],o=await this.subscribe(s.feedUrl);return a.methodExit("PodcastService","searchAndSubscribe"),o}catch(i){return a.error("Search and subscribe failed",i),{success:!1,error:i instanceof Error?i.message:"Unknown error"}}}async getPodcastMetadata(t){var e;a.methodEntry("PodcastService","getPodcastMetadata",t);try{if(!Me.validateFeedUrl(t))return a.warn("Invalid feed URL"),null;let{podcast:r}=await this.feedService.fetchFeed(t,{useCache:!0,cacheTTL:3e5});return a.methodExit("PodcastService","getPodcastMetadata"),{title:r.title,author:r.author,description:r.description,feedUrl:r.feedUrl,artworkUrl:r.imageUrl,episodeCount:(e=r.episodes)==null?void 0:e.length,genres:r.categories}}catch(r){return a.error("Failed to get podcast metadata",r),null}}};var Et=class{constructor(t,e){this.progressStore=t,this.subscriptionStore=e}async getEpisodeWithProgress(t){a.methodEntry("EpisodeManager","getEpisodeWithProgress",t);let e=await this.subscriptionStore.getAllPodcasts(),r=null;for(let n of e)if(n.episodes){let l=n.episodes.find(c=>c.id===t);if(l){r=l;break}}if(!r)return a.methodExit("EpisodeManager","getEpisodeWithProgress","not found"),null;let i=await this.progressStore.getProgress(t),s=i?await this.progressStore.getCompletionPercentage(t):0,o={...r,progress:i||void 0,completionPercentage:s};return a.methodExit("EpisodeManager","getEpisodeWithProgress"),o}async getEpisodesWithProgress(t){if(a.methodEntry("EpisodeManager","getEpisodesWithProgress",`count=${t.length}`),t.length===0)return a.methodExit("EpisodeManager","getEpisodesWithProgress","empty"),[];let e=await this.subscriptionStore.getAllPodcasts(),r=new Map;for(let n of e)if(n.episodes)for(let l of n.episodes)r.set(l.id,l);let i=await this.progressStore.getBatchProgress(t),s=await this.progressStore.getBatchCompletionPercentages(t),o=[];for(let n of t){let l=r.get(n);l&&o.push({...l,progress:i.get(n)||void 0,completionPercentage:s.get(n)||0})}return a.methodExit("EpisodeManager","getEpisodesWithProgress"),o}async getPodcastEpisodesWithProgress(t){a.methodEntry("EpisodeManager","getPodcastEpisodesWithProgress",t);let e=await this.subscriptionStore.getPodcast(t);if(!e||!e.episodes||e.episodes.length===0)return a.methodExit("EpisodeManager","getPodcastEpisodesWithProgress","not found"),[];let r=e.episodes.map(n=>n.id),i=await this.progressStore.getBatchProgress(r),s=await this.progressStore.getBatchCompletionPercentages(r),o=e.episodes.map(n=>({...n,progress:i.get(n.id)||void 0,completionPercentage:s.get(n.id)||0}));return a.methodExit("EpisodeManager","getPodcastEpisodesWithProgress"),o}filterEpisodes(t,e){a.methodEntry("EpisodeManager","filterEpisodes",`count=${t.length}`);let r=[...t];return e.podcastId&&(r=r.filter(i=>i.podcastId===e.podcastId)),e.completed!==void 0&&(r=r.filter(i=>{var o;return(((o=i.progress)==null?void 0:o.completed)||!1)===e.completed})),e.inProgress!==void 0&&(r=r.filter(i=>!!(i.progress&&!i.progress.completed&&i.progress.position>0)===e.inProgress)),e.newerThan&&(r=r.filter(i=>i.publishDate>=e.newerThan)),e.olderThan&&(r=r.filter(i=>i.publishDate<=e.olderThan)),e.episodeType&&(r=r.filter(i=>i.episodeType===e.episodeType)),e.seasonNumber!==void 0&&(r=r.filter(i=>i.seasonNumber===e.seasonNumber)),a.methodExit("EpisodeManager","filterEpisodes",`filtered=${r.length}`),r}sortEpisodes(t,e="publishDate",r="desc"){a.methodEntry("EpisodeManager","sortEpisodes",`sortBy=${e}, order=${r}`);let i=[...t].sort((s,o)=>{var l,c,p,h;let n=0;switch(e){case"publishDate":{let m=s.publishDate instanceof Date?s.publishDate:new Date(s.publishDate),d=o.publishDate instanceof Date?o.publishDate:new Date(o.publishDate);n=m.getTime()-d.getTime();break}case"duration":n=s.duration-o.duration;break;case"title":n=s.title.localeCompare(o.title);break;case"episodeNumber":{let m=s.episodeNumber||0,d=o.episodeNumber||0;n=m-d;break}case"lastPlayed":{let m=((c=(l=s.progress)==null?void 0:l.lastPlayedAt)==null?void 0:c.getTime())||0,d=((h=(p=o.progress)==null?void 0:p.lastPlayedAt)==null?void 0:h.getTime())||0;n=m-d;break}default:n=0}return r==="asc"?n:-n});return a.methodExit("EpisodeManager","sortEpisodes"),i}searchEpisodes(t,e){a.methodEntry("EpisodeManager","searchEpisodes",e);let r=e.toLowerCase(),i=t.filter(s=>{let o=s.title.toLowerCase().includes(r),n=s.description.toLowerCase().includes(r);return o||n});return a.methodExit("EpisodeManager","searchEpisodes",`results=${i.length}`),i}async getUnplayedEpisodes(t){a.methodEntry("EpisodeManager","getUnplayedEpisodes",t);let e;t?e=await this.getPodcastEpisodesWithProgress(t):e=await this.getAllEpisodesWithProgress();let r=e.filter(i=>!i.progress||i.progress.position===0);return a.methodExit("EpisodeManager","getUnplayedEpisodes"),r}async getInProgressEpisodes(t){a.methodEntry("EpisodeManager","getInProgressEpisodes",t);let e=await this.progressStore.getInProgressEpisodes();if(!e.length)return a.methodExit("EpisodeManager","getInProgressEpisodes","empty"),[];let i=(t?e.filter(o=>o.podcastId===t):e).map(o=>o.episodeId),s=await this.getEpisodesWithProgress(i);return a.methodExit("EpisodeManager","getInProgressEpisodes"),s}async getCompletedEpisodes(t){a.methodEntry("EpisodeManager","getCompletedEpisodes",t);let e=await this.progressStore.getCompletedEpisodes();if(!e.length)return a.methodExit("EpisodeManager","getCompletedEpisodes","empty"),[];let i=(t?e.filter(o=>o.podcastId===t):e).map(o=>o.episodeId),s=await this.getEpisodesWithProgress(i);return a.methodExit("EpisodeManager","getCompletedEpisodes"),s}async getRecentlyPlayedEpisodes(t=10){a.methodEntry("EpisodeManager","getRecentlyPlayedEpisodes",`limit=${t}`);let e=await this.progressStore.getRecentlyPlayed(t);if(!e.length)return a.methodExit("EpisodeManager","getRecentlyPlayedEpisodes","empty"),[];let r=e.map(o=>o.episodeId),i=await this.getEpisodesWithProgress(r),s=r.map(o=>i.find(n=>n.id===o)).filter(o=>o!==void 0);return a.methodExit("EpisodeManager","getRecentlyPlayedEpisodes"),s}async getAllEpisodesWithProgress(){a.methodEntry("EpisodeManager","getAllEpisodesWithProgress");let t=await this.subscriptionStore.getAllPodcasts(),e=[];for(let n of t)n.episodes&&e.push(...n.episodes);if(e.length===0)return a.methodExit("EpisodeManager","getAllEpisodesWithProgress","empty"),[];let r=e.map(n=>n.id),i=await this.progressStore.getBatchProgress(r),s=await this.progressStore.getBatchCompletionPercentages(r),o=e.map(n=>({...n,progress:i.get(n.id)||void 0,completionPercentage:s.get(n.id)||0}));return a.methodExit("EpisodeManager","getAllEpisodesWithProgress"),o}async getPodcastStatistics(t){a.methodEntry("EpisodeManager","getPodcastStatistics",t);let e=await this.getPodcastEpisodesWithProgress(t),r={totalEpisodes:e.length,completedEpisodes:e.filter(i=>{var s;return(s=i.progress)==null?void 0:s.completed}).length,inProgressEpisodes:e.filter(i=>i.progress&&!i.progress.completed&&i.progress.position>0).length,unplayedEpisodes:e.filter(i=>!i.progress||i.progress.position===0).length,totalDuration:e.reduce((i,s)=>i+s.duration,0),totalListeningTime:e.reduce((i,s)=>{var o;return i+(((o=s.progress)==null?void 0:o.position)||0)},0),averageCompletionRate:0};return r.totalEpisodes>0&&r.totalDuration>0&&(r.averageCompletionRate=r.totalListeningTime/r.totalDuration*100),a.methodExit("EpisodeManager","getPodcastStatistics"),r}async getOverallStatistics(){a.methodEntry("EpisodeManager","getOverallStatistics");let t=await this.subscriptionStore.getAllPodcasts(),e=0,r=0;for(let c of t)c.episodes&&(e+=c.episodes.length,r+=c.episodes.reduce((p,h)=>p+h.duration,0));let i=await this.progressStore.getTotalListeningTime(),s=(await this.progressStore.getCompletedEpisodes()).length,o=(await this.progressStore.getInProgressEpisodes()).length,n=e-s-o,l={totalEpisodes:e,completedEpisodes:s,inProgressEpisodes:o,unplayedEpisodes:n,totalDuration:r,totalListeningTime:i,averageCompletionRate:0};return l.totalEpisodes>0&&l.totalDuration>0&&(l.averageCompletionRate=l.totalListeningTime/l.totalDuration*100),a.methodExit("EpisodeManager","getOverallStatistics"),l}async getEpisodesBySeason(t,e){a.methodEntry("EpisodeManager","getEpisodesBySeason",`${t}, season=${e}`);let i=(await this.getPodcastEpisodesWithProgress(t)).filter(s=>s.seasonNumber===e);return i.sort((s,o)=>(s.episodeNumber||0)-(o.episodeNumber||0)),a.methodExit("EpisodeManager","getEpisodesBySeason"),i}async getAvailableSeasons(t){a.methodEntry("EpisodeManager","getAvailableSeasons",t);let e=await this.subscriptionStore.getPodcast(t);if(!e||!e.episodes)return a.methodExit("EpisodeManager","getAvailableSeasons","not found"),[];let r=new Set;for(let s of e.episodes)s.seasonNumber!==void 0&&r.add(s.seasonNumber);let i=Array.from(r).sort((s,o)=>s-o);return a.methodExit("EpisodeManager","getAvailableSeasons"),i}};var wt=class{constructor(){this.audio=null;this.currentUrl=null;this.status="idle";this.eventHandlers={};this.progressInterval=null;a.methodEntry("PlaybackEngine","constructor"),this.initializeAudioElement(),a.methodExit("PlaybackEngine","constructor")}initializeAudioElement(){this.audio=new Audio,this.audio.preload="metadata",this.attachEventListeners()}attachEventListeners(){this.audio&&(this.audio.addEventListener("play",()=>{var t,e;a.debug("Audio play event"),this.status="playing",(e=(t=this.eventHandlers).onPlay)==null||e.call(t),this.startProgressTracking()}),this.audio.addEventListener("pause",()=>{var t,e;a.debug("Audio pause event"),this.status="paused",(e=(t=this.eventHandlers).onPause)==null||e.call(t),this.stopProgressTracking()}),this.audio.addEventListener("ended",()=>{var t,e;a.debug("Audio ended event"),this.status="ended",(e=(t=this.eventHandlers).onEnded)==null||e.call(t),this.stopProgressTracking()}),this.audio.addEventListener("timeupdate",()=>{var t,e;this.audio&&((e=(t=this.eventHandlers).onTimeUpdate)==null||e.call(t,this.audio.currentTime))}),this.audio.addEventListener("durationchange",()=>{var t,e;this.audio&&!isNaN(this.audio.duration)&&(a.debug("Duration changed",this.audio.duration),(e=(t=this.eventHandlers).onDurationChange)==null||e.call(t,this.audio.duration))}),this.audio.addEventListener("loadstart",()=>{var t,e;a.debug("Audio load start"),this.status="loading",(e=(t=this.eventHandlers).onLoadStart)==null||e.call(t)}),this.audio.addEventListener("loadedmetadata",()=>{var t,e;a.debug("Audio metadata loaded"),(e=(t=this.eventHandlers).onLoadedMetadata)==null||e.call(t)}),this.audio.addEventListener("canplay",()=>{var t,e;a.debug("Audio can play"),(e=(t=this.eventHandlers).onCanPlay)==null||e.call(t)}),this.audio.addEventListener("error",()=>{var r,i,s;let t=(r=this.audio)==null?void 0:r.error;a.error("Audio playback error",t?new Error(t.message):void 0),this.status="error";let e=new ee((t==null?void 0:t.message)||"Unknown playback error",this.currentUrl||void 0);(s=(i=this.eventHandlers).onError)==null||s.call(i,e)}),this.audio.addEventListener("volumechange",()=>{var t,e;this.audio&&((e=(t=this.eventHandlers).onVolumeChange)==null||e.call(t,this.audio.volume,this.audio.muted))}),this.audio.addEventListener("ratechange",()=>{var t,e;this.audio&&((e=(t=this.eventHandlers).onRateChange)==null||e.call(t,this.audio.playbackRate))}),this.audio.addEventListener("progress",()=>{var t,e;if(this.audio&&this.audio.buffered.length>0){let r=this.audio.buffered.end(this.audio.buffered.length-1);(e=(t=this.eventHandlers).onProgress)==null||e.call(t,r)}}))}setEventHandlers(t){this.eventHandlers={...this.eventHandlers,...t}}load(t){if(a.methodEntry("PlaybackEngine","load",t),!this.audio)throw new ee("Audio element not initialized");try{this.status==="playing"&&this.pause(),this.currentUrl=t,this.audio.src=t,this.audio.load(),a.info("Audio loaded",t),a.methodExit("PlaybackEngine","load")}catch(e){throw a.error("Failed to load audio",e instanceof Error?e:void 0),this.status="error",new ee("Failed to load audio",t,e instanceof Error?e:void 0)}}async play(){if(a.methodEntry("PlaybackEngine","play"),!this.audio)throw new ee("Audio element not initialized");if(!this.currentUrl)throw new ee("No audio loaded");try{await this.audio.play(),a.info("Audio playing"),a.methodExit("PlaybackEngine","play")}catch(t){throw a.error("Failed to play audio",t),this.status="error",new ee("Failed to play audio",this.currentUrl,t)}}pause(){if(a.methodEntry("PlaybackEngine","pause"),!this.audio)throw new ee("Audio element not initialized");this.audio.pause(),a.info("Audio paused"),a.methodExit("PlaybackEngine","pause")}stop(){if(a.methodEntry("PlaybackEngine","stop"),!this.audio)throw new ee("Audio element not initialized");this.audio.pause(),this.audio.currentTime=0,this.status="idle",a.info("Audio stopped"),a.methodExit("PlaybackEngine","stop")}seek(t){if(a.methodEntry("PlaybackEngine","seek",t),!this.audio)throw new ee("Audio element not initialized");if(isNaN(this.audio.duration)){a.warn("Cannot seek: duration not available");return}let e=Math.max(0,Math.min(t,this.audio.duration));this.audio.currentTime=e,a.debug("Seeked to",e),a.methodExit("PlaybackEngine","seek")}setVolume(t){if(a.methodEntry("PlaybackEngine","setVolume",t),!this.audio)throw new ee("Audio element not initialized");let e=$r(t);this.audio.volume=e,a.debug("Volume set to",e),a.methodExit("PlaybackEngine","setVolume")}setPlaybackRate(t){if(a.methodEntry("PlaybackEngine","setPlaybackRate",t),!this.audio)throw new ee("Audio element not initialized");let e=Br(t);this.audio.playbackRate=e,a.debug("Playback rate set to",e),a.methodExit("PlaybackEngine","setPlaybackRate")}setMuted(t){if(a.methodEntry("PlaybackEngine","setMuted",t),!this.audio)throw new ee("Audio element not initialized");this.audio.muted=t,a.debug("Muted set to",t),a.methodExit("PlaybackEngine","setMuted")}getStatus(){return this.status}getMetadata(){if(!this.audio)return null;let t=this.audio.buffered.length>0?this.audio.buffered.end(this.audio.buffered.length-1):0;return{duration:this.audio.duration||0,currentTime:this.audio.currentTime||0,buffered:t,volume:this.audio.volume,playbackRate:this.audio.playbackRate,muted:this.audio.muted}}getCurrentTime(){var t;return((t=this.audio)==null?void 0:t.currentTime)||0}getDuration(){var t;return((t=this.audio)==null?void 0:t.duration)||0}getVolume(){var t;return((t=this.audio)==null?void 0:t.volume)||1}getPlaybackRate(){var t;return((t=this.audio)==null?void 0:t.playbackRate)||1}isMuted(){var t;return((t=this.audio)==null?void 0:t.muted)||!1}isPlaying(){return this.status==="playing"}isPaused(){return this.status==="paused"}isLoading(){return this.status==="loading"}startProgressTracking(){this.progressInterval===null&&(this.progressInterval=window.setInterval(()=>{var t,e;this.audio&&this.status==="playing"&&((e=(t=this.eventHandlers).onTimeUpdate)==null||e.call(t,this.audio.currentTime))},100))}stopProgressTracking(){this.progressInterval!==null&&(clearInterval(this.progressInterval),this.progressInterval=null)}destroy(){a.methodEntry("PlaybackEngine","destroy"),this.stopProgressTracking(),this.audio&&(this.audio.pause(),this.audio.src="",this.audio.load(),this.audio=null),this.currentUrl=null,this.status="idle",this.eventHandlers={},a.info("PlaybackEngine destroyed"),a.methodExit("PlaybackEngine","destroy")}};var St=class{constructor(t,e={}){this.currentEpisode=null;this.lastSavedPosition=0;this.lastSavedTime=0;this.saveTimer=null;this.isTracking=!1;this.progressStore=t,this.saveInterval=e.saveInterval||5e3,this.minPositionChange=e.minPositionChange||2,this.completionThreshold=e.completionThreshold||30}async startTracking(t){a.methodEntry("ProgressTracker","startTracking",t.id),this.isTracking&&await this.stopTracking(),this.currentEpisode=t,this.isTracking=!0;let e=await this.progressStore.getProgress(t.id);e?this.lastSavedPosition=e.position:this.lastSavedPosition=0,this.lastSavedTime=Date.now(),this.startPeriodicSave(),a.info("Started tracking progress",t.id),a.methodExit("ProgressTracker","startTracking")}async stopTracking(t=!0){if(a.methodEntry("ProgressTracker","stopTracking",`save=${t}`),!this.isTracking){a.methodExit("ProgressTracker","stopTracking","not tracking");return}this.stopPeriodicSave(),t&&this.currentEpisode&&await this.saveProgress(this.lastSavedPosition,!0),this.currentEpisode=null,this.isTracking=!1,this.lastSavedPosition=0,this.lastSavedTime=0,a.info("Stopped tracking progress"),a.methodExit("ProgressTracker","stopTracking")}updatePosition(t){!this.isTracking||!this.currentEpisode||(this.lastSavedPosition=t)}async forceSave(t){if(a.methodEntry("ProgressTracker","forceSave"),!this.currentEpisode){a.warn("No episode to save progress for"),a.methodExit("ProgressTracker","forceSave","no episode");return}let e=t!==void 0?t:this.lastSavedPosition;await this.saveProgress(e,!0),a.methodExit("ProgressTracker","forceSave")}async markCompleted(){if(a.methodEntry("ProgressTracker","markCompleted"),!this.currentEpisode){a.warn("No episode to mark as completed"),a.methodExit("ProgressTracker","markCompleted","no episode");return}await this.progressStore.markCompleted(this.currentEpisode.id,this.currentEpisode.podcastId,this.currentEpisode.duration),a.info("Episode marked as completed",this.currentEpisode.id),a.methodExit("ProgressTracker","markCompleted")}getLastSavedPosition(){return this.lastSavedPosition}async getResumePosition(t){a.methodEntry("ProgressTracker","getResumePosition",t);let e=await this.progressStore.getProgress(t);return e?e.completed?(a.methodExit("ProgressTracker","getResumePosition","completed"),0):(a.methodExit("ProgressTracker","getResumePosition",e.position),e.position):(a.methodExit("ProgressTracker","getResumePosition","no progress"),0)}async shouldResume(t,e=10){return await this.getResumePosition(t)>=e}async resetProgress(t){a.methodEntry("ProgressTracker","resetProgress",t),await this.progressStore.resetProgress(t),this.currentEpisode&&this.currentEpisode.id===t&&(this.lastSavedPosition=0),a.info("Progress reset",t),a.methodExit("ProgressTracker","resetProgress")}startPeriodicSave(){this.saveTimer===null&&(this.saveTimer=window.setInterval(()=>{this.periodicSave().catch(t=>{a.error("Periodic save failed",t)})},this.saveInterval))}stopPeriodicSave(){this.saveTimer!==null&&(clearInterval(this.saveTimer),this.saveTimer=null)}async periodicSave(){if(!this.isTracking||!this.currentEpisode)return;let t=await this.progressStore.getProgress(this.currentEpisode.id),e=(t==null?void 0:t.position)||0;Math.abs(this.lastSavedPosition-e)<this.minPositionChange||await this.saveProgress(this.lastSavedPosition,!1)}async saveProgress(t,e){if(this.currentEpisode)try{let r=Je(t,this.currentEpisode.duration,this.completionThreshold),i={episodeId:this.currentEpisode.id,podcastId:this.currentEpisode.podcastId,position:t,duration:this.currentEpisode.duration,lastPlayedAt:new Date,completed:r};await this.progressStore.updateProgress(i),this.lastSavedTime=Date.now(),a.debug("Progress saved",{episodeId:this.currentEpisode.id,position:t,completed:r})}catch(r){a.error("Failed to save progress",r)}}isCurrentlyTracking(){return this.isTracking}getCurrentEpisode(){return this.currentEpisode}getTimeSinceLastSave(){return this.lastSavedTime===0?0:Date.now()-this.lastSavedTime}};var Dt=class{constructor(t,e){this.currentEpisode=null;this.eventHandlers={};this.settingsProvider=null;this.currentPlaylist=null;this.currentPlaylistIndex=-1;this.loadAbortController=null;this.lastLoadTime=0;this.loadingEpisodeId=null;a.methodEntry("PlayerController","constructor"),this.engine=t,this.progressTracker=e,this.currentSettings={...ae.defaultPlaybackSettings},this.state={status:"stopped",position:0,volume:this.currentSettings.volume,playbackSpeed:this.currentSettings.playbackSpeed,muted:!1},this.setupEngineHandlers(),a.methodExit("PlayerController","constructor")}setupEngineHandlers(){let t={onPlay:()=>{this.updateState({status:"playing"})},onPause:()=>{this.updateState({status:"paused"})},onEnded:()=>{this.handleEpisodeEnded()},onTimeUpdate:e=>{this.updateState({position:e}),this.progressTracker.updatePosition(e)},onDurationChange:e=>{this.currentEpisode&&(this.currentEpisode.duration=e)},onLoadStart:()=>{this.updateState({status:"loading"})},onError:e=>{var r,i;this.updateState({status:"error",error:e.message}),(i=(r=this.eventHandlers).onError)==null||i.call(r,e)},onVolumeChange:(e,r)=>{this.updateState({volume:e,muted:r})},onRateChange:e=>{this.updateState({playbackSpeed:e})}};this.engine.setEventHandlers(t)}async loadEpisode(t,e=!1,r=!0){var o,n,l;let i=Date.now();if(this.loadingEpisodeId===t.id&&i-this.lastLoadTime<2e3){a.warn("Duplicate loadEpisode call ignored",t.id);return}if(((o=this.currentEpisode)==null?void 0:o.id)===t.id&&this.state.status!=="error"){a.info("Episode already loaded, skipping reload",t.id),e&&this.state.status!=="playing"&&await this.play();return}this.loadAbortController&&this.loadAbortController.abort(),this.loadAbortController=new AbortController;let s=this.loadAbortController.signal;this.lastLoadTime=i,this.loadingEpisodeId=t.id,a.methodEntry("PlayerController","loadEpisode",t.id);try{if(this.currentEpisode&&await this.progressTracker.stopTracking(!0),s.aborted||(this.engine.load(t.audioUrl),this.currentEpisode=t,this.updateState({currentEpisode:t,status:"paused",position:0,error:void 0}),s.aborted))return;if(t.podcastId&&this.settingsProvider)try{let h=await this.settingsProvider(t.podcastId);if(s.aborted)return;h&&(this.applyPodcastSettings(h),a.info("Applied podcast-specific settings for",t.podcastId))}catch(h){a.warn("Failed to get podcast settings",h)}if(await this.progressTracker.startTracking(t),s.aborted)return;await this.waitForMetadata(s);let c=0;if(r){let h=await this.progressTracker.shouldResume(t.id);if(s.aborted)return;if(h)c=await this.progressTracker.getResumePosition(t.id),a.info("Resuming from saved position",c);else{let m=this.currentSettings.skipIntroSeconds||0;m>0&&(c=m,a.info("Skipping intro",m))}}if(this.engine.seek(c),await new Promise(h=>setTimeout(h,50)),s.aborted)return;let p=this.engine.getCurrentTime();this.updateState({position:p}),a.info("Starting position set to",p),(l=(n=this.eventHandlers).onEpisodeChange)==null||l.call(n,t),e&&await this.play(),a.info("Episode loaded",t.title),a.methodExit("PlayerController","loadEpisode")}catch(c){if(s.aborted){a.info("Episode load aborted",t.title);return}throw a.error("Failed to load episode",c),this.updateState({status:"error",error:c instanceof Error?c.message:"Failed to load episode"}),c}}async waitForMetadata(t){return new Promise((e,r)=>{let i=()=>{if(t!=null&&t.aborted){r(new Error("Load aborted"));return}let s=this.engine.getDuration();!isNaN(s)&&s>0?e():setTimeout(i,50)};i()})}async play(){if(a.methodEntry("PlayerController","play"),!this.currentEpisode)throw new ee("No episode loaded");await this.engine.play(),a.methodExit("PlayerController","play")}pause(){a.methodEntry("PlayerController","pause"),this.engine.pause(),a.methodExit("PlayerController","pause")}async togglePlayPause(){this.engine.isPlaying()?this.pause():await this.play()}async stop(){var t,e;a.methodEntry("PlayerController","stop"),this.engine.stop(),this.currentEpisode&&await this.progressTracker.stopTracking(!0),this.currentEpisode=null,this.updateState({currentEpisode:void 0,status:"stopped",position:0}),(e=(t=this.eventHandlers).onEpisodeChange)==null||e.call(t,null),a.methodExit("PlayerController","stop")}seek(t){a.methodEntry("PlayerController","seek",t),this.engine.seek(t),this.progressTracker.updatePosition(t),a.methodExit("PlayerController","seek")}skipForward(t){let e=this.engine.getCurrentTime(),r=this.engine.getDuration(),i=Vr(e,r,t);this.seek(i)}skipBackward(t){let e=this.engine.getCurrentTime(),r=jr(e,t);this.seek(r)}setVolume(t){a.methodEntry("PlayerController","setVolume",t),this.engine.setVolume(t),this.currentSettings.volume=t,a.methodExit("PlayerController","setVolume")}setPlaybackSpeed(t){a.methodEntry("PlayerController","setPlaybackSpeed",t),this.engine.setPlaybackRate(t),this.currentSettings.playbackSpeed=t,a.methodExit("PlayerController","setPlaybackSpeed")}cyclePlaybackSpeed(){let t=this.engine.getPlaybackRate(),e=_r(t);this.setPlaybackSpeed(e)}setMuted(t){a.methodEntry("PlayerController","setMuted",t),this.engine.setMuted(t),a.methodExit("PlayerController","setMuted")}toggleMute(){let t=this.engine.isMuted();this.setMuted(!t)}applyPodcastSettings(t){a.methodEntry("PlayerController","applyPodcastSettings"),this.currentSettings={...t},this.engine.setVolume(t.volume),this.engine.setPlaybackRate(t.playbackSpeed),a.info("Podcast settings applied",t),a.methodExit("PlayerController","applyPodcastSettings")}getState(){return{...this.state}}getCurrentEpisode(){return this.currentEpisode}getCurrentPosition(){return this.engine.getCurrentTime()}getDuration(){return this.engine.getDuration()}isPlaying(){return this.engine.isPlaying()}isPaused(){return this.engine.isPaused()}setEventHandlers(t){this.eventHandlers={...this.eventHandlers,...t}}setSettingsProvider(t){this.settingsProvider=t}async markEpisodeCompleted(){this.currentEpisode&&(await this.progressTracker.markCompleted(),a.info("Episode marked as completed",this.currentEpisode.id))}async handleEpisodeEnded(){var t,e;a.methodEntry("PlayerController","handleEpisodeEnded"),this.currentEpisode&&(await this.progressTracker.markCompleted(),this.updateState({status:"stopped"}),(e=(t=this.eventHandlers).onEpisodeEnded)==null||e.call(t,this.currentEpisode),a.info("Episode ended",this.currentEpisode.title),a.methodExit("PlayerController","handleEpisodeEnded"))}updateState(t){var e,r;this.state={...this.state,...t},(r=(e=this.eventHandlers).onStateChange)==null||r.call(e,this.state)}async destroy(){a.methodEntry("PlayerController","destroy"),await this.progressTracker.stopTracking(!0),this.engine.destroy(),this.currentEpisode=null,this.currentPlaylist=null,this.currentPlaylistIndex=-1,this.eventHandlers={},a.info("PlayerController destroyed"),a.methodExit("PlayerController","destroy")}setCurrentPlaylist(t,e=0){this.currentPlaylist=t,this.currentPlaylistIndex=e,a.info("Current playlist set",t==null?void 0:t.name,"index:",e)}getCurrentPlaylist(){return this.currentPlaylist}getCurrentPlaylistIndex(){return this.currentPlaylistIndex}isPlayingFromPlaylist(){return this.currentPlaylist!==null&&this.currentPlaylistIndex>=0}hasNextInPlaylist(){return this.currentPlaylist?this.currentPlaylistIndex<this.currentPlaylist.episodeIds.length-1:!1}hasPreviousInPlaylist(){return this.currentPlaylist?this.currentPlaylistIndex>0:!1}getNextPlaylistEpisodeId(){return this.hasNextInPlaylist()?(this.currentPlaylistIndex++,this.currentPlaylist.episodeIds[this.currentPlaylistIndex]):null}getPreviousPlaylistEpisodeId(){return this.hasPreviousInPlaylist()?(this.currentPlaylistIndex--,this.currentPlaylist.episodeIds[this.currentPlaylistIndex]):null}clearPlaylist(){this.currentPlaylist=null,this.currentPlaylistIndex=-1}};function Tt(u,t=!0){if(!isFinite(u)||u<0)return t?"0s":"0 seconds";let e=Math.floor(u/3600),r=Math.floor(u%3600/60),i=Math.floor(u%60),s=[];return e>0&&s.push(t?`${e}h`:`${e} hour${e>1?"s":""}`),r>0&&s.push(t?`${r}m`:`${r} minute${r>1?"s":""}`),(i>0||s.length===0)&&s.push(t?`${i}s`:`${i} second${i>1?"s":""}`),s.join(" ")}function Xe(u){let t={year:"numeric",month:"short",day:"numeric"};return u.toLocaleDateString(void 0,t)}var We=require("obsidian");var xt=class{constructor(t){this.vault=t}async exportEpisode(t,e,r,i={}){a.methodEntry("NoteExporter","exportEpisode",t.id);let{includeFrontMatter:s=!0,includeDescription:o=!0,includeMetadata:n=!0,includeTimestamps:l=!0,includeProgress:c=!0,template:p,outputFolder:h="Podcasts",fileNameTemplate:m}=i,d=this.generateTemplateVariables(t,e,r),v="";p?v=this.applyTemplate(p,d):v=this.generateDefaultNote(t,e,r,{includeFrontMatter:s,includeDescription:o,includeMetadata:n,includeTimestamps:l,includeProgress:c});let D=this.generateFileName(t,e,m),I=(0,We.normalizePath)(`${h}/${D}`);await this.ensureFolderExists(h);let T=await this.createOrUpdateFile(I,v);return a.info("Episode exported to note",I),a.methodExit("NoteExporter","exportEpisode"),T}generateDefaultNote(t,e,r,i){let s=[];return i.includeFrontMatter&&s.push(this.generateFrontMatter(t,e,r)),s.push(`# ${t.title}
`),i.includeMetadata&&s.push(this.generateMetadataSection(t,e)),i.includeProgress&&r&&s.push(this.generateProgressSection(r)),i.includeDescription&&s.push(this.generateDescriptionSection(t)),i.includeTimestamps&&s.push(this.generateTimestampsSection()),s.push(this.generateNotesSection()),s.join(`
`)}generateFrontMatter(t,e,r){let i={title:t.title,podcast:e.title,author:e.author,episodeNumber:t.episodeNumber,seasonNumber:t.seasonNumber,publishDate:Xe(t.publishDate),duration:Tt(t.duration),audioUrl:t.audioUrl,episodeId:t.id,podcastId:t.podcastId};r&&(i.progress=Math.round(r.position/r.duration*100),i.completed=r.completed,i.lastPlayed=Xe(r.lastPlayedAt)),t.guid&&(i.guid=t.guid),e.imageUrl&&(i.image=e.imageUrl);let s=["---"];for(let[o,n]of Object.entries(i))n!=null&&(typeof n=="string"?n.includes(":")?s.push(`${o}: "${n}"`):s.push(`${o}: ${n}`):typeof n=="number"||typeof n=="boolean"?s.push(`${o}: ${n}`):typeof n=="object"&&s.push(`${o}: ${JSON.stringify(n)}`));return s.push(`---
`),s.join(`
`)}generateMetadataSection(t,e){let r=[`## Episode Information
`,`**Podcast:** ${e.title}`,`**Author:** ${e.author}`,`**Published:** ${Xe(t.publishDate)}`,`**Duration:** ${Tt(t.duration)}`];return t.episodeNumber&&r.push(`**Episode:** ${t.episodeNumber}`),t.seasonNumber&&r.push(`**Season:** ${t.seasonNumber}`),t.episodeType&&r.push(`**Type:** ${t.episodeType}`),r.push(""),r.join(`
`)}generateProgressSection(t){let e=Math.round(t.position/t.duration*100);return[`## Listening Progress
`,`**Status:** ${t.completed?"Completed":"In Progress"}`,`**Progress:** ${e}%`,`**Last Played:** ${Xe(t.lastPlayedAt)}`,""].join(`
`)}generateDescriptionSection(t){return[`## Description
`,t.description,""].join(`
`)}generateTimestampsSection(){return[`## Timestamps
`,"<!-- Add your timestamps here -->","<!-- Example: [12:34] Topic discussion -->",""].join(`
`)}generateNotesSection(){return[`## Notes
`,"<!-- Add your notes here -->",""].join(`
`)}generateTemplateVariables(t,e,r){let i={episodeTitle:t.title,episodeDescription:t.description,podcastTitle:e.title,podcastAuthor:e.author,episodeNumber:t.episodeNumber,seasonNumber:t.seasonNumber,publishDate:Xe(t.publishDate),duration:Tt(t.duration),audioUrl:t.audioUrl,episodeUrl:t.guid,imageUrl:t.imageUrl||e.imageUrl};if(r){let s=Math.round(r.position/r.duration*100);i.progress=Tt(r.position),i.completionPercentage=`${s}%`}return i}applyTemplate(t,e){let r=t;for(let[i,s]of Object.entries(e))if(s!=null){let o=new RegExp(`{{${i}}}`,"g");r=r.replace(o,String(s))}return r}generateFileName(t,e,r){if(r){let o=this.generateTemplateVariables(t,e),n=this.applyTemplate(r,o);return n=this.sanitizeFileName(n),n.endsWith(".md")||(n+=".md"),n}let i=this.sanitizeFileName(e.title),s=this.sanitizeFileName(t.title);return`${i} - ${s}.md`}sanitizeFileName(t){return t.replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").trim()}async ensureFolderExists(t){let e=(0,We.normalizePath)(t);await this.vault.adapter.exists(e)||(await this.vault.createFolder(e),a.info("Created folder",e))}async createOrUpdateFile(t,e){let r=(0,We.normalizePath)(t),i=this.vault.getAbstractFileByPath(r);if(i instanceof We.TFile)return await this.vault.modify(i,e),a.info("Updated existing file",r),i;{let s=await this.vault.create(r,e);return a.info("Created new file",r),s}}async exportEpisodes(t,e={}){a.methodEntry("NoteExporter","exportEpisodes",`count=${t.length}`);let r=[];for(let{episode:i,podcast:s,progress:o}of t)try{let n=await this.exportEpisode(i,s,o,e);r.push(n)}catch(n){a.error(`Failed to export episode: ${i.title}`,n)}return a.info(`Exported ${r.length} episodes`),a.methodExit("NoteExporter","exportEpisodes"),r}async quickExport(t,e,r){return await this.exportEpisode(t,e,r,{includeFrontMatter:!0,includeDescription:!0,includeMetadata:!0,includeTimestamps:!0,includeProgress:!!r})}};var Qa={enabled:!0,intervalMs:24*60*60*1e3,completedRetentionDays:30,inProgressRetentionDays:90,maxCacheSizeMB:100},sr=class{constructor(t,e,r,i,s={}){this.intervalId=null;this.stats={completedRecordsRemoved:0,cacheEntriesRemoved:0,bytesFreed:0};this.progressStore=t,this.feedCacheStore=e,this.imageCacheStore=r,this.episodeManager=i,this.config={...Qa,...s}}start(){if(!this.config.enabled){a.info("Cleanup service is disabled");return}if(this.intervalId!==null){a.warn("Cleanup service is already running");return}a.info(`Starting cleanup service with interval: ${this.config.intervalMs}ms`),this.runCleanup().catch(t=>{a.error("Initial cleanup failed:",t)}),this.intervalId=window.setInterval(()=>{this.runCleanup().catch(t=>{a.error("Scheduled cleanup failed:",t)})},this.config.intervalMs)}stop(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null,a.info("Cleanup service stopped"))}async runCleanup(){a.info("Running cleanup...");let t=Date.now(),e={lastCleanupAt:new Date,completedRecordsRemoved:0,cacheEntriesRemoved:0,bytesFreed:0};try{let r=await this.cleanupCompletedProgress();e.completedRecordsRemoved+=r.removed;let i=await this.cleanupExpiredCache();e.cacheEntriesRemoved+=i.removed,e.bytesFreed+=i.bytesFreed;let s=await this.cleanupImageCache();e.cacheEntriesRemoved+=s.removed,e.bytesFreed+=s.bytesFreed,this.stats=e;let o=Date.now()-t;return a.info(`Cleanup completed in ${o}ms:`,e),e}catch(r){throw a.error("Cleanup failed:",r),r}}async cleanupCompletedProgress(){try{let t=new Date;t.setDate(t.getDate()-this.config.completedRetentionDays),a.debug(`Cleaning up completed episodes older than ${t.toISOString()}`);let e=await this.episodeManager.getCompletedEpisodes(),r=0;for(let i of e){if(!i.progress)continue;let s=i.progress.lastPlayedAt;s&&new Date(s)<t&&(await this.progressStore.removeProgress(i.id),r++,a.debug(`Removed progress for completed episode: ${i.title}`))}return a.info(`Removed ${r} old completed episode progress records`),{removed:r}}catch(t){return a.error("Failed to cleanup completed progress:",t),{removed:0}}}async cleanupExpiredCache(){try{let t=await this.feedCacheStore.getCacheStats();await this.feedCacheStore.cleanupExpired();let e=await this.feedCacheStore.getCacheStats(),r=t.totalEntries-e.totalEntries,i=t.totalSize-e.totalSize;return a.info(`Removed ${r} expired cache entries, freed ${i} bytes`),{removed:r,bytesFreed:i}}catch(t){return a.error("Failed to cleanup expired cache:",t),{removed:0,bytesFreed:0}}}async cleanupImageCache(){try{let t=await this.imageCacheStore.getCacheStats(),e=this.config.maxCacheSizeMB*1024*1024;if(t.totalSize<=e)return a.debug(`Image cache size (${t.totalSize} bytes) is within limit (${e} bytes)`),{removed:0,bytesFreed:0};a.info(`Image cache size (${t.totalSize} bytes) exceeds limit (${e} bytes), cleaning up...`);let r=t.totalSize,i=t.totalImages,s=Math.max(Math.floor(t.totalImages/2),100);await this.imageCacheStore.cleanupOldImages(s);let o=await this.imageCacheStore.getCacheStats(),n=i-o.totalImages,l=r-o.totalSize;return a.info(`Removed ${n} old images, freed ${l} bytes`),{removed:n,bytesFreed:l}}catch(t){return a.error("Failed to cleanup image cache:",t),{removed:0,bytesFreed:0}}}updateConfig(t){let e=this.config.enabled;this.config={...this.config,...t},e!==this.config.enabled?this.config.enabled?this.start():this.stop():this.config.enabled&&this.intervalId!==null&&(this.stop(),this.start())}getStats(){return{...this.stats}}getConfig(){return{...this.config}}};var Ba={autoBackupEnabled:!0,autoBackupIntervalMs:24*60*60*1e3,retentionDays:30},Ct=class{constructor(t,e,r,i,s,o,n={}){this.autoBackupInterval=null;this.lastBackupDate=null;this.vault=t,this.pathManager=e,this.subscriptionStore=r,this.progressStore=i,this.playlistStore=s,this.queueStore=o,this.config={...Ba,...n}}start(){this.autoBackupInterval||(a.info("Starting backup service"),this.checkAndRunDailyBackup(),this.autoBackupInterval=setInterval(()=>{this.checkAndRunDailyBackup()},60*60*1e3))}stop(){this.autoBackupInterval&&(clearInterval(this.autoBackupInterval),this.autoBackupInterval=null,a.info("Backup service stopped"))}async checkAndRunDailyBackup(){if(!this.config.autoBackupEnabled)return;let t=new Date().toISOString().split("T")[0];if(this.lastBackupDate!==t)try{a.info("Running daily auto-backup"),await this.createDailyBackup(),await this.cleanupOldBackups(),this.lastBackupDate=t,a.info("Daily auto-backup completed")}catch(e){a.error("Daily auto-backup failed",e)}}async exportOPML(){a.methodEntry("BackupService","exportOPML");let e=(await this.subscriptionStore.getAllPodcasts()).map(i=>`      <outline text="${this.escapeXml(i.title)}" title="${this.escapeXml(i.title)}" type="rss" xmlUrl="${this.escapeXml(i.feedUrl)}"${i.websiteUrl?` htmlUrl="${this.escapeXml(i.websiteUrl)}"`:""} />`).join(`
`),r=`<?xml version="1.0" encoding="UTF-8"?>
<opml version="2.0">
  <head>
    <title>Podcast Subscriptions</title>
    <dateCreated>${new Date().toUTCString()}</dateCreated>
    <docs>http://opml.org/spec2.opml</docs>
  </head>
  <body>
    <outline text="Podcasts" title="Podcasts">
${e}
    </outline>
  </body>
</opml>`;return a.methodExit("BackupService","exportOPML"),r}parseOPML(t){a.methodEntry("BackupService","parseOPML");let e=[],r=/xmlUrl\s*=\s*["']([^"']+)["']/gi,i;for(;(i=r.exec(t))!==null;){let s=this.unescapeXml(i[1]);s&&!e.includes(s)&&e.push(s)}return a.methodExit("BackupService","parseOPML"),e}async createFullBackup(t){a.methodEntry("BackupService","createFullBackup");let e=await this.subscriptionStore.getAllPodcasts(),r=await this.progressStore.getAllProgress(),i=await this.playlistStore.load(),s=await this.queueStore.load(),o={version:"1.0.0",createdAt:new Date().toISOString(),settings:t,podcasts:e,progress:r,playlists:i,queues:s};return a.methodExit("BackupService","createFullBackup"),o}async exportFullBackupJSON(t){let e=await this.createFullBackup(t);return JSON.stringify(e,null,2)}validateBackupData(t){if(!t||typeof t!="object")return!1;let e=t;return typeof e.version=="string"&&typeof e.createdAt=="string"&&typeof e.settings=="object"&&Array.isArray(e.podcasts)&&Array.isArray(e.progress)&&Array.isArray(e.playlists)&&Array.isArray(e.queues)}async createDailyBackup(){a.methodEntry("BackupService","createDailyBackup");let e=`daily-backup-${new Date().toISOString().split("T")[0]}.json`,r=this.pathManager.getFilePath("backups",e),i=this.vault.adapter;if(await i.exists(r))return a.info("Daily backup already exists",r),r;let s=await this.subscriptionStore.getAllPodcasts(),o=await this.progressStore.getAllProgress(),n=await this.playlistStore.load(),l=await this.queueStore.load(),c={version:"1.0.0",createdAt:new Date().toISOString(),type:"daily-auto",podcasts:s,progress:o,playlists:n,queues:l};return await i.write(r,JSON.stringify(c,null,2)),a.info("Daily backup created",r),a.methodExit("BackupService","createDailyBackup"),r}async cleanupOldBackups(){a.methodEntry("BackupService","cleanupOldBackups");let t=await this.pathManager.listFiles("backups"),e=new Date;e.setDate(e.getDate()-this.config.retentionDays);let r=e.getTime(),i=0,s=this.vault.adapter;for(let o of t)if((o.split("/").pop()||"").startsWith("daily-backup-"))try{let l=await s.stat(o);l&&l.mtime<r&&(await s.remove(o),i++,a.debug("Deleted old backup",o))}catch(l){a.warn("Failed to check/delete backup file",l)}return i>0&&a.info(`Cleaned up ${i} old backup(s)`),a.methodExit("BackupService","cleanupOldBackups"),i}async getAvailableBackups(){let t=await this.pathManager.listFiles("backups"),e=[],r=this.vault.adapter;for(let i of t){let s=i.split("/").pop()||"",o=await r.stat(i);o&&e.push({filename:s,date:new Date(o.mtime),size:o.size})}return e.sort((i,s)=>s.date.getTime()-i.date.getTime()),e}async deleteAllData(){a.methodEntry("BackupService","deleteAllData");let t=[],e=0;try{let r=await this.subscriptionStore.getAllPodcasts();for(let i of r)await this.subscriptionStore.removePodcast(i.id),e++;a.info("Cleared all subscriptions")}catch(r){let i="Failed to clear subscriptions";a.error(i,r),t.push(i)}try{let r=await this.pathManager.listFiles("subscriptions");for(let i of r)await this.vault.adapter.remove(i),e++;a.info("Cleared subscription files")}catch(r){let i="Failed to clear subscription files";a.error(i,r),t.push(i)}try{await this.progressStore.clearAll(),e++,a.info("Cleared all progress")}catch(r){let i="Failed to clear progress";a.error(i,r),t.push(i)}try{let r=await this.pathManager.listFiles("progress");for(let i of r)await this.vault.adapter.remove(i),e++;a.info("Cleared progress files")}catch(r){let i="Failed to clear progress files";a.error(i,r),t.push(i)}try{await this.playlistStore.clear(),e++,a.info("Cleared all playlists")}catch(r){let i="Failed to clear playlists";a.error(i,r),t.push(i)}try{await this.queueStore.clear(),e++,a.info("Cleared all queues")}catch(r){let i="Failed to clear queues";a.error(i,r),t.push(i)}try{let r=await this.pathManager.listFiles("backups");for(let i of r)await this.vault.adapter.remove(i),e++;a.info("Cleared all backups")}catch(r){let i="Failed to clear backups";a.error(i,r),t.push(i)}try{let r=await this.pathManager.listFiles("cacheFeed");for(let i of r)await this.vault.adapter.remove(i),e++;a.info("Cleared feed cache")}catch(r){let i="Failed to clear feed cache";a.error(i,r),t.push(i)}try{let r=await this.pathManager.listFiles("cacheImages");for(let i of r)await this.vault.adapter.remove(i),e++;a.info("Cleared image cache")}catch(r){let i="Failed to clear image cache";a.error(i,r),t.push(i)}return a.methodExit("BackupService","deleteAllData"),{success:t.length===0,deletedItems:e,errors:t}}escapeXml(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}unescapeXml(t){return t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'")}};var Fr=require("obsidian");var ar=class{constructor(t,e){this.app=t,this.settings=e}updateSettings(t){this.settings=t}async insertListeningLog(t,e,r,i){let s=i||new Date,o=window.moment(s),n=this.settings.dailyNoteDateFormat||"YYYY-MM-DD",l=o.format(n)+".md",c=this.settings.dailyNoteFolderPath||"",p=c?`${c}/${l}`:l,h=o.format("HH:mm:ss"),m=this.formatListeningLog(t,e,r,h),d=await this.ensureDailyNoteExists(p,c);if(d&&d instanceof Fr.TFile){let v=await this.app.vault.read(d),D=this.insertAfterHeader(v,m);await this.app.vault.modify(d,D),a.info("Listening log inserted into daily note")}}async ensureDailyNoteExists(t,e){var i,s;let r=this.app.vault.getAbstractFileByPath(t);if(!r){if((s=(i=this.app.internalPlugins)==null?void 0:i.getPluginById("daily-notes"))!=null&&s.enabled)try{this.app.commands.executeCommandById("daily-notes:goto-today"),await new Promise(o=>setTimeout(o,500))}catch(o){a.error("Failed to invoke daily notes command",o)}if(r=this.app.vault.getAbstractFileByPath(t),!r){let o=e?this.app.vault.getAbstractFileByPath(e):!0;e&&!o&&await this.app.vault.createFolder(e),r=await this.app.vault.create(t,"")}}return r instanceof Fr.TFile?r:null}insertAfterHeader(t,e){let i=(this.settings.dailyNoteHeader||"## \u{1F3A7} Listening Log").trim();if(t.includes(i)){let s=t.split(`
`),o=s.findIndex(n=>n.trim()===i);return o!==-1?(s.splice(o+1,0,"",e),s.join(`
`)):t+`

`+i+`

`+e}else return(this.settings.dailyNoteInsertPosition||"bottom")==="top"?i+`

`+e+`

`+t:t+(t.endsWith(`
`)?"":`
`)+`
`+i+`

`+e}formatListeningLog(t,e,r,i){let s=this.formatDuration(r);return`- **${i}** - Finished listening: [[${t}]] - ${e} (${s})`}formatDuration(t){let e=Math.floor(t/3600),r=Math.floor(t%3600/60);return e>0?`${e}h ${r}m`:`${r}m`}};var or=class extends It.Plugin{async onload(){a.info("Loading Podcasts plugin");let t=`${this.app.vault.configDir}/${ae.dataFolderPath}`;this.pathManager=new ze(this.app.vault,t),this.settingsStore=new et(this.app.vault,this.pathManager),await this.loadSettings(),await this.pathManager.ensureDirectories(),this.subscriptionStore=new Ke(this.app.vault,this.pathManager),this.progressStore=new Ze(this.app.vault,this.pathManager),this.playlistStore=new pt(this.app.vault,this.pathManager),this.queueStore=new gt(this.app.vault,this.pathManager),this.feedCacheStore=new tt(this.app.vault,this.pathManager),this.imageCacheStore=new rt(this.app.vault,this.pathManager),this.feedService=new Me(this.feedCacheStore),this.podcastService=new bt(this.feedService,this.subscriptionStore,this.imageCacheStore),this.episodeManager=new Et(this.progressStore,this.subscriptionStore),this.playlistManager=new ht(this.playlistStore,this.app),this.queueManager=new mt(this.queueStore,this.app),this.feedSyncManager=new Pt(this.feedService,this.subscriptionStore,this.queueManager,this.playlistManager,this.settings.feedUpdateInterval*60*1e3),this.playbackEngine=new wt,this.progressTracker=new St(this.progressStore),this.playerController=new Dt(this.playbackEngine,this.progressTracker),this.playerController.setSettingsProvider(async s=>{try{let o=await this.subscriptionStore.getPodcast(s);return o!=null&&o.settings?o.settings:this.settings.defaultPlaybackSettings}catch(o){return a.warn("Failed to get podcast settings",o),this.settings.defaultPlaybackSettings}});let e="stopped",r=null,i=1;this.playerController.setEventHandlers({onStateChange:s=>{var o,n;(s.status!==e||((o=s.currentEpisode)==null?void 0:o.id)!==r||s.playbackSpeed!==i)&&(e=s.status,r=((n=s.currentEpisode)==null?void 0:n.id)||null,i=s.playbackSpeed,this.app.workspace.trigger("podcast:player-state-updated",s))},onEpisodeChange:s=>{r=(s==null?void 0:s.id)||null,this.app.workspace.trigger("podcast:episode-changed",s)},onEpisodeEnded:s=>{(async()=>{try{let n=await this.subscriptionStore.getPodcast(s.podcastId),l=(n==null?void 0:n.title)||"Unknown Podcast";await this.dailyNoteService.insertListeningLog(l,s.title,s.duration)}catch(n){a.error("Failed to log to daily note",n)}let o=await this.queueManager.getCurrentQueue();if(o){let n=await this.queueManager.nextAndRemovePlayed(o.id);if(o.autoPlayNext&&n){let l=await this.episodeManager.getEpisodeWithProgress(n);l&&await this.playerController.loadEpisode(l,!0,!0)}this.app.workspace.trigger("podcast:queue-changed")}})()}}),this.registerEvent(this.app.workspace.on("podcast:queue-updated",s=>{(async()=>{let o=await this.queueManager.getQueue(s);if(o&&o.isPlaylist&&o.sourceId){let n=await this.playlistManager.getPlaylist(o.sourceId);if(n){let l=o.episodeIds,c=n.episodeIds;JSON.stringify(l)!==JSON.stringify(c)&&await this.playlistManager.updatePlaylist(n.id,{episodeIds:l})}}})()})),this.registerEvent(this.app.workspace.on("podcast:playlist-updated",s=>{(async()=>{let n=(await this.queueManager.getAllQueues()).find(l=>l.sourceId===s);if(n){let l=await this.playlistManager.getPlaylist(s);if(l){let c=n.episodeIds,p=l.episodeIds,h=`Playlist: ${l.name}`,m=n.name!==h,d=JSON.stringify(c)!==JSON.stringify(p);if(d||m){let v={};if(d&&(v.episodeIds=p),m&&(v.name=h),await this.queueManager.updateQueue(n.id,v),d){let D=n.episodeIds[n.currentIndex],I=p.indexOf(D);I!==-1?await this.queueManager.jumpTo(n.id,I):await this.queueManager.jumpTo(n.id,0)}}}}})()})),this.noteExporter=new xt(this.app.vault),this.cleanupService=new sr(this.progressStore,this.feedCacheStore,this.imageCacheStore,this.episodeManager,{enabled:!0,intervalMs:24*60*60*1e3,completedRetentionDays:30,inProgressRetentionDays:90,maxCacheSizeMB:100}),this.cleanupService.start(),this.backupService=new Ct(this.app.vault,this.pathManager,this.subscriptionStore,this.progressStore,this.playlistStore,this.queueStore,{autoBackupEnabled:!0,autoBackupIntervalMs:24*60*60*1e3,retentionDays:30}),this.backupService.start(),this.dailyNoteService=new ar(this.app,this.settings);try{this.registerView(Ne,s=>new at(s,this))}catch(s){a.warn(`View ${Ne} might be already registered`,s)}try{this.registerView(Oe,s=>new ct(s,this))}catch(s){a.warn(`View ${Oe} might be already registered`,s)}try{this.registerView(Re,s=>new dt(s,this))}catch(s){a.warn(`View ${Re} might be already registered`,s)}this.addSettingTab(new st(this.app,this)),this.miniPlayer=new ut(this),this.miniPlayer.onload(),this.addRibbonIcon("podcast","Podcasts",()=>{this.activateSidebarView(),this.activatePlayerView()}),this.addCommand({id:"open-player",name:"Open player",callback:()=>{this.activatePlayerView()}}),this.addCommand({id:"open-sidebar",name:"Open sidebar",callback:()=>{this.activateSidebarView()}}),this.addCommand({id:"subscribe",name:"Subscribe",callback:()=>{new qe(this.app,this,s=>{a.info(`Successfully subscribed to podcast: ${s}`),this.activateSidebarView()}).open()}}),this.addCommand({id:"open-playlists-queues",name:"Open playlists",callback:()=>{this.activatePlaylistQueueView()}}),a.info("Podcasts plugin loaded successfully")}onunload(){a.info("Unloading Podcasts plugin"),this.feedSyncManager&&this.feedSyncManager.stopAutoSync(),this.playerController&&this.playerController.stop(),this.cleanupService&&this.cleanupService.stop(),this.backupService&&this.backupService.stop(),this.miniPlayer&&this.miniPlayer.unload()}async loadSettings(){a.methodEntry("PodcastPlayerPlugin","loadSettings");try{this.settings=await this.settingsStore.loadWithMigration();let t=this.settings.dataFolderPath;(!t||t===ae.dataFolderPath)&&(t=`${this.app.vault.configDir}/${ae.dataFolderPath}`,this.settings.dataFolderPath=t),this.pathManager.updateBasePath(t),a.info("Settings loaded successfully")}catch(t){a.error("Failed to load settings, using defaults",t),this.settings={...ae,dataFolderPath:`${this.app.vault.configDir}/${ae.dataFolderPath}`}}a.methodExit("PodcastPlayerPlugin","loadSettings")}async saveSettings(){a.methodEntry("PodcastPlayerPlugin","saveSettings");try{await this.settingsStore.updateSettings(this.settings),this.pathManager.updateBasePath(this.settings.dataFolderPath),a.info("Settings saved successfully")}catch(t){a.error("Failed to save settings",t),new It.Notice("Failed to save settings")}a.methodExit("PodcastPlayerPlugin","saveSettings")}async resetSettings(){a.methodEntry("PodcastPlayerPlugin","resetSettings");try{await this.settingsStore.resetToDefaults(),this.settings={...ae,dataFolderPath:`${this.app.vault.configDir}/${ae.dataFolderPath}`},this.pathManager.updateBasePath(this.settings.dataFolderPath),a.info("Settings reset to defaults")}catch(t){a.error("Failed to reset settings",t),new It.Notice("Failed to reset settings")}a.methodExit("PodcastPlayerPlugin","resetSettings")}async activatePlayerView(){a.methodEntry("PodcastPlayerPlugin","activatePlayerView");let{workspace:t}=this.app,e=null,r=t.getLeavesOfType(Ne);r.length>0?e=r[0]:(e=t.getRightLeaf(!1),e&&await e.setViewState({type:Ne,active:!0})),e&&await t.revealLeaf(e),a.methodExit("PodcastPlayerPlugin","activatePlayerView")}async activateSidebarView(){a.methodEntry("PodcastPlayerPlugin","activateSidebarView");let{workspace:t}=this.app,e=null,r=t.getLeavesOfType(Oe);r.length>0?e=r[0]:(e=t.getLeftLeaf(!1),e&&await e.setViewState({type:Oe,active:!0})),e&&await t.revealLeaf(e),a.methodExit("PodcastPlayerPlugin","activateSidebarView")}getSubscriptionStore(){return this.subscriptionStore}getPodcastService(){return this.podcastService}getEpisodeManager(){return this.episodeManager}getPlaylistManager(){return this.playlistManager}getQueueManager(){return this.queueManager}getFeedSyncManager(){return this.feedSyncManager}getNoteExporter(){return this.noteExporter}getBackupService(){return this.backupService}getDailyNoteService(){return this.dailyNoteService}async activatePlaylistQueueView(){a.methodEntry("PodcastPlayerPlugin","activatePlaylistQueueView");let{workspace:t}=this.app,e=null,r=t.getLeavesOfType(Re);r.length>0?e=r[0]:(e=t.getRightLeaf(!1),e&&await e.setViewState({type:Re,active:!0})),e&&await t.revealLeaf(e),a.methodExit("PodcastPlayerPlugin","activatePlaylistQueueView")}};
/*! Bundled license information:

sax/lib/sax.js:
  (*! http://mths.be/fromcodepoint v0.1.0 by @mathias *)
*/
