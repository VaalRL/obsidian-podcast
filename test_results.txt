
> obsidian-podcasts@0.1.0 test
> jest src/queue/__tests__/QueueManager.test.ts

FAIL src/queue/__tests__/QueueManager.test.ts
  QueueManager
    createQueue
      ??should create a new queue with default values (10 ms)
      ??should generate a unique ID for each queue (6 ms)
    getQueue
      ??should retrieve a queue by ID (2 ms)
      ??should return null if queue does not exist (1 ms)
    getAllQueues
      ??should return all queues sorted by updated date (2 ms)
    addEpisode
      ??should add an episode to a queue (1 ms)
      ??should not add duplicate episode (1 ms)
      ??should throw error if queue does not exist (33 ms)
    addEpisodes
      ? should add multiple episodes to a queue (4 ms)
      ??should filter out duplicate episodes (2 ms)
    removeEpisode
      ??should remove an episode from a queue (1 ms)
      ??should adjust current index when removing earlier episode (1 ms)
    next
      ??should move to next episode (1 ms)
      ??should return null at end of queue when repeat is none (1 ms)
      ??should loop to first episode when repeat is all (1 ms)
      ??should repeat current episode when repeat is one (1 ms)
    previous
      ??should move to previous episode (1 ms)
      ??should stay at first episode when repeat is none (8 ms)
      ??should loop to last episode when repeat is all (1 ms)
    toggleShuffle
      ??should toggle shuffle from false to true (1 ms)
      ??should toggle shuffle from true to false (1 ms)
    cycleRepeat
      ??should cycle from none to one (1 ms)
      ??should cycle from one to all
      ??should cycle from all to none (1 ms)
    hasNext
      ??should return true when not at end of queue
      ??should return false at end of queue when repeat is none (1 ms)
      ??should return true at end of queue when repeat is all
    insertEpisode
      ??should insert episode at index (2 ms)
      ??should move existing episode to new position instead of duplicating (1 ms)
      ? should handle index adjustment when moving episode forward (5 ms)

  ??QueueManager ??addEpisodes ??should add multiple episodes to a queue

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"episodeIds": ["ep1", "ep2", "ep3"]}

    Number of calls: 0

      197 | 			mockQueueStore.getQueue.mockResolvedValue({ ...testQueue });
      198 |
    > 199 | 			expect(mockQueueStore.saveQueue).toHaveBeenCalledWith(expect.objectContaining({
          | 			                                 ^
      200 | 				episodeIds: ['ep1', 'ep2', 'ep3'],
      201 | 			}));
      202 | 		});

      at src/queue/__tests__/QueueManager.test.ts:199:37
      at node_modules/tslib/tslib.js:170:75
      at Object.__awaiter (node_modules/tslib/tslib.js:166:16)
      at Object.<anonymous> (src/queue/__tests__/QueueManager.test.ts:184:60)

  ??QueueManager ??insertEpisode ??should handle index adjustment when moving episode forward

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"episodeIds": ["ep2", "ep3", "ep1"]}
    Received: {"autoPlayNext": true, "createdAt": 2025-12-24T07:25:10.256Z, "currentIndex": 0, "episodeIds": ["ep2", "ep1", "ep3"], "id": "queue-123", "name": "Test Queue", "repeat": "none", "shuffle": false, "updatedAt": 2025-12-24T07:25:10.256Z}

    Number of calls: 1

      662 | 			await queueManager.insertEpisode('queue-123', 'ep1', 2);
      663 |
    > 664 | 			expect(mockQueueStore.saveQueue).toHaveBeenCalledWith(expect.objectContaining({
          | 			                                 ^
      665 | 				episodeIds: ['ep2', 'ep3', 'ep1'],
      666 | 			}));
      667 | 		});

      at src/queue/__tests__/QueueManager.test.ts:664:37
      at fulfilled (node_modules/tslib/tslib.js:167:62)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 28 passed, 30 total
Snapshots:   0 total
Time:        1.608 s, estimated 3 s
Ran all test suites matching /src\\queue\\__tests__\\QueueManager.test.ts/i.
